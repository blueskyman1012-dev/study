# 오답헌터 1.31일 요약본

> 2026.01.31 작업 내역 요약

---

## 1. 버그 수정

### 한 몬스터에서 같은 문제만 반복되는 버그
- `nextMonster()`에서 `questions` 배열 깊은 복사 + `currentQuestionIndex` 초기화
- `selectNextQuestion()`에서 순차 선택 → 현재와 다른 문제 랜덤 선택으로 변경
- `onWrongAnswer()`에서도 `selectNextQuestion()` 호출 추가 (오답 시에도 문제 교체)
- AI 생성 문제가 현재 전투 중인 몬스터에도 실시간 반영되도록 동기화
- 문제가 1개뿐인 몬스터는 다른 몬스터의 문제를 최대 5개까지 가져와서 풀 확보 (`_fillQuestionsFromOtherMonsters`)

### 효과음 토글 시 클릭음 나는 버그
- `toggleSfx`/`toggleBgm` 버튼 클릭 시 `playClick()` 생략, 콜백만 실행

---

## 2. 상점 UI 재배치

- 헤더 60→50px 축소, 골드 표시에 배경 뱃지 추가
- 영구 강화 카드 70→55px, 간격 80→62px 축소
- 레벨 표시를 게이지 바(프로그레스 바)로 변경
- 소비 아이템 카드 60→50px, 간격 70→57px 축소
- 보유량 "보유: 0" → `×3` 뱃지 형태로 변경
- 영구 강화 / 소비 아이템 사이 구분선 추가
- 전체 캔버스 700px 안에 들어가도록 조정

---

## 3. 몬스터 아이콘 & 이름 개선

### 아이콘 6종 순환
- 👾 💀 🦇 🧟 👻 🕷️ (스테이지 번호 기반 순환)

### 아이콘-이름 연동 (과목별)
| 아이콘 | 수학 | 영어 | 국어 | 과학 |
|--------|------|------|------|------|
| 👾 | 슬라임 | 블롭 | 물령 | 젤리 |
| 💀 | 해골병사 | 스켈레톤 | 백골 | 본가드 |
| 🦇 | 박쥐 | 배트 | 야차 | 플라잉 |
| 🧟 | 좀비 | 언데드 | 강시 | 뮤턴트 |
| 👻 | 유령 | 고스트 | 원귀 | 스펙터 |
| 🕷️ | 거미 | 스파이더 | 독충 | 아라크네 |

### 문제 키워드 기반 이름
- `topic` 또는 문제 텍스트에서 키워드 추출 → "방정식 슬라임", "인수분해 유령" 등

---

## 4. 보스 난이도 보장

- 보스 스테이지 진입 시 `_ensureBossDifficulty()` 호출
- 현재 문제 난이도 ≥ 2(중) → 그대로 사용
- 아니면 questions 배열 → 전체 몬스터 풀에서 난이도 2 이상 검색
- 그래도 없으면 AI로 난이도 3(어려움) 문제 생성 (`_generateBossQuestion`)

---

## 5. 오답 패널티 & 보상

### 같은 문제 2회 이상 오답 → 몬스터 HP 풀 회복
- 문제별 오답 횟수를 `_wrongCounts`로 추적
- 2번째 틀리면 `hp = maxHp` + "몬스터 체력 회복!" 텍스트

### 오답 시 시간 +50초 (최대시간 제한)
- `timer = Math.min(timer + 50, maxTime)` — 남은 시간에 50초 추가, 최대시간 초과 불가

---

## 6. 사운드 시스템

### 오답 효과음 강화
- 기존: 단순 하강음 2음
- 변경: 불협화음 2음 동시 → 급하강 → 저음 마무리 (3단계)

### 로비 BGM 추가
- Web Audio API로 생성한 다크+네온 분위기 루프
- Am-F-C-G 코드 진행: 패드(triangle) + 아르페지오(sine) + 베이스(sawtooth+로우패스)
- 자동 루프 반복, AudioContext suspended 상태 resume 처리

### BGM / 효과음 개별 토글
- `SoundService`에 `sfxEnabled`, `bgmEnabled` 분리 (localStorage 저장)
- 로비 하단에 `🎵 BGM ON/OFF`, `🔊 효과음 ON/OFF` 버튼 추가
- 메인 화면 진입 → BGM 시작, 전투 화면 진입 → BGM 정지
- 첫 터치 시 Web Audio API 초기화 + BGM 자동 시작

---

## 수정 파일 목록

| 파일 | 주요 변경 |
|------|-----------|
| `app/src/game/Game.js` | 문제 선택 로직, 상점 UI, 몬스터 이름/아이콘, 보스 난이도, 오답 패널티, BGM 연동, 사운드 토글 |
| `app/src/services/SoundService.js` | 오답 효과음 개선, BGM 시스템, sfx/bgm 개별 토글 |
