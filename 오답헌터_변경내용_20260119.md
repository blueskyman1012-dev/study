# 오답헌터 변경 내용 (2026-01-19)

## 1. 서비스 배포 설정

### ngrok 외부 접속 설정
- ngrok 설치 및 authtoken 설정
- `vite.config.js`에 `allowedHosts` 추가하여 외부 접속 허용
- 포트: 9333

### start.bat 업데이트
- Dev Server와 ngrok을 별도 창에서 실행
- 포트 5173 → 9333으로 변경

---

## 2. 오답 등록 기능 개선

### 카메라 기능 (iOS/Android 호환)
- **iOS**: HTML `<label>` + `<input type="file">` 방식으로 카메라 열기
- **Android**: `getUserMedia` API로 직접 카메라 열기
- 카메라 모달 UI 추가 (촬영/닫기 버튼)

### 등록 흐름 변경
**기존**: 과목 선택 → 카메라 → 등록
**변경**: 오답등록 클릭 → 카메라 즉시 열림 → 사진 촬영 → 과목 선택 → 등록

### AI 분석 기능 (Gemini)
- Gemini Vision API 연동 시도
- API 문제로 현재 **수동 입력 방식**으로 전환
- 추후 API 안정화 시 재적용 가능

---

## 3. 게임 플레이 개선

### 선택지 랜덤화
- 같은 문제라도 매번 선택지 순서가 랜덤하게 변경
- Fisher-Yates 알고리즘 적용

### 오답 자동 생성
- "오답1, 오답2, 오답3" 대신 의미있는 오답 생성
- 숫자 정답: 비슷한 숫자로 오답 생성 (예: 정답 5 → 오답 7, 3, 10)
- 텍스트 정답: 1~100 사이 랜덤 숫자 사용

---

## 4. 수정된 파일 목록

| 파일 | 변경 내용 |
|------|-----------|
| `start.bat` | ngrok 실행 추가, 포트 변경 |
| `vite.config.js` | allowedHosts 설정 |
| `index.html` | 카메라 모달, 파일 입력 추가 |
| `src/style.css` | 카메라 모달 스타일, 버튼 스타일 |
| `src/main.js` | iOS/Android 카메라 처리 분기 |
| `src/game/Game.js` | 등록 흐름 변경, 선택지 랜덤화, 오답 생성 |
| `src/services/GeminiService.js` | Vision API 연동 (현재 미사용) |

---

## 5. 접속 방법

```
로컬: http://localhost:9333
외부: ngrok URL (실행 시 생성됨)
```

### 실행 방법
```bash
# cmd에서 실행
cd C:\hjkim\app
npm run dev

# 별도 cmd에서 ngrok 실행
ngrok http 9333
```

---

## 6. 상점 시스템 추가

### 상점 화면
- 메인 화면에 🏪 상점 버튼 추가
- 영구 강화와 소비 아이템 구매 가능

### 영구 강화 (골드로 구매, 영구 적용)

| 강화 | 효과 | 기본 가격 | 최대 레벨 |
|------|------|-----------|-----------|
| ❤️ HP 강화 | 최대 HP +10 | 100G (+50G/레벨) | 10 |
| ⏱️ 시간 강화 | 제한 시간 +2초 | 150G (+75G/레벨) | 5 |
| 💰 골드 보너스 | 골드 획득 +10% | 200G (+100G/레벨) | 5 |
| ⚔️ 공격력 강화 | 기본 데미지 +5 | 250G (+125G/레벨) | 5 |

### 소비 아이템 (골드로 구매, 사용 시 소모)

| 아이템 | 효과 | 가격 |
|--------|------|------|
| 🪶 부활권 | 사망 시 HP 50% 회복 후 부활 | 500G |
| 💡 힌트권 | 힌트 1회 무료 사용 | 100G |
| ⏰ 시간 연장 | 전투 중 버튼 클릭 시 현재 문제 +60초 | 200G |
| ✨ 골드 2배 | 다음 런 골드 획득 2배 | 500G |

### 아이템 사용 시점
- **부활권**: HP가 0이 되면 자동 사용
- **힌트권**: 힌트 버튼 클릭 시 골드 대신 사용
- **시간 연장**: 전투 화면에서 ⏰ 버튼 클릭 시 현재 문제에 +60초 (수동 사용)
- **골드 2배**: 던전 입장 시 자동 사용

### 전투 화면 하단 버튼 (4개)
- 💡힌트: 힌트권 사용 또는 골드 50G로 정답 위치 확인
- ⏰시간연장: 보유 개수 표시, 클릭 시 현재 문제 +60초
- ⏭️스킵: 콤보 초기화 후 다음 문제로
- 🚪포기: 현재 런 종료

### 메인 화면 인벤토리 표시
- 보유 중인 소비 아이템 수량 표시 (🪶, 💡)

---

## 7. 수정된 파일 목록 (상점 추가)

| 파일 | 변경 내용 |
|------|-----------|
| `src/utils/constants.js` | UPGRADES, SHOP_ITEMS 상수 추가 |
| `src/game/Game.js` | 상점 화면, 구매 기능, 아이템 사용 로직 추가 |

---

## 8. 메인 화면 UI 개선

### HP 자동 회복
- 메인 화면 진입 시 HP 항상 풀 회복
- 런 종료 시 HP 풀 회복
- 게임 로드 시 HP 풀 회복

### 메인 화면 레이아웃 재배열

```
┌─────────────────────────────────┐
│         오답헌터                 │  ← 타이틀
│     로그라이크 학습 RPG          │
├─────────────────────────────────┤
│ ┌────┐  EXP [████████──] 50/100 │  ← 플레이어 카드
│ │ LV │                💰 1,500G │
│ │  5 │                          │
│ └────┘                          │
│ ❤️ HP [████████████████] 120/120│
├─────────────────────────────────┤
│ ⚔️34  ⏱️100초  👾5  🪶2 💡3    │  ← 스탯 & 인벤토리
├─────────────────────────────────┤
│      ⚔️ 던전 입장                │  ← 버튼들
│      📷 오답 등록                │
│  🏪 상점      ⚙️ 설정           │
│      🤖 AI 수학문제 생성         │
│                                 │
│     내 오답이 몬스터가 된다!     │  ← 슬로건
└─────────────────────────────────┘
```

### 수정된 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/game/Game.js` | 메인 화면 UI 재배열, HP 자동 회복 |
| `src/main.js` | 오답등록 버튼 위치 조정 |

---

## 9. 적응형 난이도 시스템

### 정답률 기반 난이도 조절
- 런 진행 중 정답률을 실시간 추적
- 5문제 이상 풀면 적응형 난이도 적용

### 난이도 조절 규칙

| 정답률 | 효과 |
|--------|------|
| 80% 이상 | 어려운 문제 우선 출제 (70% 확률) |
| 50~80% | 랜덤 출제 (모든 난이도 균등) |
| 50% 미만 | 쉬운 문제 우선 출제 (70% 확률) |

### UI 표시
- **전투 화면**: 스테이지 옆에 정답률 표시 (5문제 이상 풀었을 때)
  - 80% 이상: 빨간색 ↑ 표시 (어려운 문제 출제 중)
  - 50% 미만: 초록색 ↓ 표시 (쉬운 문제 출제 중)
- **결과 화면**: 최종 정답률 표시 (정답/총문제)

### 문제 난이도 분류
- **쉬움 (1)**: 기초 문제, 단순 계산
- **보통 (2)**: 표준 문제
- **어려움 (3)**: 응용 문제, 복합 계산

### 수정된 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/game/Game.js` | 정답률 추적, 적응형 난이도 선택, UI 표시 |

---

## 10. 시각 효과 및 연출 강화

### 이펙트 시스템 추가
- **파티클 시스템**: 몬스터 처치, 콤보 달성 시 파티클 폭발
- **플로팅 텍스트**: 데미지 숫자, 골드 획득, 콤보 표시
- **화면 흔들림**: 오답 시, 보스 등장 시 화면 쉐이크
- **화면 플래시**: 정답(초록), 오답(빨강), 처치(흰색)

### 정답/오답 연출
| 이벤트 | 효과 |
|--------|------|
| 정답 | 초록색 플래시 + 데미지 숫자 표시 |
| 오답 | 빨간색 플래시 + 화면 흔들림 + 피해 숫자 표시 |
| 골드 획득 | 우측 상단에 "+XXG" 텍스트 떠오름 |
| 콤보 3+ | 콤보 텍스트 중앙에 표시 |
| 콤보 5+ | 콤보 텍스트 + 파티클 폭발 |

### 보스 연출
- **등장 시**: 화면 흔들림 + 빨간색 플래시 + 아이콘 확대 애니메이션
- **보스 테두리**: 펄스 애니메이션 (밝기 변화)
- **처치 시**: 보스 등급별 다른 색상/개수의 파티클

### 몬스터 애니메이션
- **호흡 효과**: 아이콘 배경 원이 부드럽게 확대/축소
- **보스 입장**: 아이콘이 확대되며 등장

### HP바/타이머 개선
- **HP바 그라데이션**: 입체감 있는 3단계 색상 그라데이션
- **HP바 하이라이트**: 상단에 빛 반사 효과
- **타이머 바**: 시간에 따라 색상 변화 (초록→노랑→빨강)
- **위험 경고**: 25% 이하 시 타이머 깜빡임

### 수정된 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/game/Game.js` | 이펙트 시스템, 파티클, 플로팅 텍스트, 화면 효과 |
| `src/canvas/Renderer.js` | HP바 그라데이션, 타이머 바, 색상 유틸리티 |
