(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class Ve{constructor(){this.db=null,this.DB_NAME="OdapHunterDB",this.DB_VERSION=1}async open(){return new Promise((e,t)=>{const n=indexedDB.open(this.DB_NAME,this.DB_VERSION);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.db=n.result,e(this.db)},n.onupgradeneeded=s=>{const i=s.target.result;this.createStores(i)}})}createStores(e){if(e.objectStoreNames.contains("player")||e.createObjectStore("player",{keyPath:"id"}),!e.objectStoreNames.contains("monsters")){const t=e.createObjectStore("monsters",{keyPath:"id",autoIncrement:!0});t.createIndex("subject","subject"),t.createIndex("status","status"),t.createIndex("createdAt","createdAt")}e.objectStoreNames.contains("items")||e.createObjectStore("items",{keyPath:"id"}),e.objectStoreNames.contains("runs")||e.createObjectStore("runs",{keyPath:"id",autoIncrement:!0}).createIndex("date","startTime")}async add(e,t){return this._transaction(e,"readwrite",n=>n.add(t))}async get(e,t){return this._transaction(e,"readonly",n=>n.get(t))}async getAll(e){return this._transaction(e,"readonly",t=>t.getAll())}async put(e,t){return this._transaction(e,"readwrite",n=>n.put(t))}async delete(e,t){return this._transaction(e,"readwrite",n=>n.delete(t))}async clear(e){return this._transaction(e,"readwrite",t=>t.clear())}async getByIndex(e,t,n){return this._transaction(e,"readonly",s=>s.index(t).getAll(n))}_transaction(e,t,n){return new Promise((s,i)=>{const r=this.db.transaction(e,t).objectStore(e),d=n(r);d.onsuccess=()=>s(d.result),d.onerror=()=>i(d.error)})}}const R={MAIN:"main",BATTLE:"battle",RESULT:"result",SHOP:"shop",REGISTER:"register",DUNGEON_SELECT:"dungeon_select",SETTINGS:"settings",STATS:"stats",ACHIEVEMENT:"achievement"},P={CANVAS_WIDTH:400,CANVAS_HEIGHT:700,DEFAULT_HP:100,DEFAULT_TIME:60,DEFAULT_DAMAGE:34,STAGES_PER_DUNGEON:100},B={expPerLevel:c=>Math.round(100*Math.pow(1.1,c-1)/10)*10,hpPerLevel:1,damagePerLevels:5,damageLevelInterval:5,timePerLevels:5,timeLevelInterval:10,expPerCorrect:5,expPerMonsterKill:20,expPerNormalBoss:50,expPerMidBoss:150,expPerFinalBoss:350,maxLevel:100,displayMaxLevel:99},Te={NORMAL_BOSS:{stages:[10,20,30,40,60,70,80,90],hpMultiplier:2,damageMultiplier:1.5,goldMultiplier:3,icon:"ğŸ‘¹",nameKey:"boss"},MID_BOSS:{stages:[50],hpMultiplier:3.5,damageMultiplier:2,goldMultiplier:5,icon:"ğŸ‘¿",nameKey:"midBoss"},FINAL_BOSS:{stages:[100],hpMultiplier:5,damageMultiplier:2.5,goldMultiplier:10,icon:"ğŸ‰",nameKey:"finalBoss"}},u={BG_PRIMARY:"#0a0a0f",BG_SECONDARY:"#12121a",BG_CARD:"#1a1a24",ACCENT:"#6366f1",ACCENT_LIGHT:"#818cf8",TEXT_PRIMARY:"#e2e8f0",TEXT_SECONDARY:"#94a3b8",SUCCESS:"#22c55e",DANGER:"#ef4444",WARNING:"#fbbf24",HP_PLAYER:"#22c55e",HP_ENEMY:"#ef4444"},Y={MATH:{id:"math",nameKey:"math",icon:"ğŸ“",color:"#6366f1"},ENGLISH:{id:"english",nameKey:"english",icon:"ğŸ“–",color:"#22c55e"},KOREAN:{id:"korean",nameKey:"korean",icon:"ğŸ“š",color:"#ef4444"},SCIENCE:{id:"science",nameKey:"science",icon:"ğŸ”¬",color:"#fbbf24"}},Z={NORMAL:{id:"normal",nameKey:"rarityNormal",color:"#ffffff",dropRate:.45},RARE:{id:"rare",nameKey:"rarityRare",color:"#3b82f6",dropRate:.35},EPIC:{id:"epic",nameKey:"rarityEpic",color:"#a855f7",dropRate:.17},LEGENDARY:{id:"legendary",nameKey:"rarityLegendary",color:"#fbbf24",dropRate:.03}},Oe={MONSTER:.05,BOSS:.35},X={hp:{nameKey:"hpUpgrade",icon:"â¤ï¸",descKey:"hpUpgradeDesc",basePrice:500,priceIncrease:300,maxLevel:10,value:10},time:{nameKey:"timeUpgrade",icon:"â±ï¸",descKey:"timeUpgradeDesc",basePrice:800,priceIncrease:500,maxLevel:5,value:3},goldBonus:{nameKey:"goldBonus",icon:"ğŸ’°",descKey:"goldBonusDesc",basePrice:1e3,priceIncrease:800,maxLevel:30,value:5,priceAccelStart:10,priceAccelInterval:5,priceAccelStep:.05},damage:{nameKey:"damageUpgrade",icon:"âš”ï¸",descKey:"damageUpgradeDesc",basePrice:900,priceIncrease:1e3,maxLevel:10,value:5}},Ie={reviveTicket:{id:"reviveTicket",nameKey:"reviveTicket",icon:"ğŸª¶",descKey:"reviveTicketDesc",price:500,hintKey:"reviveTicketHint"},hintTicket:{id:"hintTicket",nameKey:"hintTicket",icon:"ğŸ’¡",descKey:"hintTicketDesc",price:100,hintKey:"hintTicketHint"},timeBoost:{id:"timeBoost",nameKey:"timeBoost",icon:"â°",descKey:"timeBoostDesc",price:200,hintKey:"timeBoostHint"},doubleGold:{id:"doubleGold",nameKey:"doubleGold",icon:"âœ¨",descKey:"doubleGoldDesc",price:500,hintKey:"doubleGoldHint"},randomBg:{id:"randomBg",nameKey:"randomBg",icon:"ğŸ¨",descKey:"randomBgDesc",price:1}},ke={theme:{nameKey:"cosmetic_themes",icon:"ğŸ¨",items:[{id:"emerald",nameKey:"theme_emerald",price:100,color:"#34d399"},{id:"crimson",nameKey:"theme_crimson",price:100,color:"#f87171"},{id:"amber",nameKey:"theme_amber",price:100,color:"#fbbf24"},{id:"violet",nameKey:"theme_violet",price:100,color:"#a78bfa"},{id:"cyan",nameKey:"theme_cyan",price:100,color:"#22d3ee"},{id:"rose",nameKey:"theme_rose",price:100,color:"#fb7185"}]},particle:{nameKey:"cosmetic_particle",icon:"âœ¨",items:[{id:"default",nameKey:"cosmetic_particle_default",price:0},{id:"gold",nameKey:"cosmetic_particle_gold",price:200,colors:["#fbbf24","#f59e0b","#d97706","#fcd34d"]},{id:"rainbow",nameKey:"cosmetic_particle_rainbow",price:300,colors:["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6"]},{id:"sakura",nameKey:"cosmetic_particle_sakura",price:300,colors:["#fda4af","#fb7185","#f472b6","#fecdd3"]}]},damageText:{nameKey:"cosmetic_damageText",icon:"ğŸ’¥",items:[{id:"default",nameKey:"cosmetic_dmg_default",price:0},{id:"neon",nameKey:"cosmetic_dmg_neon",price:150,color:"#00ffff",glow:!0},{id:"pixel",nameKey:"cosmetic_dmg_pixel",price:150,fontScale:1.4}]},correctFlash:{nameKey:"cosmetic_flash",icon:"âš¡",items:[{id:"default",nameKey:"cosmetic_flash_default",price:0,color:"#22c55e"},{id:"blue",nameKey:"cosmetic_flash_blue",price:100,color:"#3b82f6"},{id:"purple",nameKey:"cosmetic_flash_purple",price:100,color:"#a855f7"}]}},Ne=[{id:"combo_3",nameKey:"achv_combo_3",descKey:"achv_combo_3_desc",icon:"ğŸ”¥",category:"combo",condition:{type:"combo",value:10},reward:50},{id:"combo_5",nameKey:"achv_combo_5",descKey:"achv_combo_5_desc",icon:"ğŸ”¥",category:"combo",condition:{type:"combo",value:20},reward:100},{id:"combo_10",nameKey:"achv_combo_10",descKey:"achv_combo_10_desc",icon:"ğŸ”¥",category:"combo",condition:{type:"combo",value:50},reward:300},{id:"combo_20",nameKey:"achv_combo_20",descKey:"achv_combo_20_desc",icon:"ğŸ”¥",category:"combo",condition:{type:"combo",value:100},reward:1e3},{id:"combo_500",nameKey:"achv_combo_500",descKey:"achv_combo_500_desc",icon:"ğŸ”¥",category:"combo",condition:{type:"combo",value:500},reward:5e3},{id:"first_clear",nameKey:"achv_first_clear",descKey:"achv_first_clear_desc",icon:"â­",category:"run",condition:{type:"clear",value:1},reward:200,rewardExp:30},{id:"clear_10",nameKey:"achv_clear_10",descKey:"achv_clear_10_desc",icon:"â­",category:"run",condition:{type:"clear",value:20},reward:500,rewardExp:80},{id:"clear_50",nameKey:"achv_clear_50",descKey:"achv_clear_50_desc",icon:"â­",category:"run",condition:{type:"clear",value:80},reward:2e3,rewardExp:200},{id:"perfect_run",nameKey:"achv_perfect_run",descKey:"achv_perfect_run_desc",icon:"ğŸ’",category:"run",condition:{type:"perfect_run"},reward:1e3,rewardExp:150},{id:"boss_normal",nameKey:"achv_boss_normal",descKey:"achv_boss_normal_desc",icon:"ğŸ‘¹",category:"boss",condition:{type:"boss",value:"NORMAL_BOSS"},reward:100,rewardExp:50},{id:"boss_mid",nameKey:"achv_boss_mid",descKey:"achv_boss_mid_desc",icon:"ğŸ‘¿",category:"boss",condition:{type:"boss",value:"MID_BOSS"},reward:300,rewardExp:120},{id:"boss_final",nameKey:"achv_boss_final",descKey:"achv_boss_final_desc",icon:"ğŸ‰",category:"boss",condition:{type:"boss",value:"FINAL_BOSS"},reward:500,rewardExp:300},{id:"level_10",nameKey:"achv_level_10",descKey:"achv_level_10_desc",icon:"ğŸ“ˆ",category:"level",condition:{type:"level",value:10},reward:200},{id:"level_25",nameKey:"achv_level_25",descKey:"achv_level_25_desc",icon:"ğŸ“ˆ",category:"level",condition:{type:"level",value:25},reward:500},{id:"level_50",nameKey:"achv_level_50",descKey:"achv_level_50_desc",icon:"ğŸ“ˆ",category:"level",condition:{type:"level",value:50},reward:1500},{id:"level_99",nameKey:"achv_level_99",descKey:"achv_level_99_desc",icon:"ğŸ‘‘",category:"level",condition:{type:"level",value:99},reward:5e3},{id:"level_100",nameKey:"achv_level_100",descKey:"achv_level_100_desc",icon:"ğŸŒŸ",category:"level",condition:{type:"level",value:100},reward:1e4,hidden:!0},{id:"gold_1000",nameKey:"achv_gold_1000",descKey:"achv_gold_1000_desc",icon:"ğŸ’°",category:"gold",condition:{type:"gold",value:1e3},reward:100},{id:"gold_10000",nameKey:"achv_gold_10000",descKey:"achv_gold_10000_desc",icon:"ğŸ’°",category:"gold",condition:{type:"gold",value:1e4},reward:500},{id:"gold_100000",nameKey:"achv_gold_100000",descKey:"achv_gold_100000_desc",icon:"ğŸ’°",category:"gold",condition:{type:"gold",value:1e5},reward:3e3},{id:"kills_50",nameKey:"achv_kills_50",descKey:"achv_kills_50_desc",icon:"âš”ï¸",category:"kills",condition:{type:"kills",value:50},reward:200},{id:"kills_100",nameKey:"achv_kills_100",descKey:"achv_kills_100_desc",icon:"âš”ï¸",category:"kills",condition:{type:"kills",value:100},reward:500},{id:"kills_500",nameKey:"achv_kills_500",descKey:"achv_kills_500_desc",icon:"âš”ï¸",category:"kills",condition:{type:"kills",value:500},reward:2e3},{id:"master_math",nameKey:"achv_master_math",descKey:"achv_master_math_desc",icon:"ğŸ“",category:"subject",condition:{type:"subject",value:"math",count:150},reward:300},{id:"master_science",nameKey:"achv_master_science",descKey:"achv_master_science_desc",icon:"ğŸ”¬",category:"subject",condition:{type:"subject",value:"science",count:150},reward:300},{id:"answer_100",nameKey:"achv_answer_100",descKey:"achv_answer_100_desc",icon:"âœ…",category:"study",condition:{type:"answers",value:100},reward:200},{id:"answer_500",nameKey:"achv_answer_500",descKey:"achv_answer_500_desc",icon:"âœ…",category:"study",condition:{type:"answers",value:500},reward:1e3},{id:"damage_100",nameKey:"achv_damage_100",descKey:"achv_damage_100_desc",icon:"âš”ï¸",category:"power",condition:{type:"damage",value:100},reward:500,rewardBonusDamage:1},{id:"hp_500",nameKey:"achv_hp_500",descKey:"achv_hp_500_desc",icon:"â¤ï¸",category:"power",condition:{type:"hp",value:500},reward:500,rewardBonusHp:1}],Qe=[{id:"correct_10",nameKey:"dm_correct_10",target:10,event:"correctAnswer",reward:{gold:40,exp:20}},{id:"combo_5",nameKey:"dm_combo_5",target:5,event:"combo",reward:{gold:40,exp:20}},{id:"earn_100",nameKey:"dm_earn_100",target:100,event:"goldEarned",reward:{gold:30,exp:15}},{id:"correct_20",nameKey:"dm_correct_20",target:20,event:"correctAnswer",reward:{gold:80,exp:50}},{id:"defeat_3",nameKey:"dm_defeat_3",target:3,event:"monsterDefeated",reward:{gold:70,exp:40}},{id:"combo_10",nameKey:"dm_combo_10",target:10,event:"combo",reward:{gold:80,exp:50}},{id:"answer_30",nameKey:"dm_answer_30",target:30,event:"totalAnswers",reward:{gold:70,exp:40}},{id:"defeat_5",nameKey:"dm_defeat_5",target:5,event:"monsterDefeated",reward:{gold:120,exp:80}},{id:"earn_500",nameKey:"dm_earn_500",target:500,event:"goldEarned",reward:{gold:100,exp:60}},{id:"clear_1",nameKey:"dm_clear_1",target:1,event:"dungeonClear",reward:{gold:150,exp:100}}],Je=[{id:"wm_correct_150",nameKey:"wm_correct_150",target:150,event:"correctAnswer",reward:{gold:250,exp:150}},{id:"wm_defeat_30",nameKey:"wm_defeat_30",target:30,event:"monsterDefeated",reward:{gold:300,exp:180}},{id:"wm_earn_3000",nameKey:"wm_earn_3000",target:3e3,event:"goldEarned",reward:{gold:250,exp:150}},{id:"wm_correct_300",nameKey:"wm_correct_300",target:300,event:"correctAnswer",reward:{gold:500,exp:350}},{id:"wm_defeat_50",nameKey:"wm_defeat_50",target:50,event:"monsterDefeated",reward:{gold:550,exp:350}},{id:"wm_combo_50",nameKey:"wm_combo_50",target:50,event:"combo",reward:{gold:450,exp:300}},{id:"wm_answer_200",nameKey:"wm_answer_200",target:200,event:"totalAnswers",reward:{gold:500,exp:350}},{id:"wm_combo_100",nameKey:"wm_combo_100",target:100,event:"combo",reward:{gold:700,exp:500}},{id:"wm_earn_7000",nameKey:"wm_earn_7000",target:7e3,event:"goldEarned",reward:{gold:800,exp:600}},{id:"wm_clear_7",nameKey:"wm_clear_7",target:7,event:"dungeonClear",reward:{gold:1e3,exp:700}}];function ee(c,e=null){try{return localStorage.getItem(c)}catch{return e}}function F(c,e){try{localStorage.setItem(c,e)}catch{}}function Me(c){try{localStorage.removeItem(c)}catch{}}function Pe(c,e=null){try{return sessionStorage.getItem(c)}catch{return e}}function me(c,e){try{sessionStorage.setItem(c,e)}catch{}}function Ke(c){try{sessionStorage.removeItem(c)}catch{}}const re=[{id:"default",bg:"#0a0a0f",grid:"rgba(120,130,255,0.7)",gridSub:"rgba(120,130,255,0.25)",glow:"rgba(99,102,241,0.8)"},{id:"emerald",bg:"#060f0a",grid:"rgba(52,211,153,0.7)",gridSub:"rgba(52,211,153,0.25)",glow:"rgba(16,185,129,0.8)"},{id:"crimson",bg:"#0f0606",grid:"rgba(248,113,113,0.7)",gridSub:"rgba(248,113,113,0.25)",glow:"rgba(239,68,68,0.8)"},{id:"amber",bg:"#0f0b04",grid:"rgba(251,191,36,0.7)",gridSub:"rgba(251,191,36,0.25)",glow:"rgba(245,158,11,0.8)"},{id:"violet",bg:"#0b060f",grid:"rgba(167,139,250,0.7)",gridSub:"rgba(167,139,250,0.25)",glow:"rgba(139,92,246,0.8)"},{id:"cyan",bg:"#040b0f",grid:"rgba(34,211,238,0.7)",gridSub:"rgba(34,211,238,0.25)",glow:"rgba(6,182,212,0.8)"},{id:"rose",bg:"#0f0408",grid:"rgba(251,113,133,0.7)",gridSub:"rgba(251,113,133,0.25)",glow:"rgba(244,63,94,0.8)"}],o={ctx:null,width:400,height:700,_gridCache:null,_bgTheme:null,_uiOpacity:null,_bgImage:null,_bgImageList:null,_fontCache:new Map,_lastFont:null,_colorCache:new Map,_gradientCache:new Map,init(c,e,t){this.ctx=c,this.width=e,this.height=t,this._dpr=Math.min(window.devicePixelRatio||1,3),this._gridCache=null,this._loadBgTheme(),this._loadUiOpacity();const n=ee("bg_image");n?this._loadBgImage(n):this._bgImage=null,this._fontCache.clear(),this._lastFont=null,this._colorCache.clear(),this._gradientCache.clear()},_loadUiOpacity(){const c=ee("ui_opacity");this._uiOpacity=c!==null?parseFloat(c):1},getUiOpacity(){return this._uiOpacity===null&&this._loadUiOpacity(),this._uiOpacity},setUiOpacity(c){this._uiOpacity=Math.max(.1,Math.min(1,c)),F("ui_opacity",String(this._uiOpacity))},applyUiOpacity(){this.ctx.globalAlpha=this.getUiOpacity()},resetOpacity(){this.ctx.globalAlpha=1},_loadBgTheme(){const c=ee("bg_theme")||"default";this._bgTheme=re.find(e=>e.id===c)||re[0]},setRandomBgTheme(){const c=re.filter(t=>{var n;return t.id!==((n=this._bgTheme)==null?void 0:n.id)}),e=c[Math.floor(Math.random()*c.length)];F("bg_theme",e.id),this._bgTheme=e,this._gridCache=null,this._bgImage=null,F("bg_image","")},setBgTheme(c){const e=re.find(t=>t.id===c);e&&(F("bg_theme",e.id),this._bgTheme=e,this._gridCache=null,this._bgImage=null,F("bg_image",""))},async loadBgImageList(){try{const c=await fetch("./background/list.json?"+Date.now());if(!c.ok)return this._bgImageList=[],this._bgImageList;this._bgImageList=await c.json()}catch{this._bgImageList=[]}return this._bgImageList},async _loadBgImage(c){if(!c)return this._bgImage=null,!1;const e=c.startsWith("/")?"."+c:c;return new Promise(t=>{const n=new Image;n.onload=()=>{this._bgImage=n,t(!0)},n.onerror=()=>{this._bgImage=null,t(!1)},n.src=e})},clear(c){var e;this._bgImage&&this._bgImage.complete?(this.ctx.drawImage(this._bgImage,0,0,this.width,this.height),this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(0,0,this.width,this.height)):(this.ctx.fillStyle=((e=this._bgTheme)==null?void 0:e.bg)||u.BG_PRIMARY,this.ctx.fillRect(0,0,this.width,this.height),c||this.drawGrid())},drawGrid(){if(this._bgImage&&this._bgImage.complete)return;if(!this._gridCache){const t=this._dpr||1,n=this._bgTheme||re[0],s=document.createElement("canvas");s.width=this.width*t,s.height=this.height*t;const i=s.getContext("2d");i.scale(t,t),i.strokeStyle=n.grid,i.lineWidth=1.5,i.shadowColor=n.glow,i.shadowBlur=8;for(let a=0;a<=this.width;a+=40)i.beginPath(),i.moveTo(a,0),i.lineTo(a,this.height),i.stroke();for(let a=0;a<=this.height;a+=40)i.beginPath(),i.moveTo(0,a),i.lineTo(this.width,a),i.stroke();i.shadowBlur=0,i.strokeStyle=n.gridSub,i.lineWidth=.5;for(let a=20;a<=this.width;a+=40)i.beginPath(),i.moveTo(a,0),i.lineTo(a,this.height),i.stroke();for(let a=20;a<=this.height;a+=40)i.beginPath(),i.moveTo(0,a),i.lineTo(this.width,a),i.stroke();this._gridCache=s}const c=this.ctx;c.save();const e=this._dpr||1;c.setTransform(e,0,0,e,0,0),c.drawImage(this._gridCache,0,0,this.width,this.height),c.restore()},roundRect(c,e,t,n,s,i,a){this.ctx.beginPath(),this.ctx.moveTo(c+s,e),this.ctx.arcTo(c+t,e,c+t,e+n,s),this.ctx.arcTo(c+t,e+n,c,e+n,s),this.ctx.arcTo(c,e+n,c,e,s),this.ctx.arcTo(c,e,c+t,e,s),this.ctx.closePath(),i&&(this.ctx.fillStyle=i,this.ctx.fill()),a&&(this.ctx.strokeStyle=a,this.ctx.lineWidth=2,this.ctx.stroke())},drawHPBar(c,e,t,n,s,i,a=u.HP_PLAYER){const r=Math.max(0,Math.min(1,s/i)),d=t*r,h=n/2;if(this.ctx.save(),this.roundRect(c,e,t,n,h,"rgba(0,0,0,0.3)"),this.roundRect(c,e+1,t,n-2,h,"rgba(255,255,255,0.05)"),d>2){const m=Math.min(h,d/2),p=`HP_${c}_${e}_${n}_${a}`;let _=this._gradientCache.get(p);_||(_=this.ctx.createLinearGradient(c,e,c,e+n),_.addColorStop(0,this.lightenColor(a,30)),_.addColorStop(.5,a),_.addColorStop(1,this.darkenColor(a,20)),this._evictGradientCache(),this._gradientCache.set(p,_)),this.roundRect(c,e,d,n,m,_),this.ctx.globalAlpha=.3,this.roundRect(c+2,e+2,Math.max(0,d-4),n/3,m/2,"rgba(255,255,255,0.5)"),this.ctx.globalAlpha=1}else d>0&&(this.ctx.fillStyle=a,this.ctx.fillRect(c,e,d,n));this.ctx.restore()},drawTimerBar(c,e,t,n,s,i,a=0){const r=Math.max(0,Math.min(1,s/i)),d=t*r,h=n/2;let m;if(r>.5?m="#22c55e":r>.25?m="#fbbf24":(m="#ef4444",Math.sin(a/100)>0&&(m="#ff6b6b")),this.roundRect(c,e,t,n,h,"rgba(0,0,0,0.3)"),d>2){const p=Math.min(h,d/2),_=`TM_${c}_${e}_${n}_${m}`;let A=this._gradientCache.get(_);A||(A=this.ctx.createLinearGradient(c,e,c,e+n),A.addColorStop(0,this.lightenColor(m,20)),A.addColorStop(1,this.darkenColor(m,10)),this._evictGradientCache(),this._gradientCache.set(_,A)),this.roundRect(c,e,d,n,p,A)}},_evictGradientCache(){this._gradientCache.size>50&&this._gradientCache.clear()},lightenColor(c,e){const t=`${c}_L${e}`;let n=this._colorCache.get(t);if(n)return n;const s=parseInt(c.replace("#",""),16),i=Math.round(2.55*e),a=Math.min(255,(s>>16)+i),r=Math.min(255,(s>>8&255)+i),d=Math.min(255,(s&255)+i);return n=`rgb(${a},${r},${d})`,this._colorCache.set(t,n),n},darkenColor(c,e){const t=`${c}_D${e}`;let n=this._colorCache.get(t);if(n)return n;const s=parseInt(c.replace("#",""),16),i=Math.round(2.55*e),a=Math.max(0,(s>>16)-i),r=Math.max(0,(s>>8&255)-i),d=Math.max(0,(s&255)-i);return n=`rgb(${a},${r},${d})`,this._colorCache.set(t,n),n},drawText(c,e,t,n={}){const{font:s="14px",color:i=u.TEXT_PRIMARY,align:a="left",baseline:r="top",stroke:d=!1}=n;let h=this._fontCache.get(s);if(!h){const m=s.match(/(bold\s+)?(\d+)px/i),p=m&&m[1]?"bold ":"",_=m?m[2]:"14";h=`${p}${_}px Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,this._fontCache.set(s,h)}this._lastFont!==h&&(this.ctx.font=h,this._lastFont=h),this.ctx.textAlign=a,this.ctx.textBaseline=r,d&&(this.ctx.strokeStyle="rgba(0,0,0,0.6)",this.ctx.lineWidth=3,this.ctx.lineJoin="round",this.ctx.strokeText(c,e,t)),this.ctx.fillStyle=i,this.ctx.fillText(c,e,t)},drawButton(c,e,t,n,s,i={}){const{bgColor:a=u.ACCENT,textColor:r=u.TEXT_PRIMARY,borderColor:d=null,fontSize:h=16,stroke:m=!1}=i;this.roundRect(c,e,t,n,12,a,d),this.drawText(s,c+t/2,e+n/2,{font:`bold ${h}px system-ui`,color:r,align:"center",baseline:"middle",stroke:m})},drawImage(c,e,t,n,s){c&&c.complete&&this.ctx.drawImage(c,e,t,n,s)},drawGradientCard(c,e,t,n,s,i,a){const r=this.ctx.createLinearGradient(c,e,c,e+n);r.addColorStop(0,i),r.addColorStop(1,a),this.roundRect(c,e,t,n,s,r)},getCurrentBgThemeId(){var c;return((c=this._bgTheme)==null?void 0:c.id)||"default"},drawCircle(c,e,t,n,s){this.ctx.beginPath(),this.ctx.arc(c,e,t,0,Math.PI*2),n&&(this.ctx.fillStyle=n,this.ctx.fill()),s&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.stroke())}},Ze="https://study-api.blueskyman1012.workers.dev",ce={AUTH:"auth",RATE_LIMIT:"rate_limit",SERVER:"server",NETWORK:"network",UNKNOWN:"unknown"};function et(c){return c===401||c===403?ce.AUTH:c===429?ce.RATE_LIMIT:c>=500?ce.SERVER:ce.UNKNOWN}class tt{constructor(){this.sessionToken=null,this.lastError=null}setToken(e){this.sessionToken=e}isLoggedIn(){return!!this.sessionToken}getLastError(){return this.lastError}async _fetch(e,t={}){if(!this.sessionToken)return this.lastError={type:ce.AUTH,status:0,message:"ë¡œê·¸ì¸ í•„ìš”"},null;try{const n=new AbortController,s=setTimeout(()=>n.abort(),3e4),i=await fetch(`${Ze}${e}`,{...t,signal:n.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.sessionToken}`,...t.headers}});if(clearTimeout(s),!i.ok){const a=et(i.status),r=`API ${e} ì‹¤íŒ¨: ${i.status}`;return this.lastError={type:a,status:i.status,message:r,path:e},a===ce.AUTH||a===ce.RATE_LIMIT||ce.SERVER,null}return this.lastError=null,await i.json()}catch(n){return this.lastError={type:ce.NETWORK,status:0,message:n.message,path:e},null}}async getPlayer(){return this._fetch("/api/player")}async putPlayer(e){var t;return this._fetch("/api/player",{method:"PUT",body:JSON.stringify({level:e.level,exp:e.exp,hp:e.currentHp,attack:((t=e.permanentUpgrades)==null?void 0:t.damage)||0,defense:0,gold:e.gold,data:{maxHp:e.maxHp,permanentUpgrades:e.permanentUpgrades,inventory:e.inventory,stats:e.stats,achievements:e.achievements,dailyMissions:e.dailyMissions,weeklyMissions:e.weeklyMissions,cosmetics:e.cosmetics,totalGoldEarned:e.totalGoldEarned,totalCorrectAnswers:e.totalCorrectAnswers,subjectCounts:e.subjectCounts,achievementBonusDamage:e.achievementBonusDamage,achievementBonusHp:e.achievementBonusHp,createdAt:e.createdAt}})})}async getMonsters(){return this._fetch("/api/monsters")}async postMonster(e){return this._fetch("/api/monsters",{method:"POST",body:JSON.stringify({subject:e.subject||"math",question:e.question||"",answer:e.answer||"",wrong_answer:(e.choices||[]).filter(t=>t!==e.answer).join("|"),explanation:e.explanation||"",difficulty:e.difficulty||2,data:{answers:e.answers,choices:e.choices,correctIndex:e.correctIndex,topic:e.topic,keywords:e.keywords,questionType:e.questionType,formula:e.formula,imageData:e.imageData,aiAnalysis:e.aiAnalysis,stats:e.stats,review:e.review,isGenerated:e.isGenerated}})})}async putMonster(e,t){return this._fetch(`/api/monsters/${e}`,{method:"PUT",body:JSON.stringify(t)})}async postRun(e){return this._fetch("/api/runs",{method:"POST",body:JSON.stringify({start_time:new Date(e.startTime).toISOString(),end_time:e.endTime?new Date(e.endTime).toISOString():new Date().toISOString(),score:e.earnedExp||0,monsters_defeated:(e.defeatedMonsters||[]).length,data:{result:e.result,earnedGold:e.earnedGold,bestCombo:e.bestCombo,correctAnswers:e.correctAnswers,totalAnswers:e.totalAnswers,goldMultiplier:e.goldMultiplier}})})}async getRuns(){return this._fetch("/api/runs")}async downloadRuns(e){const t=await this.getRuns();if(!(t!=null&&t.runs)||!Array.isArray(t.runs)||t.runs.length===0)return!1;const n=await e.getAll("runs")||[];try{for(const s of n)await e.delete("runs",s.id);for(const s of t.runs){const i=typeof s.data=="string"?JSON.parse(s.data):s.data||{},a={serverId:s.id,startTime:s.start_time?new Date(s.start_time).getTime():Date.now(),endTime:s.end_time?new Date(s.end_time).getTime():Date.now(),earnedExp:s.score||0,defeatedCount:s.monsters_defeated||0,result:i.result||"unknown",earnedGold:i.earnedGold||0,bestCombo:i.bestCombo||0,correctAnswers:i.correctAnswers||0,totalAnswers:i.totalAnswers||0,goldMultiplier:i.goldMultiplier||1};await e.add("runs",a)}return!0}catch{try{const i=await e.getAll("runs")||[];for(const a of i)await e.delete("runs",a.id);for(const a of n)await e.add("runs",a)}catch{}return!1}}async getSettings(){return this._fetch("/api/settings")}async putSettings(e){return this._fetch("/api/settings",{method:"PUT",body:JSON.stringify(e)})}async saveKey(e,t){return this._fetch("/api/keys",{method:"POST",body:JSON.stringify({key_name:e,key_value:t})})}async deleteKey(e){return this._fetch(`/api/keys/${e}`,{method:"DELETE"})}async downloadKeys(){const e=await this._fetch("/api/keys");return e!=null&&e.keys?e.keys:null}async uploadMonsters(e){const t=await e.getByIndex("monsters","status","alive")||[],n=await e.getByIndex("monsters","status","cleared")||[],s=[...t,...n];let i=0;for(const a of s){if(a.serverId)continue;const r=await this.postMonster(a);r!=null&&r.id&&(a.serverId=r.id,await e.put("monsters",a),i++)}return i>0,i}async downloadPlayerData(e){const t=await this.getPlayer();if(!(t!=null&&t.player))return null;const n=t.player,s=typeof n.data=="string"?JSON.parse(n.data):n.data||{},a=await e.get("player","main")||{id:"main",createdAt:s.createdAt||Date.now()};a.level=n.level||1,a.exp=n.exp||0,a.gold=n.gold||0,a.maxHp=s.maxHp||n.hp||100,a.currentHp=a.maxHp,a.permanentUpgrades=s.permanentUpgrades||{hp:0,time:0,goldBonus:0,damage:0},a.inventory=s.inventory||{reviveTicket:0,hintTicket:0,timeBoost:0,doubleGold:0},a.stats=s.stats||{totalRuns:0,totalKills:0,bestCombo:0},s.achievements&&(a.achievements=s.achievements),s.dailyMissions&&(a.dailyMissions=s.dailyMissions),s.weeklyMissions&&(a.weeklyMissions=s.weeklyMissions);const r=a.cosmetics||{},d=s.cosmetics||{},h=(m,p)=>[...new Set([...m||["default"],...p||["default"]])];return a.cosmetics={purchasedThemes:h(r.purchasedThemes,d.purchasedThemes),particleStyle:d.particleStyle||r.particleStyle||"default",purchasedParticles:h(r.purchasedParticles,d.purchasedParticles),damageTextStyle:d.damageTextStyle||r.damageTextStyle||"default",purchasedDamageText:h(r.purchasedDamageText,d.purchasedDamageText),correctFlash:d.correctFlash||r.correctFlash||"default",purchasedFlash:h(r.purchasedFlash,d.purchasedFlash)},s.totalGoldEarned!==void 0&&(a.totalGoldEarned=s.totalGoldEarned),s.totalCorrectAnswers!==void 0&&(a.totalCorrectAnswers=s.totalCorrectAnswers),s.subjectCounts&&(a.subjectCounts=s.subjectCounts),s.achievementBonusDamage!==void 0&&(a.achievementBonusDamage=s.achievementBonusDamage),s.achievementBonusHp!==void 0&&(a.achievementBonusHp=s.achievementBonusHp),await e.put("player",a),a}async downloadMonsters(e){const t=await this.getMonsters();if(!(t!=null&&t.monsters)||!Array.isArray(t.monsters)||t.monsters.length===0)return!1;const n=await e.getByIndex("monsters","status","alive"),s=await e.getByIndex("monsters","status","cleared"),i=[...n,...s];try{for(const a of i)await e.delete("monsters",a.id);for(const a of t.monsters){const r=typeof a.data=="string"?JSON.parse(a.data):a.data||{},d={serverId:a.id,subject:a.subject||"math",question:a.question||"",answer:a.answer||"",answers:r.answers||[a.answer],choices:r.choices||[],correctIndex:r.correctIndex||0,explanation:a.explanation||"",topic:r.topic||"",difficulty:a.difficulty||2,keywords:r.keywords||[],questionType:r.questionType||"ê°ê´€ì‹",formula:r.formula||"",imageData:r.imageData,aiAnalysis:r.aiAnalysis,isGenerated:r.isGenerated||!1,hp:80+(a.difficulty||2)*20,maxHp:80+(a.difficulty||2)*20,createdAt:a.created_at?new Date(a.created_at).getTime():Date.now(),status:a.status==="defeated"?"cleared":"alive",stats:r.stats||{attempts:0,correct:0,wrong:0,lastAttempt:null,averageTime:0},review:r.review||{nextReviewDate:null,reviewCount:0,masteryLevel:0}};await e.add("monsters",d)}return!0}catch{try{const r=await e.getAll("monsters")||[];for(const d of r)await e.delete("monsters",d.id);for(const d of i)await e.add("monsters",d)}catch{}return!1}}}const H=new tt;function st(c){c.roundRect||(c.roundRect=function(e,t,n,s,i){typeof i=="number"&&(i=[i,i,i,i]);const[a,r,d,h]=i;this.moveTo(e+a,t),this.lineTo(e+n-r,t),this.quadraticCurveTo(e+n,t,e+n,t+r),this.lineTo(e+n,t+s-d),this.quadraticCurveTo(e+n,t+s,e+n-d,t+s),this.lineTo(e+h,t+s),this.quadraticCurveTo(e,t+s,e,t+s-h),this.lineTo(e,t+a),this.quadraticCurveTo(e,t,e+a,t)})}function ge(c){const e=document.createElement("canvas"),t=360,n=20;e.width=t;const s=e.getContext("2d");st(s);const i=(g,S,M)=>{s.font=M;const y=[];let T="";for(const E of g)s.measureText(T+E).width>S?(y.push(T),T=E):T+=E;return T&&y.push(T),y},a=de(c.question)||"ë¬¸ì œ ì—†ìŒ",r=c.answer||"?",d=c.topic||"",h=c.difficulty||2,m=c.choices||[],p={math:"ğŸ“",science:"ğŸ”¬",english:"ğŸ“–",korean:"ğŸ“"}[c.subject]||"ğŸ“",_=["","â˜…","â˜…â˜…","â˜…â˜…â˜…"][h]||"â˜…â˜…";s.font="bold 16px system-ui";const A=i(a,t-n*2,"bold 16px system-ui"),v=[];for(let g=0;g<m.length;g++){const S=i(`${g+1}. ${m[g]}`,t-n*2-10,"14px system-ui");v.push(S)}const C=v.reduce((g,S)=>g+S.length*20+4,0);let w=n+30+12+A.length*22+16;m.length>0&&(w+=8+C+8),w+=28+n,e.height=w;const f=s.createLinearGradient(0,0,0,w);f.addColorStop(0,"#1a1a2e"),f.addColorStop(1,"#16213e"),s.fillStyle=f,s.beginPath(),s.roundRect(0,0,t,w,12),s.fill(),s.strokeStyle="rgba(99,102,241,0.4)",s.lineWidth=1.5,s.beginPath(),s.roundRect(0,0,t,w,12),s.stroke();let b=n;s.font="13px system-ui",s.fillStyle="#818cf8",s.fillText(`${p} ${d}`,n,b+12),s.fillStyle="#64748b",s.textAlign="right",s.fillText(_,t-n,b+12),s.textAlign="left",b+=30,s.strokeStyle="rgba(99,102,241,0.2)",s.lineWidth=1,s.beginPath(),s.moveTo(n,b),s.lineTo(t-n,b),s.stroke(),b+=12,s.font="bold 16px system-ui",s.fillStyle="#e2e8f0";for(const g of A)s.fillText(g,n,b+14),b+=22;if(b+=8,m.length>0){s.strokeStyle="rgba(255,255,255,0.06)",s.beginPath(),s.moveTo(n,b),s.lineTo(t-n,b),s.stroke(),b+=8;for(let g=0;g<v.length;g++){const S=g===(c.correctIndex||0);s.fillStyle=S?"rgba(34,197,94,0.12)":"rgba(99,102,241,0.08)";const M=v[g].length*20+4;s.beginPath(),s.roundRect(n,b,t-n*2,M,6),s.fill(),s.font="14px system-ui",s.fillStyle=S?"#22c55e":"#cbd5e1";for(const y of v[g])s.fillText(y,n+8,b+15),b+=20;b+=4}b+=8}s.font="bold 14px system-ui",s.fillStyle="#94a3b8",s.fillText("ì •ë‹µ: ",n,b+14);const x=n+s.measureText("ì •ë‹µ: ").width;return s.fillStyle="#22c55e",s.fillText(r,x,b+14),e.toDataURL("image/png")}function de(c){if(!c||typeof c!="string")return c;let e=c;return e=e.replace(/\((?:answer|hint|note|difficulty|topic|type|level|correct|solution|explanation|ì°¸ê³ )\s*[:ï¼š]\s*[^)]*\)/gi,""),e=e.replace(/\(\s*(?:[A-Za-z]+\s+){2,}[A-Za-z.,!?]*\s*\)/g,""),e=e.replace(/\*\*(.+?)\*\*/g,"$1"),e=e.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"$1"),e=e.replace(/`([^`]+)`/g,"$1"),e=e.replace(/^(?:Q?\d+[.)]\s*|ë¬¸ì œ\s*\d*[.):ï¼š]?\s*)/i,""),e=nt(e),e=e.replace(/(?:^|\. )(?:[A-Z][a-z]+(?:\s+[a-z]+){2,}[.?!]?\s*)/g,""),e=e.replace(/\s{2,}/g," ").trim(),e}function nt(c){let e=c;return e=e.replace(/\\frac\s*\{([^}]*)\}\s*\{([^}]*)\}/g,"$1/$2"),e=e.replace(/\\sqrt\s*\[([^\]]*)\]\s*\{([^}]*)\}/g,"$1âˆš$2"),e=e.replace(/\\sqrt\s*\{([^}]*)\}/g,"âˆš$1"),e=e.replace(/\\times/g,"Ã—"),e=e.replace(/\\div/g,"Ã·"),e=e.replace(/\\cdot/g,"Â·"),e=e.replace(/\\pm/g,"Â±"),e=e.replace(/\\pi/g,"Ï€"),e=e.replace(/\\alpha/g,"Î±"),e=e.replace(/\\beta/g,"Î²"),e=e.replace(/\\theta/g,"Î¸"),e=e.replace(/\\infty/g,"âˆ"),e=e.replace(/\\leq/g,"â‰¤"),e=e.replace(/\\geq/g,"â‰¥"),e=e.replace(/\\neq/g,"â‰ "),e=e.replace(/\\le(?![a-z])/g,"â‰¤"),e=e.replace(/\\ge(?![a-z])/g,"â‰¥"),e=e.replace(/\\(?:left|right)[()[\]{}|.]/g,""),e=e.replace(/\\text\s*\{([^}]*)\}/g,"$1"),e=e.replace(/\\(?:quad|;|,|!)/g," "),e=e.replace(/\^\{([^}]*)\}/g,"^$1"),e=e.replace(/_\{([^}]*)\}/g,"$1"),e=e.replace(/\$/g,""),e=e.replace(/\\[a-zA-Z]+/g,""),e=e.replace(/[{}]/g,""),e}const at="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",it="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",ot="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent";class rt{constructor(e){this.apiKey=e||null}setApiKey(e){this.apiKey=e,me("gemini_api_key",e),H.isLoggedIn()&&H.saveKey("gemini_api_key",e).catch(t=>{})}loadApiKey(){const e=Pe("gemini_api_key");return this.apiKey=e||null,this.apiKey}hasApiKey(){return!!this.apiKey}async analyzeImage(e,t){var m,p,_,A,v,C;if(!this.apiKey)throw new Error("API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤");const n=e.includes(",")?e.split(",")[1]:e;let s="image/jpeg";e.startsWith("data:image/png")?s="image/png":e.startsWith("data:image/webp")&&(s="image/webp");const i=`ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ${t} ë¬¸ì œ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ì´ ì´ë¯¸ì§€ì—ì„œ ë¬¸ì œì™€ ì •ë‹µì„ ì¶”ì¶œí•´ì£¼ì„¸ìš”.

ì¤‘ìš”í•œ ê·œì¹™:
1. ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”
2. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”
3. ë¬¸ì œì— ë³´ê¸°(ì„ íƒì§€)ê°€ ìˆìœ¼ë©´ choices ë°°ì—´ì— ë„£ìœ¼ì„¸ìš”
4. ë³´ê¸°ê°€ ì—†ìœ¼ë©´ choicesëŠ” ë¹ˆ ë°°ì—´ë¡œ ë‘ì„¸ìš”
5. ì •ë‹µì€ ë°˜ë“œì‹œ ì°¾ì•„ì„œ answerì— ë„£ìœ¼ì„¸ìš”
6. correctIndexëŠ” choices ë°°ì—´ì—ì„œ ì •ë‹µì˜ ìœ„ì¹˜ (0ë¶€í„° ì‹œì‘)
7. ë¶€ë“±ì‹ ë¬¸ì œ: ì •ë‹µì€ ë°˜ë“œì‹œ ë¶€ë“±ì‹ í‘œí˜„ìœ¼ë¡œ (ì˜ˆ: "x > 4", "x â‰¤ -3"). ê²½ê³„ê°’ ìˆ«ìë§Œ ì“°ì§€ ë§ˆì„¸ìš”.
8. questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)

JSON í˜•ì‹:
{
  "question": "ë¬¸ì œ ë‚´ìš© ì „ì²´",
  "answer": "ì •ë‹µ",
  "choices": ["ë³´ê¸°1", "ë³´ê¸°2", "ë³´ê¸°3", "ë³´ê¸°4"],
  "correctIndex": 0,
  "explanation": "ê°„ë‹¨í•œ í’€ì´ ì„¤ëª…"
}

ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  ìœ„ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.`,a=await fetch(it,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.apiKey},body:JSON.stringify({contents:[{parts:[{inline_data:{mime_type:s,data:n}},{text:i}]}],generationConfig:{temperature:.1,maxOutputTokens:2048}})});if(!a.ok){let w=`HTTP ${a.status}`;try{w=((m=(await a.json()).error)==null?void 0:m.message)||w}catch{}throw new Error(w)}const r=await a.json();if(r.error)throw new Error(r.error.message);const d=(C=(v=(A=(_=(p=r.candidates)==null?void 0:p[0])==null?void 0:_.content)==null?void 0:A.parts)==null?void 0:v[0])==null?void 0:C.text;if(!d)throw new Error("AIê°€ ë¹ˆ ì‘ë‹µì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤");const h=this.parseJSON(d);if(!h||!h.question)throw new Error("ë¬¸ì œë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");return h}async generateContent(e){var i,a,r,d,h,m;if(!this.apiKey)throw new Error("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");const t=await fetch(at,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.apiKey},body:JSON.stringify({contents:[{parts:[{text:e}]}],generationConfig:{temperature:.7,maxOutputTokens:1024}})});if(!t.ok){let p=`HTTP ${t.status}`;try{p=((i=(await t.json()).error)==null?void 0:i.message)||p}catch{}throw new Error(p)}const s=(m=(h=(d=(r=(a=(await t.json()).candidates)==null?void 0:a[0])==null?void 0:r.content)==null?void 0:d.parts)==null?void 0:h[0])==null?void 0:m.text;if(!s)throw new Error("AIê°€ ë¹ˆ ì‘ë‹µì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤");return s}async analyzeQuestion(e,t){const n=`
ë‹¤ìŒ ë¬¸ì œì˜ ìœ í˜•ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.

ê³¼ëª©: ${t}
ë¬¸ì œ: ${e}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "type": "ë¬¸ì œ ìœ í˜• (ì˜ˆ: ì¼ì°¨ë°©ì •ì‹, ì´ì°¨í•¨ìˆ˜, ë¬¸ë²•, ë…í•´ ë“±)",
  "concept": "í•µì‹¬ ê°œë…",
  "difficulty": "ìƒ/ì¤‘/í•˜",
  "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]
}
`,s=await this.generateContent(n);return this.parseJSON(s)}async generateSimilarProblems(e,t,n,s=3){const a=/ë¶€ë“±ì‹/.test(e)||/[<>â‰¤â‰¥]/.test(t)?`
5. ë¶€ë“±ì‹ ë¬¸ì œ: ì •ë‹µì€ ë°˜ë“œì‹œ ë¶€ë“±ì‹ í‘œí˜„ (ì˜ˆ: "x > 4", "x â‰¤ -3"), ì„ íƒì§€ë„ ë¶€ë“±ì‹ í‘œí˜„ìœ¼ë¡œ (ë¶€ë“±í˜¸ ë°©í–¥/ë“±í˜¸ ë°”ê¿”ì„œ ì˜¤ë‹µ ìƒì„±). ê²½ê³„ê°’ ìˆ«ìë§Œ ì •ë‹µìœ¼ë¡œ ì“°ì§€ ë§ˆì„¸ìš”.`:"",r=`
ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ${n} ì„ ìƒë‹˜ì…ë‹ˆë‹¤.
í•™ìƒì´ ë‹¤ìŒ ë¬¸ì œë¥¼ í‹€ë ¸ìŠµë‹ˆë‹¤. ë¹„ìŠ·í•œ ìœ í˜•ì˜ ë¬¸ì œë¥¼ ${s}ê°œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

[ì›ë³¸ ë¬¸ì œ]
ë¬¸ì œ: ${e}
ì •ë‹µ: ${t}

[ìš”êµ¬ì‚¬í•­]
1. ê°™ì€ ê°œë…ì„ ë‹¤ë£¨ì§€ë§Œ ìˆ«ìë‚˜ ìƒí™©ì„ ë°”ê¿”ì„œ ì¶œì œ
2. ë‚œì´ë„: ì‰¬ì›€ 1ê°œ, ë³´í†µ 1ê°œ, ì–´ë ¤ì›€ 1ê°œ
3. ê° ë¬¸ì œì— 4ì§€ì„ ë‹¤ ë³´ê¸° í¬í•¨
4. ìˆ˜ëŠ¥/ëª¨ì˜ê³ ì‚¬ ìŠ¤íƒ€ì¼ë¡œ ì¶œì œ${a}
5. questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "problems": [
    {
      "question": "ë¬¸ì œ ë‚´ìš©",
      "answer": "ì •ë‹µ",
      "choices": ["ë³´ê¸°1", "ë³´ê¸°2", "ë³´ê¸°3", "ë³´ê¸°4"],
      "correctIndex": 0,
      "difficulty": 1,
      "explanation": "ê°„ë‹¨í•œ í’€ì´"
    }
  ]
}

JSONë§Œ ì¶œë ¥í•˜ê³  ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
`,d=await this.generateContent(r);return this.parseJSON(d)}async generateNewProblems(e,t,n=5){const i=/ë¶€ë“±ì‹/.test(t)?`
5. ë¶€ë“±ì‹ ë¬¸ì œ: ì •ë‹µì€ ë°˜ë“œì‹œ ë¶€ë“±ì‹ í‘œí˜„ (ì˜ˆ: "x > 4", "x â‰¤ -3"), ì„ íƒì§€ë„ ë¶€ë“±ì‹ í‘œí˜„ìœ¼ë¡œ (ë¶€ë“±í˜¸ ë°©í–¥/ë“±í˜¸ ë°”ê¿”ì„œ ì˜¤ë‹µ ìƒì„±). ê²½ê³„ê°’ ìˆ«ìë§Œ ì •ë‹µìœ¼ë¡œ ì“°ì§€ ë§ˆì„¸ìš”.`:"",a=`
ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ${e} ì„ ìƒë‹˜ì…ë‹ˆë‹¤.
"${t}" ì£¼ì œë¡œ ë¬¸ì œë¥¼ ${n}ê°œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

[ìš”êµ¬ì‚¬í•­]
1. ìˆ˜ëŠ¥/ëª¨ì˜ê³ ì‚¬ ìŠ¤íƒ€ì¼
2. ë‹¤ì–‘í•œ ë‚œì´ë„ (ì‰¬ì›€~ì–´ë ¤ì›€)
3. 4ì§€ì„ ë‹¤ ê°ê´€ì‹
4. ê³ ë“±í•™ìƒ ìˆ˜ì¤€${i}
5. questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "problems": [
    {
      "question": "ë¬¸ì œ ë‚´ìš©",
      "answer": "ì •ë‹µ",
      "choices": ["ë³´ê¸°1", "ë³´ê¸°2", "ë³´ê¸°3", "ë³´ê¸°4"],
      "correctIndex": 0,
      "difficulty": 1,
      "topic": "${t}",
      "explanation": "ê°„ë‹¨í•œ í’€ì´"
    }
  ]
}

JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.
`,r=await this.generateContent(a);return this.parseJSON(r)}async generateHint(e,t,n){const s=`
ë‹¤ìŒ ë¬¸ì œì— ëŒ€í•œ íŒíŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”. ì •ë‹µì„ ì§ì ‘ ì•Œë ¤ì£¼ì§€ ë§ê³ , í’€ì´ ë°©í–¥ë§Œ ì œì‹œí•˜ì„¸ìš”.

ê³¼ëª©: ${n}
ë¬¸ì œ: ${e}
ì •ë‹µ: ${t}

í•œ ë¬¸ì¥ìœ¼ë¡œ íŒíŠ¸ë¥¼ ì£¼ì„¸ìš”.
`;return await this.generateContent(s)}async generateExplanation(e,t,n){const s=`
ë‹¤ìŒ ë¬¸ì œì˜ í’€ì´ë¥¼ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.

ê³¼ëª©: ${n}
ë¬¸ì œ: ${e}
ì •ë‹µ: ${t}

[í˜•ì‹]
1ë‹¨ê³„: ...
2ë‹¨ê³„: ...
ì •ë‹µ: ${t}

í•™ìƒì´ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
`;return await this.generateContent(s)}async generateProblemImage(e,t=[],n="",s=""){var r,d,h;if(!this.apiKey)return null;const i=t.length>0?`
ë³´ê¸°:
${t.map((m,p)=>`  ${p+1}. ${m}`).join(`
`)}`:"",a=`ì•„ë˜ ì‹œí—˜ ë¬¸ì œë¥¼ ê¹”ë”í•œ ì‹œí—˜ì§€ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

${s?`[${s}]`:""}
${e}${i}

ê·œì¹™:
- í°ìƒ‰ ë°°ê²½, ê²€ì€ìƒ‰ í…ìŠ¤íŠ¸
- ìˆ˜í•™ ê¸°í˜¸ì™€ ê³µì‹ì€ ì •í™•í•˜ê²Œ ë Œë”ë§
- í•œêµ­ì–´ ì‹œí—˜ì§€ ëŠë‚Œìœ¼ë¡œ ê¹”ë”í•˜ê²Œ
- ì •ë‹µì€ í‘œì‹œí•˜ì§€ ë§ˆì„¸ìš”`;try{const m=await fetch(ot,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.apiKey},body:JSON.stringify({contents:[{parts:[{text:a}]}],generationConfig:{responseModalities:["IMAGE","TEXT"],temperature:.4}})});if(!m.ok)return null;const _=((h=(d=(r=(await m.json()).candidates)==null?void 0:r[0])==null?void 0:d.content)==null?void 0:h.parts)||[];for(const A of _)if(A.inlineData)return`data:${A.inlineData.mimeType};base64,${A.inlineData.data}`;return null}catch{return null}}parseJSON(e){try{const t=e.match(/\{[\s\S]*\}/);if(t){const n=JSON.parse(t[0]);return n.question&&(n.question=de(n.question)),n.problems&&n.problems.forEach(s=>{s.question&&(s.question=de(s.question))}),n}return null}catch{return null}}}const q=new rt,qe="https://caricature-api-rust.wizice.com",ct="gemini-2.0-flash",xe={linear:{name:"ì¼ì°¨ë°©ì •ì‹",examples:"2x + 3 = 7"},quadratic:{name:"ì´ì°¨ë°©ì •ì‹",examples:"xÂ² - 5x + 6 = 0"},factoring:{name:"ì¸ìˆ˜ë¶„í•´",examples:"xÂ² + 5x + 6"},function:{name:"í•¨ìˆ˜",examples:"f(x) = 2x + 1, f(3) = ?"},inequality:{name:"ë¶€ë“±ì‹",examples:"2x - 3 > 5"},fraction:{name:"ë¶„ìˆ˜ ê³„ì‚°",examples:"1/2 + 1/3"},percentage:{name:"ë¹„ìœ¨/í¼ì„¼íŠ¸",examples:"20ì˜ 30%"},sequence:{name:"ìˆ˜ì—´",examples:"ë“±ì°¨ìˆ˜ì—´ í•©"},probability:{name:"í™•ë¥ ",examples:"ì£¼ì‚¬ìœ„ í™•ë¥ "},geometry:{name:"ë„í˜•",examples:"ì‚¼ê°í˜• ë„“ì´"}},Ae={force:{name:"í˜ê³¼ ìš´ë™",examples:"ë“±ì†ìš´ë™, ê°€ì†ë„, F=ma",level:"ì¤‘"},chemical:{name:"í™”í•™ë°˜ì‘",examples:"í™”í•™ë°˜ì‘ì‹, ì§ˆëŸ‰ë³´ì¡´ë²•ì¹™",level:"ì¤‘"},cell:{name:"ì„¸í¬",examples:"ì„¸í¬ êµ¬ì¡°, ì„¸í¬ë¶„ì—´, ì‚¼íˆ¬í˜„ìƒ",level:"ì¤‘"},earth:{name:"ì§€êµ¬ê³¼í•™",examples:"ì§€ì¸µ, íŒêµ¬ì¡°ë¡ , ê¸°ìƒí˜„ìƒ",level:"ì¤‘"},mechanics:{name:"ì—­í•™",examples:"ìš´ë™ë°©ì •ì‹, ì¼ê³¼ ì—ë„ˆì§€, ìš´ë™ëŸ‰",level:"ê³ "},electromagnetic:{name:"ì „ìê¸°",examples:"ì „ê¸°ì¥, ìê¸°ì¥, ì „ìê¸°ìœ ë„",level:"ê³ "},mole:{name:"ëª°ê³¼ ë°˜ì‘ì‹",examples:"ëª° ê°œë…, í™”í•™ì–‘ë¡ , ë†ë„ ê³„ì‚°",level:"ê³ "},genetics:{name:"ìœ ì „",examples:"ë©˜ë¸ìœ ì „, DNA, ìœ ì „ì ë°œí˜„",level:"ê³ "}};class lt{constructor(){this.apiKey=null,this.loadApiKey()}loadApiKey(){return this.apiKey=Pe("smileprint_api_key"),this.apiKey}hasApiKey(){return this.loadApiKey(),!!this.apiKey}buildGeneratePrompt(e,t,n){const s=xe[e]||xe.linear,i=["ì‰¬ì›€","ë³´í†µ","ì–´ë ¤ì›€"][t-1]||"ë³´í†µ",a=e==="inequality",r=a?`- ì •ë‹µì€ ë°˜ë“œì‹œ ë¶€ë“±ì‹ í‘œí˜„ (ì˜ˆ: "x > 4", "x â‰¤ -3", "x < 2")
- ì„ íƒì§€ë„ ë¶€ë“±ì‹ í‘œí˜„ìœ¼ë¡œ (ë¶€ë“±í˜¸ ë°©í–¥/ë“±í˜¸ ìœ ë¬´ë¥¼ ë°”ê¿”ì„œ ì˜¤ë‹µ ìƒì„±)
- ì˜ˆ: ì •ë‹µ "x > 4" â†’ ì˜¤ë‹µ "x < 4", "x â‰¥ 4", "x â‰¤ 4"
- ì ˆëŒ€ ê²½ê³„ê°’ ìˆ«ìë§Œ ì •ë‹µìœ¼ë¡œ ì“°ì§€ ë§ˆì„¸ìš” (ì˜ëª»ëœ ì˜ˆ: "4")`:`- ì •ë‹µì€ ë°˜ë“œì‹œ ìˆ«ì (ì˜ˆ: "5", "-3", "2, -3")
- ì´ì°¨ë°©ì •ì‹ì€ ë‘ ê·¼ì„ ì‰¼í‘œë¡œ êµ¬ë¶„ (ì˜ˆ: "2, -3")
- ì˜¤ë‹µì€ ì •ë‹µê³¼ ë¹„ìŠ·í•œ ìˆ«ìë¡œ (ì˜ˆ: ì •ë‹µ 5 â†’ ì˜¤ë‹µ 3, 7, -5)`,d=a?`"answer": "x > 4",
      "answers": ["x > 4"],
      "choices": ["x > 4", "x < 4", "x â‰¥ 4", "x â‰¤ 4"],`:`"answer": "5",
      "answers": ["5"],
      "choices": ["5", "3", "7", "-5"],`;return`ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ìˆ˜í•™ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.

## ì‘ì—…
${s.name} ë¬¸ì œë¥¼ ${n}ê°œ ë§Œë“œì„¸ìš”.
ì˜ˆì‹œ: ${s.examples}

## ì¡°ê±´
- ë‚œì´ë„: ${i}
${r}
- í•™ìƒì´ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë°˜ì˜í•œ ì˜¤ë‹µ 3ê°œ í¬í•¨

## JSON ì¶œë ¥ (ë°˜ë“œì‹œ ì´ í˜•ì‹ë§Œ)
{
  "problems": [
    {
      "question": "ë¬¸ì œ ë‚´ìš©",
      ${d}
      "correctIndex": 0,
      "explanation": "í’€ì´: ë‹¨ê³„ë³„ í’€ì´ ê³¼ì •",
      "difficulty": ${t},
      "topic": "${s.name}"
    }
  ]
}

## ë¬¸ì œ ì‘ì„± ê·œì¹™ (ë§¤ìš° ì¤‘ìš”)
- questionì€ ë°˜ë“œì‹œ **í•œê¸€**ë¡œ ì‘ì„± (ìˆ˜í•™ ë³€ìˆ˜ x, y, a, bì™€ ìˆ˜ì‹ ê¸°í˜¸ +, -, =, >, < ë§Œ í—ˆìš©)
- LaTeX ë¬¸ë²• ì ˆëŒ€ ê¸ˆì§€ (\\frac, \\sqrt, \\times, \\div, \\pi, \\alpha ë“± ì‚¬ìš© ê¸ˆì§€)
- ì œê³±ì€ x^2 ë˜ëŠ” "xì˜ ì œê³±"ìœ¼ë¡œ, ë¶„ìˆ˜ëŠ” 1/2 ë˜ëŠ” "2ë¶„ì˜ 1"ë¡œ ì‘ì„±
- ë£¨íŠ¸ëŠ” "ë£¨íŠ¸3" ë˜ëŠ” "âˆš3"ìœ¼ë¡œ ì‘ì„±
- ì˜ì–´ ë¬¸ì¥ì´ë‚˜ ì˜ì–´ ì„¤ëª… ê¸ˆì§€ (ì˜ˆ: "Solve for x" â†’ "xì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤")
- ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì‚¬ìš© ê¸ˆì§€ (ë³¼ë“œ, ì´íƒ¤ë¦­, ì½”ë“œë¸”ë¡ ë“±)

## í•„ìˆ˜
- choices[0]ì€ ë°˜ë“œì‹œ ì •ë‹µ
- explanationì€ ë‹¨ê³„ë³„ í’€ì´
- questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)`}buildSciencePrompt(e,t,n){const s=Ae[e]||Ae.force,i=["ì‰¬ì›€","ë³´í†µ","ì–´ë ¤ì›€"][t-1]||"ë³´í†µ";return`ë‹¹ì‹ ì€ í•œêµ­ ê³¼í•™ ì„ ìƒë‹˜ì…ë‹ˆë‹¤. ì¤‘í•™êµì™€ ê³ ë“±í•™êµ ê³¼í•™ì„ ê°€ë¥´ì¹©ë‹ˆë‹¤.

## ì‘ì—…
${s.name} (${s.level}ë“±í•™êµ) ë¬¸ì œë¥¼ ${n}ê°œ ë§Œë“œì„¸ìš”.
ì˜ˆì‹œ ì£¼ì œ: ${s.examples}

## ì¡°ê±´
- ë‚œì´ë„: ${i}
- ì •ë‹µì€ ë°˜ë“œì‹œ ì§§ì€ í…ìŠ¤íŠ¸ ë˜ëŠ” ìˆ«ì (ì˜ˆ: "ê°€ì†ë„", "36", "DNA")
- í•™ìƒì´ ìì£¼ í˜¼ë™í•˜ëŠ” ê°œë…ì„ ë°˜ì˜í•œ ì˜¤ë‹µ 3ê°œ í¬í•¨
- ê³„ì‚° ë¬¸ì œëŠ” ë‹¨ìœ„ë¥¼ í¬í•¨ (ì˜ˆ: "10 m/sÂ²")

## ì˜¤ë‹µ ìƒì„± ê·œì¹™ (ë§¤ìš° ì¤‘ìš”)
- ì˜¤ë‹µì€ ë°˜ë“œì‹œ ì •ë‹µê³¼ **ê°™ì€ í˜•ì‹**ì´ì–´ì•¼ í•©ë‹ˆë‹¤
  - ì •ë‹µì´ í…ìŠ¤íŠ¸ë©´ ì˜¤ë‹µë„ í…ìŠ¤íŠ¸, ì •ë‹µì´ ìˆ«ìë©´ ì˜¤ë‹µë„ ìˆ«ì
  - ì •ë‹µì— ë‹¨ìœ„ê°€ ìˆìœ¼ë©´ ì˜¤ë‹µì—ë„ ê°™ì€ ë‹¨ìœ„ ì‚¬ìš© (ì˜ˆ: ì •ë‹µ "10 m/sÂ²" â†’ ì˜¤ë‹µ "5 m/sÂ²")
- ì˜¤ë‹µì€ ì •ë‹µê³¼ **ë¹„ìŠ·í•œ ê¸€ì ìˆ˜/ê¸¸ì´**ì—¬ì•¼ í•©ë‹ˆë‹¤
- ì˜¤ë‹µì€ ì •ë‹µê³¼ **ê°™ì€ ê³¼í•™ ë¶„ì•¼ì˜ ê´€ë ¨ ìš©ì–´**ì—¬ì•¼ í•©ë‹ˆë‹¤
- 4ê°œ ì„ íƒì§€ë§Œ ë³´ê³  ì •ë‹µì„ ì°ì„ ìˆ˜ ì—†ë„ë¡, ì˜¤ë‹µë„ ê·¸ëŸ´ë“¯í•´ì•¼ í•©ë‹ˆë‹¤

### ë‚˜ìœ ì˜ˆì‹œ (ì ˆëŒ€ ì´ë ‡ê²Œ ë§Œë“¤ì§€ ë§ˆì„¸ìš”)
- ì •ë‹µ "ë¯¸í† ì½˜ë“œë¦¬ì•„" â†’ ì˜¤ë‹µ "42", "87", "15" (X) â† í…ìŠ¤íŠ¸ ë‹µì— ìˆ«ì ì˜¤ë‹µ ê¸ˆì§€
- ì •ë‹µ "DNA" â†’ ì˜¤ë‹µ "ì‚¬ê³¼", "ì»´í“¨í„°", "ì¶•êµ¬" (X) â† ë¬´ê´€í•œ ë‹¨ì–´ ê¸ˆì§€
- ì •ë‹µ "10 m/sÂ²" â†’ ì˜¤ë‹µ "ì†ë ¥", "ë³€ìœ„", "ì§ˆëŸ‰" (X) â† ìˆ«ì+ë‹¨ìœ„ ë‹µì— í…ìŠ¤íŠ¸ ì˜¤ë‹µ ê¸ˆì§€

### ì¢‹ì€ ì˜ˆì‹œ (ì£¼ì œë³„)
- í˜ê³¼ ìš´ë™: ì •ë‹µ "ê°€ì†ë„" â†’ ì˜¤ë‹µ "ì†ë ¥", "ë³€ìœ„", "ê´€ì„±"
- ì„¸í¬: ì •ë‹µ "ë¯¸í† ì½˜ë“œë¦¬ì•„" â†’ ì˜¤ë‹µ "ë¦¬ë³´ì†œ", "ì†Œí¬ì²´", "ê³¨ì§€ì²´"
- í™”í•™: ì •ë‹µ "ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™" â†’ ì˜¤ë‹µ "ì—ë„ˆì§€ ë³´ì¡´ ë²•ì¹™", "ì¼ì • ì„±ë¶„ë¹„ ë²•ì¹™", "ë°°ìˆ˜ ë¹„ë¡€ ë²•ì¹™"
- ìœ ì „: ì •ë‹µ "DNA" â†’ ì˜¤ë‹µ "RNA", "mRNA", "ë‹¨ë°±ì§ˆ"
- ê³„ì‚°: ì •ë‹µ "20 N" â†’ ì˜¤ë‹µ "10 N", "40 N", "5 N"

## JSON ì¶œë ¥ (ë°˜ë“œì‹œ ì´ í˜•ì‹ë§Œ)
{
  "problems": [
    {
      "question": "ë¬¸ì œ ë‚´ìš©",
      "answer": "ì •ë‹µ",
      "answers": ["ì •ë‹µ"],
      "choices": ["ì •ë‹µ", "ì˜¤ë‹µ1", "ì˜¤ë‹µ2", "ì˜¤ë‹µ3"],
      "correctIndex": 0,
      "explanation": "í’€ì´: ìƒì„¸í•œ ê³¼í•™ì  ì„¤ëª…",
      "difficulty": ${t},
      "topic": "${s.name}"
    }
  ]
}

## ë¬¸ì œ ì‘ì„± ê·œì¹™ (ë§¤ìš° ì¤‘ìš”)
- questionì€ ë°˜ë“œì‹œ **í•œê¸€**ë¡œ ì‘ì„± (ê³¼í•™ ì•½ì–´ DNA, RNA, pH, mol ë“±ì€ í—ˆìš©)
- LaTeX ë¬¸ë²• ì ˆëŒ€ ê¸ˆì§€ (\\frac, \\sqrt, \\times ë“± ì‚¬ìš© ê¸ˆì§€)
- í™”í•™ì‹ì€ ê°„ë‹¨íˆ ì‘ì„± (ì˜ˆ: H2O, CO2, NaCl)
- ì˜ì–´ ë¬¸ì¥ì´ë‚˜ ì˜ì–´ ì„¤ëª… ê¸ˆì§€ (ì˜ˆ: "What is..." â†’ "~ì€ ë¬´ì—‡ì¸ê°€?")
- ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì‚¬ìš© ê¸ˆì§€ (ë³¼ë“œ, ì´íƒ¤ë¦­, ì½”ë“œë¸”ë¡ ë“±)

## í•„ìˆ˜
- choices[0]ì€ ë°˜ë“œì‹œ ì •ë‹µ
- explanationì€ ê³¼í•™ì  ì›ë¦¬ë¥¼ í¬í•¨í•œ ìƒì„¸ í’€ì´
- questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)`}buildSimilarPrompt(e){const t=e.topic||"ìˆ˜í•™",s=t==="ë¶€ë“±ì‹"||e.answer&&/[<>â‰¤â‰¥]/.test(e.answer)?`- ë¶€ë“±ì‹ ë¬¸ì œ: ì •ë‹µì€ ë°˜ë“œì‹œ ë¶€ë“±ì‹ í‘œí˜„ (ì˜ˆ: "x > 4", "x â‰¤ -3")
- ì„ íƒì§€ë„ ë¶€ë“±ì‹ í‘œí˜„ (ë¶€ë“±í˜¸ ë°©í–¥/ë“±í˜¸ ë°”ê¿”ì„œ ì˜¤ë‹µ ìƒì„±)
- ì ˆëŒ€ ê²½ê³„ê°’ ìˆ«ìë§Œ ì •ë‹µìœ¼ë¡œ ì“°ì§€ ë§ˆì„¸ìš”`:`- ì •ë‹µì€ ìˆ«ìë§Œ
- ì˜¤ë‹µ 3ê°œ í¬í•¨ (ì •ë‹µê³¼ ë¹„ìŠ·í•œ ìˆ«ì)`;return`ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ìˆ˜í•™ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.

## ì›ë³¸ ë¬¸ì œ
ë¬¸ì œ: ${e.question}
ì •ë‹µ: ${e.answer}
ì£¼ì œ: ${t}

## ì‘ì—…
ìœ„ ë¬¸ì œì™€ ìœ ì‚¬í•˜ì§€ë§Œ ìˆ«ìê°€ ë‹¤ë¥¸ ë¬¸ì œ 2ê°œë¥¼ ë§Œë“œì„¸ìš”.

## ì¡°ê±´
- ê°™ì€ ìœ í˜•, ë‹¤ë¥¸ ìˆ«ì
${s}
- ë‹¨ê³„ë³„ í’€ì´ í¬í•¨
- questionì€ í•œê¸€ë¡œ ì‘ì„± (ë³€ìˆ˜ x, yì™€ ìˆ˜ì‹ ê¸°í˜¸ë§Œ í—ˆìš©, LaTeX ê¸ˆì§€, ì˜ì–´ ë¬¸ì¥ ê¸ˆì§€)
- questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)

## JSON ì¶œë ¥
{
  "problems": [
    {
      "question": "ìƒˆ ë¬¸ì œ",
      "answer": "ì •ë‹µ",
      "answers": ["ì •ë‹µ"],
      "choices": ["ì •ë‹µ", "ì˜¤ë‹µ1", "ì˜¤ë‹µ2", "ì˜¤ë‹µ3"],
      "correctIndex": 0,
      "explanation": "í’€ì´",
      "difficulty": ${e.difficulty||2},
      "topic": "${t}"
    }
  ]
}`}buildValidatePrompt(e){return`ë‹¤ìŒ ìˆ˜í•™ ë¬¸ì œë¥¼ í’€ì–´ì„œ ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”.

ë¬¸ì œ: ${e.question}
ì œì‹œëœ ì •ë‹µ: ${e.answer}

## ì‘ì—…
1. ë¬¸ì œë¥¼ ì§ì ‘ í’€ì–´ë³´ì„¸ìš”
2. ê³„ì‚°í•œ ì •ë‹µê³¼ ì œì‹œëœ ì •ë‹µì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

## JSON ì¶œë ¥
{
  "calculatedAnswer": "ê³„ì‚°í•œ ì •ë‹µ",
  "isCorrect": true,
  "explanation": "í’€ì´ ê³¼ì •"
}`}async callAPI(e){var d;if(!this.apiKey)throw new Error("SmilePrint API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤");const t=new FormData,n=this.createDummyImage();t.append("image",n,"dummy.png"),t.append("prompt",e),t.append("model",ct),t.append("temperature","0.7");const s=await fetch(`${qe}/api/v1/analyze/image`,{method:"POST",headers:{"X-API-Key":this.apiKey},body:t});if(!s.ok){const h=await s.json().catch(()=>({}));throw new Error(h.errorMessage||`API ì˜¤ë¥˜: ${s.status}`)}const i=await s.json(),r=((d=(await this.waitForCompletion(i.jobId,i.accessKey)).result)==null?void 0:d.analysisText)||"";return this.parseJSON(r)}createDummyImage(){const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");t.fillStyle="white",t.fillRect(0,0,1,1);const n=e.toDataURL("image/png"),s=atob(n.includes(",")?n.split(",")[1]:n),i="image/png",a=new ArrayBuffer(s.length),r=new Uint8Array(a);for(let d=0;d<s.length;d++)r[d]=s.charCodeAt(d);return new Blob([a],{type:i})}async waitForCompletion(e,t,n=30){for(let s=0;s<n;s++){const i=s===0?300:1e3;await this.sleep(i);const r=await(await fetch(`${qe}/api/v1/analyze/status/${e}`,{headers:{Authorization:`Bearer ${t}`}})).json();if(r.status==="completed")return r;if(r.status==="failed")throw new Error(r.errorMessage||"ìƒì„± ì‹¤íŒ¨")}throw new Error("ì‹œê°„ ì´ˆê³¼")}parseJSON(e){try{const t=e.match(/\{[\s\S]*\}/);if(t){const n=JSON.parse(t[0]);return n.problems&&n.problems.forEach(s=>{s.question&&(s.question=de(s.question))}),n}return null}catch{return null}}sleep(e){return new Promise(t=>setTimeout(t,e))}async generateProblems(e="linear",t=2,n=3,s="math"){const i=s==="science"?this.buildSciencePrompt(e,t,n):this.buildGeneratePrompt(e,t,n),a=await this.callAPI(i);if(!a||!a.problems)throw new Error("ë¬¸ì œ ìƒì„± ì‹¤íŒ¨");return a.problems}async generateSimilar(e){const t=this.buildSimilarPrompt(e),n=await this.callAPI(t);if(!n||!n.problems)throw new Error("ìœ ì‚¬ ë¬¸ì œ ìƒì„± ì‹¤íŒ¨");return n.problems}async validateProblem(e){const t=this.buildValidatePrompt(e),n=await this.callAPI(t);return n||{isCorrect:!1,reason:"ê²€ì¦ ì‹¤íŒ¨"}}async generateRandom(e=5,t="math"){const s=Object.keys(t==="science"?Ae:xe),i=s[Math.floor(Math.random()*s.length)],a=Math.floor(Math.random()*3)+1;return await this.generateProblems(i,a,e,t)}getTopics(e="math"){return e==="science"?Ae:xe}}const U=new lt;class dt{constructor(){this.audioContext=null,this.sfxEnabled=!0,this.bgmEnabled=!0,this.volume=.5,this.bgmVolume=.35,this.bgmPlaying=!1,this.bgmNodes=[],this.bgmInterval=null}init(){try{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume().catch(()=>{})}catch{this.audioContext=null}this.sfxEnabled=ee("sfx_enabled")!=="false",this.bgmEnabled=ee("bgm_enabled")!=="false",this.volume=parseFloat(ee("sound_volume")||"0.5"),this.bgmVolume=parseFloat(ee("bgm_volume")||"0.35")}get enabled(){return this.sfxEnabled}toggleSfx(){return this.sfxEnabled=!this.sfxEnabled,F("sfx_enabled",this.sfxEnabled),this.sfxEnabled}toggleBgm(){return this.bgmEnabled=!this.bgmEnabled,F("bgm_enabled",this.bgmEnabled),this.bgmEnabled?this.startLobbyBgm():this.stopBgm(),this.bgmEnabled}toggle(){const e=!(this.sfxEnabled&&this.bgmEnabled);return this.sfxEnabled=e,this.bgmEnabled=e,F("sfx_enabled",this.sfxEnabled),F("bgm_enabled",this.bgmEnabled),this.bgmEnabled||this.stopBgm(),e}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),F("sound_volume",this.volume)}startLobbyBgm(){this.bgmEnabled&&(this.bgmPlaying||(this.init(),this.bgmPlaying=!0,this._playLobbyLoop()))}stopBgm(){this.bgmPlaying=!1,this.bgmInterval&&(clearTimeout(this.bgmInterval),this.bgmInterval=null),this.bgmNodes.forEach(e=>{try{e.stop()}catch{}}),this.bgmNodes=[]}_playLobbyLoop(){if(!this.bgmPlaying||!this.bgmEnabled)return;this.bgmNodes=[];const t=60/70,n=this.audioContext;if(!n)return;if(n.state==="suspended"){n.resume().then(()=>{this.bgmPlaying&&this.bgmEnabled&&this._playLobbyLoop()}).catch(()=>{});return}const s=this.bgmVolume,i=[[220,261.63,329.63],[174.61,220,261.63],[130.81,164.81,196],[196,246.94,293.66]];let a=0;i.forEach(m=>{const p=t*4;m.forEach(_=>{this._schedulePadNote(_,a,p,s*.5)}),a+=p}),[440,523.25,659.25,523.25,349.23,440,523.25,440,523.25,659.25,783.99,659.25,392,493.88,587.33,493.88].forEach((m,p)=>{const _=p*t;this._scheduleArpNote(m,_,t*.7,s*.3)}),[{freq:110,time:0},{freq:110,time:t*2},{freq:87.31,time:t*4},{freq:87.31,time:t*6},{freq:130.81,time:t*8},{freq:130.81,time:t*10},{freq:98,time:t*12},{freq:98,time:t*14}].forEach(m=>{this._scheduleBassNote(m.freq,m.time,t*1.5,s*.4)});const h=a*1e3;this.bgmInterval=setTimeout(()=>{this._playLobbyLoop()},h)}_schedulePadNote(e,t,n,s){const i=this.audioContext,a=i.currentTime,r=i.createOscillator(),d=i.createGain(),h=i.createBiquadFilter();r.type="triangle",r.frequency.value=e,h.type="lowpass",h.frequency.value=800,r.connect(h),h.connect(d),d.connect(i.destination),d.gain.setValueAtTime(0,a+t),d.gain.linearRampToValueAtTime(s,a+t+.3),d.gain.setValueAtTime(s,a+t+n-.4),d.gain.linearRampToValueAtTime(0,a+t+n),r.start(a+t),r.stop(a+t+n),this.bgmNodes.push(r)}_scheduleArpNote(e,t,n,s){const i=this.audioContext,a=i.currentTime,r=i.createOscillator(),d=i.createGain(),h=i.createBiquadFilter();r.type="sine",r.frequency.value=e,h.type="lowpass",h.frequency.value=2e3,r.connect(h),h.connect(d),d.connect(i.destination),d.gain.setValueAtTime(s,a+t),d.gain.exponentialRampToValueAtTime(.001,a+t+n),r.start(a+t),r.stop(a+t+n+.05),this.bgmNodes.push(r)}_scheduleBassNote(e,t,n,s){const i=this.audioContext,a=i.currentTime,r=i.createOscillator(),d=i.createGain();r.type="sawtooth",r.frequency.value=e;const h=i.createBiquadFilter();h.type="lowpass",h.frequency.value=400,r.connect(h),h.connect(d),d.connect(i.destination),d.gain.setValueAtTime(s,a+t),d.gain.exponentialRampToValueAtTime(.001,a+t+n),r.start(a+t),r.stop(a+t+n+.05),this.bgmNodes.push(r)}playTone(e,t,n="sine",s=1){if(!this.sfxEnabled||!this.audioContext)return;if(this.audioContext.state==="suspended"){this.audioContext.resume().catch(()=>{});return}const i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.audioContext.destination),i.frequency.value=e,i.type=n;const r=this.volume*s;a.gain.setValueAtTime(r,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+t),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+t)}playCorrect(){this.sfxEnabled&&(this.init(),this.playTone(523.25,.1),setTimeout(()=>this.playTone(659.25,.1),80),setTimeout(()=>this.playTone(783.99,.15),160))}playWrong(){this.sfxEnabled&&(this.init(),this.playTone(311.13,.12,"sawtooth",.35),this.playTone(293.66,.12,"square",.15),setTimeout(()=>{this.playTone(233.08,.15,"sawtooth",.3),this.playTone(220,.15,"square",.12)},120),setTimeout(()=>{this.playTone(146.83,.25,"sawtooth",.25)},250))}playClick(){this.sfxEnabled&&(this.init(),this.playTone(800,.05,"sine",.3))}playItemDrop(e="normal"){if(!this.sfxEnabled)return;this.init();const t={normal:[600,800,1e3],rare:[700,900,1100,1300],epic:[800,1e3,1200,1400,1600],legendary:[500,700,900,1100,1300,1500,1700]};(t[e]||t.normal).forEach((s,i)=>{setTimeout(()=>this.playTone(s,.1,"sine",.4),i*60)})}playCombo(e){if(!this.sfxEnabled)return;this.init();const t=400+Math.min(e,10)*50;this.playTone(t,.08),setTimeout(()=>this.playTone(t*1.25,.1),50)}playTimerWarning(){this.sfxEnabled&&(this.init(),this.playTone(440,.1,"square",.2))}playMonsterDefeat(){this.sfxEnabled&&(this.init(),this._playNoiseBurst(.06,.5),this.playTone(80,.15,"sawtooth",.5),this.playTone(120,.12,"square",.2),setTimeout(()=>this.playTone(523.25,.08,"sine",.4),80),setTimeout(()=>this.playTone(659.25,.08,"sine",.4),140),setTimeout(()=>this.playTone(783.99,.12,"sine",.45),200),setTimeout(()=>this.playTone(1046.5,.18,"sine",.35),270),setTimeout(()=>this.playTone(1318.51,.06,"sine",.2),380),setTimeout(()=>this.playTone(1567.98,.06,"sine",.15),430))}_playNoiseBurst(e,t){if(!this.audioContext||this.audioContext.state==="suspended")return;const n=this.audioContext,s=n.sampleRate*e,i=n.createBuffer(1,s,n.sampleRate),a=i.getChannelData(0);for(let m=0;m<s;m++)a[m]=(Math.random()*2-1)*(1-m/s);const r=n.createBufferSource();r.buffer=i;const d=n.createGain(),h=n.createBiquadFilter();h.type="bandpass",h.frequency.value=1500,h.Q.value=.8,d.gain.setValueAtTime(this.volume*t,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+e),r.connect(h),h.connect(d),d.connect(n.destination),r.start()}playBossAppear(){this.sfxEnabled&&(this.init(),this.playTone(150,.3,"sawtooth",.4),setTimeout(()=>this.playTone(100,.4,"sawtooth",.5),200))}playLevelUp(){if(!this.sfxEnabled)return;this.init(),[523.25,659.25,783.99,1046.5].forEach((t,n)=>{setTimeout(()=>this.playTone(t,.15),n*100)})}playGameOver(){this.sfxEnabled&&(this.init(),this.playTone(60,.4,"sawtooth",.5),this._playNoiseBurst(.1,.3),setTimeout(()=>{this.playTone(392,.35,"triangle",.4),this.playTone(466.16,.35,"triangle",.15)},300),setTimeout(()=>{this.playTone(349.23,.35,"triangle",.4),this.playTone(415.3,.35,"triangle",.12)},650),setTimeout(()=>{this.playTone(293.66,.4,"triangle",.4),this.playTone(349.23,.4,"triangle",.12)},1e3),setTimeout(()=>{this.playTone(130.81,.7,"sawtooth",.3),this.playTone(155.56,.7,"triangle",.2),this.playTone(73.42,.8,"triangle",.25)},1400))}playClear(){if(!this.sfxEnabled)return;this.init(),[523.25,659.25,783.99,659.25,783.99,1046.5].forEach((t,n)=>{setTimeout(()=>this.playTone(t,.12),n*80)})}playDungeonStart(){this.sfxEnabled&&(this.init(),this.playTone(220,.15,"sawtooth",.3),setTimeout(()=>this.playTone(330,.15,"sawtooth",.3),100),setTimeout(()=>this.playTone(440,.2,"sawtooth",.3),200))}playCapture(){this.sfxEnabled&&(this.init(),this.playTone(1200,.05,"sine",.3),setTimeout(()=>this.playTone(800,.08,"sine",.2),50))}playHint(){this.sfxEnabled&&(this.init(),this.playTone(880,.1,"sine",.3),setTimeout(()=>this.playTone(1100,.15,"sine",.3),100))}playGold(){this.sfxEnabled&&(this.init(),this.playTone(1318.51,.05),setTimeout(()=>this.playTone(1567.98,.08),50))}vibrate(e=50){navigator.vibrate&&navigator.vibrate(e)}playCorrectWithVibrate(){this.playCorrect(),this.vibrate(50)}playWrongWithVibrate(){this.playWrong(),this.vibrate([50,30,50])}}const D=new dt,We="app_language";let $e=ee(We,"ko");const Ee={ko:{title:"ì˜¤ë‹µí—Œí„°",subtitle:"ë¡œê·¸ë¼ì´í¬ í•™ìŠµ RPG",slogan:"ë‚´ ì˜¤ë‹µì´ ëª¬ìŠ¤í„°ê°€ ëœë‹¤!",enterDungeon:"âš”ï¸ ë˜ì „ ì…ì¥",stats:"ğŸ“Š í†µê³„",shop:"ğŸª ìƒì ",settings:"âš™ï¸ ì„¤ì •",aiGenerate:"ğŸ¤– AI ë¬¸ì œ ìƒì„±",aiConnected:"ğŸŸ¢ AI ì—°ë™ë¨",aiNotConnected:"ğŸ”´ AI ë¯¸ì—°ë™ (ì„¤ì •ì—ì„œ ì—°ë™)",stage:"ìŠ¤í…Œì´ì§€",accuracyRate:"ì •ë‹µë¥ ",wrongMonster:"ì˜¤ë‹µ ëª¬ìŠ¤í„°",loadingQuestion:"ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",viewFull:"ğŸ” ì „ì²´ë³´ê¸°",seconds:"ì´ˆ",obtained:"íšë“!",skip:"â­ï¸ìŠ¤í‚µ",quit:"ğŸšªí¬ê¸°",cleared:"ğŸ‰ í´ë¦¬ì–´!",failed:"ğŸ’€ ì‹¤íŒ¨...",stageLabel:"ìŠ¤í…Œì´ì§€",defeatedMonsters:"ì²˜ì¹˜í•œ ëª¬ìŠ¤í„°",bestCombo:"ìµœê³  ì½¤ë³´",accuracyLabel:"ì •ë‹µë¥ ",earnedGold:"íšë“ ê³¨ë“œ",toMain:"ë©”ì¸ìœ¼ë¡œ",shopTitle:"ğŸª ìƒì ",back:"â† ë’¤ë¡œ",permanentUpgrade:"âš¡ ì˜êµ¬ ê°•í™”",consumableItems:"ğŸ’ ì†Œë¹„ ì•„ì´í…œ",randomBg:"ëœë¤ ë°°ê²½",randomBgDesc:"random background",randomBgApplied:"ğŸ¨ ë°°ê²½ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!",shopTabUpgrade:"ê°•í™”",shopTabConsume:"ì•„ì´í…œ",shopTabCosmetic:"ê¾¸ë¯¸ê¸°",shopStatSummary:"í˜„ì¬ ìŠ¤íƒ¯",shopHp:"HP",shopAtk:"ê³µê²©ë ¥",shopTime:"ì‹œê°„",shopGoldBonus:"ê³¨ë“œ+",shopMaxReached:"âœ¦ MAX",shopNotEnoughShort:"{0}G ë¶€ì¡±",shopCurrentTheme:"í˜„ì¬ í…Œë§ˆ",reviveTicketHint:"ì‚¬ë§ ì‹œ ìë™ ì‚¬ìš©",hintTicketHint:"ì „íˆ¬ ì¤‘ ğŸ’¡ ë²„íŠ¼",timeBoostHint:"ì „íˆ¬ ì¤‘ â° ë²„íŠ¼",doubleGoldHint:"ë˜ì „ ì…ì¥ ì‹œ ìë™",theme_default:"ê¸°ë³¸ (ì¸ë””ê³ )",theme_emerald:"ì—ë©”ë„ë“œ",theme_crimson:"í¬ë¦¼ìŠ¨",theme_amber:"ì•°ë²„",theme_violet:"ë°”ì´ì˜¬ë ›",theme_cyan:"ì‹œì•ˆ",theme_rose:"ë¡œì¦ˆ",settingsTitle:"âš™ï¸ ì„¤ì •",settingsTabGame:"ê²Œì„",settingsTabApi:"API",settingsTabData:"ë°ì´í„°",smilePrintApi:"ğŸ–¼ï¸ SmilePrint API (ê¶Œì¥)",configured:"âœ… ì„¤ì •ë¨",notConfigured:"âŒ ë¯¸ì„¤ì •",inputSmilePrintKey:"ğŸ”‘ SmilePrint API í‚¤ ì…ë ¥",geminiApi:"ğŸ¤– Gemini API (ë°±ì—…)",geminiKey:"ğŸ”‘ Gemini í‚¤",testGenerate:"í…ŒìŠ¤íŠ¸ ìƒì„±",soundSettings:"ğŸ”Š ì‚¬ìš´ë“œ ì„¤ì •",bgmOn:"ğŸµ BGM ON",bgmOff:"ğŸ”‡ BGM OFF",sfxOn:"ğŸ”Š íš¨ê³¼ìŒ ON",sfxOff:"ğŸ”ˆ íš¨ê³¼ìŒ OFF",apiGuide:"ğŸ“‹ API í‚¤ ë°œê¸‰ ë°©ë²•",smilePrintSection:"[ SmilePrint API ]",requestAdmin:"ê´€ë¦¬ìì—ê²Œ API í‚¤ ìš”ì²­",geminiSection:"[ Gemini API ]",visitAiStudio:"aistudio.google.com ì ‘ì†",createApiKey:"Get API Key â†’ Create API Key",aiFeatures:"AI ì—°ë™ ì‹œ ê°€ëŠ¥í•œ ê¸°ëŠ¥:",aiFeature1:"â€¢ ë¬¸ì œ ì‚¬ì§„ ìë™ ë¶„ì„ (SmilePrint)",aiFeature2:"â€¢ ìœ ì‚¬ ë¬¸ì œ ìë™ ìƒì„± (Gemini)",aiFeature3:"â€¢ ë¬¸ì œ í’€ì´ íŒíŠ¸ ì œê³µ",dataManage:"ğŸ—‚ï¸ ë°ì´í„° ê´€ë¦¬",problemCount:"ë¬¸ì œ {0}ê°œ",export:"ğŸ“¤ ë‚´ë³´ë‚´ê¸°",import:"ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°",resetAll:"ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”",langSettings:"ğŸŒ ì–¸ì–´ ì„¤ì •",uiOpacityTitle:"ğŸ”² UI íˆ¬ëª…ë„",statsTitle:"ğŸ“Š í†µê³„",overallStats:"ğŸ“‹ ì „ì²´ í†µê³„",totalQuestions:"ì´ ë¬¸ì œ ìˆ˜",totalRuns:"ì´ ëŸ° íšŸìˆ˜",subjectStats:"ğŸ“š ê³¼ëª©ë³„ í†µê³„",difficultyStats:"ğŸ¯ ë‚œì´ë„ë³„ ë¶„ì„",easy:"ì‰¬ì›€",normal:"ë³´í†µ",hard:"ì–´ë ¤ì›€",playRecord:"ğŸ† í”Œë ˆì´ ê¸°ë¡",clear:"í´ë¦¬ì–´",fail:"ì‹¤íŒ¨",totalGoldEarned:"ì´ íšë“ ê³¨ë“œ",stats_winRate:"ìŠ¹ë¥ ",stats_totalPlayTime:"ì´ í”Œë ˆì´ ì‹œê°„",stats_avgRunDuration:"í‰ê·  ëŸ° ì‹œê°„",stats_longestRun:"ìµœì¥ ëŸ°",stats_shortestClear:"ìµœë‹¨ í´ë¦¬ì–´",stats_currentStreak:"í˜„ì¬ ì—°ìŠ¹",stats_bestStreak:"ìµœê³  ì—°ìŠ¹",stats_recentRecord:"ìµœê·¼ ì „ì ",stats_recentWinRate:"ìµœê·¼ ìŠ¹ë¥ ",stats_recentAccuracy:"ìµœê·¼ ì •ë‹µë¥ ",stats_subjectAccuracy:"ê³¼ëª©ë³„ ì •ë‹µë¥ ",stats_difficultyAccuracy:"ë‚œì´ë„ë³„ ì •ë‹µë¥ ",stats_avgAccuracy:"í‰ê·  ì •ë‹µë¥ ",stats_avgGoldPerRun:"ëŸ°ë‹¹ í‰ê·  ê³¨ë“œ",stats_totalDefeated:"ì´ ì²˜ì¹˜ ìˆ˜",stats_heroBanner:"íˆì–´ë¡œ í†µê³„",stats_streakTime:"ì—°ìŠ¹ & ì‹œê°„",stats_subjectPerf:"ê³¼ëª©ë³„ ì„±ê³¼",stats_diffAnalysis:"ë‚œì´ë„ ë¶„ì„",stats_playStats:"í”Œë ˆì´ ê¸°ë¡",stats_recentBattle:"ìµœê·¼ ì „ì ",stats_advanced:"ì‹¬í™” í†µê³„",stats_noData:"ì•„ì§ í”Œë ˆì´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤",stats_noDataSub:"ë˜ì „ì— ë„ì „í•˜ì—¬ í†µê³„ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”!",stats_runs:"íšŒ",stats_wins:"ìŠ¹ë¦¬",stats_losses:"íŒ¨ë°°",stats_accuracy:"ì •ë‹µë¥ ",stats_combo:"ì½¤ë³´",stats_gold:"ê³¨ë“œ",stats_time:"ì‹œê°„",stats_streak:"ì—°ìŠ¹",stats_min:"ë¶„",stats_sec:"ì´ˆ",stats_hr:"ì‹œê°„",stats_attempts:"ì‹œë„",stats_correct:"ì •ë‹µ",stats_itemUsage:"ì•„ì´í…œ ì‚¬ìš© í†µê³„",stats_skipTotal:"ìŠ¤í‚µ",stats_hintTotal:"íŒíŠ¸",stats_timeBoostTotal:"ì‹œê°„ì—°ì¥",stats_reviveTotal:"ë¶€í™œ",stats_timeoutTotal:"ì‹œê°„ì´ˆê³¼",stats_perRun:"í‰ê· ",stats_wrongBySubject:"ê³¼ëª©ë³„ ì˜¤ë‹µ ë¶„ì„",stats_wrongCount:"âŒ",stats_correctCount:"âœ…",stats_wrongRate:"ì˜¤ë‹µë¥ ",stats_hintShort:"íŒíŠ¸",stats_timeBoostShort:"ì‹œê°„+",stats_reviveShort:"ë¶€í™œ",result_itemUsage:"ì•„ì´í…œ ì‚¬ìš©",result_timeout:"ì‹œê°„ì´ˆê³¼",stats_topicAnalysis:"ìœ í˜•ë³„ ì˜¤ë‹µ ë¶„ì„",stats_weakTopics:"ì·¨ì•½ ìœ í˜• TOP",stats_noWrongTopics:"ì˜¤ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",stats_topicDetail:"ìœ í˜•ë³„",stats_colAttempts:"íšŸìˆ˜",stats_colCorrectRate:"ì •ë‹µë¥ ",stats_colWrongRate:"ì˜¤ë‹µë¥ ",stats_colDate:"ë‚ ì§œ",stats_colCombo:"ì½¤ë³´",stats_colGold:"ê³¨ë“œ",stats_colTime:"ì‹œê°„",stats_diffWrong:"ë‚œì´ë„ë³„ ì˜¤ë‹µ",stats_tabOverview:"ì¢…í•©",stats_tabSubject:"ê³¼ëª©",stats_tabAnalysis:"ë¶„ì„",dungeonSelect:"âš”ï¸ ë˜ì „ ì„ íƒ",selectDungeon:"ë„ì „í•  ë˜ì „ì„ ì„ íƒí•˜ì„¸ìš”",mathDungeon:"ìˆ˜í•™ ë˜ì „",scienceDungeon:"ê³¼í•™ ë˜ì „",registeredMonsters:"ë“±ë¡ëœ ëª¬ìŠ¤í„°: {0}ë§ˆë¦¬",mathTopics:"ë°©ì •ì‹, í•¨ìˆ˜, í™•ë¥ , ë„í˜• ë“±",scienceTopics:"í˜ê³¼ ìš´ë™, í™”í•™ë°˜ì‘, ìœ ì „, ì—­í•™ ë“±",goBack:"â† ë’¤ë¡œê°€ê¸°",subjectSelect:"ğŸ“¸ ê³¼ëª© ì„ íƒ",cancel:"â† ì·¨ì†Œ",capturedPhoto:"ğŸ“· ì´¬ì˜ëœ ì‚¬ì§„",selectSubject:"ì´ ë¬¸ì œì˜ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”",math:"ìˆ˜í•™",english:"ì˜ì–´",korean:"êµ­ì–´",science:"ê³¼í•™",boss:"ë³´ìŠ¤",midBoss:"ì¤‘ê°„ë³´ìŠ¤",finalBoss:"ìµœì¢…ë³´ìŠ¤",rarityNormal:"ì¼ë°˜",rarityRare:"ë ˆì–´",rarityEpic:"ì—í”½",rarityLegendary:"ì „ì„¤",hpUpgrade:"HP ê°•í™”",hpUpgradeDesc:"ìµœëŒ€ HP +10",timeUpgrade:"ì‹œê°„ ê°•í™”",timeUpgradeDesc:"ì œí•œ ì‹œê°„ +3ì´ˆ",goldBonus:"ê³¨ë“œ ë³´ë„ˆìŠ¤",goldBonusDesc:"ê³¨ë“œ íšë“ +5%",damageUpgrade:"ê³µê²©ë ¥ ê°•í™”",damageUpgradeDesc:"ê¸°ë³¸ ë°ë¯¸ì§€ +5",reviveTicket:"ë¶€í™œê¶Œ",reviveTicketDesc:"ì‚¬ë§ ì‹œ HP 50% íšŒë³µ í›„ ë¶€í™œ",hintTicket:"íŒíŠ¸ê¶Œ",hintTicketDesc:"íŒíŠ¸ 1íšŒ ë¬´ë£Œ ì‚¬ìš©",timeBoost:"ì‹œê°„ ì—°ì¥",timeBoostDesc:"ì „íˆ¬ ì¤‘ ì‚¬ìš© ì‹œ í˜„ì¬ ë¬¸ì œ +60ì´ˆ",doubleGold:"ê³¨ë“œ 1.25ë°°",doubleGoldDesc:"ë‹¤ìŒ ëŸ° ê³¨ë“œ íšë“ 1.25ë°°",noProblems:"ë“±ë¡ëœ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤! ë¨¼ì € ì˜¤ë‹µì„ ë“±ë¡í•´ì£¼ì„¸ìš”.",goldMultiplierApplied:"âœ¨ ê³¨ë“œ 1.25ë°° ì•„ì´í…œ ì ìš©! ì´ë²ˆ ëŸ°ì—ì„œ íšë“ ê³¨ë“œê°€ 1.25ë°°ê°€ ë©ë‹ˆë‹¤!",noPhoto:"ì´¬ì˜ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.",aiAnalyzed:`AIê°€ ë¶„ì„í•œ ê²°ê³¼:

ë¬¸ì œ: {0}
ì •ë‹µ: {1}
ì£¼ì œ: {2}
í’€ì´: {3}

ì´ ë‚´ìš©ì´ ë§ë‚˜ìš”?`,aiAnalyzedSimple:`AIê°€ ë¶„ì„í•œ ê²°ê³¼:

ë¬¸ì œ: {0}
ì •ë‹µ: {1}

ì´ ë‚´ìš©ì´ ë§ë‚˜ìš”?`,editQuestion:"ë¬¸ì œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”:",editAnswer:"ì •ë‹µì„ ìˆ˜ì •í•˜ì„¸ìš”:",aiFailed:`AI ë¶„ì„ ì‹¤íŒ¨: {0}

ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.`,inputQuestion:"ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”:",inputAnswer:"ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”:",inputAnswerNum:"ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš” (ìˆ«ì):",noAnswer:"ì •ë‹µì´ ì—†ì–´ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",monsterRegistered:"ëª¬ìŠ¤í„°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘¾",inputGeminiKey:"Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:",geminiKeySaved:"Gemini API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!",inputSmilePrintApiKey:"SmilePrint API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:",smilePrintKeySaved:`SmilePrint API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!

ì´ë¯¸ì§€ ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,testGenerating:"í…ŒìŠ¤íŠ¸ ë¬¸ì œ ìƒì„± ì¤‘... ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.",testGenerated:`âœ… {0}ê°œ ë¬¸ì œ ìƒì„± ë° ë˜ì „ ì¶”ê°€ ì™„ë£Œ!

ì˜ˆì‹œ:
ë¬¸ì œ: {1}
ì •ë‹µ: {2}`,generateFailed:"ë¬¸ì œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",invalidInput:"ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤",aiGenerateMenu:`ğŸ¤– AI ë¬¸ì œ ìƒì„±

ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”:
1. {0}
2. {1}

ë²ˆí˜¸ ì…ë ¥ (1-2):`,aiTopicMenu:`ğŸ¤– AI {0}ë¬¸ì œ ìƒì„±

ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”:
{1}

ë²ˆí˜¸ ì…ë ¥ (1-{2}):`,difficultyMenu:`ì£¼ì œ: {0}

ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”:
1. {1}
2. {2}
3. {3}

ë²ˆí˜¸ ì…ë ¥:`,countMenu:`ì£¼ì œ: {0}
ë‚œì´ë„: {1}

ìƒì„±í•  ë¬¸ì œ ê°œìˆ˜ (1-10):`,generated:`âœ… {0}ê°œ ë¬¸ì œ ìƒì„± ì™„ë£Œ!

ì£¼ì œ: {1}
ë‚œì´ë„: {2}

ì˜ˆì‹œ:
ë¬¸ì œ: {3}
ì •ë‹µ: {4}`,levelProgress:"ğŸ“Š ë ˆë²¨ ì§„ì²™ë„",currentStats:"ğŸ“‹ í˜„ì¬ ìŠ¤íƒ¯",nextBonus:"ğŸ¯ ë‹¤ìŒ ë³´ë„ˆìŠ¤",expGain:"ğŸ’¡ ê²½í—˜ì¹˜ íšë“",close:"ë‹«ê¸°",correctAnswer:"ì •ë‹µ",monsterKill:"ëª¬ìŠ¤í„° ì²˜ì¹˜",normalBossLabel:"ì¼ë°˜ ë³´ìŠ¤",midBossLabel:"ì¤‘ê°„ ë³´ìŠ¤",finalBossLabel:"ìµœì¢… ë³´ìŠ¤",base:"ê¸°ë³¸",level:"ë ˆë²¨",upgrade:"ê°•í™”",attack:"ê³µê²©ë ¥",time:"ì‹œê°„",noProblemsToReset:"ì´ˆê¸°í™”í•  ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.",confirmReset:`ì •ë§ë¡œ ëª¨ë“  ë¬¸ì œ({0}ê°œ)ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,confirmResetFinal:`âš ï¸ ìµœì¢… í™•ì¸

{0}ê°œì˜ ë¬¸ì œê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.
ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,resetDone:"âœ… {0}ê°œì˜ ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",resetError:"ë¬¸ì œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",resetAccount:"ğŸ”„ ê³„ì • ì´ˆê¸°í™”",confirmAccountReset:`âš ï¸ ê³„ì • ì´ˆê¸°í™”

ë ˆë²¨, ê³¨ë“œ, ì—…ê·¸ë ˆì´ë“œ, ì•„ì´í…œ, í”Œë ˆì´ ê¸°ë¡ì´
ëª¨ë‘ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

(ë“±ë¡í•œ ë¬¸ì œëŠ” ìœ ì§€ë©ë‹ˆë‹¤)

ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,confirmAccountResetFinal:`âš ï¸ ìµœì¢… í™•ì¸

ê³„ì • ë°ì´í„°ê°€ ì˜êµ¬ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,accountResetDone:`âœ… ê³„ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
ë ˆë²¨ 1, ê³¨ë“œ 100ìœ¼ë¡œ ì¬ì‹œì‘í•©ë‹ˆë‹¤.`,accountResetError:"ê³„ì • ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",noExportData:"ë‚´ë³´ë‚¼ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.",exported:"âœ… {0}ê°œì˜ ë¬¸ì œë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤!",exportError:"ë¬¸ì œ ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",invalidFile:"ì˜¬ë°”ë¥¸ ë¬¸ì œ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.",noImportData:"ë¶ˆëŸ¬ì˜¬ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.",confirmImport:`{0}ê°œì˜ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

(ê¸°ì¡´ ë¬¸ì œëŠ” ìœ ì§€ë©ë‹ˆë‹¤)`,imported:"âœ… {0}ê°œì˜ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!",importError:`ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`,analyzing:"ğŸ¤– {0} ë¶„ì„ ì¤‘...",analyzingDesc:"ë¬¸ì œë¥¼ ì½ê³  ë‹µì„ ì°¾ê³  ìˆì–´ìš”",generating:"ğŸ¤– AI ë¬¸ì œ ìƒì„± ì¤‘...",generatingDesc:"{0}ê°œ ë¬¸ì œë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”",pleaseWait:"ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...",autoFillGenerating:"ğŸ¤– ë¬¸ì œ ìë™ ìƒì„± ì¤‘...",autoFillDesc:"{0}ê°œ ë¬¸ì œë¥¼ ì±„ìš°ê³  ìˆìŠµë‹ˆë‹¤",autoFillProgress:"{0}/{1}ê°œ ìƒì„± ì™„ë£Œ",monsterHpRecover:"ëª¬ìŠ¤í„° ì²´ë ¥ íšŒë³µ!",reviveUsed:`ğŸª¶ ë¶€í™œê¶Œ ì‚¬ìš©! HP 50% íšŒë³µ!
(ë‚¨ì€ ë¶€í™œê¶Œ: {0})`,noHintNoGold:`íŒíŠ¸ê¶Œì´ ì—†ê³  ê³¨ë“œë„ ë¶€ì¡±í•©ë‹ˆë‹¤!
(50G í•„ìš”)

ìƒì ì—ì„œ íŒíŠ¸ê¶Œì„ êµ¬ë§¤í•˜ì„¸ìš”!`,useGoldForHint:`íŒíŠ¸ê¶Œì´ ì—†ìŠµë‹ˆë‹¤.
50Gë¥¼ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

í˜„ì¬ ê³¨ë“œ: {0}G`,topicHint:"ğŸ“š ì£¼ì œ: {0}",explanationHint:"ğŸ’­ í’€ì´ íŒíŠ¸: {0}...",wrongChoiceHint:"âŒ {0}ë²ˆì€ ì˜¤ë‹µì…ë‹ˆë‹¤!",keywordHint:"ğŸ”‘ í‚¤ì›Œë“œ: {0}",readCarefully:"ğŸ’¡ ë¬¸ì œë¥¼ ì°¨ê·¼ì°¨ê·¼ ì½ì–´ë³´ì„¸ìš”!",trySubstitute:"ğŸ“ ì„ íƒì§€ë¥¼ í•˜ë‚˜ì”© ëŒ€ì…í•´ë³´ì„¸ìš”.",hintTitle:"ğŸ’¡ íŒíŠ¸",timeBoostUsed:"â° ì‹œê°„ +60ì´ˆ! (ë‚¨ì€ ì‹œê°„ì—°ì¥: {0})",noTimeBoost:`ì‹œê°„ ì—°ì¥ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤!
ìƒì ì—ì„œ êµ¬ë§¤í•˜ì„¸ìš”.`,questionLabel:"ğŸ“ ë¬¸ì œ",noQuestion:"ë¬¸ì œ ì—†ìŒ",problemViewer:"ğŸ“‹ ë¬¸ì œ ë³´ê¸°",problemViewerEmpty:"ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.",filterAll:"ì „ì²´",filterImage:"ğŸ“· ì´ë¯¸ì§€",answerLabel:"ì •ë‹µ",difficultyLabel:"ë‚œì´ë„",alreadyMax:"ì´ë¯¸ ìµœëŒ€ ë ˆë²¨ì…ë‹ˆë‹¤!",notEnoughGold:"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!",upgradeBought:"{0} {1} Lv.{2} êµ¬ë§¤ ì™„ë£Œ!",itemBought:"{0} {1} êµ¬ë§¤ ì™„ë£Œ! (ë³´ìœ : {2}ê°œ)",levelUp:"ğŸ‰ ë ˆë²¨ì—…! LV.{0}",attackBonus:"ê³µê²©ë ¥ +{0}",timeBonus:"ë¬¸ì œ ì‹œê°„ +{0}ì´ˆ",maxLevelBonus:"ğŸ† MAX! ê³µê²©ë ¥+10, HP+10, ì‹œê°„+15",exportFilename:"ì˜¤ë‹µë¬¸ì œ","item.hpPotion":"HP í¬ì…˜","item.timeSand":"ì‹œê°„ì˜ ëª¨ë˜","item.smallGoldBag":"ì‘ì€ ê¸ˆí™” ì£¼ë¨¸ë‹ˆ","item.highHpPotion":"ê³ ê¸‰ HP í¬ì…˜","item.timeCrystal":"ì‹œê°„ì˜ ìˆ˜ì •","item.goldBag":"ê¸ˆí™” ì£¼ë¨¸ë‹ˆ","item.comboBooster":"ì½¤ë³´ ë¶€ìŠ¤í„°","item.holyGrail":"ìƒëª…ì˜ ì„±ë°°","item.freeHint":"ë¬´ë£Œ íŒíŠ¸ê¶Œ","item.reviveFeather":"ë¶€í™œì˜ ê¹ƒí„¸","item.goldAmulet":"ê³¨ë“œ 1.25ë°° ë¶€ì ","item.immortalRing":"ë¶ˆì‚¬ì˜ ë°˜ì§€","item.timeStop":"ì‹œê°„ ì •ì§€","item.legendaryGold":"ì „ì„¤ì˜ ê¸ˆê´´","item.wisdomCrown":"ì§€í˜œì˜ ì™•ê´€","mon.slime":"ìŠ¬ë¼ì„","mon.blob":"ë¸”ë¡­","mon.muryeong":"ë¬¼ë ¹","mon.jelly":"ì ¤ë¦¬","mon.skeleton":"í•´ê³¨ë³‘ì‚¬","mon.skelleton":"ìŠ¤ì¼ˆë ˆí†¤","mon.baekgol":"ë°±ê³¨","mon.boneguard":"ë³¸ê°€ë“œ","mon.bat":"ë°•ì¥","mon.batwing":"ë°°íŠ¸","mon.yacha":"ì•¼ì°¨","mon.flying":"í”Œë¼ì‰","mon.zombie":"ì¢€ë¹„","mon.undead":"ì–¸ë°ë“œ","mon.gangsi":"ê°•ì‹œ","mon.mutant":"ë®¤í„´íŠ¸","mon.ghost":"ìœ ë ¹","mon.ghosty":"ê³ ìŠ¤íŠ¸","mon.wongui":"ì›ê·€","mon.specter":"ìŠ¤í™í„°","mon.spider":"ê±°ë¯¸","mon.spidery":"ìŠ¤íŒŒì´ë”","mon.dokchung":"ë…ì¶©","mon.arachne":"ì•„ë¼í¬ë„¤",loggingIn:"ë¡œê·¸ì¸ ì¤‘...",loginFailed:"ë¡œê·¸ì¸ ì‹¤íŒ¨",serverError:"ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",cameraError:"ì¹´ë©”ë¼ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ",loading:"ë¡œë”© ì¤‘...",error:"ì˜¤ë¥˜: ",googleLoadFailed:"Google ë¡œê·¸ì¸ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.",htmlTitle:"ì˜¤ë‹µí—Œí„°",htmlSlogan:"ë‚´ ì˜¤ë‹µì´ ëª¬ìŠ¤í„°ê°€ ëœë‹¤!",htmlRegister:"ğŸ“¸ ì˜¤ë‹µ ë“±ë¡",htmlLogout:"ë¡œê·¸ì•„ì›ƒ",htmlCapture:"ğŸ“· ì´¬ì˜",htmlClose:"âœ• ë‹«ê¸°",multipleChoice:"ê°ê´€ì‹",noAnalysisResult:"ë¶„ì„ ê²°ê³¼ ì—†ìŒ",defaultTopic:"ìˆ˜í•™",defaultProblem:"ë¬¸ì œ",linearEquation:"ì¼ì°¨ë°©ì •ì‹",guide_title_0:"ì˜¤ë‹µí—Œí„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!",guide_title_1:"ì˜¤ë‹µì„ ë“±ë¡í•˜ì„¸ìš”",guide_title_2:"ë˜ì „ êµ¬ì¡°",guide_title_3:"ì „íˆ¬ ë©”ì»¤ë‹ˆì¦˜",guide_title_4:"ì•„ì´í…œ",guide_title_5:"ìƒì ",guide_title_6:"ì„±ì¥ ì‹œìŠ¤í…œ",guide_desc_0:`ì˜¤ë‹µí—Œí„°ëŠ” í‹€ë¦° ë¬¸ì œê°€
ëª¬ìŠ¤í„°ê°€ ë˜ëŠ” í•™ìŠµ RPGì…ë‹ˆë‹¤!

ğŸ“¸ ì˜¤ë‹µ ì‚¬ì§„ ì´¬ì˜ â†’ AIê°€ ëª¬ìŠ¤í„° ìƒì„±
âš”ï¸ ë˜ì „ì—ì„œ ë¬¸ì œë¥¼ í’€ë©° ëª¬ìŠ¤í„° í‡´ì¹˜
ğŸ’° ê³¨ë“œì™€ ê²½í—˜ì¹˜ë¡œ ìºë¦­í„° ì„±ì¥

í‹€ë¦´ìˆ˜ë¡ ê°•í•´ì§€ëŠ” ë‚˜ë§Œì˜ ë˜ì „!`,guide_desc_1:`í•˜ë‹¨ì˜ ğŸ“¸ ì˜¤ë‹µ ë“±ë¡ ë²„íŠ¼ìœ¼ë¡œ
í‹€ë¦° ë¬¸ì œ ì‚¬ì§„ì„ ì´¬ì˜í•˜ì„¸ìš”.

ğŸ“ ìˆ˜í•™ / ğŸ”¬ ê³¼í•™ ê³¼ëª© ì„ íƒ
â†’ AIê°€ ë¬¸ì œë¥¼ ìë™ ë¶„ì„
â†’ 4ì§€ì„ ë‹¤ ëª¬ìŠ¤í„°ê°€ ìƒì„±!

ëª¬ìŠ¤í„°ê°€ ë§ì„ìˆ˜ë¡ ë˜ì „ì´ í’ì„±í•´ì ¸ìš”.`,guide_desc_2:`ë˜ì „ì€ ì´ 100ì¸µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

ğŸ‘¹ 10ì¸µë§ˆë‹¤ ë³´ìŠ¤ ëª¬ìŠ¤í„° ë“±ì¥
ğŸ‘¿ 50ì¸µì— ê°•ë ¥í•œ ì¤‘ê°„ ë³´ìŠ¤
ğŸ‰ 100ì¸µì— ìµœì¢… ë³´ìŠ¤ ëŒ€ê¸°!

ë³´ìŠ¤ëŠ” HPê°€ ë†’ê³  ì˜¤ë‹µ ì‹œ ë²Œì¹™ì´ í¬ì§€ë§Œ
ì²˜ì¹˜í•˜ë©´ ëŒ€ëŸ‰ ê³¨ë“œì™€ ì•„ì´í…œì„ ë“œë!`,guide_desc_3:`â­• ì •ë‹µ â†’ ëª¬ìŠ¤í„°ì—ê²Œ ë°ë¯¸ì§€!
âŒ ì˜¤ë‹µ â†’ ë‚´ê°€ í”¼í•´ë¥¼ ë°›ìŒ
â° ì‹œê°„ ì´ˆê³¼ â†’ í° í”¼í•´ + ë‹¤ìŒ ë¬¸ì œ

ğŸ”¥ ì—°ì† ì •ë‹µìœ¼ë¡œ ì½¤ë³´ ë°œë™!
ì½¤ë³´ê°€ ë†’ì„ìˆ˜ë¡ ì¶”ê°€ ë°ë¯¸ì§€+ê³¨ë“œ

â­ï¸ ìŠ¤í‚µ: ì†ŒëŸ‰ í”¼í•´ë¡œ ë¬¸ì œ ë„˜ê¸°ê¸°`,guide_desc_4:`ì „íˆ¬ ì¤‘ ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´í…œ:

ğŸª¶ ë¶€í™œê¶Œ: HP 0 ì‹œ ìë™ ë¶€í™œ (50%)
ğŸ’¡ íŒíŠ¸: ë¬¸ì œ íŒíŠ¸ + ì˜¤ë‹µ 1ê°œ ì œê±°
â° ì‹œê°„ ë¶€ìŠ¤íŠ¸: 60ì´ˆ ì¶”ê°€
âœ¨ ê³¨ë“œ 2ë°°: ë˜ì „ ì…ì¥ ì‹œ ìë™ ì ìš©

ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ì•„ì´í…œ ë“œë ì°¬ìŠ¤!
ë³´ìŠ¤ì¼ìˆ˜ë¡ ë“œë í™•ë¥ ì´ ë†’ì•„ìš” ğŸ`,guide_desc_5:`ë©”ì¸ì˜ ğŸª ìƒì ì—ì„œ ê°•í™”í•˜ì„¸ìš”!

âš¡ ê°•í™”: HPÂ·ê³µê²©ë ¥Â·ì‹œê°„Â·ê³¨ë“œ ë³´ë„ˆìŠ¤
   ì˜êµ¬ ìŠ¤íƒ¯ ì—…ê·¸ë ˆì´ë“œ!
ğŸ’ ì•„ì´í…œ: ì†Œë¹„ ì•„ì´í…œ êµ¬ë§¤ (Ã—5 ëŒ€ëŸ‰ ê°€ëŠ¥)
ğŸ¨ ê¾¸ë¯¸ê¸°: ë°°ê²½ í…Œë§ˆ ë³€ê²½

ê³¨ë“œë¥¼ ëª¨ì•„ ì „ëµì ìœ¼ë¡œ íˆ¬ìí•˜ì„¸ìš”.`,guide_desc_6:`ë ˆë²¨ì€ ìµœëŒ€ 100ê¹Œì§€ ì„±ì¥!
ë ˆë²¨ì—…ë§ˆë‹¤ HPÂ·ê³µê²©ë ¥Â·ì‹œê°„ ë³´ë„ˆìŠ¤

ğŸ† 30ê°œ ì´ìƒì˜ ì—…ì  ë‹¬ì„± ë„ì „
   ì½¤ë³´Â·ë³´ìŠ¤Â·í´ë¦¬ì–´Â·ë ˆë²¨ ì—…ì  ë“±

ğŸ“‹ ì¼ì¼ ë¯¸ì…˜ 3ê°œ (ë§¤ì¼ ê°±ì‹ )
ğŸ“… ì£¼ê°„ ë¯¸ì…˜ 3ê°œ (ë§¤ì£¼ ê°±ì‹ )
ë¯¸ì…˜ ë‹¬ì„±ìœ¼ë¡œ ì¶”ê°€ ê³¨ë“œ+ê²½í—˜ì¹˜!`,guide_next:"ë‹¤ìŒ â–¶",achievementTitle:"ğŸ† ì—…ì ",achievement:"ğŸ† ì—…ì ",dailyMissionTitle:"ğŸ“‹ ì¼ì¼ ë¯¸ì…˜",achievementList:"ğŸ† ì—…ì  ({0}/{1})",claimed:"ìˆ˜ë ¹ì™„ë£Œ",achv_cat_combo:"ğŸ”¥ ì½¤ë³´",achv_cat_run:"â­ ëŸ°",achv_cat_boss:"ğŸ‘¹ ë³´ìŠ¤",achv_cat_level:"ğŸ“ˆ ë ˆë²¨",achv_cat_gold:"ğŸ’° ê³¨ë“œ",achv_cat_kills:"âš”ï¸ ì²˜ì¹˜",achv_cat_subject:"ğŸ“š ê³¼ëª©",achv_cat_study:"âœ… í•™ìŠµ",achv_combo_3:"ë¶ˆê½ƒ ì‹œì‘",achv_combo_3_desc:"10 ì½¤ë³´ ë‹¬ì„±",achv_combo_5:"ì—°ì† ì •ë‹µì™•",achv_combo_5_desc:"20 ì½¤ë³´ ë‹¬ì„±",achv_combo_10:"ì½¤ë³´ ë§ˆìŠ¤í„°",achv_combo_10_desc:"50 ì½¤ë³´ ë‹¬ì„±",achv_combo_20:"ì „ì„¤ì˜ ì½¤ë³´",achv_combo_20_desc:"100 ì½¤ë³´ ë‹¬ì„±",achv_combo_500:"ì‹ ì˜ ì½¤ë³´",achv_combo_500_desc:"500 ì½¤ë³´ ë‹¬ì„±",achv_first_clear:"ì²« í´ë¦¬ì–´",achv_first_clear_desc:"ì²« ë˜ì „ í´ë¦¬ì–´",achv_clear_10:"ë˜ì „ ì •ë³µì",achv_clear_10_desc:"20íšŒ í´ë¦¬ì–´",achv_clear_50:"ë˜ì „ ë§ˆìŠ¤í„°",achv_clear_50_desc:"80íšŒ í´ë¦¬ì–´",achv_perfect_run:"ì™„ë²½í•œ ëŸ°",achv_perfect_run_desc:"ì •ë‹µë¥  100% í´ë¦¬ì–´ (10ë¬¸ì œ ì´ìƒ)",achv_boss_normal:"ë³´ìŠ¤ ì‚¬ëƒ¥ê¾¼",achv_boss_normal_desc:"ì¼ë°˜ ë³´ìŠ¤ ì²˜ì¹˜",achv_boss_mid:"ì¤‘ê°„ë³´ìŠ¤ ê²©íŒŒ",achv_boss_mid_desc:"ì¤‘ê°„ ë³´ìŠ¤ ì²˜ì¹˜",achv_boss_final:"ìµœì¢…ë³´ìŠ¤ ì²˜ì¹˜",achv_boss_final_desc:"ìµœì¢… ë³´ìŠ¤ ì²˜ì¹˜",achv_level_10:"ì„±ì¥ì˜ ì‹œì‘",achv_level_10_desc:"ë ˆë²¨ 15 ë‹¬ì„±",achv_level_25:"ì¤‘ê¸‰ ëª¨í—˜ê°€",achv_level_25_desc:"ë ˆë²¨ 35 ë‹¬ì„±",achv_level_50:"ê³ ê¸‰ ëª¨í—˜ê°€",achv_level_50_desc:"ë ˆë²¨ 60 ë‹¬ì„±",achv_level_99:"ìµœê°•ì",achv_level_99_desc:"ë ˆë²¨ 99 ë‹¬ì„±",achv_level_100:"ì „ì„¤ì˜ ì‹œì‘",achv_level_100_desc:"ë ˆë²¨ 100 ë‹¬ì„± â€” í•œê³„ë¥¼ ë„˜ì–´ì„  ì",hiddenAchievement:"ìˆ¨ê²¨ì§„ ì—…ì ",achv_gold_1000:"ê¸ˆí™” ìˆ˜ì§‘ê°€",achv_gold_1000_desc:"ëˆ„ì  3,000G íšë“",achv_gold_10000:"ë¶€ìì˜ ê¸¸",achv_gold_10000_desc:"ëˆ„ì  20,000G íšë“",achv_gold_100000:"ê³¨ë“œ ì™•",achv_gold_100000_desc:"ëˆ„ì  150,000G íšë“",achv_kills_50:"80ë§ˆë¦¬ ì²˜ì¹˜",achv_kills_50_desc:"ëª¬ìŠ¤í„° 80ë§ˆë¦¬ ì²˜ì¹˜",achv_kills_100:"200ë§ˆë¦¬ ì²˜ì¹˜",achv_kills_100_desc:"ëª¬ìŠ¤í„° 200ë§ˆë¦¬ ì²˜ì¹˜",achv_kills_500:"800ë§ˆë¦¬ í•™ì‚´ì",achv_kills_500_desc:"ëª¬ìŠ¤í„° 800ë§ˆë¦¬ ì²˜ì¹˜",achv_master_math:"ìˆ˜í•™ ë§ˆìŠ¤í„°",achv_master_math_desc:"ìˆ˜í•™ ë¬¸ì œ 150ê°œ ë“±ë¡",achv_master_science:"ê³¼í•™ ë§ˆìŠ¤í„°",achv_master_science_desc:"ê³¼í•™ ë¬¸ì œ 150ê°œ ë“±ë¡",achv_answer_100:"í•™ìŠµì˜ ì‹œì‘",achv_answer_100_desc:"ëˆ„ì  ì •ë‹µ 200ê°œ",achv_answer_500:"í•™ìŠµ ë‹¬ì¸",achv_answer_500_desc:"ëˆ„ì  ì •ë‹µ 800ê°œ",achv_damage_100:"ê°•ë ¥í•œ ì „ì‚¬",achv_damage_100_desc:"ê³µê²©ë ¥ 100 ë‹¬ì„±",achv_hp_500:"ì² ë²½ ë°©ì–´",achv_hp_500_desc:"ì²´ë ¥ 500 ë‹¬ì„±",achv_cat_power:"âš¡ ì „íˆ¬ë ¥",dm_correct_10:"ì˜¤ëŠ˜ ì •ë‹µ 10ê°œ",dm_correct_20:"ì˜¤ëŠ˜ ì •ë‹µ 20ê°œ",dm_defeat_3:"ëª¬ìŠ¤í„° 3ë§ˆë¦¬ ì²˜ì¹˜",dm_defeat_5:"ëª¬ìŠ¤í„° 5ë§ˆë¦¬ ì²˜ì¹˜",dm_combo_5:"5 ì½¤ë³´ ë‹¬ì„±",dm_combo_10:"10 ì½¤ë³´ ë‹¬ì„±",dm_clear_1:"ë˜ì „ 1íšŒ í´ë¦¬ì–´",dm_earn_100:"ê³¨ë“œ 100G íšë“",dm_earn_500:"ê³¨ë“œ 500G íšë“",dm_answer_30:"ë¬¸ì œ 30ê°œ í’€ê¸°",weeklyMissionTitle:"ğŸ“‹ ì£¼ê°„ ë¯¸ì…˜",wm_correct_150:"ì´ë²ˆ ì£¼ ì •ë‹µ 150ê°œ",wm_correct_300:"ì´ë²ˆ ì£¼ ì •ë‹µ 300ê°œ",wm_defeat_30:"ëª¬ìŠ¤í„° 30ë§ˆë¦¬ ì²˜ì¹˜",wm_defeat_50:"ëª¬ìŠ¤í„° 50ë§ˆë¦¬ ì²˜ì¹˜",wm_combo_50:"50 ì½¤ë³´ ë‹¬ì„±",wm_combo_100:"100 ì½¤ë³´ ë‹¬ì„±",wm_clear_7:"ë˜ì „ 7íšŒ í´ë¦¬ì–´",wm_earn_3000:"ê³¨ë“œ 3000G íšë“",wm_earn_7000:"ê³¨ë“œ 7000G íšë“",wm_answer_200:"ë¬¸ì œ 200ê°œ í’€ê¸°",guide_start:"ì‹œì‘í•˜ê¸°!",viewGuide:"ğŸ“– ê²Œì„ ê°€ì´ë“œ ë³´ê¸°",cosmetic_themes:"í…Œë§ˆ",cosmetic_particle:"íŒŒí‹°í´ ìŠ¤íƒ€ì¼",cosmetic_damageText:"ë°ë¯¸ì§€ í…ìŠ¤íŠ¸",cosmetic_flash:"ì •ë‹µ ì´í™íŠ¸",cosmetic_equipped:"ì¥ì°©ì¤‘",cosmetic_equip:"ì¥ì°©",cosmetic_particle_default:"ê¸°ë³¸",cosmetic_particle_gold:"í™©ê¸ˆ",cosmetic_particle_rainbow:"ë¬´ì§€ê°œ",cosmetic_particle_sakura:"ë²šê½ƒ",cosmetic_dmg_default:"ê¸°ë³¸",cosmetic_dmg_neon:"ë„¤ì˜¨",cosmetic_dmg_pixel:"í”½ì…€",cosmetic_flash_default:"ê¸°ë³¸ (ì´ˆë¡)",cosmetic_flash_blue:"íŒŒë‘",cosmetic_flash_purple:"ë³´ë¼"},en:{title:"Wrong Answer Hunter",subtitle:"Roguelike Learning RPG",slogan:"Your wrong answers become monsters!",enterDungeon:"âš”ï¸ Enter Dungeon",stats:"ğŸ“Š Stats",shop:"ğŸª Shop",settings:"âš™ï¸ Settings",aiGenerate:"ğŸ¤– AI Generate",aiConnected:"ğŸŸ¢ AI Connected",aiNotConnected:"ğŸ”´ AI Not Connected (Set in Settings)",stage:"Stage",accuracyRate:"Accuracy",wrongMonster:"Wrong Answer Monster",loadingQuestion:"Loading question...",viewFull:"ğŸ” View All",seconds:"s",obtained:"Obtained!",skip:"â­ï¸Skip",quit:"ğŸšªQuit",cleared:"ğŸ‰ Cleared!",failed:"ğŸ’€ Failed...",stageLabel:"Stage",defeatedMonsters:"Monsters Defeated",bestCombo:"Best Combo",accuracyLabel:"Accuracy",earnedGold:"Gold Earned",toMain:"To Main",shopTitle:"ğŸª Shop",back:"â† Back",permanentUpgrade:"âš¡ Permanent Upgrades",consumableItems:"ğŸ’ Consumables",randomBg:"Random Background",randomBgDesc:"random background",randomBgApplied:"ğŸ¨ Background has been changed!",shopTabUpgrade:"Upgrades",shopTabConsume:"Items",shopTabCosmetic:"Cosmetic",shopStatSummary:"Current Stats",shopHp:"HP",shopAtk:"ATK",shopTime:"TIME",shopGoldBonus:"GOLD+",shopMaxReached:"âœ¦ MAX",shopNotEnoughShort:"{0}G short",shopCurrentTheme:"Current Theme",reviveTicketHint:"Auto-used on death",hintTicketHint:"ğŸ’¡ button in battle",timeBoostHint:"â° button in battle",doubleGoldHint:"Auto on dungeon entry",theme_default:"Default (Indigo)",theme_emerald:"Emerald",theme_crimson:"Crimson",theme_amber:"Amber",theme_violet:"Violet",theme_cyan:"Cyan",theme_rose:"Rose",settingsTitle:"âš™ï¸ Settings",settingsTabGame:"Game",settingsTabApi:"API",settingsTabData:"Data",smilePrintApi:"ğŸ–¼ï¸ SmilePrint API (Recommended)",configured:"âœ… Configured",notConfigured:"âŒ Not Configured",inputSmilePrintKey:"ğŸ”‘ Enter SmilePrint API Key",geminiApi:"ğŸ¤– Gemini API (Backup)",geminiKey:"ğŸ”‘ Gemini Key",testGenerate:"Test Generate",soundSettings:"ğŸ”Š Sound Settings",bgmOn:"ğŸµ BGM ON",bgmOff:"ğŸ”‡ BGM OFF",sfxOn:"ğŸ”Š SFX ON",sfxOff:"ğŸ”ˆ SFX OFF",apiGuide:"ğŸ“‹ How to Get API Key",smilePrintSection:"[ SmilePrint API ]",requestAdmin:"Request API key from admin",geminiSection:"[ Gemini API ]",visitAiStudio:"Visit aistudio.google.com",createApiKey:"Get API Key â†’ Create API Key",aiFeatures:"Available with AI:",aiFeature1:"â€¢ Auto photo analysis (SmilePrint)",aiFeature2:"â€¢ Auto problem generation (Gemini)",aiFeature3:"â€¢ Problem solving hints",dataManage:"ğŸ—‚ï¸ Data Management",problemCount:"{0} problems",export:"ğŸ“¤ Export",import:"ğŸ“¥ Import",resetAll:"ğŸ—‘ï¸ Reset All",langSettings:"ğŸŒ Language",uiOpacityTitle:"ğŸ”² UI Opacity",statsTitle:"ğŸ“Š Stats",overallStats:"ğŸ“‹ Overall Stats",totalQuestions:"Total Questions",totalRuns:"Total Runs",subjectStats:"ğŸ“š By Subject",difficultyStats:"ğŸ¯ By Difficulty",easy:"Easy",normal:"Normal",hard:"Hard",playRecord:"ğŸ† Play Record",clear:"Cleared",fail:"Failed",totalGoldEarned:"Total Gold Earned",stats_winRate:"Win Rate",stats_totalPlayTime:"Total Play Time",stats_avgRunDuration:"Avg Run Duration",stats_longestRun:"Longest Run",stats_shortestClear:"Fastest Clear",stats_currentStreak:"Current Streak",stats_bestStreak:"Best Streak",stats_recentRecord:"Recent Record",stats_recentWinRate:"Recent Win Rate",stats_recentAccuracy:"Recent Accuracy",stats_subjectAccuracy:"Subject Accuracy",stats_difficultyAccuracy:"Difficulty Accuracy",stats_avgAccuracy:"Avg Accuracy",stats_avgGoldPerRun:"Avg Gold/Run",stats_totalDefeated:"Total Defeated",stats_heroBanner:"Hero Stats",stats_streakTime:"Streak & Time",stats_subjectPerf:"By Subject",stats_diffAnalysis:"Difficulty Analysis",stats_playStats:"Play Record",stats_recentBattle:"Recent Battles",stats_advanced:"Advanced Stats",stats_noData:"No play records yet",stats_noDataSub:"Challenge a dungeon to start tracking!",stats_runs:"runs",stats_wins:"Wins",stats_losses:"Losses",stats_accuracy:"Accuracy",stats_combo:"Combo",stats_gold:"Gold",stats_time:"Time",stats_streak:"Streak",stats_min:"min",stats_sec:"sec",stats_hr:"hr",stats_attempts:"Attempts",stats_correct:"Correct",stats_itemUsage:"Item Usage Stats",stats_skipTotal:"Skip",stats_hintTotal:"Hint",stats_timeBoostTotal:"Time+",stats_reviveTotal:"Revive",stats_timeoutTotal:"Timeout",stats_perRun:"Avg",stats_wrongBySubject:"Wrong Answers by Subject",stats_wrongCount:"âŒ",stats_correctCount:"âœ…",stats_wrongRate:"Wrong Rate",stats_hintShort:"Hint",stats_timeBoostShort:"Time+",stats_reviveShort:"Revive",result_itemUsage:"Item Usage",result_timeout:"Timeout",stats_topicAnalysis:"Wrong by Topic",stats_weakTopics:"Weak Topics TOP",stats_noWrongTopics:"No wrong answer data",stats_topicDetail:"By Type",stats_colAttempts:"Count",stats_colCorrectRate:"Correct%",stats_colWrongRate:"Wrong%",stats_colDate:"Date",stats_colCombo:"Combo",stats_colGold:"Gold",stats_colTime:"Time",stats_diffWrong:"Wrong by Difficulty",stats_tabOverview:"Overview",stats_tabSubject:"Subject",stats_tabAnalysis:"Analysis",dungeonSelect:"âš”ï¸ Select Dungeon",selectDungeon:"Choose a dungeon to challenge",mathDungeon:"Math Dungeon",scienceDungeon:"Science Dungeon",registeredMonsters:"Registered Monsters: {0}",mathTopics:"Equations, Functions, Probability, Geometry, etc.",scienceTopics:"Forces, Chemical Reactions, Genetics, Mechanics, etc.",goBack:"â† Go Back",subjectSelect:"ğŸ“¸ Select Subject",cancel:"â† Cancel",capturedPhoto:"ğŸ“· Captured Photo",selectSubject:"Select the subject for this problem",math:"Math",english:"English",korean:"Korean",science:"Science",boss:"Boss",midBoss:"Mid Boss",finalBoss:"Final Boss",rarityNormal:"Normal",rarityRare:"Rare",rarityEpic:"Epic",rarityLegendary:"Legendary",hpUpgrade:"HP Boost",hpUpgradeDesc:"Max HP +10",timeUpgrade:"Time Boost",timeUpgradeDesc:"Time Limit +3s",goldBonus:"Gold Bonus",goldBonusDesc:"Gold Gain +5%",damageUpgrade:"Attack Boost",damageUpgradeDesc:"Base Damage +5",reviveTicket:"Revive Ticket",reviveTicketDesc:"Revive with 50% HP on death",hintTicket:"Hint Ticket",hintTicketDesc:"Free hint use x1",timeBoost:"Time Extend",timeBoostDesc:"Current problem +60s in battle",doubleGold:"Gold x1.25",doubleGoldDesc:"Next run gold x1.25",noProblems:"No registered problems! Please register wrong answers first.",goldMultiplierApplied:"âœ¨ Gold x1.25 applied! Gold earned this run will be x1.25!",noPhoto:"No photo captured.",aiAnalyzed:`AI Analysis Result:

Question: {0}
Answer: {1}
Topic: {2}
Explanation: {3}

Is this correct?`,aiAnalyzedSimple:`AI Analysis Result:

Question: {0}
Answer: {1}

Is this correct?`,editQuestion:"Edit question:",editAnswer:"Edit answer:",aiFailed:`AI analysis failed: {0}

Please enter manually.`,inputQuestion:"Enter the question:",inputAnswer:"Enter the answer:",inputAnswerNum:"Enter the answer (number):",noAnswer:"Cannot register without an answer.",monsterRegistered:"Monster registered! ğŸ‘¾",inputGeminiKey:"Enter Gemini API Key:",geminiKeySaved:"Gemini API key saved!",inputSmilePrintApiKey:"Enter SmilePrint API Key:",smilePrintKeySaved:`SmilePrint API key saved!

Image analysis is now available.`,testGenerating:"Generating test problems... Please wait.",testGenerated:`âœ… {0} problems generated!

Example:
Q: {1}
A: {2}`,generateFailed:"Problem generation failed.",invalidInput:"Invalid input",aiGenerateMenu:`ğŸ¤– AI Problem Generation

Select subject:
1. {0}
2. {1}

Enter number (1-2):`,aiTopicMenu:`ğŸ¤– AI {0} Problem Generation

Select topic:
{1}

Enter number (1-{2}):`,difficultyMenu:`Topic: {0}

Select difficulty:
1. {1}
2. {2}
3. {3}

Enter number:`,countMenu:`Topic: {0}
Difficulty: {1}

Number of problems (1-10):`,generated:`âœ… {0} problems generated!

Topic: {1}
Difficulty: {2}

Example:
Q: {3}
A: {4}`,levelProgress:"ğŸ“Š Level Progress",currentStats:"ğŸ“‹ Current Stats",nextBonus:"ğŸ¯ Next Bonus",expGain:"ğŸ’¡ EXP Gain",close:"Close",correctAnswer:"Correct",monsterKill:"Monster Kill",normalBossLabel:"Normal Boss",midBossLabel:"Mid Boss",finalBossLabel:"Final Boss",base:"Base",level:"Level",upgrade:"Upgrade",attack:"Attack",time:"Time",noProblemsToReset:"No problems to reset.",confirmReset:`Delete all problems ({0})?

This cannot be undone.`,confirmResetFinal:`âš ï¸ Final Confirmation

{0} problems will be permanently deleted.
Are you sure?`,resetDone:"âœ… {0} problems deleted.",resetError:"Error resetting problems.",resetAccount:"ğŸ”„ Reset Account",confirmAccountReset:`âš ï¸ Reset Account

Level, gold, upgrades, items, and play records
will all be reset.

(Registered problems will be kept)

Are you sure?`,confirmAccountResetFinal:`âš ï¸ Final Confirmation

Account data will be permanently reset.
This cannot be undone. Proceed?`,accountResetDone:`âœ… Account has been reset.
Restarting at Level 1 with 100 gold.`,accountResetError:"Error resetting account.",noExportData:"No problems to export.",exported:"âœ… {0} problems exported!",exportError:"Error exporting problems.",invalidFile:"Invalid problem file.",noImportData:"No problems to import.",confirmImport:`Import {0} problems?

(Existing problems will be kept)`,imported:"âœ… {0} problems imported!",importError:`Error importing problems.
Please check the file format.`,analyzing:"ğŸ¤– {0} Analyzing...",analyzingDesc:"Reading the problem and finding the answer",generating:"ğŸ¤– AI Generating...",generatingDesc:"Creating {0} problems",pleaseWait:"Please wait...",autoFillGenerating:"ğŸ¤– Auto-generating problems...",autoFillDesc:"Filling {0} more problems",autoFillProgress:"{0}/{1} generated",monsterHpRecover:"Monster HP recovered!",reviveUsed:`ğŸª¶ Revive used! HP 50% restored!
(Remaining: {0})`,noHintNoGold:`No hint tickets and not enough gold!
(50G needed)

Buy hint tickets at the shop!`,useGoldForHint:`No hint tickets.
Use 50G?

Current gold: {0}G`,topicHint:"ğŸ“š Topic: {0}",explanationHint:"ğŸ’­ Hint: {0}...",wrongChoiceHint:"âŒ Option {0} is wrong!",keywordHint:"ğŸ”‘ Keywords: {0}",readCarefully:"ğŸ’¡ Read the problem carefully!",trySubstitute:"ğŸ“ Try substituting each option.",hintTitle:"ğŸ’¡ Hint",timeBoostUsed:"â° +60s! (Remaining: {0})",noTimeBoost:`No time extend items!
Buy at the shop.`,questionLabel:"ğŸ“ Question",noQuestion:"No question",problemViewer:"ğŸ“‹ Problems",problemViewerEmpty:"No problems registered.",filterAll:"All",filterImage:"ğŸ“· Image",answerLabel:"Answer",difficultyLabel:"Difficulty",alreadyMax:"Already at max level!",notEnoughGold:"Not enough gold!",upgradeBought:"{0} {1} Lv.{2} purchased!",itemBought:"{0} {1} purchased! (Owned: {2})",levelUp:"ğŸ‰ Level Up! LV.{0}",attackBonus:"Attack +{0}",timeBonus:"Problem time +{0}s",maxLevelBonus:"ğŸ† MAX! ATK+10, HP+10, TIME+15",exportFilename:"problems","item.hpPotion":"HP Potion","item.timeSand":"Sands of Time","item.smallGoldBag":"Small Gold Pouch","item.highHpPotion":"High HP Potion","item.timeCrystal":"Time Crystal","item.goldBag":"Gold Pouch","item.comboBooster":"Combo Booster","item.holyGrail":"Holy Grail","item.freeHint":"Free Hint","item.reviveFeather":"Revive Feather","item.goldAmulet":"Gold x1.25 Amulet","item.immortalRing":"Immortal Ring","item.timeStop":"Time Stop","item.legendaryGold":"Legendary Gold Bar","item.wisdomCrown":"Crown of Wisdom","mon.slime":"Slime","mon.blob":"Blob","mon.muryeong":"Jelly","mon.jelly":"Gel","mon.skeleton":"Skeleton Soldier","mon.skelleton":"Skeleton","mon.baekgol":"Bone Knight","mon.boneguard":"Boneguard","mon.bat":"Bat","mon.batwing":"Batwing","mon.yacha":"Yaksha","mon.flying":"Flyer","mon.zombie":"Zombie","mon.undead":"Undead","mon.gangsi":"Jiangshi","mon.mutant":"Mutant","mon.ghost":"Ghost","mon.ghosty":"Phantom","mon.wongui":"Wraith","mon.specter":"Specter","mon.spider":"Spider","mon.spidery":"Arachnid","mon.dokchung":"Venomous","mon.arachne":"Arachne",loggingIn:"Logging in...",loginFailed:"Login failed",serverError:"Server connection failed. Please try again later.",cameraError:"Cannot open camera: ",loading:"Loading...",error:"Error: ",googleLoadFailed:"Failed to load Google login. Please refresh the page.",htmlTitle:"Wrong Answer Hunter",htmlSlogan:"Hunt wrong answers and level up!",htmlRegister:"ğŸ“¸ Register Wrong Answer",htmlLogout:"Logout",htmlCapture:"ğŸ“· Capture",htmlClose:"âœ• Close",multipleChoice:"Multiple Choice",noAnalysisResult:"No analysis result",defaultTopic:"Math",defaultProblem:"Problem",linearEquation:"Linear Equation",guide_title_0:"Welcome to Wrong Answer Hunter!",guide_title_1:"Register Wrong Answers",guide_title_2:"Dungeon Structure",guide_title_3:"Battle Mechanics",guide_title_4:"Items",guide_title_5:"Shop",guide_title_6:"Growth System",guide_desc_0:`Wrong Answer Hunter is a learning RPG
where wrong answers become monsters!

ğŸ“¸ Photo wrong answers â†’ AI creates monsters
âš”ï¸ Solve problems to defeat monsters
ğŸ’° Earn Gold & EXP to grow

The more you get wrong, the stronger you become!`,guide_desc_1:`Tap the ğŸ“¸ Register button
to capture a wrong answer photo.

ğŸ“ Math / ğŸ”¬ Science subject selection
â†’ AI auto-analyzes the problem
â†’ 4-choice monster is created!

More monsters = richer dungeons.`,guide_desc_2:`Dungeons have 100 floors total.

ğŸ‘¹ Boss monster every 10 floors
ğŸ‘¿ Powerful mid-boss at floor 50
ğŸ‰ Final boss awaits at floor 100!

Bosses have high HP & harsh penalties,
but drop tons of Gold & items!`,guide_desc_3:`â­• Correct â†’ Damage the monster!
âŒ Wrong â†’ You take damage
â° Time out â†’ Heavy damage + next question

ğŸ”¥ Consecutive answers trigger combos!
Higher combos = bonus damage + Gold

â­ï¸ Skip: Take minor damage to skip`,guide_desc_4:`Items usable during battle:

ğŸª¶ Revive: Auto-revive at 0 HP (50%)
ğŸ’¡ Hint: Get a hint + remove 1 wrong answer
â° Time Boost: +60 seconds
âœ¨ Gold Ã—2: Applied on dungeon entry

Monsters may drop items on defeat!
Bosses have higher drop rates ğŸ`,guide_desc_5:`Power up at the ğŸª Shop!

âš¡ Upgrade: HPÂ·ATKÂ·TimeÂ·Gold bonuses
   Permanent stat upgrades!
ğŸ’ Items: Buy consumables (bulk Ã—5 available)
ğŸ¨ Customize: Change background themes

Save Gold and invest strategically.`,guide_desc_6:`Max level is 100!
Each level-up grants HPÂ·ATKÂ·Time bonuses

ğŸ† 30+ achievements to unlock
   ComboÂ·BossÂ·ClearÂ·Level achievements & more

ğŸ“‹ 3 Daily missions (reset daily)
ğŸ“… 3 Weekly missions (reset weekly)
Complete missions for bonus Gold + EXP!`,guide_next:"Next â–¶",achievementTitle:"ğŸ† Achievements",achievement:"ğŸ† Achieve",dailyMissionTitle:"ğŸ“‹ Daily Missions",achievementList:"ğŸ† Achievements ({0}/{1})",claimed:"Claimed",achv_cat_combo:"ğŸ”¥ Combo",achv_cat_run:"â­ Run",achv_cat_boss:"ğŸ‘¹ Boss",achv_cat_level:"ğŸ“ˆ Level",achv_cat_gold:"ğŸ’° Gold",achv_cat_kills:"âš”ï¸ Kills",achv_cat_subject:"ğŸ“š Subject",achv_cat_study:"âœ… Study",achv_combo_3:"First Flame",achv_combo_3_desc:"Reach 10 combo",achv_combo_5:"Streak Master",achv_combo_5_desc:"Reach 20 combo",achv_combo_10:"Combo Master",achv_combo_10_desc:"Reach 50 combo",achv_combo_20:"Legendary Combo",achv_combo_20_desc:"Reach 100 combo",achv_combo_500:"Divine Combo",achv_combo_500_desc:"Reach 500 combo",achv_first_clear:"First Clear",achv_first_clear_desc:"Clear first dungeon",achv_clear_10:"Dungeon Conqueror",achv_clear_10_desc:"Clear 20 times",achv_clear_50:"Dungeon Master",achv_clear_50_desc:"Clear 80 times",achv_perfect_run:"Perfect Run",achv_perfect_run_desc:"100% accuracy clear (10+ questions)",achv_boss_normal:"Boss Hunter",achv_boss_normal_desc:"Defeat a normal boss",achv_boss_mid:"Mid Boss Slayer",achv_boss_mid_desc:"Defeat a mid boss",achv_boss_final:"Dragon Slayer",achv_boss_final_desc:"Defeat the final boss",achv_level_10:"Growing Up",achv_level_10_desc:"Reach level 15",achv_level_25:"Intermediate",achv_level_25_desc:"Reach level 35",achv_level_50:"Advanced",achv_level_50_desc:"Reach level 60",achv_level_99:"The Strongest",achv_level_99_desc:"Reach level 99",achv_level_100:"Legend Begins",achv_level_100_desc:"Reach level 100 â€” Beyond the limit",hiddenAchievement:"Hidden Achievement",achv_gold_1000:"Gold Collector",achv_gold_1000_desc:"Earn 3,000G total",achv_gold_10000:"Road to Riches",achv_gold_10000_desc:"Earn 20,000G total",achv_gold_100000:"Gold King",achv_gold_100000_desc:"Earn 150,000G total",achv_kills_50:"80 Kills",achv_kills_50_desc:"Defeat 80 monsters",achv_kills_100:"200 Kills",achv_kills_100_desc:"Defeat 200 monsters",achv_kills_500:"800 Kills Slayer",achv_kills_500_desc:"Defeat 800 monsters",achv_master_math:"Math Master",achv_master_math_desc:"Register 150 math problems",achv_master_science:"Science Master",achv_master_science_desc:"Register 150 science problems",achv_answer_100:"Study Start",achv_answer_100_desc:"200 correct answers total",achv_answer_500:"Study Expert",achv_answer_500_desc:"800 correct answers total",achv_damage_100:"Mighty Warrior",achv_damage_100_desc:"Reach 100 Attack Power",achv_hp_500:"Iron Wall",achv_hp_500_desc:"Reach 500 HP",achv_cat_power:"âš¡ Combat Power",dm_correct_10:"10 correct today",dm_correct_20:"20 correct today",dm_defeat_3:"Defeat 3 monsters",dm_defeat_5:"Defeat 5 monsters",dm_combo_5:"Reach 5 combo",dm_combo_10:"Reach 10 combo",dm_clear_1:"Clear 1 dungeon",dm_earn_100:"Earn 100G",dm_earn_500:"Earn 500G",dm_answer_30:"Solve 30 problems",weeklyMissionTitle:"ğŸ“‹ Weekly Missions",wm_correct_150:"150 correct this week",wm_correct_300:"300 correct this week",wm_defeat_30:"Defeat 30 monsters",wm_defeat_50:"Defeat 50 monsters",wm_combo_50:"Reach 50 combo",wm_combo_100:"Reach 100 combo",wm_clear_7:"Clear 7 dungeons",wm_earn_3000:"Earn 3000G",wm_earn_7000:"Earn 7000G",wm_answer_200:"Solve 200 problems",guide_start:"Let's Go!",viewGuide:"ğŸ“– View Game Guide",cosmetic_themes:"Themes",cosmetic_particle:"Particle Style",cosmetic_damageText:"Damage Text",cosmetic_flash:"Correct Effect",cosmetic_equipped:"Equipped",cosmetic_equip:"Equip",cosmetic_particle_default:"Default",cosmetic_particle_gold:"Gold",cosmetic_particle_rainbow:"Rainbow",cosmetic_particle_sakura:"Sakura",cosmetic_dmg_default:"Default",cosmetic_dmg_neon:"Neon",cosmetic_dmg_pixel:"Pixel",cosmetic_flash_default:"Default (Green)",cosmetic_flash_blue:"Blue",cosmetic_flash_purple:"Purple"},ja:{title:"èª¤ç­”ãƒãƒ³ã‚¿ãƒ¼",subtitle:"ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ã‚¯å­¦ç¿’RPG",slogan:"é–“é•ã„ãŒãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã«ãªã‚‹ï¼",enterDungeon:"âš”ï¸ ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å…¥å ´",stats:"ğŸ“Š çµ±è¨ˆ",shop:"ğŸª ã‚·ãƒ§ãƒƒãƒ—",settings:"âš™ï¸ è¨­å®š",aiGenerate:"ğŸ¤– AIå•é¡Œç”Ÿæˆ",aiConnected:"ğŸŸ¢ AIæ¥ç¶šæ¸ˆã¿",aiNotConnected:"ğŸ”´ AIæœªæ¥ç¶šï¼ˆè¨­å®šã§æ¥ç¶šï¼‰",stage:"ã‚¹ãƒ†ãƒ¼ã‚¸",accuracyRate:"æ­£ç­”ç‡",wrongMonster:"èª¤ç­”ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼",loadingQuestion:"å•é¡Œã‚’èª­ã¿è¾¼ã¿ä¸­...",viewFull:"ğŸ” å…¨æ–‡è¡¨ç¤º",seconds:"ç§’",obtained:"ç²å¾—ï¼",skip:"â­ï¸ã‚¹ã‚­ãƒƒãƒ—",quit:"ğŸšªæ’¤é€€",cleared:"ğŸ‰ ã‚¯ãƒªã‚¢ï¼",failed:"ğŸ’€ å¤±æ•—...",stageLabel:"ã‚¹ãƒ†ãƒ¼ã‚¸",defeatedMonsters:"å€’ã—ãŸãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼",bestCombo:"æœ€é«˜ã‚³ãƒ³ãƒœ",accuracyLabel:"æ­£ç­”ç‡",earnedGold:"ç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰",toMain:"ãƒ¡ã‚¤ãƒ³ã¸",shopTitle:"ğŸª ã‚·ãƒ§ãƒƒãƒ—",back:"â† æˆ»ã‚‹",permanentUpgrade:"âš¡ æ°¸ä¹…å¼·åŒ–",consumableItems:"ğŸ’ æ¶ˆè²»ã‚¢ã‚¤ãƒ†ãƒ ",randomBg:"ãƒ©ãƒ³ãƒ€ãƒ èƒŒæ™¯",randomBgDesc:"random background",randomBgApplied:"ğŸ¨ èƒŒæ™¯ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸï¼",shopTabUpgrade:"å¼·åŒ–",shopTabConsume:"ã‚¢ã‚¤ãƒ†ãƒ ",shopTabCosmetic:"ãƒ‡ã‚³",shopStatSummary:"ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",shopHp:"HP",shopAtk:"æ”»æ’ƒåŠ›",shopTime:"æ™‚é–“",shopGoldBonus:"ã‚´ãƒ¼ãƒ«ãƒ‰+",shopMaxReached:"âœ¦ MAX",shopNotEnoughShort:"{0}Gä¸è¶³",shopCurrentTheme:"ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ",reviveTicketHint:"æ­»äº¡æ™‚ã«è‡ªå‹•ä½¿ç”¨",hintTicketHint:"æˆ¦é—˜ä¸­ğŸ’¡ãƒœã‚¿ãƒ³",timeBoostHint:"æˆ¦é—˜ä¸­â°ãƒœã‚¿ãƒ³",doubleGoldHint:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å…¥å ´æ™‚ã«è‡ªå‹•",theme_default:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ",theme_emerald:"ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰",theme_crimson:"ã‚¯ãƒªãƒ ã‚¾ãƒ³",theme_amber:"ã‚¢ãƒ³ãƒãƒ¼",theme_violet:"ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆ",theme_cyan:"ã‚·ã‚¢ãƒ³",theme_rose:"ãƒ­ãƒ¼ã‚º",settingsTitle:"âš™ï¸ è¨­å®š",settingsTabGame:"ã‚²ãƒ¼ãƒ ",settingsTabApi:"API",settingsTabData:"ãƒ‡ãƒ¼ã‚¿",smilePrintApi:"ğŸ–¼ï¸ SmilePrint APIï¼ˆæ¨å¥¨ï¼‰",configured:"âœ… è¨­å®šæ¸ˆã¿",notConfigured:"âŒ æœªè¨­å®š",inputSmilePrintKey:"ğŸ”‘ SmilePrint APIã‚­ãƒ¼å…¥åŠ›",geminiApi:"ğŸ¤– Gemini APIï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰",geminiKey:"ğŸ”‘ Geminiã‚­ãƒ¼",testGenerate:"ãƒ†ã‚¹ãƒˆç”Ÿæˆ",soundSettings:"ğŸ”Š ã‚µã‚¦ãƒ³ãƒ‰è¨­å®š",bgmOn:"ğŸµ BGM ON",bgmOff:"ğŸ”‡ BGM OFF",sfxOn:"ğŸ”Š åŠ¹æœéŸ³ ON",sfxOff:"ğŸ”ˆ åŠ¹æœéŸ³ OFF",apiGuide:"ğŸ“‹ APIã‚­ãƒ¼å–å¾—æ–¹æ³•",smilePrintSection:"[ SmilePrint API ]",requestAdmin:"ç®¡ç†è€…ã«APIã‚­ãƒ¼ã‚’è¦è«‹",geminiSection:"[ Gemini API ]",visitAiStudio:"aistudio.google.com ã«ã‚¢ã‚¯ã‚»ã‚¹",createApiKey:"Get API Key â†’ Create API Key",aiFeatures:"AIé€£å‹•ã§å¯èƒ½ãªæ©Ÿèƒ½:",aiFeature1:"â€¢ å•é¡Œå†™çœŸè‡ªå‹•åˆ†æï¼ˆSmilePrintï¼‰",aiFeature2:"â€¢ é¡ä¼¼å•é¡Œè‡ªå‹•ç”Ÿæˆï¼ˆGeminiï¼‰",aiFeature3:"â€¢ å•é¡Œè§£æ³•ãƒ’ãƒ³ãƒˆæä¾›",dataManage:"ğŸ—‚ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†",problemCount:"å•é¡Œ{0}å€‹",export:"ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",import:"ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ",resetAll:"ğŸ—‘ï¸ å…¨åˆæœŸåŒ–",langSettings:"ğŸŒ è¨€èªè¨­å®š",uiOpacityTitle:"ğŸ”² UIé€æ˜åº¦",statsTitle:"ğŸ“Š çµ±è¨ˆ",overallStats:"ğŸ“‹ å…¨ä½“çµ±è¨ˆ",totalQuestions:"ç·å•é¡Œæ•°",totalRuns:"ç·ãƒ©ãƒ³å›æ•°",subjectStats:"ğŸ“š ç§‘ç›®åˆ¥çµ±è¨ˆ",difficultyStats:"ğŸ¯ é›£æ˜“åº¦åˆ¥åˆ†æ",easy:"ç°¡å˜",normal:"æ™®é€š",hard:"é›£ã—ã„",playRecord:"ğŸ† ãƒ—ãƒ¬ã‚¤è¨˜éŒ²",clear:"ã‚¯ãƒªã‚¢",fail:"å¤±æ•—",totalGoldEarned:"ç·ç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰",stats_winRate:"å‹ç‡",stats_totalPlayTime:"ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“",stats_avgRunDuration:"å¹³å‡ãƒ©ãƒ³æ™‚é–“",stats_longestRun:"æœ€é•·ãƒ©ãƒ³",stats_shortestClear:"æœ€çŸ­ã‚¯ãƒªã‚¢",stats_currentStreak:"ç¾åœ¨ã®é€£å‹",stats_bestStreak:"æœ€é«˜é€£å‹",stats_recentRecord:"æœ€è¿‘ã®æˆ¦ç¸¾",stats_recentWinRate:"æœ€è¿‘ã®å‹ç‡",stats_recentAccuracy:"æœ€è¿‘ã®æ­£ç­”ç‡",stats_subjectAccuracy:"ç§‘ç›®åˆ¥æ­£ç­”ç‡",stats_difficultyAccuracy:"é›£æ˜“åº¦åˆ¥æ­£ç­”ç‡",stats_avgAccuracy:"å¹³å‡æ­£ç­”ç‡",stats_avgGoldPerRun:"ãƒ©ãƒ³å¹³å‡ã‚´ãƒ¼ãƒ«ãƒ‰",stats_totalDefeated:"ç·æ’ƒç ´æ•°",stats_heroBanner:"ãƒ’ãƒ¼ãƒ­ãƒ¼çµ±è¨ˆ",stats_streakTime:"é€£å‹ï¼†æ™‚é–“",stats_subjectPerf:"ç§‘ç›®åˆ¥æˆæœ",stats_diffAnalysis:"é›£æ˜“åº¦åˆ†æ",stats_playStats:"ãƒ—ãƒ¬ã‚¤è¨˜éŒ²",stats_recentBattle:"æœ€è¿‘ã®æˆ¦ç¸¾",stats_advanced:"è©³ç´°çµ±è¨ˆ",stats_noData:"ã¾ã ãƒ—ãƒ¬ã‚¤è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“",stats_noDataSub:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã«æŒ‘æˆ¦ã—ã¦çµ±è¨ˆã‚’è²¯ã‚ã¾ã—ã‚‡ã†ï¼",stats_runs:"å›",stats_wins:"å‹åˆ©",stats_losses:"æ•—åŒ—",stats_accuracy:"æ­£ç­”ç‡",stats_combo:"ã‚³ãƒ³ãƒœ",stats_gold:"ã‚´ãƒ¼ãƒ«ãƒ‰",stats_time:"æ™‚é–“",stats_streak:"é€£å‹",stats_min:"åˆ†",stats_sec:"ç§’",stats_hr:"æ™‚é–“",stats_attempts:"è©¦è¡Œ",stats_correct:"æ­£è§£",stats_itemUsage:"ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨çµ±è¨ˆ",stats_skipTotal:"ã‚¹ã‚­ãƒƒãƒ—",stats_hintTotal:"ãƒ’ãƒ³ãƒˆ",stats_timeBoostTotal:"æ™‚é–“å»¶é•·",stats_reviveTotal:"å¾©æ´»",stats_timeoutTotal:"ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ",stats_perRun:"å¹³å‡",stats_wrongBySubject:"ç§‘ç›®åˆ¥èª¤ç­”åˆ†æ",stats_wrongCount:"âŒ",stats_correctCount:"âœ…",stats_wrongRate:"èª¤ç­”ç‡",stats_hintShort:"ãƒ’ãƒ³ãƒˆ",stats_timeBoostShort:"æ™‚é–“+",stats_reviveShort:"å¾©æ´»",result_itemUsage:"ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨",result_timeout:"ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ",stats_topicAnalysis:"é¡å‹åˆ¥èª¤ç­”åˆ†æ",stats_weakTopics:"å¼±ç‚¹ã‚¿ã‚¤ãƒ—TOP",stats_noWrongTopics:"èª¤ç­”ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“",stats_topicDetail:"é¡å‹åˆ¥",stats_colAttempts:"å›æ•°",stats_colCorrectRate:"æ­£ç­”ç‡",stats_colWrongRate:"èª¤ç­”ç‡",stats_colDate:"æ—¥ä»˜",stats_colCombo:"ã‚³ãƒ³ãƒœ",stats_colGold:"ã‚´ãƒ¼ãƒ«ãƒ‰",stats_colTime:"æ™‚é–“",stats_diffWrong:"é›£æ˜“åº¦åˆ¥èª¤ç­”",stats_tabOverview:"ç·åˆ",stats_tabSubject:"ç§‘ç›®",stats_tabAnalysis:"åˆ†æ",dungeonSelect:"âš”ï¸ ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³é¸æŠ",selectDungeon:"æŒ‘æˆ¦ã™ã‚‹ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„",mathDungeon:"æ•°å­¦ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³",scienceDungeon:"ç§‘å­¦ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³",registeredMonsters:"ç™»éŒ²ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼: {0}ä½“",mathTopics:"æ–¹ç¨‹å¼ã€é–¢æ•°ã€ç¢ºç‡ã€å›³å½¢ãªã©",scienceTopics:"åŠ›ã¨é‹å‹•ã€åŒ–å­¦åå¿œã€éºä¼ã€åŠ›å­¦ãªã©",goBack:"â† æˆ»ã‚‹",subjectSelect:"ğŸ“¸ ç§‘ç›®é¸æŠ",cancel:"â† ã‚­ãƒ£ãƒ³ã‚»ãƒ«",capturedPhoto:"ğŸ“· æ’®å½±ã—ãŸå†™çœŸ",selectSubject:"ã“ã®å•é¡Œã®ç§‘ç›®ã‚’é¸ã‚“ã§ãã ã•ã„",math:"æ•°å­¦",english:"è‹±èª",korean:"å›½èª",science:"ç§‘å­¦",boss:"ãƒœã‚¹",midBoss:"ä¸­é–“ãƒœã‚¹",finalBoss:"æœ€çµ‚ãƒœã‚¹",rarityNormal:"ä¸€èˆ¬",rarityRare:"ãƒ¬ã‚¢",rarityEpic:"ã‚¨ãƒ”ãƒƒã‚¯",rarityLegendary:"ä¼èª¬",hpUpgrade:"HPå¼·åŒ–",hpUpgradeDesc:"æœ€å¤§HP +10",timeUpgrade:"æ™‚é–“å¼·åŒ–",timeUpgradeDesc:"åˆ¶é™æ™‚é–“ +3ç§’",goldBonus:"ã‚´ãƒ¼ãƒ«ãƒ‰ãƒœãƒ¼ãƒŠã‚¹",goldBonusDesc:"ã‚´ãƒ¼ãƒ«ãƒ‰ç²å¾— +5%",damageUpgrade:"æ”»æ’ƒåŠ›å¼·åŒ–",damageUpgradeDesc:"åŸºæœ¬ãƒ€ãƒ¡ãƒ¼ã‚¸ +5",reviveTicket:"å¾©æ´»åˆ¸",reviveTicketDesc:"æ­»äº¡æ™‚HP 50%å›å¾©ã—ã¦å¾©æ´»",hintTicket:"ãƒ’ãƒ³ãƒˆåˆ¸",hintTicketDesc:"ãƒ’ãƒ³ãƒˆ1å›ç„¡æ–™ä½¿ç”¨",timeBoost:"æ™‚é–“å»¶é•·",timeBoostDesc:"æˆ¦é—˜ä¸­ä½¿ç”¨æ™‚+60ç§’",doubleGold:"ã‚´ãƒ¼ãƒ«ãƒ‰1.25å€",doubleGoldDesc:"æ¬¡ã®ãƒ©ãƒ³ã§ã‚´ãƒ¼ãƒ«ãƒ‰ç²å¾—1.25å€",noProblems:"ç™»éŒ²ã•ã‚ŒãŸå•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼ã¾ãšå•é¡Œã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚",goldMultiplierApplied:"âœ¨ ã‚´ãƒ¼ãƒ«ãƒ‰1.25å€é©ç”¨ï¼ã“ã®ãƒ©ãƒ³ã§ç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰ãŒ1.25å€ã«ãªã‚Šã¾ã™ï¼",noPhoto:"æ’®å½±ã•ã‚ŒãŸå†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚",aiAnalyzed:`AIåˆ†æçµæœ:

å•é¡Œ: {0}
ç­”ãˆ: {1}
ãƒ†ãƒ¼ãƒ: {2}
è§£èª¬: {3}

ã“ã®å†…å®¹ã§åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ`,aiAnalyzedSimple:`AIåˆ†æçµæœ:

å•é¡Œ: {0}
ç­”ãˆ: {1}

ã“ã®å†…å®¹ã§åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ`,editQuestion:"å•é¡Œã‚’ä¿®æ­£ã—ã¦ãã ã•ã„:",editAnswer:"ç­”ãˆã‚’ä¿®æ­£ã—ã¦ãã ã•ã„:",aiFailed:`AIåˆ†æå¤±æ•—: {0}

æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`,inputQuestion:"å•é¡Œã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",inputAnswer:"ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",inputAnswerNum:"ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæ•°å­—ï¼‰:",noAnswer:"ç­”ãˆãŒãªã„ãŸã‚ç™»éŒ²ã§ãã¾ã›ã‚“ã€‚",monsterRegistered:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸï¼ğŸ‘¾",inputGeminiKey:"Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",geminiKeySaved:"Gemini APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼",inputSmilePrintApiKey:"SmilePrint APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",smilePrintKeySaved:`SmilePrint APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼

ç”»åƒåˆ†ææ©Ÿèƒ½ãŒä½¿ç”¨å¯èƒ½ã§ã™ã€‚`,testGenerating:"ãƒ†ã‚¹ãƒˆå•é¡Œç”Ÿæˆä¸­...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚",testGenerated:`âœ… {0}å€‹ã®å•é¡Œã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼

ä¾‹:
å•é¡Œ: {1}
ç­”ãˆ: {2}`,generateFailed:"å•é¡Œç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚",invalidInput:"ç„¡åŠ¹ãªå…¥åŠ›ã§ã™",aiGenerateMenu:`ğŸ¤– AIå•é¡Œç”Ÿæˆ

ç§‘ç›®ã‚’é¸ã‚“ã§ãã ã•ã„:
1. {0}
2. {1}

ç•ªå·å…¥åŠ› (1-2):`,aiTopicMenu:`ğŸ¤– AI {0}å•é¡Œç”Ÿæˆ

ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ãã ã•ã„:
{1}

ç•ªå·å…¥åŠ› (1-{2}):`,difficultyMenu:`ãƒ†ãƒ¼ãƒ: {0}

é›£æ˜“åº¦ã‚’é¸ã‚“ã§ãã ã•ã„:
1. {1}
2. {2}
3. {3}

ç•ªå·å…¥åŠ›:`,countMenu:`ãƒ†ãƒ¼ãƒ: {0}
é›£æ˜“åº¦: {1}

ç”Ÿæˆã™ã‚‹å•é¡Œæ•° (1-10):`,generated:`âœ… {0}å€‹ã®å•é¡Œã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼

ãƒ†ãƒ¼ãƒ: {1}
é›£æ˜“åº¦: {2}

ä¾‹:
å•é¡Œ: {3}
ç­”ãˆ: {4}`,levelProgress:"ğŸ“Š ãƒ¬ãƒ™ãƒ«é€²æ—",currentStats:"ğŸ“‹ ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",nextBonus:"ğŸ¯ æ¬¡ã®ãƒœãƒ¼ãƒŠã‚¹",expGain:"ğŸ’¡ çµŒé¨“å€¤ç²å¾—",close:"é–‰ã˜ã‚‹",correctAnswer:"æ­£è§£",monsterKill:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨ä¼",normalBossLabel:"ä¸€èˆ¬ãƒœã‚¹",midBossLabel:"ä¸­é–“ãƒœã‚¹",finalBossLabel:"æœ€çµ‚ãƒœã‚¹",base:"åŸºæœ¬",level:"ãƒ¬ãƒ™ãƒ«",upgrade:"å¼·åŒ–",attack:"æ”»æ’ƒåŠ›",time:"æ™‚é–“",noProblemsToReset:"åˆæœŸåŒ–ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚",confirmReset:`æœ¬å½“ã«ã™ã¹ã¦ã®å•é¡Œ({0}å€‹)ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ

ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`,confirmResetFinal:`âš ï¸ æœ€çµ‚ç¢ºèª

{0}å€‹ã®å•é¡ŒãŒæ°¸ä¹…ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,resetDone:"âœ… {0}å€‹ã®å•é¡ŒãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚",resetError:"å•é¡Œã®åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",resetAccount:"ğŸ”„ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆæœŸåŒ–",confirmAccountReset:`âš ï¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆæœŸåŒ–

ãƒ¬ãƒ™ãƒ«ã€ã‚´ãƒ¼ãƒ«ãƒ‰ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã‚¢ã‚¤ãƒ†ãƒ ã€
ãƒ—ãƒ¬ã‚¤è¨˜éŒ²ãŒã™ã¹ã¦åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚

ï¼ˆç™»éŒ²ã—ãŸå•é¡Œã¯ç¶­æŒã•ã‚Œã¾ã™ï¼‰

æœ¬å½“ã«åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ`,confirmAccountResetFinal:`âš ï¸ æœ€çµ‚ç¢ºèª

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæ°¸ä¹…ã«åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚
å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`,accountResetDone:`âœ… ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚
ãƒ¬ãƒ™ãƒ«1ã€ã‚´ãƒ¼ãƒ«ãƒ‰100ã§å†é–‹ã—ã¾ã™ã€‚`,accountResetError:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",noExportData:"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚",exported:"âœ… {0}å€‹ã®å•é¡Œã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼",exportError:"å•é¡Œã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",invalidFile:"æœ‰åŠ¹ãªå•é¡Œãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",noImportData:"ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚",confirmImport:`{0}å€‹ã®å•é¡Œã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ

ï¼ˆæ—¢å­˜ã®å•é¡Œã¯ä¿æŒã•ã‚Œã¾ã™ï¼‰`,imported:"âœ… {0}å€‹ã®å•é¡Œã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼",importError:`å•é¡Œã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`,analyzing:"ğŸ¤– {0} åˆ†æä¸­...",analyzingDesc:"å•é¡Œã‚’èª­ã‚“ã§ç­”ãˆã‚’æ¢ã—ã¦ã„ã¾ã™",generating:"ğŸ¤– AIå•é¡Œç”Ÿæˆä¸­...",generatingDesc:"{0}å€‹ã®å•é¡Œã‚’ä½œæˆä¸­",pleaseWait:"ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„...",autoFillGenerating:"ğŸ¤– å•é¡Œã‚’è‡ªå‹•ç”Ÿæˆä¸­...",autoFillDesc:"{0}å€‹ã®å•é¡Œã‚’è£œå……ä¸­",autoFillProgress:"{0}/{1}å€‹ç”Ÿæˆå®Œäº†",monsterHpRecover:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼HPå›å¾©ï¼",reviveUsed:`ğŸª¶ å¾©æ´»åˆ¸ä½¿ç”¨ï¼HP 50%å›å¾©ï¼
ï¼ˆæ®‹ã‚Š: {0}ï¼‰`,noHintNoGold:`ãƒ’ãƒ³ãƒˆåˆ¸ãŒãªãã‚´ãƒ¼ãƒ«ãƒ‰ã‚‚ä¸è¶³ï¼
ï¼ˆ50Gå¿…è¦ï¼‰

ã‚·ãƒ§ãƒƒãƒ—ã§ãƒ’ãƒ³ãƒˆåˆ¸ã‚’è³¼å…¥ã—ã¦ãã ã•ã„ï¼`,useGoldForHint:`ãƒ’ãƒ³ãƒˆåˆ¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
50Gã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ

ç¾åœ¨ã®ã‚´ãƒ¼ãƒ«ãƒ‰: {0}G`,topicHint:"ğŸ“š ãƒ†ãƒ¼ãƒ: {0}",explanationHint:"ğŸ’­ è§£æ³•ãƒ’ãƒ³ãƒˆ: {0}...",wrongChoiceHint:"âŒ {0}ç•ªã¯ä¸æ­£è§£ã§ã™ï¼",keywordHint:"ğŸ”‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {0}",readCarefully:"ğŸ’¡ å•é¡Œã‚’ã‚ˆãèª­ã‚“ã§ã¿ã¦ãã ã•ã„ï¼",trySubstitute:"ğŸ“ é¸æŠè‚¢ã‚’ä¸€ã¤ãšã¤ä»£å…¥ã—ã¦ã¿ã¦ãã ã•ã„ã€‚",hintTitle:"ğŸ’¡ ãƒ’ãƒ³ãƒˆ",timeBoostUsed:"â° +60ç§’ï¼ï¼ˆæ®‹ã‚Š: {0}ï¼‰",noTimeBoost:`æ™‚é–“å»¶é•·ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ï¼
ã‚·ãƒ§ãƒƒãƒ—ã§è³¼å…¥ã—ã¦ãã ã•ã„ã€‚`,questionLabel:"ğŸ“ å•é¡Œ",noQuestion:"å•é¡Œãªã—",problemViewer:"ğŸ“‹ å•é¡Œä¸€è¦§",problemViewerEmpty:"ç™»éŒ²ã•ã‚ŒãŸå•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚",filterAll:"å…¨éƒ¨",filterImage:"ğŸ“· ç”»åƒ",answerLabel:"æ­£è§£",difficultyLabel:"é›£æ˜“åº¦",alreadyMax:"æœ€å¤§ãƒ¬ãƒ™ãƒ«ã§ã™ï¼",notEnoughGold:"ã‚´ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼",upgradeBought:"{0} {1} Lv.{2} è³¼å…¥å®Œäº†ï¼",itemBought:"{0} {1} è³¼å…¥å®Œäº†ï¼ï¼ˆæ‰€æŒ: {2}å€‹ï¼‰",levelUp:"ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼LV.{0}",attackBonus:"æ”»æ’ƒåŠ› +{0}",timeBonus:"å•é¡Œæ™‚é–“ +{0}ç§’",maxLevelBonus:"ğŸ† MAX! æ”»æ’ƒåŠ›+10, HP+10, æ™‚é–“+15",exportFilename:"èª¤ç­”å•é¡Œ","item.hpPotion":"HPãƒãƒ¼ã‚·ãƒ§ãƒ³","item.timeSand":"æ™‚ã®ç ‚","item.smallGoldBag":"å°ã•ãªé‡‘è²¨è¢‹","item.highHpPotion":"é«˜ç´šHPãƒãƒ¼ã‚·ãƒ§ãƒ³","item.timeCrystal":"æ™‚ã®æ°´æ™¶","item.goldBag":"é‡‘è²¨è¢‹","item.comboBooster":"ã‚³ãƒ³ãƒœãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼","item.holyGrail":"ç”Ÿå‘½ã®è–æ¯","item.freeHint":"ç„¡æ–™ãƒ’ãƒ³ãƒˆåˆ¸","item.reviveFeather":"å¾©æ´»ã®ç¾½","item.goldAmulet":"ã‚´ãƒ¼ãƒ«ãƒ‰1.25å€ãŠå®ˆã‚Š","item.immortalRing":"ä¸æ­»ã®æŒ‡è¼ª","item.timeStop":"æ™‚é–“åœæ­¢","item.legendaryGold":"ä¼èª¬ã®é‡‘å¡Š","item.wisdomCrown":"çŸ¥æµã®ç‹å† ","mon.slime":"ã‚¹ãƒ©ã‚¤ãƒ ","mon.blob":"ãƒ–ãƒ­ãƒ–","mon.muryeong":"ã‚¼ãƒªãƒ¼","mon.jelly":"ã‚¸ã‚§ãƒªãƒ¼","mon.skeleton":"éª¸éª¨å…µ","mon.skelleton":"ã‚¹ã‚±ãƒ«ãƒˆãƒ³","mon.baekgol":"ç™½éª¨","mon.boneguard":"ãƒœãƒ¼ãƒ³ã‚¬ãƒ¼ãƒ‰","mon.bat":"ã‚³ã‚¦ãƒ¢ãƒª","mon.batwing":"ãƒãƒƒãƒˆ","mon.yacha":"å¤œå‰","mon.flying":"ãƒ•ãƒ©ã‚¤ãƒ³ã‚°","mon.zombie":"ã‚¾ãƒ³ãƒ“","mon.undead":"ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰","mon.gangsi":"ã‚­ãƒ§ãƒ³ã‚·ãƒ¼","mon.mutant":"ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ³ãƒˆ","mon.ghost":"å¹½éœŠ","mon.ghosty":"ã‚´ãƒ¼ã‚¹ãƒˆ","mon.wongui":"æ€¨é¬¼","mon.specter":"ã‚¹ãƒšã‚¯ã‚¿ãƒ¼","mon.spider":"ã‚¯ãƒ¢","mon.spidery":"ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼","mon.dokchung":"æ¯’è™«","mon.arachne":"ã‚¢ãƒ©ã‚¯ãƒ",loggingIn:"ãƒ­ã‚°ã‚¤ãƒ³ä¸­...",loginFailed:"ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—",serverError:"ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šå¤±æ•—ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",cameraError:"ã‚«ãƒ¡ãƒ©ã‚’é–‹ã‘ã¾ã›ã‚“: ",loading:"èª­ã¿è¾¼ã¿ä¸­...",error:"ã‚¨ãƒ©ãƒ¼: ",googleLoadFailed:"Googleãƒ­ã‚°ã‚¤ãƒ³ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚",htmlTitle:"èª¤ç­”ãƒãƒ³ã‚¿ãƒ¼",htmlSlogan:"é–“é•ã„ã‚’å€’ã—ã¦ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼",htmlRegister:"ğŸ“¸ èª¤ç­”ç™»éŒ²",htmlLogout:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",htmlCapture:"ğŸ“· æ’®å½±",htmlClose:"âœ• é–‰ã˜ã‚‹",multipleChoice:"é¸æŠå¼",noAnalysisResult:"åˆ†æçµæœãªã—",defaultTopic:"æ•°å­¦",defaultProblem:"å•é¡Œ",linearEquation:"ä¸€æ¬¡æ–¹ç¨‹å¼",guide_title_0:"èª¤ç­”ãƒãƒ³ã‚¿ãƒ¼ã¸ã‚ˆã†ã“ãï¼",guide_title_1:"èª¤ç­”ã‚’ç™»éŒ²ã—ã‚ˆã†",guide_title_2:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³æ§‹é€ ",guide_title_3:"ãƒãƒˆãƒ«ã®ä»•çµ„ã¿",guide_title_4:"ã‚¢ã‚¤ãƒ†ãƒ ",guide_title_5:"ã‚·ãƒ§ãƒƒãƒ—",guide_title_6:"æˆé•·ã‚·ã‚¹ãƒ†ãƒ ",guide_desc_0:`èª¤ç­”ãƒãƒ³ã‚¿ãƒ¼ã¯é–“é•ãˆãŸå•é¡ŒãŒ
ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã«ãªã‚‹å­¦ç¿’RPGã§ã™ï¼

ğŸ“¸ èª¤ç­”ã‚’æ’®å½± â†’ AIãŒãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç”Ÿæˆ
âš”ï¸ ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã§å•é¡Œã‚’è§£ã„ã¦è¨ä¼
ğŸ’° ã‚´ãƒ¼ãƒ«ãƒ‰ã¨çµŒé¨“å€¤ã§ã‚­ãƒ£ãƒ©æˆé•·

é–“é•ãˆã‚‹ã»ã©å¼·ããªã‚‹ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ï¼`,guide_desc_1:`ç”»é¢ä¸‹ã®ğŸ“¸èª¤ç­”ç™»éŒ²ãƒœã‚¿ãƒ³ã§
é–“é•ãˆãŸå•é¡Œã®å†™çœŸã‚’æ’®å½±ã€‚

ğŸ“ æ•°å­¦ / ğŸ”¬ ç†ç§‘ ç§‘ç›®é¸æŠ
â†’ AIãŒå•é¡Œã‚’è‡ªå‹•åˆ†æ
â†’ 4æŠãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒç”Ÿæˆï¼

ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒå¤šã„ã»ã©ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãŒè±Šã‹ã«ã€‚`,guide_desc_2:`ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã¯å…¨100éšã§æ§‹æˆã€‚

ğŸ‘¹ 10éšã”ã¨ã«ãƒœã‚¹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å‡ºç¾
ğŸ‘¿ 50éšã«å¼·åŠ›ãªä¸­é–“ãƒœã‚¹
ğŸ‰ 100éšã«æœ€çµ‚ãƒœã‚¹ãŒå¾…æ©Ÿï¼

ãƒœã‚¹ã¯HPãŒé«˜ãèª¤ç­”æ™‚ã®ãƒšãƒŠãƒ«ãƒ†ã‚£å¤§
è¨ä¼ã§å¤§é‡ã‚´ãƒ¼ãƒ«ãƒ‰ã¨ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ï¼`,guide_desc_3:`â­• æ­£è§£ â†’ ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼
âŒ ä¸æ­£è§£ â†’ è‡ªåˆ†ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã‚‹
â° æ™‚é–“åˆ‡ã‚Œ â†’ å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ + æ¬¡ã®å•é¡Œ

ğŸ”¥ é€£ç¶šæ­£è§£ã§ã‚³ãƒ³ãƒœç™ºå‹•ï¼
ã‚³ãƒ³ãƒœãŒé«˜ã„ã»ã©è¿½åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸+ã‚´ãƒ¼ãƒ«ãƒ‰

â­ï¸ ã‚¹ã‚­ãƒƒãƒ—: å°‘é‡ãƒ€ãƒ¡ãƒ¼ã‚¸ã§å•é¡Œãƒ‘ã‚¹`,guide_desc_4:`ãƒãƒˆãƒ«ä¸­ã«ä½¿ãˆã‚‹ã‚¢ã‚¤ãƒ†ãƒ :

ğŸª¶ å¾©æ´»åˆ¸: HP0æ™‚ã«è‡ªå‹•å¾©æ´» (50%)
ğŸ’¡ ãƒ’ãƒ³ãƒˆ: å•é¡Œãƒ’ãƒ³ãƒˆ + ä¸æ­£è§£1ã¤é™¤å»
â° ã‚¿ã‚¤ãƒ ãƒ–ãƒ¼ã‚¹ãƒˆ: 60ç§’è¿½åŠ 
âœ¨ ã‚´ãƒ¼ãƒ«ãƒ‰2å€: ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å…¥å ´æ™‚ã«é©ç”¨

ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨ä¼ã§ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ï¼
ãƒœã‚¹ã»ã©ãƒ‰ãƒ­ãƒƒãƒ—ç‡ãŒé«˜ã„ ğŸ`,guide_desc_5:`ãƒ¡ã‚¤ãƒ³ã®ğŸªã‚·ãƒ§ãƒƒãƒ—ã§å¼·åŒ–ï¼

âš¡ å¼·åŒ–: HPÂ·æ”»æ’ƒåŠ›Â·æ™‚é–“Â·ã‚´ãƒ¼ãƒ«ãƒ‰ãƒœãƒ¼ãƒŠã‚¹
   æ°¸ä¹…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼
ğŸ’ ã‚¢ã‚¤ãƒ†ãƒ : æ¶ˆè²»ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥ (Ã—5ä¸€æ‹¬å¯)
ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º: èƒŒæ™¯ãƒ†ãƒ¼ãƒå¤‰æ›´

ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’è²¯ã‚ã¦æˆ¦ç•¥çš„ã«æŠ•è³‡ã—ã‚ˆã†ã€‚`,guide_desc_6:`ãƒ¬ãƒ™ãƒ«ã¯æœ€å¤§100ã¾ã§æˆé•·ï¼
ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã”ã¨ã«HPÂ·æ”»æ’ƒåŠ›Â·æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹

ğŸ† 30ä»¥ä¸Šã®å®Ÿç¸¾é”æˆã«æŒ‘æˆ¦
   ã‚³ãƒ³ãƒœÂ·ãƒœã‚¹Â·ã‚¯ãƒªã‚¢Â·ãƒ¬ãƒ™ãƒ«å®Ÿç¸¾ãªã©

ğŸ“‹ ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³3å€‹ (æ¯æ—¥æ›´æ–°)
ğŸ“… ã‚¦ã‚£ãƒ¼ã‚¯ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³3å€‹ (æ¯é€±æ›´æ–°)
ãƒŸãƒƒã‚·ãƒ§ãƒ³é”æˆã§è¿½åŠ ã‚´ãƒ¼ãƒ«ãƒ‰+çµŒé¨“å€¤ï¼`,guide_next:"æ¬¡ã¸ â–¶",achievementTitle:"ğŸ† å®Ÿç¸¾",achievement:"ğŸ† å®Ÿç¸¾",dailyMissionTitle:"ğŸ“‹ ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³",achievementList:"ğŸ† å®Ÿç¸¾ ({0}/{1})",claimed:"å—å–æ¸ˆ",achv_cat_combo:"ğŸ”¥ ã‚³ãƒ³ãƒœ",achv_cat_run:"â­ ãƒ©ãƒ³",achv_cat_boss:"ğŸ‘¹ ãƒœã‚¹",achv_cat_level:"ğŸ“ˆ ãƒ¬ãƒ™ãƒ«",achv_cat_gold:"ğŸ’° ã‚´ãƒ¼ãƒ«ãƒ‰",achv_cat_kills:"âš”ï¸ è¨ä¼",achv_cat_subject:"ğŸ“š ç§‘ç›®",achv_cat_study:"âœ… å­¦ç¿’",achv_combo_3:"ç‚ã®å§‹ã¾ã‚Š",achv_combo_3_desc:"10ã‚³ãƒ³ãƒœé”æˆ",achv_combo_5:"é€£ç¶šæ­£è§£ç‹",achv_combo_5_desc:"20ã‚³ãƒ³ãƒœé”æˆ",achv_combo_10:"ã‚³ãƒ³ãƒœãƒã‚¹ã‚¿ãƒ¼",achv_combo_10_desc:"50ã‚³ãƒ³ãƒœé”æˆ",achv_combo_20:"ä¼èª¬ã®ã‚³ãƒ³ãƒœ",achv_combo_20_desc:"100ã‚³ãƒ³ãƒœé”æˆ",achv_combo_500:"ç¥ã®ã‚³ãƒ³ãƒœ",achv_combo_500_desc:"500ã‚³ãƒ³ãƒœé”æˆ",achv_first_clear:"åˆã‚¯ãƒªã‚¢",achv_first_clear_desc:"åˆãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¯ãƒªã‚¢",achv_clear_10:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å¾æœè€…",achv_clear_10_desc:"20å›ã‚¯ãƒªã‚¢",achv_clear_50:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒã‚¹ã‚¿ãƒ¼",achv_clear_50_desc:"80å›ã‚¯ãƒªã‚¢",achv_perfect_run:"ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒ©ãƒ³",achv_perfect_run_desc:"æ­£ç­”ç‡100%ã‚¯ãƒªã‚¢ï¼ˆ10å•ä»¥ä¸Šï¼‰",achv_boss_normal:"ãƒœã‚¹ãƒãƒ³ã‚¿ãƒ¼",achv_boss_normal_desc:"ä¸€èˆ¬ãƒœã‚¹è¨ä¼",achv_boss_mid:"ä¸­é–“ãƒœã‚¹æ’ƒç ´",achv_boss_mid_desc:"ä¸­é–“ãƒœã‚¹è¨ä¼",achv_boss_final:"ãƒ‰ãƒ©ã‚´ãƒ³ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼",achv_boss_final_desc:"æœ€çµ‚ãƒœã‚¹è¨ä¼",achv_level_10:"æˆé•·ã®å§‹ã¾ã‚Š",achv_level_10_desc:"ãƒ¬ãƒ™ãƒ«15é”æˆ",achv_level_25:"ä¸­ç´šå†’é™ºè€…",achv_level_25_desc:"ãƒ¬ãƒ™ãƒ«35é”æˆ",achv_level_50:"ä¸Šç´šå†’é™ºè€…",achv_level_50_desc:"ãƒ¬ãƒ™ãƒ«60é”æˆ",achv_level_99:"æœ€å¼·è€…",achv_level_99_desc:"ãƒ¬ãƒ™ãƒ«99é”æˆ",achv_level_100:"ä¼èª¬ã®å§‹ã¾ã‚Š",achv_level_100_desc:"ãƒ¬ãƒ™ãƒ«100é”æˆ â€” é™ç•Œã‚’è¶…ãˆãŸè€…",hiddenAchievement:"éš ã•ã‚ŒãŸå®Ÿç¸¾",achv_gold_1000:"é‡‘è²¨ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼",achv_gold_1000_desc:"ç´¯è¨ˆ3,000Gç²å¾—",achv_gold_10000:"å¯Œã¸ã®é“",achv_gold_10000_desc:"ç´¯è¨ˆ20,000Gç²å¾—",achv_gold_100000:"ã‚´ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ³ã‚°",achv_gold_100000_desc:"ç´¯è¨ˆ150,000Gç²å¾—",achv_kills_50:"80ä½“è¨ä¼",achv_kills_50_desc:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼80ä½“è¨ä¼",achv_kills_100:"200ä½“è¨ä¼",achv_kills_100_desc:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼200ä½“è¨ä¼",achv_kills_500:"800ä½“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼",achv_kills_500_desc:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼800ä½“è¨ä¼",achv_master_math:"æ•°å­¦ãƒã‚¹ã‚¿ãƒ¼",achv_master_math_desc:"æ•°å­¦å•é¡Œ150å€‹ç™»éŒ²",achv_master_science:"ç§‘å­¦ãƒã‚¹ã‚¿ãƒ¼",achv_master_science_desc:"ç§‘å­¦å•é¡Œ150å€‹ç™»éŒ²",achv_answer_100:"å­¦ç¿’ã®å§‹ã¾ã‚Š",achv_answer_100_desc:"ç´¯è¨ˆæ­£è§£200å€‹",achv_answer_500:"å­¦ç¿’ã®é”äºº",achv_answer_500_desc:"ç´¯è¨ˆæ­£è§£800å€‹",achv_damage_100:"å¼·åŠ›ãªæˆ¦å£«",achv_damage_100_desc:"æ”»æ’ƒåŠ›100é”æˆ",achv_hp_500:"é‰„å£ã®é˜²å¾¡",achv_hp_500_desc:"ä½“åŠ›500é”æˆ",achv_cat_power:"âš¡ æˆ¦é—˜åŠ›",dm_correct_10:"ä»Šæ—¥ã®æ­£è§£10å€‹",dm_correct_20:"ä»Šæ—¥ã®æ­£è§£20å€‹",dm_defeat_3:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼3ä½“è¨ä¼",dm_defeat_5:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼5ä½“è¨ä¼",dm_combo_5:"5ã‚³ãƒ³ãƒœé”æˆ",dm_combo_10:"10ã‚³ãƒ³ãƒœé”æˆ",dm_clear_1:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³1å›ã‚¯ãƒªã‚¢",dm_earn_100:"ã‚´ãƒ¼ãƒ«ãƒ‰100Gç²å¾—",dm_earn_500:"ã‚´ãƒ¼ãƒ«ãƒ‰500Gç²å¾—",dm_answer_30:"å•é¡Œ30å•è§£ã",weeklyMissionTitle:"ğŸ“‹ ã‚¦ã‚£ãƒ¼ã‚¯ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³",wm_correct_150:"ä»Šé€±ã®æ­£è§£150å€‹",wm_correct_300:"ä»Šé€±ã®æ­£è§£300å€‹",wm_defeat_30:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼30ä½“è¨ä¼",wm_defeat_50:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼50ä½“è¨ä¼",wm_combo_50:"50ã‚³ãƒ³ãƒœé”æˆ",wm_combo_100:"100ã‚³ãƒ³ãƒœé”æˆ",wm_clear_7:"ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³7å›ã‚¯ãƒªã‚¢",wm_earn_3000:"ã‚´ãƒ¼ãƒ«ãƒ‰3000Gç²å¾—",wm_earn_7000:"ã‚´ãƒ¼ãƒ«ãƒ‰7000Gç²å¾—",wm_answer_200:"å•é¡Œ200å•è§£ã",guide_start:"ã¯ã˜ã‚ã‚‹ï¼",viewGuide:"ğŸ“– ã‚²ãƒ¼ãƒ ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹",cosmetic_themes:"ãƒ†ãƒ¼ãƒ",cosmetic_particle:"ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«",cosmetic_damageText:"ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆ",cosmetic_flash:"æ­£è§£ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ",cosmetic_equipped:"è£…ç€ä¸­",cosmetic_equip:"è£…ç€",cosmetic_particle_default:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ",cosmetic_particle_gold:"ã‚´ãƒ¼ãƒ«ãƒ‰",cosmetic_particle_rainbow:"ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼",cosmetic_particle_sakura:"ã‚µã‚¯ãƒ©",cosmetic_dmg_default:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ",cosmetic_dmg_neon:"ãƒã‚ªãƒ³",cosmetic_dmg_pixel:"ãƒ”ã‚¯ã‚»ãƒ«",cosmetic_flash_default:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç·‘ï¼‰",cosmetic_flash_blue:"ãƒ–ãƒ«ãƒ¼",cosmetic_flash_purple:"ãƒ‘ãƒ¼ãƒ—ãƒ«"},zh:{title:"é”™é¢˜çŒäºº",subtitle:"Roguelikeå­¦ä¹ RPG",slogan:"ä½ çš„é”™é¢˜å˜æˆæ€ªç‰©ï¼",enterDungeon:"âš”ï¸ è¿›å…¥åœ°ç‰¢",stats:"ğŸ“Š ç»Ÿè®¡",shop:"ğŸª å•†åº—",settings:"âš™ï¸ è®¾ç½®",aiGenerate:"ğŸ¤– AIç”Ÿæˆé¢˜ç›®",aiConnected:"ğŸŸ¢ AIå·²è¿æ¥",aiNotConnected:"ğŸ”´ AIæœªè¿æ¥ï¼ˆåœ¨è®¾ç½®ä¸­è¿æ¥ï¼‰",stage:"å…³å¡",accuracyRate:"æ­£ç¡®ç‡",wrongMonster:"é”™é¢˜æ€ªç‰©",loadingQuestion:"åŠ è½½é¢˜ç›®ä¸­...",viewFull:"ğŸ” æŸ¥çœ‹å…¨æ–‡",seconds:"ç§’",obtained:"è·å¾—ï¼",skip:"â­ï¸è·³è¿‡",quit:"ğŸšªæ”¾å¼ƒ",cleared:"ğŸ‰ é€šå…³ï¼",failed:"ğŸ’€ å¤±è´¥...",stageLabel:"å…³å¡",defeatedMonsters:"å‡»è´¥æ€ªç‰©",bestCombo:"æœ€é«˜è¿å‡»",accuracyLabel:"æ­£ç¡®ç‡",earnedGold:"è·å¾—é‡‘å¸",toMain:"è¿”å›ä¸»é¡µ",shopTitle:"ğŸª å•†åº—",back:"â† è¿”å›",permanentUpgrade:"âš¡ æ°¸ä¹…å¼ºåŒ–",consumableItems:"ğŸ’ æ¶ˆè€—å“",randomBg:"éšæœºèƒŒæ™¯",randomBgDesc:"random background",randomBgApplied:"ğŸ¨ èƒŒæ™¯å·²æ›´æ¢ï¼",shopTabUpgrade:"å¼ºåŒ–",shopTabConsume:"é“å…·",shopTabCosmetic:"è£…é¥°",shopStatSummary:"å½“å‰å±æ€§",shopHp:"HP",shopAtk:"æ”»å‡»åŠ›",shopTime:"æ—¶é—´",shopGoldBonus:"é‡‘å¸+",shopMaxReached:"âœ¦ MAX",shopNotEnoughShort:"ç¼ºå°‘{0}G",shopCurrentTheme:"å½“å‰ä¸»é¢˜",reviveTicketHint:"æ­»äº¡æ—¶è‡ªåŠ¨ä½¿ç”¨",hintTicketHint:"æˆ˜æ–—ä¸­ğŸ’¡æŒ‰é’®",timeBoostHint:"æˆ˜æ–—ä¸­â°æŒ‰é’®",doubleGoldHint:"è¿›å…¥å‰¯æœ¬æ—¶è‡ªåŠ¨",theme_default:"é»˜è®¤(é›è“)",theme_emerald:"ç¿¡ç¿ ",theme_crimson:"æ·±çº¢",theme_amber:"ç¥ç€",theme_violet:"ç´«ç½—å…°",theme_cyan:"é’è‰²",theme_rose:"ç«ç‘°",settingsTitle:"âš™ï¸ è®¾ç½®",settingsTabGame:"æ¸¸æˆ",settingsTabApi:"API",settingsTabData:"æ•°æ®",smilePrintApi:"ğŸ–¼ï¸ SmilePrint APIï¼ˆæ¨èï¼‰",configured:"âœ… å·²è®¾ç½®",notConfigured:"âŒ æœªè®¾ç½®",inputSmilePrintKey:"ğŸ”‘ è¾“å…¥SmilePrint APIå¯†é’¥",geminiApi:"ğŸ¤– Gemini APIï¼ˆå¤‡ç”¨ï¼‰",geminiKey:"ğŸ”‘ Geminiå¯†é’¥",testGenerate:"æµ‹è¯•ç”Ÿæˆ",soundSettings:"ğŸ”Š å£°éŸ³è®¾ç½®",bgmOn:"ğŸµ BGM ON",bgmOff:"ğŸ”‡ BGM OFF",sfxOn:"ğŸ”Š éŸ³æ•ˆ ON",sfxOff:"ğŸ”ˆ éŸ³æ•ˆ OFF",apiGuide:"ğŸ“‹ APIå¯†é’¥è·å–æ–¹æ³•",smilePrintSection:"[ SmilePrint API ]",requestAdmin:"å‘ç®¡ç†å‘˜è¯·æ±‚APIå¯†é’¥",geminiSection:"[ Gemini API ]",visitAiStudio:"è®¿é—® aistudio.google.com",createApiKey:"Get API Key â†’ Create API Key",aiFeatures:"AIè¿æ¥åå¯ç”¨åŠŸèƒ½:",aiFeature1:"â€¢ é¢˜ç›®ç…§ç‰‡è‡ªåŠ¨åˆ†æï¼ˆSmilePrintï¼‰",aiFeature2:"â€¢ ç±»ä¼¼é¢˜ç›®è‡ªåŠ¨ç”Ÿæˆï¼ˆGeminiï¼‰",aiFeature3:"â€¢ è§£é¢˜æç¤º",dataManage:"ğŸ—‚ï¸ æ•°æ®ç®¡ç†",problemCount:"{0}é“é¢˜",export:"ğŸ“¤ å¯¼å‡º",import:"ğŸ“¥ å¯¼å…¥",resetAll:"ğŸ—‘ï¸ å…¨éƒ¨é‡ç½®",langSettings:"ğŸŒ è¯­è¨€è®¾ç½®",uiOpacityTitle:"ğŸ”² UIé€æ˜åº¦",statsTitle:"ğŸ“Š ç»Ÿè®¡",overallStats:"ğŸ“‹ æ€»ä½“ç»Ÿè®¡",totalQuestions:"æ€»é¢˜æ•°",totalRuns:"æ€»æ¸¸æˆæ¬¡æ•°",subjectStats:"ğŸ“š æŒ‰ç§‘ç›®ç»Ÿè®¡",difficultyStats:"ğŸ¯ æŒ‰éš¾åº¦åˆ†æ",easy:"ç®€å•",normal:"æ™®é€š",hard:"å›°éš¾",playRecord:"ğŸ† æ¸¸æˆè®°å½•",clear:"é€šå…³",fail:"å¤±è´¥",totalGoldEarned:"æ€»è·å¾—é‡‘å¸",stats_winRate:"èƒœç‡",stats_totalPlayTime:"æ€»æ¸¸æˆæ—¶é—´",stats_avgRunDuration:"å¹³å‡æ¸¸æˆæ—¶é•¿",stats_longestRun:"æœ€é•¿æ¸¸æˆ",stats_shortestClear:"æœ€å¿«é€šå…³",stats_currentStreak:"å½“å‰è¿èƒœ",stats_bestStreak:"æœ€é«˜è¿èƒœ",stats_recentRecord:"æœ€è¿‘æˆ˜ç»©",stats_recentWinRate:"æœ€è¿‘èƒœç‡",stats_recentAccuracy:"æœ€è¿‘æ­£ç¡®ç‡",stats_subjectAccuracy:"æŒ‰ç§‘ç›®æ­£ç¡®ç‡",stats_difficultyAccuracy:"æŒ‰éš¾åº¦æ­£ç¡®ç‡",stats_avgAccuracy:"å¹³å‡æ­£ç¡®ç‡",stats_avgGoldPerRun:"åœºå‡é‡‘å¸",stats_totalDefeated:"æ€»å‡»è´¥æ•°",stats_heroBanner:"è‹±é›„ç»Ÿè®¡",stats_streakTime:"è¿èƒœä¸æ—¶é—´",stats_subjectPerf:"ç§‘ç›®æˆç»©",stats_diffAnalysis:"éš¾åº¦åˆ†æ",stats_playStats:"æ¸¸æˆè®°å½•",stats_recentBattle:"æœ€è¿‘æˆ˜ç»©",stats_advanced:"é«˜çº§ç»Ÿè®¡",stats_noData:"è¿˜æ²¡æœ‰æ¸¸æˆè®°å½•",stats_noDataSub:"æŒ‘æˆ˜åœ°ç‰¢å¼€å§‹ç§¯ç´¯ç»Ÿè®¡å§ï¼",stats_runs:"æ¬¡",stats_wins:"èƒœåˆ©",stats_losses:"å¤±è´¥",stats_accuracy:"æ­£ç¡®ç‡",stats_combo:"è¿å‡»",stats_gold:"é‡‘å¸",stats_time:"æ—¶é—´",stats_streak:"è¿èƒœ",stats_min:"åˆ†",stats_sec:"ç§’",stats_hr:"å°æ—¶",stats_attempts:"å°è¯•",stats_correct:"æ­£ç¡®",stats_itemUsage:"é“å…·ä½¿ç”¨ç»Ÿè®¡",stats_skipTotal:"è·³è¿‡",stats_hintTotal:"æç¤º",stats_timeBoostTotal:"å»¶æ—¶",stats_reviveTotal:"å¤æ´»",stats_timeoutTotal:"è¶…æ—¶",stats_perRun:"å¹³å‡",stats_wrongBySubject:"æŒ‰ç§‘ç›®é”™é¢˜åˆ†æ",stats_wrongCount:"âŒ",stats_correctCount:"âœ…",stats_wrongRate:"é”™è¯¯ç‡",stats_hintShort:"æç¤º",stats_timeBoostShort:"å»¶æ—¶",stats_reviveShort:"å¤æ´»",result_itemUsage:"é“å…·ä½¿ç”¨",result_timeout:"è¶…æ—¶",stats_topicAnalysis:"æŒ‰ç±»å‹é”™é¢˜åˆ†æ",stats_weakTopics:"è–„å¼±ç±»å‹TOP",stats_noWrongTopics:"æš‚æ— é”™é¢˜æ•°æ®",stats_topicDetail:"æŒ‰ç±»å‹",stats_colAttempts:"æ¬¡æ•°",stats_colCorrectRate:"æ­£ç¡®ç‡",stats_colWrongRate:"é”™è¯¯ç‡",stats_colDate:"æ—¥æœŸ",stats_colCombo:"è¿å‡»",stats_colGold:"é‡‘å¸",stats_colTime:"æ—¶é—´",stats_diffWrong:"æŒ‰éš¾åº¦é”™é¢˜",stats_tabOverview:"ç»¼åˆ",stats_tabSubject:"ç§‘ç›®",stats_tabAnalysis:"åˆ†æ",dungeonSelect:"âš”ï¸ é€‰æ‹©åœ°ç‰¢",selectDungeon:"é€‰æ‹©è¦æŒ‘æˆ˜çš„åœ°ç‰¢",mathDungeon:"æ•°å­¦åœ°ç‰¢",scienceDungeon:"ç§‘å­¦åœ°ç‰¢",registeredMonsters:"å·²æ³¨å†Œæ€ªç‰©: {0}åª",mathTopics:"æ–¹ç¨‹å¼ã€å‡½æ•°ã€æ¦‚ç‡ã€å‡ ä½•ç­‰",scienceTopics:"åŠ›ä¸è¿åŠ¨ã€åŒ–å­¦ååº”ã€é—ä¼ ã€åŠ›å­¦ç­‰",goBack:"â† è¿”å›",subjectSelect:"ğŸ“¸ é€‰æ‹©ç§‘ç›®",cancel:"â† å–æ¶ˆ",capturedPhoto:"ğŸ“· æ‹æ‘„çš„ç…§ç‰‡",selectSubject:"è¯·é€‰æ‹©è¿™é“é¢˜çš„ç§‘ç›®",math:"æ•°å­¦",english:"è‹±è¯­",korean:"è¯­æ–‡",science:"ç§‘å­¦",boss:"Boss",midBoss:"ä¸­é—´Boss",finalBoss:"æœ€ç»ˆBoss",rarityNormal:"æ™®é€š",rarityRare:"ç¨€æœ‰",rarityEpic:"å²è¯—",rarityLegendary:"ä¼ è¯´",hpUpgrade:"HPå¼ºåŒ–",hpUpgradeDesc:"æœ€å¤§HP +10",timeUpgrade:"æ—¶é—´å¼ºåŒ–",timeUpgradeDesc:"æ—¶é—´é™åˆ¶ +3ç§’",goldBonus:"é‡‘å¸åŠ æˆ",goldBonusDesc:"é‡‘å¸è·å– +5%",damageUpgrade:"æ”»å‡»åŠ›å¼ºåŒ–",damageUpgradeDesc:"åŸºç¡€ä¼¤å®³ +5",reviveTicket:"å¤æ´»åˆ¸",reviveTicketDesc:"æ­»äº¡æ—¶æ¢å¤50% HPå¤æ´»",hintTicket:"æç¤ºåˆ¸",hintTicketDesc:"å…è´¹ä½¿ç”¨1æ¬¡æç¤º",timeBoost:"æ—¶é—´å»¶é•¿",timeBoostDesc:"æˆ˜æ–—ä¸­ä½¿ç”¨å½“å‰é¢˜ç›®+60ç§’",doubleGold:"é‡‘å¸1.25å€",doubleGoldDesc:"ä¸‹æ¬¡æ¸¸æˆé‡‘å¸è·å–1.25å€",noProblems:"æ²¡æœ‰æ³¨å†Œçš„é¢˜ç›®ï¼è¯·å…ˆæ³¨å†Œé”™é¢˜ã€‚",goldMultiplierApplied:"âœ¨ é‡‘å¸1.25å€å·²ç”Ÿæ•ˆï¼æœ¬æ¬¡æ¸¸æˆè·å¾—çš„é‡‘å¸å°†ä¸º1.25å€ï¼",noPhoto:"æ²¡æœ‰æ‹æ‘„çš„ç…§ç‰‡ã€‚",aiAnalyzed:`AIåˆ†æç»“æœ:

é¢˜ç›®: {0}
ç­”æ¡ˆ: {1}
ä¸»é¢˜: {2}
è§£æ: {3}

è¿™ä¸ªå†…å®¹æ­£ç¡®å—ï¼Ÿ`,aiAnalyzedSimple:`AIåˆ†æç»“æœ:

é¢˜ç›®: {0}
ç­”æ¡ˆ: {1}

è¿™ä¸ªå†…å®¹æ­£ç¡®å—ï¼Ÿ`,editQuestion:"è¯·ä¿®æ”¹é¢˜ç›®:",editAnswer:"è¯·ä¿®æ”¹ç­”æ¡ˆ:",aiFailed:`AIåˆ†æå¤±è´¥: {0}

è¯·æ‰‹åŠ¨è¾“å…¥ã€‚`,inputQuestion:"è¯·è¾“å…¥é¢˜ç›®:",inputAnswer:"è¯·è¾“å…¥ç­”æ¡ˆ:",inputAnswerNum:"è¯·è¾“å…¥ç­”æ¡ˆï¼ˆæ•°å­—ï¼‰:",noAnswer:"æ²¡æœ‰ç­”æ¡ˆï¼Œæ— æ³•æ³¨å†Œã€‚",monsterRegistered:"æ€ªç‰©å·²æ³¨å†Œï¼ğŸ‘¾",inputGeminiKey:"è¯·è¾“å…¥Gemini APIå¯†é’¥:",geminiKeySaved:"Gemini APIå¯†é’¥å·²ä¿å­˜ï¼",inputSmilePrintApiKey:"è¯·è¾“å…¥SmilePrint APIå¯†é’¥:",smilePrintKeySaved:`SmilePrint APIå¯†é’¥å·²ä¿å­˜ï¼

ç°åœ¨å¯ä»¥ä½¿ç”¨å›¾åƒåˆ†æåŠŸèƒ½ã€‚`,testGenerating:"æ­£åœ¨ç”Ÿæˆæµ‹è¯•é¢˜ç›®...è¯·ç¨ç­‰ã€‚",testGenerated:`âœ… ç”Ÿæˆäº†{0}é“é¢˜ï¼

ç¤ºä¾‹:
é¢˜ç›®: {1}
ç­”æ¡ˆ: {2}`,generateFailed:"é¢˜ç›®ç”Ÿæˆå¤±è´¥ã€‚",invalidInput:"è¾“å…¥æ— æ•ˆ",aiGenerateMenu:`ğŸ¤– AIé¢˜ç›®ç”Ÿæˆ

é€‰æ‹©ç§‘ç›®:
1. {0}
2. {1}

è¾“å…¥ç¼–å· (1-2):`,aiTopicMenu:`ğŸ¤– AI {0}é¢˜ç›®ç”Ÿæˆ

é€‰æ‹©ä¸»é¢˜:
{1}

è¾“å…¥ç¼–å· (1-{2}):`,difficultyMenu:`ä¸»é¢˜: {0}

é€‰æ‹©éš¾åº¦:
1. {1}
2. {2}
3. {3}

è¾“å…¥ç¼–å·:`,countMenu:`ä¸»é¢˜: {0}
éš¾åº¦: {1}

ç”Ÿæˆé¢˜ç›®æ•°é‡ (1-10):`,generated:`âœ… ç”Ÿæˆäº†{0}é“é¢˜ï¼

ä¸»é¢˜: {1}
éš¾åº¦: {2}

ç¤ºä¾‹:
é¢˜ç›®: {3}
ç­”æ¡ˆ: {4}`,levelProgress:"ğŸ“Š ç­‰çº§è¿›åº¦",currentStats:"ğŸ“‹ å½“å‰å±æ€§",nextBonus:"ğŸ¯ ä¸‹ä¸€ä¸ªå¥–åŠ±",expGain:"ğŸ’¡ ç»éªŒå€¼è·å–",close:"å…³é—­",correctAnswer:"æ­£ç¡®",monsterKill:"å‡»è´¥æ€ªç‰©",normalBossLabel:"æ™®é€šBoss",midBossLabel:"ä¸­é—´Boss",finalBossLabel:"æœ€ç»ˆBoss",base:"åŸºç¡€",level:"ç­‰çº§",upgrade:"å¼ºåŒ–",attack:"æ”»å‡»åŠ›",time:"æ—¶é—´",noProblemsToReset:"æ²¡æœ‰å¯é‡ç½®çš„é¢˜ç›®ã€‚",confirmReset:`ç¡®å®šè¦åˆ é™¤æ‰€æœ‰é¢˜ç›®({0}é“)å—ï¼Ÿ

æ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`,confirmResetFinal:`âš ï¸ æœ€ç»ˆç¡®è®¤

{0}é“é¢˜å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚
ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`,resetDone:"âœ… å·²åˆ é™¤{0}é“é¢˜ã€‚",resetError:"é‡ç½®é¢˜ç›®æ—¶å‘ç”Ÿé”™è¯¯ã€‚",resetAccount:"ğŸ”„ é‡ç½®è´¦å·",confirmAccountReset:`âš ï¸ é‡ç½®è´¦å·

ç­‰çº§ã€é‡‘å¸ã€å‡çº§ã€é“å…·ã€æ¸¸æˆè®°å½•
å°†å…¨éƒ¨é‡ç½®ã€‚

ï¼ˆå·²æ³¨å†Œçš„é¢˜ç›®å°†ä¿ç•™ï¼‰

ç¡®å®šè¦é‡ç½®å—ï¼Ÿ`,confirmAccountResetFinal:`âš ï¸ æœ€ç»ˆç¡®è®¤

è´¦å·æ•°æ®å°†è¢«æ°¸ä¹…é‡ç½®ã€‚
æ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`,accountResetDone:`âœ… è´¦å·å·²é‡ç½®ã€‚
ä»1çº§ã€100é‡‘å¸é‡æ–°å¼€å§‹ã€‚`,accountResetError:"é‡ç½®è´¦å·æ—¶å‘ç”Ÿé”™è¯¯ã€‚",noExportData:"æ²¡æœ‰å¯å¯¼å‡ºçš„é¢˜ç›®ã€‚",exported:"âœ… å·²å¯¼å‡º{0}é“é¢˜ï¼",exportError:"å¯¼å‡ºé¢˜ç›®æ—¶å‘ç”Ÿé”™è¯¯ã€‚",invalidFile:"æ— æ•ˆçš„é¢˜ç›®æ–‡ä»¶ã€‚",noImportData:"æ²¡æœ‰å¯å¯¼å…¥çš„é¢˜ç›®ã€‚",confirmImport:`å¯¼å…¥{0}é“é¢˜å—ï¼Ÿ

ï¼ˆç°æœ‰é¢˜ç›®å°†ä¿ç•™ï¼‰`,imported:"âœ… å·²å¯¼å…¥{0}é“é¢˜ï¼",importError:`å¯¼å…¥é¢˜ç›®æ—¶å‘ç”Ÿé”™è¯¯ã€‚
è¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚`,analyzing:"ğŸ¤– {0} åˆ†æä¸­...",analyzingDesc:"æ­£åœ¨é˜…è¯»é¢˜ç›®å¯»æ‰¾ç­”æ¡ˆ",generating:"ğŸ¤– AIé¢˜ç›®ç”Ÿæˆä¸­...",generatingDesc:"æ­£åœ¨åˆ›å»º{0}é“é¢˜",pleaseWait:"è¯·ç¨å€™...",autoFillGenerating:"ğŸ¤– è‡ªåŠ¨ç”Ÿæˆé¢˜ç›®ä¸­...",autoFillDesc:"æ­£åœ¨è¡¥å……{0}é“é¢˜",autoFillProgress:"å·²ç”Ÿæˆ{0}/{1}é“",monsterHpRecover:"æ€ªç‰©HPæ¢å¤ï¼",reviveUsed:`ğŸª¶ ä½¿ç”¨å¤æ´»åˆ¸ï¼HPæ¢å¤50%ï¼
ï¼ˆå‰©ä½™: {0}ï¼‰`,noHintNoGold:`æ²¡æœ‰æç¤ºåˆ¸ï¼Œé‡‘å¸ä¹Ÿä¸å¤Ÿï¼
ï¼ˆéœ€è¦50Gï¼‰

è¯·åœ¨å•†åº—è´­ä¹°æç¤ºåˆ¸ï¼`,useGoldForHint:`æ²¡æœ‰æç¤ºåˆ¸ã€‚
ä½¿ç”¨50Gå—ï¼Ÿ

å½“å‰é‡‘å¸: {0}G`,topicHint:"ğŸ“š ä¸»é¢˜: {0}",explanationHint:"ğŸ’­ è§£é¢˜æç¤º: {0}...",wrongChoiceHint:"âŒ ç¬¬{0}ä¸ªé€‰é¡¹æ˜¯é”™çš„ï¼",keywordHint:"ğŸ”‘ å…³é”®è¯: {0}",readCarefully:"ğŸ’¡ è¯·ä»”ç»†é˜…è¯»é¢˜ç›®ï¼",trySubstitute:"ğŸ“ è¯•ç€é€ä¸ªä»£å…¥é€‰é¡¹ã€‚",hintTitle:"ğŸ’¡ æç¤º",timeBoostUsed:"â° +60ç§’ï¼ï¼ˆå‰©ä½™: {0}ï¼‰",noTimeBoost:`æ²¡æœ‰æ—¶é—´å»¶é•¿é“å…·ï¼
è¯·åœ¨å•†åº—è´­ä¹°ã€‚`,questionLabel:"ğŸ“ é¢˜ç›®",noQuestion:"æ— é¢˜ç›®",problemViewer:"ğŸ“‹ æŸ¥çœ‹é¢˜ç›®",problemViewerEmpty:"æ²¡æœ‰å·²æ³¨å†Œçš„é¢˜ç›®ã€‚",filterAll:"å…¨éƒ¨",filterImage:"ğŸ“· å›¾ç‰‡",answerLabel:"ç­”æ¡ˆ",difficultyLabel:"éš¾åº¦",alreadyMax:"å·²è¾¾æœ€é«˜ç­‰çº§ï¼",notEnoughGold:"é‡‘å¸ä¸è¶³ï¼",upgradeBought:"{0} {1} Lv.{2} è´­ä¹°å®Œæˆï¼",itemBought:"{0} {1} è´­ä¹°å®Œæˆï¼ï¼ˆæŒæœ‰: {2}ä¸ªï¼‰",levelUp:"ğŸ‰ å‡çº§ï¼LV.{0}",attackBonus:"æ”»å‡»åŠ› +{0}",timeBonus:"é¢˜ç›®æ—¶é—´ +{0}ç§’",maxLevelBonus:"ğŸ† MAX! æ”»å‡»åŠ›+10, HP+10, æ—¶é—´+15",exportFilename:"é”™é¢˜","item.hpPotion":"HPè¯æ°´","item.timeSand":"æ—¶é—´ä¹‹æ²™","item.smallGoldBag":"å°é‡‘å¸è¢‹","item.highHpPotion":"é«˜çº§HPè¯æ°´","item.timeCrystal":"æ—¶é—´æ°´æ™¶","item.goldBag":"é‡‘å¸è¢‹","item.comboBooster":"è¿å‡»åŠ é€Ÿå™¨","item.holyGrail":"ç”Ÿå‘½åœ£æ¯","item.freeHint":"å…è´¹æç¤ºåˆ¸","item.reviveFeather":"å¤æ´»ä¹‹ç¾½","item.goldAmulet":"é‡‘å¸1.25å€æŠ¤ç¬¦","item.immortalRing":"ä¸æ­»ä¹‹æˆ’","item.timeStop":"æ—¶é—´åœæ­¢","item.legendaryGold":"ä¼ è¯´é‡‘å—","item.wisdomCrown":"æ™ºæ…§ä¹‹å† ","mon.slime":"å²è±å§†","mon.blob":"ç²˜æ¶²æ€ª","mon.muryeong":"æ°´çµ","mon.jelly":"æœå†»æ€ª","mon.skeleton":"éª·é«…å…µ","mon.skelleton":"éª·é«…","mon.baekgol":"ç™½éª¨","mon.boneguard":"éª¨å«","mon.bat":"è™è ","mon.batwing":"è ç¿¼","mon.yacha":"å¤œå‰","mon.flying":"é£è¡Œè€…","mon.zombie":"åƒµå°¸","mon.undead":"äº¡çµ","mon.gangsi":"åƒµå°¸","mon.mutant":"å˜å¼‚ä½“","mon.ghost":"å¹½çµ","mon.ghosty":"é¬¼é­‚","mon.wongui":"æ€¨é¬¼","mon.specter":"å¹½é­‚","mon.spider":"èœ˜è››","mon.spidery":"è››æ€ª","mon.dokchung":"æ¯’è™«","mon.arachne":"è››å¥³",loggingIn:"ç™»å½•ä¸­...",loginFailed:"ç™»å½•å¤±è´¥",serverError:"æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚",cameraError:"æ— æ³•æ‰“å¼€æ‘„åƒå¤´: ",loading:"åŠ è½½ä¸­...",error:"é”™è¯¯: ",googleLoadFailed:"æ— æ³•åŠ è½½Googleç™»å½•ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚",htmlTitle:"é”™é¢˜çŒäºº",htmlSlogan:"æ¶ˆç­é”™é¢˜ï¼Œå‡çº§æ‰“æ€ªï¼",htmlRegister:"ğŸ“¸ ç™»è®°é”™é¢˜",htmlLogout:"é€€å‡ºç™»å½•",htmlCapture:"ğŸ“· æ‹ç…§",htmlClose:"âœ• å…³é—­",multipleChoice:"é€‰æ‹©é¢˜",noAnalysisResult:"æ— åˆ†æç»“æœ",defaultTopic:"æ•°å­¦",defaultProblem:"é¢˜ç›®",linearEquation:"ä¸€æ¬¡æ–¹ç¨‹",guide_title_0:"æ¬¢è¿æ¥åˆ°é”™é¢˜çŒäººï¼",guide_title_1:"ç™»è®°é”™é¢˜",guide_title_2:"åœ°ç‰¢ç»“æ„",guide_title_3:"æˆ˜æ–—æœºåˆ¶",guide_title_4:"é“å…·",guide_title_5:"å•†åº—",guide_title_6:"æˆé•¿ç³»ç»Ÿ",guide_desc_0:`é”™é¢˜çŒäººæ˜¯ä¸€æ¬¾é”™é¢˜
å˜æˆæ€ªç‰©çš„å­¦ä¹ RPGï¼

ğŸ“¸ æ‹æ‘„é”™é¢˜ â†’ AIç”Ÿæˆæ€ªç‰©
âš”ï¸ åœ¨åœ°ç‰¢ä¸­è§£é¢˜æ¶ˆç­æ€ªç‰©
ğŸ’° è·å¾—é‡‘å¸å’Œç»éªŒå€¼æˆé•¿

é”™å¾—è¶Šå¤šï¼Œåœ°ç‰¢è¶Šä¸°å¯Œï¼`,guide_desc_1:`ç‚¹å‡»å±å¹•ä¸‹æ–¹çš„ğŸ“¸ç™»è®°é”™é¢˜æŒ‰é’®
æ‹æ‘„é”™é¢˜ç…§ç‰‡ã€‚

ğŸ“ æ•°å­¦ / ğŸ”¬ ç§‘å­¦ ç§‘ç›®é€‰æ‹©
â†’ AIè‡ªåŠ¨åˆ†æé¢˜ç›®
â†’ ç”Ÿæˆå››é€‰ä¸€æ€ªç‰©ï¼

æ€ªç‰©è¶Šå¤šï¼Œåœ°ç‰¢è¶Šä¸°å¯Œã€‚`,guide_desc_2:`åœ°ç‰¢å…±æœ‰100å±‚ã€‚

ğŸ‘¹ æ¯10å±‚å‡ºç°Bossæ€ªç‰©
ğŸ‘¿ 50å±‚æœ‰å¼ºåŠ›ä¸­é—´Boss
ğŸ‰ 100å±‚æœ‰æœ€ç»ˆBossï¼

Bossè¡€é‡é«˜ï¼Œç­”é”™æƒ©ç½šå¤§ï¼Œ
ä½†å‡»è´¥åæ‰è½å¤§é‡é‡‘å¸å’Œé“å…·ï¼`,guide_desc_3:`â­• ç­”å¯¹ â†’ å¯¹æ€ªç‰©é€ æˆä¼¤å®³ï¼
âŒ ç­”é”™ â†’ è‡ªå·±å—åˆ°ä¼¤å®³
â° è¶…æ—¶ â†’ å¤§é‡ä¼¤å®³ + ä¸‹ä¸€é¢˜

ğŸ”¥ è¿ç»­ç­”å¯¹è§¦å‘è¿å‡»ï¼
è¿å‡»è¶Šé«˜ï¼Œé¢å¤–ä¼¤å®³+é‡‘å¸è¶Šå¤š

â­ï¸ è·³è¿‡ï¼šå—å°‘é‡ä¼¤å®³è·³è¿‡é¢˜ç›®`,guide_desc_4:`æˆ˜æ–—ä¸­å¯ä½¿ç”¨çš„é“å…·ï¼š

ğŸª¶ å¤æ´»åˆ¸ï¼šHPå½’0æ—¶è‡ªåŠ¨å¤æ´» (50%)
ğŸ’¡ æç¤ºï¼šè·å¾—æç¤º + å»é™¤1ä¸ªé”™è¯¯é€‰é¡¹
â° æ—¶é—´å¢å¼ºï¼šå¢åŠ 60ç§’
âœ¨ é‡‘å¸ç¿»å€ï¼šè¿›å…¥åœ°ç‰¢æ—¶è‡ªåŠ¨ç”Ÿæ•ˆ

å‡»è´¥æ€ªç‰©æœ‰å‡ ç‡æ‰è½é“å…·ï¼
Bossæ‰è½æ¦‚ç‡æ›´é«˜ ğŸ`,guide_desc_5:`åœ¨ä¸»ç•Œé¢ğŸªå•†åº—ä¸­å¼ºåŒ–ï¼

âš¡ å¼ºåŒ–ï¼šHPÂ·æ”»å‡»åŠ›Â·æ—¶é—´Â·é‡‘å¸åŠ æˆ
   æ°¸ä¹…å±æ€§å‡çº§ï¼
ğŸ’ é“å…·ï¼šè´­ä¹°æ¶ˆè€—å“ï¼ˆå¯æ‰¹é‡Ã—5ï¼‰
ğŸ¨ è£…é¥°ï¼šæ›´æ¢èƒŒæ™¯ä¸»é¢˜

ç§¯æ”’é‡‘å¸ï¼Œæˆ˜ç•¥æŠ•èµ„ã€‚`,guide_desc_6:`ç­‰çº§æœ€é«˜å¯è¾¾100çº§ï¼
æ¯æ¬¡å‡çº§è·å¾—HPÂ·æ”»å‡»åŠ›Â·æ—¶é—´åŠ æˆ

ğŸ† 30å¤šä¸ªæˆå°±ç­‰ä½ æŒ‘æˆ˜
   è¿å‡»Â·BossÂ·é€šå…³Â·ç­‰çº§æˆå°±ç­‰

ğŸ“‹ æ¯æ—¥ä»»åŠ¡3ä¸ªï¼ˆæ¯å¤©åˆ·æ–°ï¼‰
ğŸ“… æ¯å‘¨ä»»åŠ¡3ä¸ªï¼ˆæ¯å‘¨åˆ·æ–°ï¼‰
å®Œæˆä»»åŠ¡è·å¾—é¢å¤–é‡‘å¸+ç»éªŒå€¼ï¼`,guide_next:"ä¸‹ä¸€é¡µ â–¶",achievementTitle:"ğŸ† æˆå°±",achievement:"ğŸ† æˆå°±",dailyMissionTitle:"ğŸ“‹ æ¯æ—¥ä»»åŠ¡",achievementList:"ğŸ† æˆå°± ({0}/{1})",claimed:"å·²é¢†å–",achv_cat_combo:"ğŸ”¥ è¿å‡»",achv_cat_run:"â­ å†’é™©",achv_cat_boss:"ğŸ‘¹ Boss",achv_cat_level:"ğŸ“ˆ ç­‰çº§",achv_cat_gold:"ğŸ’° é‡‘å¸",achv_cat_kills:"âš”ï¸ å‡»æ€",achv_cat_subject:"ğŸ“š ç§‘ç›®",achv_cat_study:"âœ… å­¦ä¹ ",achv_combo_3:"ç«ç„°èµ·å§‹",achv_combo_3_desc:"è¾¾æˆ10è¿å‡»",achv_combo_5:"è¿ç»­æ­£ç¡®ç‹",achv_combo_5_desc:"è¾¾æˆ20è¿å‡»",achv_combo_10:"è¿å‡»å¤§å¸ˆ",achv_combo_10_desc:"è¾¾æˆ50è¿å‡»",achv_combo_20:"ä¼ è¯´è¿å‡»",achv_combo_20_desc:"è¾¾æˆ100è¿å‡»",achv_combo_500:"ç¥ä¹‹è¿å‡»",achv_combo_500_desc:"è¾¾æˆ500è¿å‡»",achv_first_clear:"é¦–æ¬¡é€šå…³",achv_first_clear_desc:"é¦–æ¬¡é€šå…³åœ°ç‰¢",achv_clear_10:"åœ°ç‰¢å¾æœè€…",achv_clear_10_desc:"é€šå…³20æ¬¡",achv_clear_50:"åœ°ç‰¢å¤§å¸ˆ",achv_clear_50_desc:"é€šå…³80æ¬¡",achv_perfect_run:"å®Œç¾é€šå…³",achv_perfect_run_desc:"100%æ­£ç¡®ç‡é€šå…³ï¼ˆ10é¢˜ä»¥ä¸Šï¼‰",achv_boss_normal:"BossçŒäºº",achv_boss_normal_desc:"å‡»è´¥æ™®é€šBoss",achv_boss_mid:"ä¸­é—´Bosså‡»ç ´",achv_boss_mid_desc:"å‡»è´¥ä¸­é—´Boss",achv_boss_final:"å± é¾™è€…",achv_boss_final_desc:"å‡»è´¥æœ€ç»ˆBoss",achv_level_10:"æˆé•¿å¼€å§‹",achv_level_10_desc:"è¾¾åˆ°15çº§",achv_level_25:"ä¸­çº§å†’é™©è€…",achv_level_25_desc:"è¾¾åˆ°35çº§",achv_level_50:"é«˜çº§å†’é™©è€…",achv_level_50_desc:"è¾¾åˆ°60çº§",achv_level_99:"æœ€å¼ºè€…",achv_level_99_desc:"è¾¾åˆ°99çº§",achv_level_100:"ä¼ è¯´çš„å¼€å§‹",achv_level_100_desc:"è¾¾åˆ°100çº§ â€” è¶…è¶Šæé™ä¹‹äºº",hiddenAchievement:"éšè—æˆå°±",achv_gold_1000:"é‡‘å¸æ”¶è—å®¶",achv_gold_1000_desc:"ç´¯è®¡è·å¾—3,000G",achv_gold_10000:"è‡´å¯Œä¹‹è·¯",achv_gold_10000_desc:"ç´¯è®¡è·å¾—20,000G",achv_gold_100000:"é‡‘å¸ä¹‹ç‹",achv_gold_100000_desc:"ç´¯è®¡è·å¾—150,000G",achv_kills_50:"80åªå‡»æ€",achv_kills_50_desc:"å‡»è´¥80åªæ€ªç‰©",achv_kills_100:"200åªå‡»æ€",achv_kills_100_desc:"å‡»è´¥200åªæ€ªç‰©",achv_kills_500:"800åªå± æ€è€…",achv_kills_500_desc:"å‡»è´¥800åªæ€ªç‰©",achv_master_math:"æ•°å­¦å¤§å¸ˆ",achv_master_math_desc:"æ³¨å†Œ150é“æ•°å­¦é¢˜",achv_master_science:"ç§‘å­¦å¤§å¸ˆ",achv_master_science_desc:"æ³¨å†Œ150é“ç§‘å­¦é¢˜",achv_answer_100:"å­¦ä¹ èµ·æ­¥",achv_answer_100_desc:"ç´¯è®¡æ­£ç¡®200é“",achv_answer_500:"å­¦ä¹ è¾¾äºº",achv_answer_500_desc:"ç´¯è®¡æ­£ç¡®800é“",achv_damage_100:"å¼ºåŠ›æˆ˜å£«",achv_damage_100_desc:"æ”»å‡»åŠ›è¾¾åˆ°100",achv_hp_500:"é“å£é˜²å¾¡",achv_hp_500_desc:"ä½“åŠ›è¾¾åˆ°500",achv_cat_power:"âš¡ æˆ˜æ–—åŠ›",dm_correct_10:"ä»Šå¤©ç­”å¯¹10é¢˜",dm_correct_20:"ä»Šå¤©ç­”å¯¹20é¢˜",dm_defeat_3:"å‡»è´¥3åªæ€ªç‰©",dm_defeat_5:"å‡»è´¥5åªæ€ªç‰©",dm_combo_5:"è¾¾æˆ5è¿å‡»",dm_combo_10:"è¾¾æˆ10è¿å‡»",dm_clear_1:"é€šå…³1æ¬¡åœ°ç‰¢",dm_earn_100:"è·å¾—100G",dm_earn_500:"è·å¾—500G",dm_answer_30:"è§£ç­”30é“é¢˜",weeklyMissionTitle:"ğŸ“‹ æ¯å‘¨ä»»åŠ¡",wm_correct_150:"æœ¬å‘¨ç­”å¯¹150é¢˜",wm_correct_300:"æœ¬å‘¨ç­”å¯¹300é¢˜",wm_defeat_30:"å‡»è´¥30åªæ€ªç‰©",wm_defeat_50:"å‡»è´¥50åªæ€ªç‰©",wm_combo_50:"è¾¾æˆ50è¿å‡»",wm_combo_100:"è¾¾æˆ100è¿å‡»",wm_clear_7:"é€šå…³7æ¬¡åœ°ç‰¢",wm_earn_3000:"è·å¾—3000G",wm_earn_7000:"è·å¾—7000G",wm_answer_200:"è§£ç­”200é“é¢˜",guide_start:"å¼€å§‹å§ï¼",viewGuide:"ğŸ“– æŸ¥çœ‹æ¸¸æˆæŒ‡å—",cosmetic_themes:"ä¸»é¢˜",cosmetic_particle:"ç²’å­æ ·å¼",cosmetic_damageText:"ä¼¤å®³æ–‡å­—",cosmetic_flash:"æ­£ç¡®ç‰¹æ•ˆ",cosmetic_equipped:"å·²è£…å¤‡",cosmetic_equip:"è£…å¤‡",cosmetic_particle_default:"é»˜è®¤",cosmetic_particle_gold:"é»„é‡‘",cosmetic_particle_rainbow:"å½©è™¹",cosmetic_particle_sakura:"æ¨±èŠ±",cosmetic_dmg_default:"é»˜è®¤",cosmetic_dmg_neon:"éœ“è™¹",cosmetic_dmg_pixel:"åƒç´ ",cosmetic_flash_default:"é»˜è®¤ï¼ˆç»¿è‰²ï¼‰",cosmetic_flash_blue:"è“è‰²",cosmetic_flash_purple:"ç´«è‰²"}};function ut(c){Ee[c]&&($e=c,F(We,c),ze())}function ze(){document.title=l("htmlTitle");const c=document.querySelector("#login-box h1");c&&(c.textContent=l("htmlTitle"));const e=document.querySelector("#login-box p");e&&(e.textContent=l("htmlSlogan"));const t=document.getElementById("register-btn");t&&(t.textContent=l("htmlRegister"));const n=document.getElementById("logout-btn");n&&(n.textContent=l("htmlLogout"));const s=document.getElementById("camera-capture");s&&(s.textContent=l("htmlCapture"));const i=document.getElementById("camera-close");i&&(i.textContent=l("htmlClose"))}function ht(){return $e}function l(c,...e){let n=(Ee[$e]||Ee.ko)[c]??Ee.ko[c]??c;return e.forEach((s,i)=>{n=n.replace(`{${i}}`,s)}),n}class mt{constructor(){this.particles=[],this.floatingTexts=[],this.screenShake=0,this.screenFlash=null,this.comboGlow=0,this.bossEntrance=0,this.pulseTime=0,this.levelUpPopup=null,this.achievementBanner=null,this._achievementQueue=[]}setCosmetics(e){this._cosmetics=e}getCorrectFlashColor(){if(!this._cosmetics)return"#22c55e";const e=this._cosmetics.correctFlash||"default",t=ke.correctFlash.items.find(n=>n.id===e);return(t==null?void 0:t.color)||"#22c55e"}hasActiveEffects(){return this.particles.length>0||this.floatingTexts.length>0||this.screenShake>0||this.screenFlash!==null||this.bossEntrance>0||this.levelUpPopup!==null||this.achievementBanner!==null}update(){const e=Date.now();if(this.pulseTime=e,!this.hasActiveEffects())return;let t=0;for(let n=0;n<this.particles.length;n++){const s=this.particles[n];s.x+=s.vx,s.y+=s.vy,s.vy+=s.gravity||0,s.life-=16,s.alpha=Math.max(0,s.life/s.maxLife),s.life>0&&(this.particles[t++]=s)}this.particles.length=t,t=0;for(let n=0;n<this.floatingTexts.length;n++){const s=this.floatingTexts[n];s.y-=s.speed,s.life-=16,s.alpha=Math.max(0,s.life/s.maxLife),s.scale=1+(1-s.alpha)*.3,s.life>0&&(this.floatingTexts[t++]=s)}if(this.floatingTexts.length=t,this.screenShake>0&&(this.screenShake*=.85,this.screenShake<.5&&(this.screenShake=0)),this.screenFlash&&(this.screenFlash.alpha-=.05,this.screenFlash.alpha<=0&&(this.screenFlash=null)),this.comboGlow>0&&(this.comboGlow*=.95),this.bossEntrance>0&&(this.bossEntrance-=.02),this.achievementBanner){this.achievementBanner.elapsed+=16;const{elapsed:n}=this.achievementBanner;if(n<2e3)this.achievementBanner.alpha=1;else if(n<2500)this.achievementBanner.alpha=1-(n-2e3)/500;else if(this.achievementBanner=null,this._achievementQueue.length>0){const s=this._achievementQueue.shift();this.achievementBanner=s,this.addParticleExplosion(200,40,"#fbbf24",15)}}if(this.levelUpPopup){this.levelUpPopup.elapsed+=16;const{elapsed:n}=this.levelUpPopup;n<2500?this.levelUpPopup.alpha=1:n<3e3?this.levelUpPopup.alpha=1-(n-2500)/500:this.levelUpPopup=null}}render(){const e=o.ctx;if(this.particles.length>0){e.save();const t=Math.PI*2;for(const n of this.particles)e.globalAlpha=n.alpha,e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,n.size,0,t),e.fill();e.restore()}if(this.floatingTexts.length>0){e.save(),e.textAlign="center",e.textBaseline="middle";for(const t of this.floatingTexts)e.globalAlpha=t.alpha,e.font=`bold ${Math.round(t.fontSize*t.scale)}px system-ui`,e.fillStyle=t.color,t.glow?(e.shadowColor=t.color,e.shadowBlur=12):(e.shadowColor="transparent",e.shadowBlur=0),e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=3,e.strokeText(t.text,t.x,t.y),e.fillText(t.text,t.x,t.y);e.shadowColor="transparent",e.shadowBlur=0,e.restore()}if(this.screenFlash&&(e.save(),e.globalAlpha=this.screenFlash.alpha,e.fillStyle=this.screenFlash.color,e.fillRect(0,0,P.CANVAS_WIDTH,P.CANVAS_HEIGHT),e.restore()),this.renderAchievementBanner(),this.levelUpPopup){const t=P.CANVAS_WIDTH,n=P.CANVAS_HEIGHT,s=this.levelUpPopup.alpha;e.save(),e.globalAlpha=s*.4,e.fillStyle="#000",e.fillRect(0,0,t,n);const i=280,a=180,r=t/2,d=n/2;e.globalAlpha=s;const h=e.createLinearGradient(r-i/2,d-a/2,r+i/2,d+a/2);h.addColorStop(0,"#1a1040"),h.addColorStop(1,"#2d1b69");const m=16,p=r-i/2,_=d-a/2;e.beginPath(),e.moveTo(p+m,_),e.lineTo(p+i-m,_),e.arcTo(p+i,_,p+i,_+m,m),e.lineTo(p+i,_+a-m),e.arcTo(p+i,_+a,p+i-m,_+a,m),e.lineTo(p+m,_+a),e.arcTo(p,_+a,p,_+a-m,m),e.lineTo(p,_+m),e.arcTo(p,_,p+m,_,m),e.closePath(),e.fillStyle=h,e.fill(),e.strokeStyle="#fbbf24",e.lineWidth=2,e.stroke(),e.textAlign="center",e.textBaseline="middle",e.font="bold 32px system-ui",e.strokeStyle="#000",e.lineWidth=4,e.strokeText("LEVEL UP!",r,d-45),e.fillStyle="#fbbf24",e.fillText("LEVEL UP!",r,d-45),e.font="bold 26px system-ui",e.fillStyle="#c084fc",e.strokeText(`LV.${this.levelUpPopup.level}`,r,d-5),e.fillText(`LV.${this.levelUpPopup.level}`,r,d-5),e.font="bold 16px system-ui",e.fillStyle="#e2e8f0",e.lineWidth=2,this.levelUpPopup.bonusMsg.split(`
`).forEach((v,C)=>{e.strokeText(v,r,d+30+C*22),e.fillText(v,r,d+30+C*22)}),e.restore()}}addDamageText(e,t,n,s=!1){let i=s?"#ef4444":"#fbbf24",a=s?60:50,r=!0;if(!s&&this._cosmetics){const d=this._cosmetics.damageTextStyle||"default";d==="neon"?i="#00ffff":d==="pixel"&&(a=Math.round(a*1.4))}this.floatingTexts.push({x:e,y:t,text:`-${n}`,color:i,fontSize:a,speed:.6,life:2e3,maxLife:2e3,alpha:1,scale:1,glow:r})}addGoldText(e,t,n){this.floatingTexts.push({x:e,y:t,text:`+${n}G`,color:"#fbbf24",fontSize:18,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}addComboText(e){this.floatingTexts.push({x:200,y:400,text:`${e} COMBO!`,color:e>=10?"#ff6b6b":e>=5?"#fbbf24":"#22c55e",fontSize:e>=10?36:e>=5?30:24,speed:1,life:600,maxLife:600,alpha:1,scale:1}),this.comboGlow=1}addParticleExplosion(e,t,n,s=12,i=!1){let a=null;if(i&&this._cosmetics){const r=this._cosmetics.particleStyle||"default";if(r!=="default"){const d=ke.particle.items.find(h=>h.id===r);d!=null&&d.colors&&(a=d.colors)}}for(let r=0;r<s;r++){const d=Math.PI*2/s*r+Math.random()*.5,h=2+Math.random()*3,m=a?a[Math.floor(Math.random()*a.length)]:n;this.particles.push({x:e,y:t,vx:Math.cos(d)*h,vy:Math.sin(d)*h,gravity:.1,size:3+Math.random()*4,color:m,life:500+Math.random()*300,maxLife:800,alpha:1})}}shakeScreen(e=10){this.screenShake=e}flashScreen(e,t=.3){this.screenFlash={color:e,alpha:t}}startBossEntrance(){this.bossEntrance=1,this.flashScreen("#ff0000",.4),this.shakeScreen(15)}showLevelUp(e,t){this.levelUpPopup={level:e,bonusMsg:t,alpha:1,elapsed:0},this.addParticleExplosion(P.CANVAS_WIDTH/2,P.CANVAS_HEIGHT/2,"#fbbf24",20),this.flashScreen("#fbbf24",.2)}isLevelUpActive(){return this.levelUpPopup!==null}dismissLevelUp(){this.levelUpPopup=null}showAchievementUnlock(e){const t={icon:e.icon,name:e.nameKey,reward:e.reward,alpha:1,elapsed:0};this.achievementBanner?this._achievementQueue.push(t):(this.achievementBanner=t,this.addParticleExplosion(200,40,"#fbbf24",15))}renderAchievementBanner(){if(!this.achievementBanner)return;const e=o.ctx,t=this.achievementBanner.alpha,n=P.CANVAS_WIDTH;e.save(),e.globalAlpha=t;const s=50,i=Math.min(0,-50+this.achievementBanner.elapsed*.2);e.fillStyle="rgba(99,102,241,0.95)",e.fillRect(0,i,n,s),e.textAlign="center",e.textBaseline="middle",e.font="20px system-ui",e.fillStyle="#fff",e.fillText(this.achievementBanner.icon,30,i+s/2),e.font="bold 14px system-ui",e.fillStyle="#fbbf24",e.textAlign="left",e.fillText(`ğŸ† ${l(this.achievementBanner.name)}`,55,i+18),e.font="12px system-ui",e.fillStyle="#e2e8f0",e.fillText(`+${this.achievementBanner.reward}G`,55,i+36),e.restore()}}class gt{constructor(e,t){this.db=e,this.game=t,this.player=null}async loadPlayer(){let e=await this.db.get("player","main");e||(e=this.createNewPlayer(),await this.db.put("player",e)),this.player=e;let t=!1;this.player.cosmetics||(this.player.cosmetics={purchasedThemes:["default"],particleStyle:"default",purchasedParticles:["default"],damageTextStyle:"default",purchasedDamageText:["default"],correctFlash:"default",purchasedFlash:["default"]},t=!0),this.player.maxHp=this.getTotalMaxHp(),this.player.currentHp=this.player.maxHp,await this.db.put("player",this.player),t&&H.isLoggedIn()&&H.putPlayer(this.player).catch(n=>{})}createNewPlayer(){return{id:"main",level:1,exp:0,gold:100,maxHp:P.DEFAULT_HP,currentHp:P.DEFAULT_HP,permanentUpgrades:{hp:0,time:0,goldBonus:0,damage:0},inventory:{reviveTicket:0,hintTicket:0,timeBoost:0,doubleGold:0},stats:{totalRuns:0,totalKills:0,bestCombo:0,totalClears:0},cosmetics:{purchasedThemes:["default"],particleStyle:"default",purchasedParticles:["default"],damageTextStyle:"default",purchasedDamageText:["default"],correctFlash:"default",purchasedFlash:["default"]},achievements:{},dailyMissions:{},totalGoldEarned:0,totalCorrectAnswers:0,subjectCounts:{},createdAt:Date.now()}}getExpForLevel(e){return B.expPerLevel(e)}getLevelProgress(){const e=this.player.exp,t=this.getExpForLevel(this.player.level);return Math.min(e/t,1)}getLevelBonusHp(){let e=(this.player.level-1)*B.hpPerLevel;return this.player.level>=B.maxLevel&&(e+=10),e}getLevelBonusDamage(){let e=Math.floor(this.player.level/B.damageLevelInterval)*B.damagePerLevels;return this.player.level>=B.maxLevel&&(e+=10),e}getLevelBonusTime(){let e=Math.floor(this.player.level/B.timeLevelInterval)*B.timePerLevels;return this.player.level>=B.maxLevel&&(e+=15),e}getTotalMaxHp(){var i,a;const e=P.DEFAULT_HP,t=this.getLevelBonusHp(),n=(((i=this.player.permanentUpgrades)==null?void 0:i.hp)||0)*((a=X.hp)==null?void 0:a.value),s=this.player.achievementBonusHp||0;return e+t+n+s}getTotalDamage(){var i,a;const e=P.DEFAULT_DAMAGE,t=this.getLevelBonusDamage(),n=(((i=this.player.permanentUpgrades)==null?void 0:i.damage)||0)*((a=X.damage)==null?void 0:a.value),s=this.player.achievementBonusDamage||0;return e+t+n+s}getTotalTime(e){var a,r;const t=e||2;let n;t<=1?n=60:t>=3?n=160:n=100;const s=this.getLevelBonusTime(),i=(((a=this.player.permanentUpgrades)==null?void 0:a.time)||0)*((r=X.time)==null?void 0:r.value);return n+s+i}async gainExp(e){var t,n;if(!(this.player.level>=B.maxLevel)){for(this.player.exp+=e;this.player.exp>=this.getExpForLevel(this.player.level)&&this.player.level<B.maxLevel;){this.player.exp-=this.getExpForLevel(this.player.level),this.player.level++;const s=this.player.maxHp;this.player.maxHp=this.getTotalMaxHp(),this.player.currentHp=Math.min(this.player.currentHp+(this.player.maxHp-s),this.player.maxHp),D.playLevelUp();let i=this.getLevelUpBonusMessage()||`HP +${B.hpPerLevel}`;this.player.level===B.maxLevel&&(i=l("maxLevelBonus")||"ğŸ† MAX! ATK+10, HP+10, TIME+15"),(t=this.game)!=null&&t.effects&&this.game.effects.showLevelUp(this.player.level,i),(n=this.game)!=null&&n.achievementManager&&this.game.achievementManager.onLevelUp(this.player.level)}await this.save()}}getLevelUpBonusMessage(){const e=this.player.level,t=[`HP +${B.hpPerLevel}`];return e%B.damageLevelInterval===0&&t.push(l("attackBonus",B.damagePerLevels)),e%B.timeLevelInterval===0&&t.push(l("timeBonus",B.timePerLevels)),t.join(`
`)}resetHp(){this.player.maxHp=this.getTotalMaxHp(),this.player.currentHp=this.player.maxHp}async save(){await this.db.put("player",this.player),H.isLoggedIn()&&(this._saveTimer&&clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>{H.putPlayer(this.player).catch(e=>{})},1e3))}}class pt{constructor(e){this.db=e,this.monsters=[],this._difficultyIndex={easy:[],medium:[],hard:[]}}_buildDifficultyIndex(){this._difficultyIndex={easy:[],medium:[],hard:[]};for(const e of this.monsters){const t=e.difficulty||2;t<=1?this._difficultyIndex.easy.push(e):t>=3?this._difficultyIndex.hard.push(e):this._difficultyIndex.medium.push(e)}}async loadMonsters(){this.monsters=await this.db.getByIndex("monsters","status","alive"),this._buildDifficultyIndex()}async loadMonstersBySubject(e){const t=await this.db.getByIndex("monsters","status","alive");e==="math"?this.monsters=t.filter(n=>!n.subject||n.subject==="math"):this.monsters=t.filter(n=>n.subject===e),this._buildDifficultyIndex()}getBossType(e){return Te.FINAL_BOSS.stages.includes(e)?"FINAL_BOSS":Te.MID_BOSS.stages.includes(e)?"MID_BOSS":Te.NORMAL_BOSS.stages.includes(e)?"NORMAL_BOSS":null}selectMonsterByDifficulty(e,t){if(t<5){const r=this.monsters.filter(h=>(h.difficulty||2)<=2),d=r.length>0?r:this.monsters;return d[Math.floor(Math.random()*d.length)]}const{easy:n,medium:s,hard:i}=this._difficultyIndex;let a;if(e>=.8){if(a=i.length>0?i:s,Math.random()<.7&&a.length>0)return a[Math.floor(Math.random()*a.length)]}else if(e<.5&&(a=n.length>0?n:s,Math.random()<.7&&a.length>0))return a[Math.floor(Math.random()*a.length)];return this.monsters[Math.floor(Math.random()*this.monsters.length)]}prepareMonster(e,t,n){const s={...e};if(e.questions&&e.questions.length>0&&(s.questions=[...e.questions]),s.currentQuestionIndex=-1,s.questions&&s.questions.length>0){const a=Math.floor(Math.random()*s.questions.length),r=s.questions[a];s.question=r.question,s.answer=r.answer,s.choices=r.choices||[],s.correctIndex=r.correctIndex||0,s.explanation=r.explanation||""}const i=this.getBossType(t);if(s.bossType=i,i){const a=Te[i],r=l(a.nameKey),d=s.topic||"";s.name=d?`${a.icon} ${d} ${r}`:`${a.icon} ${r}`,s.hp=Math.round(s.maxHp*a.hpMultiplier),s.maxHp=s.hp,s.goldMultiplier=a.goldMultiplier,s.damageMultiplier=a.damageMultiplier,s.icon=a.icon,this._ensureBossDifficulty(s),D.playBossAppear(),n.startBossEntrance()}else this._assignMonsterAppearance(s,t);return this._prepareChoices(s),s}_assignMonsterAppearance(e,t){const n=[{icon:"ğŸ‘¾",nameKeys:{math:"mon.slime",english:"mon.blob",korean:"mon.muryeong",science:"mon.jelly"}},{icon:"ğŸ’€",nameKeys:{math:"mon.skeleton",english:"mon.skelleton",korean:"mon.baekgol",science:"mon.boneguard"}},{icon:"ğŸ¦‡",nameKeys:{math:"mon.bat",english:"mon.batwing",korean:"mon.yacha",science:"mon.flying"}},{icon:"ğŸ§Ÿ",nameKeys:{math:"mon.zombie",english:"mon.undead",korean:"mon.gangsi",science:"mon.mutant"}},{icon:"ğŸ‘»",nameKeys:{math:"mon.ghost",english:"mon.ghosty",korean:"mon.wongui",science:"mon.specter"}},{icon:"ğŸ•·ï¸",nameKeys:{math:"mon.spider",english:"mon.spidery",korean:"mon.dokchung",science:"mon.arachne"}}],s=e.difficulty||2,a=((s<=1?0:s>=3?4:2)+t)%n.length,r=n[a],d=e.subject||"math",h=r.nameKeys[d]||r.nameKeys.math,m=l(h),p=e.topic||"";if(p)e.name=`${p} ${m}`;else{const _=this._extractNamePrefix(e);e.name=_?`${_} ${m}`:m}e.goldMultiplier=1,e.damageMultiplier=1,e.icon=r.icon}_extractNamePrefix(e){if(e.keywords&&e.keywords.length>0)return e.keywords[0];const t=e.question||"";if(!t)return"";const n=t.match(/[ã€Œã€ã€\[](.{2,8})[ã€ã€ã€‘\]]/);if(n)return n[1];const s=t.match(/['"'"](.{2,8})['"'"]/);return s?s[1]:""}_prepareChoices(e){let t=e.answer;if(!t&&e.choices&&e.choices.length>0){const s=e.correctIndex||0;t=e.choices[s]}t||(t="?");const n=String(t).trim();if(/^-?\d+\.?\d*$/.test(n)&&!/[<>â‰¤â‰¥]/.test(n)){const s=e.question||"",i=(e.topic||"").toLowerCase();if(/ë¶€ë“±ì‹|inequality/i.test(i)||/[<>â‰¤â‰¥]/.test(s)&&/[a-zA-Zx]/.test(s)){const r=s.match(/[â‰¤â‰¥]|[<>]=?/g);r&&r.length>0&&(t=`x ${r[r.length-1]} ${n}`,e.choices=[])}}if(e.answer=t,!e.choices||e.choices.length===0){const s=this.generateWrongAnswers(t);e.choices=[t,...s]}else e.choices.includes(t)||(e.choices[0]=t);e.choices=this.shuffleArray([...e.choices]),e.correctIndex=e.choices.indexOf(t),e.correctIndex===-1&&(e.choices[0]=t,e.choices=this.shuffleArray([...e.choices]),e.correctIndex=e.choices.indexOf(t))}generateWrongAnswers(e){const t=e.match(/^(.*?)\s*([<>â‰¤â‰¥]=?|[â‰¤â‰¥])\s*(.+)$/);if(t)return this._generateInequalityWrongAnswers(e,t);const n=String(e).trim(),s=n.match(/^(-?\d+\.?\d*)\s*(.+)$/);if(s&&!/^[a-zA-Zê°€-í£]/.test(n)){const a=parseFloat(s[1]),r=s[2];return this._generateNumericWrongAnswers(a).map(d=>`${d} ${r}`)}const i=parseFloat(n);return!isNaN(i)&&String(i)===n?this._generateNumericWrongAnswers(i).map(String):this._generateTextWrongAnswers(n)}_generateNumericWrongAnswers(e){const t=[e+Math.floor(Math.random()*5)+1,e-Math.floor(Math.random()*5)-1,e*2,e+10,e-10,Math.abs(e)*-1,e+.5,e-.5],n=[...new Set(t.filter(s=>s!==e))];return this.shuffleArray(n),n.slice(0,3)}_generateTextWrongAnswers(e){const t=[["ë¯¸í† ì½˜ë“œë¦¬ì•„","ë¦¬ë³´ì†œ","ì†Œí¬ì²´","ê³¨ì§€ì²´","ì—½ë¡ì²´","í•µ","ì„¸í¬ë§‰","ë¦¬ì†Œì¢€","ì¤‘ì‹¬ì²´","ì•¡í¬"],["DNA","RNA","mRNA","ë‹¨ë°±ì§ˆ","ì•„ë¯¸ë…¸ì‚°","ë‰´í´ë ˆì˜¤íƒ€ì´ë“œ","ì—¼ìƒ‰ì²´","ìœ ì „ì"],["ê°€ì†ë„","ì†ë ¥","ë³€ìœ„","ê´€ì„±","í˜","ì§ˆëŸ‰","ìš´ë™ëŸ‰","ì¤‘ë ¥"],["ì–‘ì„±ì","ì¤‘ì„±ì","ì „ì","ì¿¼í¬","ë‰´íŠ¸ë¦¬ë…¸","ê´‘ì","ì›ìí•µ"],["ì‚°ì†Œ","ìˆ˜ì†Œ","ì§ˆì†Œ","íƒ„ì†Œ","í—¬ë¥¨","ë„¤ì˜¨","ì² ","êµ¬ë¦¬","ê¸ˆ"],["ê´‘í•©ì„±","í˜¸í¡","ë°œíš¨","ì¦ì‚°ì‘ìš©","ì‚¼íˆ¬","í™•ì‚°","ëŠ¥ë™ìˆ˜ì†¡"],["ì§€ì§„","í™”ì‚°","íŒêµ¬ì¡°ë¡ ","ëŒ€ë¥˜","í’í™”","ì¹¨ì‹","í‡´ì ","ë‹¨ì¸µ"],["ì „ì••","ì „ë¥˜","ì €í•­","ì „ë ¥","ìê¸°ì¥","ì „ê¸°ì¥","ìœ ë„ì „ë¥˜"],["ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™","ì—ë„ˆì§€ ë³´ì¡´ ë²•ì¹™","ì¼ì • ì„±ë¶„ë¹„ ë²•ì¹™","ë°°ìˆ˜ ë¹„ë¡€ ë²•ì¹™","ê¸°ì²´ ë°˜ì‘ ë²•ì¹™"],["ë“±ì† ìš´ë™","ë“±ê°€ì†ë„ ìš´ë™","í¬ë¬¼ì„  ìš´ë™","ì›ìš´ë™","ë‹¨ì§„ë™","ììœ ë‚™í•˜"],["ê³µìœ  ê²°í•©","ì´ì˜¨ ê²°í•©","ê¸ˆì† ê²°í•©","ìˆ˜ì†Œ ê²°í•©","ë°˜ë°ë¥´ë°œìŠ¤ í˜"],["ê°ìˆ˜ë¶„ì—´","ì²´ì„¸í¬ë¶„ì—´","ìˆ˜ì •","ë°œìƒ","ë¶„í™”","ìƒì¥"]],n=e.toLowerCase();for(const h of t){const m=h.findIndex(p=>p.toLowerCase()===n||p===e);if(m!==-1){const p=h.filter((_,A)=>A!==m);return this.shuffleArray(p),p.slice(0,3)}}const s=t.flat(),i=e.length,a=s.filter(h=>h!==e&&Math.abs(h.length-i)<=2).sort(()=>Math.random()-.5);if(a.length>=3)return a.slice(0,3);const d=["ì›ì","ë¶„ì","ì—ë„ˆì§€","íŒŒë™","ì „ì","ì„¸í¬","ìœ ì „ì","ì¤‘ë ¥","ë§ˆì°°ë ¥","ì••ë ¥"].filter(h=>h!==e);return this.shuffleArray(d),d.slice(0,3)}_generateInequalityWrongAnswers(e,t){const[,n,s,i]=t;return({">":["<","â‰¥","â‰¤"],"<":[">","â‰¤","â‰¥"],">=":["<=",">","<"],"<=":[">=","<",">"],"â‰¥":["â‰¤",">","<"],"â‰¤":["â‰¥","<",">"]}[s]||["<",">","â‰¤"]).map(d=>`${n} ${d} ${i}`).slice(0,3)}shuffleArray(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}_toQuestionObj(e,t){return{question:e.question,answer:e.answer,choices:e.choices||[],correctIndex:e.correctIndex||0,explanation:e.explanation||"",...t}}_pushGeneratedProblem(e,t,n,s){if(e.length>=n||!t.question||!t.answer)return;let i=t.choices||[],a=t.correctIndex||0;i.length>0&&!i.includes(t.answer)&&(i[0]=t.answer,a=0),e.push({question:t.question,answer:t.answer,choices:i,correctIndex:a,explanation:t.explanation||"",...s!=null?{difficulty:t.difficulty||s}:{}})}_ensureBossDifficulty(e){if((e.difficulty||1)>=2)return;if(e.questions&&e.questions.length>0){const n=e.questions.filter(s=>(s.difficulty||1)>=2);if(n.length>0){const s=n[Math.floor(Math.random()*n.length)];e.question=s.question,e.answer=s.answer,e.choices=s.choices||[],e.correctIndex=s.correctIndex||0,e.explanation=s.explanation||"",e.difficulty=s.difficulty;return}}const t=this.monsters.filter(n=>(n.difficulty||1)>=2&&n.id!==e.id);if(t.length>0){const n=t[Math.floor(Math.random()*t.length)];e.question=n.question,e.answer=n.answer,e.choices=n.choices||[],e.correctIndex=n.correctIndex||0,e.explanation=n.explanation||"",e.difficulty=n.difficulty;return}e.isGeneratingBoss||(e.isGeneratingBoss=!0,this._generateBossQuestion(e))}async _generateBossQuestion(e){try{let t=null;if(U.hasApiKey()){const n=e.topic||"linear";t=await U.generateProblems(n,3,3)}else if(q.hasApiKey()){const n=await q.generateSimilarProblems(e.question||l("defaultProblem"),e.answer||"",l("defaultTopic"),3);t=n==null?void 0:n.problems}if(t&&t.length>0){e.questions||(e.questions=[this._toQuestionObj(e,{difficulty:e.difficulty||1})]);for(const s of t)this._pushGeneratedProblem(e.questions,s,10,3);const n=t[0];e.question=n.question,e.answer=n.answer,e.choices=n.choices||[],e.correctIndex=n.correctIndex||0,e.explanation=n.explanation||"",e.difficulty=n.difficulty||3,this._prepareChoices(e)}}catch{}finally{e.isGeneratingBoss=!1}}fillQuestionsFromOtherMonsters(e){if(!e||!this.monsters||this.monsters.length<=1)return;e.questions||(e.questions=[]);const t=e.id,n=this.monsters.filter(s=>s.id!==t);this.shuffleArray(n);for(const s of n){if(e.questions.length>=5)break;if(s.questions&&s.questions.length>0)for(const i of s.questions){if(e.questions.length>=5)break;e.questions.some(a=>a.question===i.question)||e.questions.push({...i})}else s.question&&(e.questions.some(i=>i.question===s.question)||e.questions.push(this._toQuestionObj(s)))}}async autoGenerateQuestions(e){e.questions||(e.questions=[]);try{let t=null;if(U.hasApiKey()){const n={question:e.question||"",answer:e.answer||"",topic:e.topic||l("defaultTopic"),difficulty:e.difficulty||2};t=await U.generateSimilar(n)}else if(q.hasApiKey()){const n=await q.generateSimilarProblems(e.question||l("defaultProblem"),e.answer||"",l("defaultTopic"),3);t=n==null?void 0:n.problems}if(t&&t.length>0){for(const s of t)this._pushGeneratedProblem(e.questions,s,10);const n=this.monsters.find(s=>s.id===e.id);n&&(n.questions=e.questions,await this.db.put("monsters",n))}else this._fillFromAllMonsters(e,10)}catch{try{this._fillFromAllMonsters(e,10)}catch{}(!e.questions||e.questions.length===0)&&(e.questions=[{question:e.question||"?",answer:e.answer||"?",choices:e.choices||[],correctIndex:e.correctIndex||0,explanation:e.explanation||""}])}finally{e.isGenerating=!1}}_fillFromAllMonsters(e,t){e.questions||(e.questions=[]);const n=e.id,s=this.monsters.filter(i=>i.id!==n);this.shuffleArray(s);for(const i of s){if(e.questions.length>=t)break;const a=this._toQuestionObj(i);if(e.questions.some(r=>r.question===a.question)||e.questions.push(a),i.questions)for(const r of i.questions){if(e.questions.length>=t)break;e.questions.some(d=>d.question===r.question)||e.questions.push({...r})}}}async generateSimilarWithProblemGenerator(e,t){try{const n={question:e.question||"",answer:e.answer||"",topic:e.topic||l("defaultTopic"),difficulty:e.difficulty||2},s=await U.generateSimilar(n);if(s&&s.length>0){const i=this.monsters.find(a=>a.id===e.id);if(i){i.questions||(i.questions=[this._toQuestionObj(i)]);for(const a of s)this._pushGeneratedProblem(i.questions,a,10);await this.db.put("monsters",i),t&&t.id===i.id&&(t.questions=[...i.questions])}}}catch{q.hasApiKey()&&this.generateSimilarMonsters(e,t)}}async generateSimilarMonsters(e,t){var n,s;try{const i=((s=Y[(n=e.subject)==null?void 0:n.toUpperCase()])==null?void 0:s.nameKey)||"math",a=l(i),r=await q.generateSimilarProblems(e.question||l("defaultProblem"),e.answer||"",a,2);if(r&&r.problems){const d=this.monsters.find(h=>h.id===e.id);if(d){d.questions||(d.questions=[this._toQuestionObj(d)]);for(const h of r.problems)this._pushGeneratedProblem(d.questions,h,10);await this.db.put("monsters",d),t&&t.id===d.id&&(t.questions=[...d.questions])}}}catch{}}async onMonsterDefeated(e){const t=this.monsters.find(n=>n.id===e);t&&(t.status="cleared",await this.db.put("monsters",t),this.monsters=this.monsters.filter(n=>n.id!==t.id),this._buildDifficultyIndex(),H.isLoggedIn()&&t.serverId&&H.putMonster(t.serverId,{status:"cleared",defeated_at:new Date().toISOString()}).catch(n=>{}))}}class _e{constructor(e){this.game=e,this._cachedStats=null,this._cacheKey=null}invalidateCache(){this._cachedStats=null,this._cacheKey=null}static inferTopic(e){if(e.topic)return e.topic;const t=(e.question||"").toLowerCase(),n=e.subject||"math";return n==="math"?t.includes("ë¶€ë“±ì‹")||/[<>â‰¤â‰¥]\s*\d/.test(t)?"ë¶€ë“±ì‹":t.includes("ì¸ìˆ˜ë¶„í•´")||t.includes("factor")?"ì¸ìˆ˜ë¶„í•´":t.includes("ì´ì°¨")||t.includes("xÂ²")||t.includes("x^2")?"ì´ì°¨ë°©ì •ì‹":t.includes("í•¨ìˆ˜")||t.includes("f(x)")||t.includes("f(")?"í•¨ìˆ˜":t.includes("ìˆ˜ì—´")||t.includes("ë“±ì°¨")||t.includes("ë“±ë¹„")?"ìˆ˜ì—´":t.includes("í™•ë¥ ")||t.includes("ê²½ìš°ì˜ ìˆ˜")?"í™•ë¥ ":t.includes("ë„“ì´")||t.includes("ì‚¼ê°í˜•")||t.includes("ì‚¬ê°í˜•")||t.includes("ì›ì˜")||t.includes("ë„í˜•")||t.includes("ë‘˜ë ˆ")||t.includes("ë¶€í”¼")?"ë„í˜•":t.includes("í¼ì„¼íŠ¸")||t.includes("%")||t.includes("ë¹„ìœ¨")||t.includes("ë¹„ë¡€")?"ë¹„ìœ¨/í¼ì„¼íŠ¸":t.includes("ë¶„ìˆ˜")||/\d+\/\d+\s*[+\-Ã—Ã·]/.test(t)?"ë¶„ìˆ˜ ê³„ì‚°":(t.includes("ë°©ì •ì‹")||/\d+\s*x\s*[+\-=]/.test(t)||/x\s*[+\-]\s*\d+\s*=/.test(t),"ì¼ì°¨ë°©ì •ì‹"):n==="science"?t.includes("ìœ ì „")||t.includes("dna")||t.includes("ë©˜ë¸")||t.includes("í˜•ì§ˆ")?"ìœ ì „":t.includes("ì„¸í¬")||t.includes("ë¶„ì—´")||t.includes("ì‚¼íˆ¬")?"ì„¸í¬":t.includes("ì „ê¸°")||t.includes("ìê¸°")||t.includes("ì „ìê¸°")||t.includes("ì „ë¥˜")||t.includes("ì „ì••")?"ì „ìê¸°":t.includes("ëª°")||t.includes("ë†ë„")||t.includes("í™”í•™ì–‘ë¡ ")?"ëª°ê³¼ ë°˜ì‘ì‹":t.includes("í™”í•™")||t.includes("ë°˜ì‘ì‹")||t.includes("ì§ˆëŸ‰ë³´ì¡´")?"í™”í•™ë°˜ì‘":t.includes("í˜")||t.includes("ìš´ë™")||t.includes("ê°€ì†")||t.includes("ì†ë„")||t.includes("f=ma")?"í˜ê³¼ ìš´ë™":t.includes("ì—­í•™")||t.includes("ì—ë„ˆì§€")||t.includes("ìš´ë™ëŸ‰")||t.includes("ì¼ê³¼")?"ì—­í•™":t.includes("ì§€êµ¬")||t.includes("ì§€ì¸µ")||t.includes("íŒ")||t.includes("ê¸°ìƒ")||t.includes("í™”ì„")?"ì§€êµ¬ê³¼í•™":"í˜ê³¼ ìš´ë™":null}async aggregateStats(){var b,x,g,S,M;const e=this.game.db,t=await e.getAll("runs")||[],n=await e.getAll("monsters")||[],s=t.length>0&&t[t.length-1].startTime||0,i=`${t.length}_${n.length}_${s}`;if(this._cacheKey===i&&this._cachedStats)return this.game.cachedStats=this._cachedStats,this._cachedStats;const a={totalRuns:t.length,totalClears:0,totalFails:0,totalAnswers:0,totalCorrect:0,bestCombo:0,totalGoldEarned:0,bySubject:{},byDifficulty:{1:0,2:0,3:0},totalSkips:0,totalHints:0,totalTimeBoosts:0,totalRevives:0,totalTimeouts:0,avgSkipsPerRun:0,avgHintsPerRun:0,wrongBySubject:{},correctBySubject:{},wrongByTopic:{},correctByTopic:{},wrongByDifficulty:{},subjectTopics:{},winRate:0,totalPlayTime:0,avgRunDuration:0,longestRun:0,shortestClear:0,currentStreak:0,bestStreak:0,recentRuns:[],recentWinRate:0,recentAccuracy:0,subjectAccuracy:{},difficultyAccuracy:{1:{attempts:0,correct:0},2:{attempts:0,correct:0},3:{attempts:0,correct:0}},avgAccuracy:0,avgGoldPerRun:0,totalDefeated:0};let r=t,d=!0;for(let y=1;y<t.length;y++)if((t[y].startTime||0)<(t[y-1].startTime||0)){d=!1;break}d||(r=[...t].sort((y,T)=>(y.startTime||0)-(T.startTime||0)));let h=0,m=0;for(const y of r){if(y.result==="clear"?(a.totalClears++,h++,h>m&&(m=h)):y.result==="failed"&&(a.totalFails++,h=0),a.totalAnswers+=y.totalAnswers||0,a.totalCorrect+=y.correctAnswers||0,(y.bestCombo||0)>a.bestCombo&&(a.bestCombo=y.bestCombo),a.totalGoldEarned+=y.earnedGold||0,a.totalSkips+=y.skipCount||0,a.totalHints+=y.hintCount||0,a.totalTimeBoosts+=y.timeBoostCount||0,a.totalRevives+=y.reviveCount||0,a.totalTimeouts+=y.timeoutCount||0,y.correctBySubject)for(const[T,E]of Object.entries(y.correctBySubject))a.correctBySubject[T]=(a.correctBySubject[T]||0)+E;if(y.wrongBySubject)for(const[T,E]of Object.entries(y.wrongBySubject))a.wrongBySubject[T]=(a.wrongBySubject[T]||0)+E;if(y.correctByTopic)for(const[T,E]of Object.entries(y.correctByTopic))a.correctByTopic[T]=(a.correctByTopic[T]||0)+E;if(y.wrongByTopic)for(const[T,E]of Object.entries(y.wrongByTopic))a.wrongByTopic[T]=(a.wrongByTopic[T]||0)+E;if(y.wrongByDifficulty)for(const[T,E]of Object.entries(y.wrongByDifficulty))a.wrongByDifficulty[T]=(a.wrongByDifficulty[T]||0)+E;if(y.startTime&&y.endTime){const T=y.endTime-y.startTime;a.totalPlayTime+=T,T>a.longestRun&&(a.longestRun=T),y.result==="clear"&&(a.shortestClear===0||T<a.shortestClear)&&(a.shortestClear=T)}a.totalDefeated+=((b=y.defeatedMonsters)==null?void 0:b.length)||0}a.currentStreak=h,a.bestStreak=m,a.totalRuns>0&&(a.winRate=Math.round(a.totalClears/a.totalRuns*100),a.avgRunDuration=a.totalPlayTime/a.totalRuns,a.avgGoldPerRun=Math.round(a.totalGoldEarned/a.totalRuns),a.avgSkipsPerRun=Math.round(a.totalSkips/a.totalRuns*10)/10,a.avgHintsPerRun=Math.round(a.totalHints/a.totalRuns*10)/10),a.totalAnswers>0&&(a.avgAccuracy=Math.round(a.totalCorrect/a.totalAnswers*100));const p=r.slice(-10);let _=0,A=0,v=0;a.recentRuns=new Array(p.length);for(let y=0;y<p.length;y++){const T=p[y];T.result==="clear"&&_++,A+=T.totalAnswers||0,v+=T.correctAnswers||0,a.recentRuns[y]={result:T.result,accuracy:T.totalAnswers>0?Math.round(T.correctAnswers/T.totalAnswers*100):0,combo:T.bestCombo||0,gold:T.earnedGold||0,duration:T.startTime&&T.endTime?T.endTime-T.startTime:0,date:T.startTime||0}}p.length>0&&(a.recentWinRate=Math.round(_/p.length*100),a.recentAccuracy=A>0?Math.round(v/A*100):0);const C={};for(const y of n){y.id&&(C[y.id]=y);const T=y.subject||"math";a.bySubject[T]=(a.bySubject[T]||0)+1;const E=y.difficulty||2;a.byDifficulty[E]!==void 0&&a.byDifficulty[E]++,a.subjectAccuracy[T]||(a.subjectAccuracy[T]={attempts:0,correct:0}),a.subjectAccuracy[T].attempts+=((x=y.stats)==null?void 0:x.attempts)||0,a.subjectAccuracy[T].correct+=((g=y.stats)==null?void 0:g.correct)||0,a.difficultyAccuracy[E]&&(a.difficultyAccuracy[E].attempts+=((S=y.stats)==null?void 0:S.attempts)||0,a.difficultyAccuracy[E].correct+=((M=y.stats)==null?void 0:M.correct)||0)}for(const y of r)if(y.defeatedMonsters)for(const T of y.defeatedMonsters){const E=C[T];if(!E)continue;const I=_e.inferTopic(E);if(!I)continue;const N=E.subject||"math";a.subjectTopics[N]||(a.subjectTopics[N]={}),a.subjectTopics[N][I]||(a.subjectTopics[N][I]={attempts:0,correct:0}),a.subjectTopics[N][I].attempts++,a.subjectTopics[N][I].correct++}const w={ì¼ì°¨ë°©ì •ì‹:"math",ì´ì°¨ë°©ì •ì‹:"math",ì¸ìˆ˜ë¶„í•´:"math",í•¨ìˆ˜:"math",ë¶€ë“±ì‹:"math","ë¶„ìˆ˜ ê³„ì‚°":"math","ë¹„ìœ¨/í¼ì„¼íŠ¸":"math",ìˆ˜ì—´:"math",í™•ë¥ :"math",ë„í˜•:"math","í˜ê³¼ ìš´ë™":"science",í™”í•™ë°˜ì‘:"science",ì„¸í¬:"science",ì§€êµ¬ê³¼í•™:"science",ì—­í•™:"science",ì „ìê¸°:"science","ëª°ê³¼ ë°˜ì‘ì‹":"science",ìœ ì „:"science"},f=new Set([...Object.keys(a.correctByTopic),...Object.keys(a.wrongByTopic)]);for(const y of f){const T=w[y];if(!T)continue;const E=a.correctByTopic[y]||0,I=a.wrongByTopic[y]||0,N=E+I;a.subjectTopics[T]||(a.subjectTopics[T]={}),a.subjectTopics[T][y]||(a.subjectTopics[T][y]={attempts:0,correct:0});const G=a.subjectTopics[T][y];G.attempts=Math.max(G.attempts,N),G.correct=Math.max(G.correct,E)}return this.game.cachedStats=a,this._cachedStats=a,this._cacheKey=i,a}}class ft{constructor(e){this.game=e}get player(){return this.game.playerManager.player}get effects(){return this.game.effects}get monsterManager(){return this.game.monsterManager}get itemManager(){return this.game.itemManager}updateBattle(){const e=Date.now();if(this.game.lastTime>0){const t=(e-this.game.lastTime)/1e3,n=this.game.timer;if(this.game.timer-=t,this.game.timer<=10&&this.game.timer>0){const s=Math.ceil(n),i=Math.ceil(this.game.timer);s!==i&&D.playTimerWarning()}this.game.timer<=0&&this.onTimeOut()}this.game.lastTime=e}selectAnswer(e){e===(this.game.currentMonster.correctIndex||0)?this.onCorrectAnswer():this.onWrongAnswer()}async onCorrectAnswer(){var f;const e=this.game,t=e.currentMonster,n=e.currentRun;e.lastTime=-1,n.correctAnswers++,n.totalAnswers++;const s=(t==null?void 0:t.subject)||e.currentSubject||"math";n.correctBySubject||(n.correctBySubject={}),n.correctBySubject[s]=(n.correctBySubject[s]||0)+1;const i=(t==null?void 0:t.topic)||_e.inferTopic(t)||"";i&&(n.correctByTopic||(n.correctByTopic={}),n.correctByTopic[i]=(n.correctByTopic[i]||0)+1),e.combo++,e.combo>n.bestCombo&&(n.bestCombo=e.combo),e.combo>=3?(D.playCombo(e.combo),this.effects.addComboText(e.combo),e.combo>=5&&this.effects.addParticleExplosion(200,350,"#fbbf24",e.combo*2,!0)):D.playCorrectWithVibrate(),this.effects.flashScreen(this.effects.getCorrectFlashColor(),.15);const r=e.playerManager.getTotalDamage()+e.combo*2;t.hp-=r,this.effects.addDamageText(200+(Math.random()-.5)*40,280,r,!1),await e.playerManager.gainExp(B.expPerCorrect);const d=Math.floor(Math.random()*16)+5,m=1+(((f=this.player.permanentUpgrades)==null?void 0:f.goldBonus)||0)*X.goldBonus.value/100,p=t.goldMultiplier||1,_=(n==null?void 0:n.goldMultiplier)||1,A=this.player.level<=10?1.5:1,v=Math.round(d*m*p*_*A),C=Math.min(e.combo,10)*2,w=v+C;if(this.player.gold+=w,n.earnedGold+=w,D.playGold(),e.achievementManager&&(e.achievementManager.onCorrectAnswer(e.combo),e.achievementManager.onGoldEarned(w)),this.effects.addGoldText(350,30,w),t.hp<=0)e.finalBossWrongLastTurn=!1,await this.onMonsterDefeated();else{t.bossType==="FINAL_BOSS"&&e.finalBossWrongLastTurn&&(e.finalBossWrongLastTurn=!1),this.selectNextQuestion();const b=t.difficulty||2;e.timer=e.playerManager.getTotalTime(b),e.lastTime=Date.now(),this.player.currentHp<=0&&await e.endRun(!1)}}selectNextQuestion(){const e=this.game.currentMonster;if(!e)return;e.questions||(e.questions=[{question:e.question,answer:e.answer,choices:e.choices||[],correctIndex:e.correctIndex||0,explanation:e.explanation||""}],e.currentQuestionIndex=0,this.monsterManager.fillQuestionsFromOtherMonsters(e)),e.questions.length<3&&!e.isGenerating&&(e.isGenerating=!0,this.monsterManager.autoGenerateQuestions(e));const n=e.currentQuestionIndex??-1;let s;if(e.questions.length<=1)s=0;else{let a=0;do s=Math.floor(Math.random()*e.questions.length),a++;while(s===n&&a<10);s===n&&(s=(n+1)%e.questions.length)}e.currentQuestionIndex=s,e.questions[s]||(s=0,e.currentQuestionIndex=0);const i=e.questions[s];i&&(Object.assign(e,this.monsterManager._toQuestionObj(i)),this.monsterManager._prepareChoices(e))}reshuffleChoices(){const e=this.game.currentMonster;if(!e||!e.choices)return;const t=e.answer;t&&!e.choices.includes(t)&&(e.choices[0]=t),e.choices=this.monsterManager.shuffleArray([...e.choices]),e.correctIndex=e.choices.indexOf(t)}async onWrongAnswer(){var _;const e=this.game,t=e.currentMonster,n=e.currentRun;e.lastTime=-1,n.totalAnswers++,e.combo=0;const s=(t==null?void 0:t.subject)||e.currentSubject||"math";n.wrongBySubject||(n.wrongBySubject={}),n.wrongBySubject[s]=(n.wrongBySubject[s]||0)+1;const i=(t==null?void 0:t.topic)||_e.inferTopic(t)||"";i&&(n.wrongByTopic||(n.wrongByTopic={}),n.wrongByTopic[i]=(n.wrongByTopic[i]||0)+1);const a=String((t==null?void 0:t.difficulty)||2);n.wrongByDifficulty||(n.wrongByDifficulty={}),n.wrongByDifficulty[a]=(n.wrongByDifficulty[a]||0)+1,t._wrongCounts||(t._wrongCounts={}),t._healCount||(t._healCount=0);const r=t.question||"_default";t._wrongCounts[r]=(t._wrongCounts[r]||0)+1;let d=25;const h=t==null?void 0:t.bossType;h==="NORMAL_BOSS"?d=30:h==="MID_BOSS"?(d=40,t._healCount<5&&(t._healCount++,t.hp=Math.min(t.hp+30,t.maxHp),this.effects.floatingTexts.push({x:200,y:250,text:l("monsterHpRecover"),color:"#ef4444",fontSize:18,speed:1.5,life:1200,maxLife:1200,alpha:1,scale:1}))):h==="FINAL_BOSS"&&(d=60,e.finalBossWrongLastTurn&&(this.player.currentHp-=5,t._healCount<10&&(t._healCount++,t.hp=Math.min(t.hp+15,t.maxHp),this.effects.floatingTexts.push({x:200,y:250,text:l("monsterHpRecover"),color:"#ef4444",fontSize:18,speed:1.5,life:1200,maxLife:1200,alpha:1,scale:1}))),e.finalBossWrongLastTurn=!0),this.player.currentHp-=d,D.playWrongWithVibrate(),this.effects.flashScreen("#ef4444",.25),this.effects.shakeScreen(12),this.effects.addDamageText(100+(Math.random()-.5)*30,35,d,!0),this.player.currentHp<=0&&((_=this.player.inventory)==null?void 0:_.reviveTicket)>0&&(this.player.inventory.reviveTicket--,n&&(n.reviveCount=(n.reviveCount||0)+1),this.player.currentHp=Math.round(this.player.maxHp*.5),await e.playerManager.save(),await this.game.showModal(l("reviveUsed",this.player.inventory.reviveTicket))),this.selectNextQuestion();const m=t.difficulty||2,p=e.playerManager.getTotalTime(m);e.timer=Math.min(e.timer+50,p),e.lastTime=Date.now(),t&&(U.hasApiKey()?this.monsterManager.generateSimilarWithProblemGenerator(t,e.currentMonster):q.hasApiKey()&&this.monsterManager.generateSimilarMonsters(t,e.currentMonster)),this.player.currentHp<=0&&await e.endRun(!1)}async onTimeOut(){var n,s;const e=this.game;e.lastTime=-1,e.combo=0,e.currentRun&&(e.currentRun.timeoutCount=(e.currentRun.timeoutCount||0)+1),this.player.currentHp-=45,this.player.currentHp<=0&&((n=this.player.inventory)==null?void 0:n.reviveTicket)>0&&(this.player.inventory.reviveTicket--,e.currentRun&&(e.currentRun.reviveCount=(e.currentRun.reviveCount||0)+1),this.player.currentHp=Math.round(this.player.maxHp*.5),await e.playerManager.save(),await this.game.showModal(l("reviveUsed",this.player.inventory.reviveTicket))),this.selectNextQuestion();const t=((s=e.currentMonster)==null?void 0:s.difficulty)||2;e.timer=e.playerManager.getTotalTime(t),e.lastTime=Date.now(),this.player.currentHp<=0&&await e.endRun(!1)}async onMonsterDefeated(){const e=this.game,t=e.currentMonster;e.currentRun.defeatedMonsters.push(t.id),D.playMonsterDefeat();const s=t.bossType;s==="FINAL_BOSS"?(this.effects.addParticleExplosion(200,300,"#ff0000",30,!0),this.effects.addParticleExplosion(200,300,"#ffd700",20,!0),this.effects.shakeScreen(20)):s==="MID_BOSS"?(this.effects.addParticleExplosion(200,300,"#9932cc",25,!0),this.effects.shakeScreen(15)):s==="NORMAL_BOSS"?(this.effects.addParticleExplosion(200,300,"#ff6b35",20,!0),this.effects.shakeScreen(10)):this.effects.addParticleExplosion(200,300,"#6366f1",12,!0),this.effects.flashScreen("#ffffff",.3);let i=B.expPerMonsterKill;s==="FINAL_BOSS"?i=B.expPerFinalBoss:s==="MID_BOSS"?i=B.expPerMidBoss:s==="NORMAL_BOSS"&&(i=B.expPerNormalBoss),await e.playerManager.gainExp(i),await this.monsterManager.onMonsterDefeated(t.id),e.achievementManager&&e.achievementManager.onMonsterDefeated(t.bossType),this.itemManager.checkDrop(t,e),e.stage++,e.stage>P.STAGES_PER_DUNGEON?await e.endRun(!0):await e.nextMonster()}async skipQuestion(){var s,i;const e=this.game;e.lastTime=-1,e.combo=0,e.currentRun.skipCount++;const t=Math.min(30,10+(e.currentRun.skipCount-1)*5);if(this.player.currentHp-=t,this.player.currentHp<=0)if(((s=this.player.inventory)==null?void 0:s.reviveTicket)>0)this.player.inventory.reviveTicket--,e.currentRun&&(e.currentRun.reviveCount=(e.currentRun.reviveCount||0)+1),this.player.currentHp=Math.round(this.player.maxHp*.5),await e.playerManager.save(),await this.game.showModal(l("reviveUsed",this.player.inventory.reviveTicket));else{await e.endRun(!1);return}this.selectNextQuestion();const n=((i=e.currentMonster)==null?void 0:i.difficulty)||2;e.timer=e.playerManager.getTotalTime(n),e.lastTime=Date.now()}async useHint(){var s;const e=this.game,t=e.currentMonster;if(!t)return;if(((s=this.player.inventory)==null?void 0:s.hintTicket)>0){this.player.inventory.hintTicket--,e.currentRun&&(e.currentRun.hintCount=(e.currentRun.hintCount||0)+1),await e.playerManager.save(),await this._showHintInfo(t);return}if(this.player.gold<50){await this.game.showModal(l("noHintNoGold"));return}await this.game.showConfirm(l("useGoldForHint",this.player.gold))&&(this.player.gold-=50,e.currentRun&&(e.currentRun.hintCount=(e.currentRun.hintCount||0)+1),await e.playerManager.save(),await this._showHintInfo(t))}async _showHintInfo(e){const t=[];if(e.topic&&t.push(l("topicHint",e.topic)),e.explanation){const a=e.explanation.split(/[.!?ã€‚]/)[0];a&&a.length>5&&t.push(l("explanationHint",a.substring(0,50)))}const n=e.choices||[],s=e.correctIndex||0,i=n.map((a,r)=>r).filter(a=>a!==s);if(i.length>0){const a=i[Math.floor(Math.random()*i.length)];t.push(l("wrongChoiceHint",a+1))}e.keywords&&e.keywords.length>0&&t.push(l("keywordHint",e.keywords.slice(0,2).join(", "))),t.length===0&&(t.push(l("readCarefully")),t.push(l("trySubstitute"))),await this.game.showModal(`${l("hintTitle")}

${t.join(`

`)}`)}async useTimeBoost(){var e;((e=this.player.inventory)==null?void 0:e.timeBoost)>0?(this.player.inventory.timeBoost--,this.game.currentRun&&(this.game.currentRun.timeBoostCount=(this.game.currentRun.timeBoostCount||0)+1),this.game.timer+=60,await this.game.playerManager.save(),D.playClick(),await this.game.showModal(l("timeBoostUsed",this.player.inventory.timeBoost))):await this.game.showModal(l("noTimeBoost"))}showFullQuestion(){const e=this.game.currentMonster;if(!e)return;const t=d=>String(d??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let n="";try{n=e.imageData||ge(e)}catch{n=""}const s=n?`<img src="${n}" style="max-width:100%;border-radius:10px;border:1px solid rgba(99,102,241,0.3);" />`:`<div style="padding:20px;font-size:16px;line-height:1.6;color:#e2e8f0;">${t(e.question||"ë¬¸ì œ ì—†ìŒ")}<br><br><b style="color:#22c55e;">ì •ë‹µ: ${t(e.answer||"?")}</b></div>`,i=document.getElementById("question-modal");i&&i.remove();const a=document.createElement("div");a.id="question-modal",a.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;display:flex;justify-content:center;align-items:center;font-family:system-ui,-apple-system,sans-serif;",a.innerHTML=`<div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:16px;padding:16px;width:360px;max-height:85vh;overflow-y:auto;color:#e2e8f0;border:1px solid #6366f1;">
      <div style="text-align:center;margin-bottom:12px;">
        ${s}
      </div>
      <button id="q-modal-close" style="width:100%;padding:12px;border:none;border-radius:10px;background:#6366f1;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${t(l("close"))}</button>
    </div>`,this.game.lastTime=-1;const r=()=>{a.remove(),this.game.lastTime=Date.now()};document.body.appendChild(a),document.getElementById("q-modal-close").onclick=r,a.onclick=d=>{d.target===a&&r()}}}class _t{constructor(e){this.game=e}get player(){return this.game.playerManager.player}getUpgradePrice(e){var s;const t=X[e];if(!t)return 0;const n=((s=this.player.permanentUpgrades)==null?void 0:s[e])||0;if(t.priceAccelStart){let i=t.basePrice;for(let a=0;a<n;a++){let r=1.1;a>=5&&(r=1.15),a>=t.priceAccelStart&&(r=1.15+(Math.floor((a-t.priceAccelStart)/t.priceAccelInterval)+1)*t.priceAccelStep),i*=r}return Math.ceil(i/10)*10}if(n>=5){const i=t.basePrice*Math.pow(1.1,5);return Math.ceil(i*Math.pow(1.15,n-5)/10)*10}return Math.ceil(t.basePrice*Math.pow(1.1,n)/10)*10}async buyUpgrade(e){const t=X[e];if(!t)return;this.player.permanentUpgrades||(this.player.permanentUpgrades={hp:0,time:0,goldBonus:0,damage:0});const n=this.player.permanentUpgrades[e]||0;if(n>=t.maxLevel)return;const s=this.getUpgradePrice(e);if(this.player.gold<s){this.showInsufficientGold(s);return}this.player.gold-=s,this.player.permanentUpgrades[e]=n+1,e==="hp"&&(this.player.maxHp+=t.value,this.player.currentHp=this.player.maxHp),D.playClick(),await this.game.playerManager.save(),this.game.achievementManager.checkPowerAchievements(),this.game.effects.addParticleExplosion(200,350,"#22c55e",15),this.game.effects.flashScreen("#22c55e",.15),this.game.effects.floatingTexts.push({x:200,y:350,text:`-${s}G`,color:"#fbbf24",fontSize:18,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}async buyItem(e){const t=Ie[e];if(t){if(this.player.gold<t.price){this.showInsufficientGold(t.price);return}if(e==="randomBg"){this.player.gold-=t.price,D.playClick(),await this.game.playerManager.save(),o.setRandomBgTheme(),this.game.effects.flashScreen("#9333ea",.3),this.game.render();return}this.player.inventory||(this.player.inventory={reviveTicket:0,hintTicket:0,timeBoost:0,doubleGold:0}),this.player.gold-=t.price,this.player.inventory[e]=(this.player.inventory[e]||0)+1,D.playClick(),await this.game.playerManager.save(),this.game.effects.addParticleExplosion(200,350,"#fbbf24",12),this.game.effects.flashScreen("#fbbf24",.15),this.game.effects.floatingTexts.push({x:200,y:350,text:`-${t.price}G`,color:"#fbbf24",fontSize:18,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}}async buyItemBulk(e,t=5){const n=Ie[e];if(!n||e==="randomBg")return;const s=n.price*t;if(this.player.gold<s){this.showInsufficientGold(s);return}this.player.inventory||(this.player.inventory={reviveTicket:0,hintTicket:0,timeBoost:0,doubleGold:0}),this.player.gold-=s,this.player.inventory[e]=(this.player.inventory[e]||0)+t,D.playClick(),await this.game.playerManager.save(),this.game.effects.addParticleExplosion(200,350,"#fbbf24",20),this.game.effects.flashScreen("#fbbf24",.2),this.game.effects.floatingTexts.push({x:200,y:350,text:`-${s}G`,color:"#fbbf24",fontSize:20,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}async buyCosmetic(e,t){const n=ke[e];if(!n)return;const s=n.items.find(a=>a.id===t);if(!s||s.price===0)return;const i=this.player.cosmetics;if(e==="theme"){if(i.purchasedThemes.includes(t)){o.setBgTheme(t),D.playClick(),this.game.render();return}if(this.player.gold<s.price){this.showInsufficientGold(s.price);return}this.player.gold-=s.price,i.purchasedThemes.push(t),o.setBgTheme(t)}else{const a=e==="particle"?"purchasedParticles":e==="damageText"?"purchasedDamageText":"purchasedFlash",r=e==="particle"?"particleStyle":e==="damageText"?"damageTextStyle":"correctFlash";if(i[a].includes(t)){i[r]=t,D.playClick(),await this.game.playerManager.save(),this.game.render();return}if(this.player.gold<s.price){this.showInsufficientGold(s.price);return}this.player.gold-=s.price,i[a].push(t),i[r]=t}D.playClick(),await this.game.playerManager.save(),this.game.effects.addParticleExplosion(200,350,"#9333ea",15),this.game.effects.flashScreen("#9333ea",.2),this.game.effects.floatingTexts.push({x:200,y:350,text:`-${s.price}G`,color:"#fbbf24",fontSize:18,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}async equipCosmetic(e,t){const n=this.player.cosmetics;if(e==="theme"){if(!n.purchasedThemes.includes(t))return;o.setBgTheme(t),D.playClick(),await this.game.playerManager.save(),this.game.render()}else{const s=e==="particle"?"purchasedParticles":e==="damageText"?"purchasedDamageText":"purchasedFlash",i=e==="particle"?"particleStyle":e==="damageText"?"damageTextStyle":"correctFlash";if(!n[s].includes(t))return;n[i]=t,D.playClick(),await this.game.playerManager.save(),this.game.render()}}showInsufficientGold(e){const t=e-this.player.gold;this.game.effects.shakeScreen(3),this.game.effects.floatingTexts.push({x:200,y:350,text:l("shopNotEnoughShort",t),color:"#ef4444",fontSize:16,speed:1.5,life:1e3,maxLife:1e3,alpha:1,scale:1})}}class yt{constructor(e){this.game=e,this.droppedItem=null}checkDrop(e,t){const n=e.bossType;let s=Oe.MONSTER;if(n==="FINAL_BOSS"?s=1:n==="MID_BOSS"?s=.7:n==="NORMAL_BOSS"&&(s=Oe.BOSS),Math.random()<s){const i=this.rollItemDrop(n);if(this.onItemDrop(i,t),n==="FINAL_BOSS"&&Math.random()<.5){const a=this.rollItemDrop(n);setTimeout(()=>this.onItemDrop(a,t),500)}}}rollItemDrop(e){const t=Math.random();let n;t<Z.LEGENDARY.dropRate?n=Z.LEGENDARY:t<Z.LEGENDARY.dropRate+Z.EPIC.dropRate?n=Z.EPIC:t<Z.LEGENDARY.dropRate+Z.EPIC.dropRate+Z.RARE.dropRate?n=Z.RARE:n=Z.NORMAL;const s=this.getItemsByRarity(n);return{...s[Math.floor(Math.random()*s.length)],rarity:n}}getItemsByRarity(e){const t={normal:[{name:l("item.hpPotion"),effect:"hp",value:10,icon:"â¤ï¸"},{name:l("item.timeSand"),effect:"time",value:5,icon:"â³"},{name:l("item.smallGoldBag"),effect:"gold",value:20,icon:"ğŸ’°"}],rare:[{name:l("item.highHpPotion"),effect:"hp",value:25,icon:"ğŸ’–"},{name:l("item.timeCrystal"),effect:"time",value:10,icon:"âŒ›"},{name:l("item.goldBag"),effect:"gold",value:50,icon:"ğŸ’"},{name:l("item.comboBooster"),effect:"combo",value:3,icon:"ğŸ”¥"}],epic:[{name:l("item.holyGrail"),effect:"hp",value:50,icon:"ğŸ†"},{name:l("item.freeHint"),effect:"freeHint",value:1,icon:"ğŸ’¡"},{name:l("item.reviveFeather"),effect:"revive",value:1,icon:"ğŸª¶"},{name:l("item.goldAmulet"),effect:"goldMulti",value:1.25,icon:"âœ¨"}],legendary:[{name:l("item.immortalRing"),effect:"revive",value:2,icon:"ğŸ’"},{name:l("item.timeStop"),effect:"timeStop",value:1,icon:"â±ï¸"},{name:l("item.legendaryGold"),effect:"gold",value:200,icon:"ğŸ¥‡"},{name:l("item.wisdomCrown"),effect:"allTime",value:10,icon:"ğŸ‘‘"}]};return t[e.id]||t.normal}onItemDrop(e,t){const n=t.playerManager.player;switch(D.playItemDrop(e.rarity.id),e.effect){case"hp":n.currentHp=Math.min(n.maxHp,n.currentHp+e.value);break;case"time":t.timer+=e.value;break;case"gold":n.gold+=e.value,t.currentRun.earnedGold+=e.value;break;case"combo":t.combo+=e.value;break;case"freeHint":t.currentRun.freeHints=(t.currentRun.freeHints||0)+e.value;break;case"revive":n.inventory||(n.inventory={reviveTicket:0,hintTicket:0,timeBoost:0,doubleGold:0}),n.inventory.reviveTicket=(n.inventory.reviveTicket||0)+e.value;break;case"goldMulti":t.currentRun.goldMultiplier=(t.currentRun.goldMultiplier||1)*e.value;break;case"timeStop":t.currentRun.timeStops=(t.currentRun.timeStops||0)+e.value;break;case"allTime":t.timer+=e.value;break}["revive","gold"].includes(e.effect)&&t.playerManager.save(),this.showItemDropNotification(e)}showItemDropNotification(e){this.droppedItem=e,setTimeout(()=>{this.droppedItem=null},2e3)}}class bt{constructor(e){this.game=e,this.notificationQueue=[]}get player(){return this.game.playerManager.player}initDailyMissions(){if(!this.player)return;this.player.achievements||(this.player.achievements={}),this.player.dailyMissions||(this.player.dailyMissions={}),this.player.totalGoldEarned===void 0&&(this.player.totalGoldEarned=0),this.player.totalCorrectAnswers===void 0&&(this.player.totalCorrectAnswers=0);const e=new Date().toISOString().slice(0,10);if(this.player.dailyMissions.date!==e){const t=this._dateSeed(e),n=[...Qe],s=[];for(let i=0;i<3&&n.length>0;i++){const a=(t+i*7+i*i*3)%n.length,r=n.splice(a,1)[0];s.push({id:r.id,nameKey:r.nameKey,progress:0,target:r.target,completed:!1,claimed:!1,event:r.event,reward:{...r.reward}})}this.player.dailyMissions={date:e,missions:s},this.game.playerManager.save()}this.initWeeklyMissions()}_getISOWeek(e){const t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()+3-(t.getDay()+6)%7);const n=new Date(t.getFullYear(),0,4),s=Math.ceil(((t-n)/864e5+1)/7);return`${t.getFullYear()}-W${String(s).padStart(2,"0")}`}initWeeklyMissions(){if(!this.player)return;this.player.weeklyMissions||(this.player.weeklyMissions={});const e=this._getISOWeek(new Date);if(this.player.weeklyMissions.week!==e){const t=this._dateSeed(e),n=[...Je],s=[];for(let i=0;i<3&&n.length>0;i++){const a=(t+i*7+i*i*3)%n.length,r=n.splice(a,1)[0];s.push({id:r.id,nameKey:r.nameKey,progress:0,target:r.target,completed:!1,claimed:!1,event:r.event,reward:{...r.reward}})}this.player.weeklyMissions={week:e,missions:s},this.game.playerManager.save()}}_dateSeed(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t)}async unlock(e){if(this.player.achievements[e])return;const t=Ne.find(n=>n.id===e);t&&(this.player.achievements[e]=Date.now(),this.player.gold+=t.reward,t.rewardExp&&await this.game.playerManager.gainExp(t.rewardExp),t.rewardBonusDamage&&(this.player.achievementBonusDamage=(this.player.achievementBonusDamage||0)+t.rewardBonusDamage),t.rewardBonusHp&&(this.player.achievementBonusHp=(this.player.achievementBonusHp||0)+t.rewardBonusHp,this.player.maxHp=this.game.playerManager.getTotalMaxHp(),this.player.currentHp=Math.min(this.player.currentHp+t.rewardBonusHp,this.player.maxHp)),this.game.effects&&this.game.effects.showAchievementUnlock(t),await this.game.playerManager.save())}async claimDailyReward(e){var s;const t=(s=this.player.dailyMissions)==null?void 0:s.missions;if(!t||!t[e])return!1;const n=t[e];return!n.completed||n.claimed?!1:(n.claimed=!0,n.reward.gold&&(this.player.gold+=n.reward.gold),n.reward.exp&&await this.game.playerManager.gainExp(n.reward.exp),await this.game.playerManager.save(),!0)}async claimWeeklyReward(e){var s;const t=(s=this.player.weeklyMissions)==null?void 0:s.missions;if(!t||!t[e])return!1;const n=t[e];return!n.completed||n.claimed?!1:(n.claimed=!0,n.reward.gold&&(this.player.gold+=n.reward.gold),n.reward.exp&&await this.game.playerManager.gainExp(n.reward.exp),await this.game.playerManager.save(),!0)}_updateDaily(e,t=1){var i,a;const n=(i=this.player.dailyMissions)==null?void 0:i.missions;if(n)for(const r of n)r.event===e&&!r.completed&&(r.progress=Math.min(r.progress+t,r.target),r.progress>=r.target&&(r.completed=!0));const s=(a=this.player.weeklyMissions)==null?void 0:a.missions;if(s)for(const r of s)r.event===e&&!r.completed&&(r.progress=Math.min(r.progress+t,r.target),r.progress>=r.target&&(r.completed=!0))}onCorrectAnswer(e){var i,a;this._updateDaily("correctAnswer"),this._updateDaily("totalAnswers"),this.player.totalCorrectAnswers=(this.player.totalCorrectAnswers||0)+1,e>=10&&this.unlock("combo_3"),e>=20&&this.unlock("combo_5"),e>=50&&this.unlock("combo_10"),e>=100&&this.unlock("combo_20"),e>=500&&this.unlock("combo_500");const t=(i=this.player.dailyMissions)==null?void 0:i.missions;if(t)for(const r of t)r.event==="combo"&&!r.completed&&e>=r.target&&(r.progress=r.target,r.completed=!0);const n=(a=this.player.weeklyMissions)==null?void 0:a.missions;if(n)for(const r of n)r.event==="combo"&&!r.completed&&e>=r.target&&(r.progress=r.target,r.completed=!0);const s=this.player.totalCorrectAnswers||0;s>=100&&this.unlock("answer_100"),s>=500&&this.unlock("answer_500")}onGoldEarned(e){this.player.totalGoldEarned=(this.player.totalGoldEarned||0)+e,this._updateDaily("goldEarned",e);const t=this.player.totalGoldEarned;t>=1e3&&this.unlock("gold_1000"),t>=1e4&&this.unlock("gold_10000"),t>=1e5&&this.unlock("gold_100000")}onMonsterDefeated(e){var n;this._updateDaily("monsterDefeated"),e==="NORMAL_BOSS"&&this.unlock("boss_normal"),e==="MID_BOSS"&&this.unlock("boss_mid"),e==="FINAL_BOSS"&&this.unlock("boss_final");const t=((n=this.player.stats)==null?void 0:n.totalKills)||0;t>=50&&this.unlock("kills_50"),t>=100&&this.unlock("kills_100"),t>=500&&this.unlock("kills_500")}onLevelUp(e){e>=10&&this.unlock("level_10"),e>=25&&this.unlock("level_25"),e>=50&&this.unlock("level_50"),e>=99&&this.unlock("level_99"),e>=100&&this.unlock("level_100"),this.checkPowerAchievements()}checkPowerAchievements(){const e=this.game.playerManager;e.getTotalDamage()>=100&&this.unlock("damage_100"),e.getTotalMaxHp()>=500&&this.unlock("hp_500")}onRunEnd(e){if(e){if(e.result==="clear"){this._updateDaily("dungeonClear"),this.player.stats.totalClears||(this.player.stats.totalClears=0);const t=this.player.stats.totalClears+1;this.player.stats.totalClears=t,t>=1&&this.unlock("first_clear"),t>=20&&this.unlock("clear_10"),t>=80&&this.unlock("clear_50"),e.totalAnswers>=10&&e.correctAnswers===e.totalAnswers&&this.unlock("perfect_run")}this.game.playerManager.save()}}onMonsterRegistered(e){this.player.subjectCounts||(this.player.subjectCounts={}),this.player.subjectCounts[e]=(this.player.subjectCounts[e]||0)+1,e==="math"&&this.player.subjectCounts.math>=150&&this.unlock("master_math"),e==="science"&&this.player.subjectCounts.science>=150&&this.unlock("master_science")}}function V(c){return typeof c!="string"?String(c??""):c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class wt{constructor(e){this.game=e,this._lastDismissTime=0}_onDismiss(){this._lastDismissTime=Date.now()}showAnalyzingScreen(e="AI"){o.clear(),o.drawText(l("analyzing",e),200,300,{font:"bold 24px system-ui",color:u.ACCENT_LIGHT,align:"center"}),o.drawText(l("analyzingDesc"),200,350,{font:"16px system-ui",color:u.TEXT_SECONDARY,align:"center"})}showGeneratingScreen(e){o.clear(),o.drawText(l("generating"),200,280,{font:"bold 24px system-ui",color:u.ACCENT_LIGHT,align:"center"}),o.drawText(l("generatingDesc",e),200,330,{font:"16px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("pleaseWait"),200,370,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"})}showToast(e,t=3e3){const n=document.getElementById("toast-notification");n&&n.remove();const s=document.createElement("div");if(s.id="toast-notification",s.style.cssText="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:10001;max-width:340px;width:90%;pointer-events:auto;animation:toastIn 0.3s ease;font-family:system-ui,-apple-system,sans-serif;",s.innerHTML=`
      <div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:14px;padding:16px 20px;color:#e2e8f0;border:1px solid #22c55e;box-shadow:0 4px 20px rgba(34,197,94,0.3);white-space:pre-wrap;font-size:14px;line-height:1.5;max-height:40vh;overflow-y:auto;">
        ${V(e)}
      </div>
    `,!document.getElementById("toast-style")){const i=document.createElement("style");i.id="toast-style",i.textContent="@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}@keyframes toastOut{from{opacity:1;transform:translateX(-50%) translateY(0)}to{opacity:0;transform:translateX(-50%) translateY(-20px)}}",document.head.appendChild(i)}document.body.appendChild(s),s.onclick=()=>s.remove(),setTimeout(()=>{s.parentNode&&(s.style.animation="toastOut 0.3s ease",setTimeout(()=>s.remove(),300))},t)}showModal(e){return new Promise(t=>{const n=document.getElementById("custom-modal");n&&n.remove();const s=document.createElement("div");s.id="custom-modal",s.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10000;display:flex;justify-content:center;align-items:center;font-family:system-ui,-apple-system,sans-serif;",s.innerHTML=`
        <div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:16px;padding:20px;width:320px;max-height:80vh;overflow-y:auto;color:#e2e8f0;border:1px solid #6366f1;">
          <div style="white-space:pre-wrap;font-size:15px;line-height:1.6;margin-bottom:16px;">${V(e)}</div>
          <button id="modal-ok-btn" style="width:100%;padding:12px;border:none;border-radius:10px;background:#6366f1;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${l("close")}</button>
        </div>
      `,document.body.appendChild(s),document.getElementById("modal-ok-btn").onclick=()=>{s.remove(),this._onDismiss(),t()},s.onclick=i=>{i.target===s&&(s.remove(),this._onDismiss(),t())}})}showConfirm(e){return new Promise(t=>{const n=document.getElementById("custom-modal");n&&n.remove();const s=document.createElement("div");s.id="custom-modal",s.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10000;display:flex;justify-content:center;align-items:center;font-family:system-ui,-apple-system,sans-serif;",s.innerHTML=`
        <div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:16px;padding:20px;width:320px;max-height:80vh;overflow-y:auto;color:#e2e8f0;border:1px solid #6366f1;">
          <div style="white-space:pre-wrap;font-size:15px;line-height:1.6;margin-bottom:16px;">${V(e)}</div>
          <div style="display:flex;gap:10px;">
            <button id="modal-cancel-btn" style="flex:1;padding:12px;border:none;border-radius:10px;background:#374151;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${l("cancel")||"ì·¨ì†Œ"}</button>
            <button id="modal-ok-btn" style="flex:1;padding:12px;border:none;border-radius:10px;background:#6366f1;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${l("confirm")||"í™•ì¸"}</button>
          </div>
        </div>
      `,document.body.appendChild(s),document.getElementById("modal-ok-btn").onclick=()=>{s.remove(),this._onDismiss(),t(!0)},document.getElementById("modal-cancel-btn").onclick=()=>{s.remove(),this._onDismiss(),t(!1)},s.onclick=i=>{i.target===s&&(s.remove(),this._onDismiss(),t(!1))}})}showPrompt(e,t=""){return new Promise(n=>{const s=document.getElementById("custom-modal");s&&s.remove();const i=document.createElement("div");i.id="custom-modal",i.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10000;display:flex;justify-content:center;align-items:center;font-family:system-ui,-apple-system,sans-serif;",i.innerHTML=`
        <div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:16px;padding:20px;width:320px;max-height:80vh;overflow-y:auto;color:#e2e8f0;border:1px solid #6366f1;">
          <div style="white-space:pre-wrap;font-size:15px;line-height:1.6;margin-bottom:12px;">${V(e)}</div>
          <input id="modal-input" type="text" value="${V(t)}" style="width:100%;box-sizing:border-box;padding:10px;border:1px solid #4b5563;border-radius:8px;background:#0f172a;color:#e2e8f0;font-size:15px;margin-bottom:12px;">
          <div style="display:flex;gap:10px;">
            <button id="modal-cancel-btn" style="flex:1;padding:12px;border:none;border-radius:10px;background:#374151;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${l("cancel")||"ì·¨ì†Œ"}</button>
            <button id="modal-ok-btn" style="flex:1;padding:12px;border:none;border-radius:10px;background:#6366f1;color:white;font-size:16px;font-weight:bold;cursor:pointer;">${l("confirm")||"í™•ì¸"}</button>
          </div>
        </div>
      `,document.body.appendChild(i);const a=document.getElementById("modal-input"),r=i.firstElementChild;setTimeout(()=>{a.focus(),a.scrollIntoView({behavior:"smooth",block:"center"})},100);const d=()=>{if(window.visualViewport){const m=window.visualViewport.height;r.style.maxHeight=`${m*.7}px`,i.style.alignItems="flex-start",i.style.paddingTop=`${Math.max(20,(m-r.offsetHeight)/3)}px`}};window.visualViewport&&window.visualViewport.addEventListener("resize",d);const h=m=>{window.visualViewport&&window.visualViewport.removeEventListener("resize",d),i.remove(),this._onDismiss(),n(m)};a.addEventListener("keydown",m=>{m.key==="Enter"&&h(a.value)}),document.getElementById("modal-ok-btn").onclick=()=>h(a.value),document.getElementById("modal-cancel-btn").onclick=()=>h(null),i.onclick=m=>{m.target===i&&h(null)}})}showLevelProgress(){var E,I,N,G,$;const e=this.game.playerManager,t=e.player,n=t.level,s=t.exp,i=e.getExpForLevel(n),a=e.getLevelProgress(),r=Math.round(a*100),d=e.getLevelBonusHp(),h=e.getLevelBonusDamage(),m=e.getLevelBonusTime(),p=e.getTotalMaxHp(),_=e.getTotalDamage(),A=e.getTotalTime((E=this.game.currentMonster)==null?void 0:E.difficulty),v=Math.ceil(n/B.damageLevelInterval)*B.damageLevelInterval+1,C=Math.ceil(n/B.timeLevelInterval)*B.timeLevelInterval+1,w=document.getElementById("level-modal");w&&w.remove();let f=`${l("base")} ${P.DEFAULT_HP}`;d>0&&(f+=` + ${l("level")} ${d}`),((I=t.permanentUpgrades)==null?void 0:I.hp)>0&&(f+=` + ${l("upgrade")} ${t.permanentUpgrades.hp*X.hp.value}`);let b=`${l("base")} ${P.DEFAULT_DAMAGE}`;h>0&&(b+=` + ${l("level")} ${h}`),((N=t.permanentUpgrades)==null?void 0:N.damage)>0&&(b+=` + ${l("upgrade")} ${t.permanentUpgrades.damage*X.damage.value}`);let x=`${l("base")} ${P.DEFAULT_TIME}`;m>0&&(x+=` + ${l("level")} ${m}`),((G=t.permanentUpgrades)==null?void 0:G.time)>0&&(x+=` + ${l("upgrade")} ${t.permanentUpgrades.time*X.time.value}`);const S=((($=t.permanentUpgrades)==null?void 0:$.goldBonus)||0)*X.goldBonus.value,M=100+S;let y=`${l("base")} 100%`;S>0&&(y+=` + ${l("upgrade")} ${S}%`);const T=document.createElement("div");T.id="level-modal",T.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; display: flex; justify-content: center; align-items: center; font-family: system-ui, -apple-system, sans-serif;",T.innerHTML=`
      <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; padding: 20px; width: 340px; max-height: 80vh; overflow-y: auto; color: #e2e8f0; border: 1px solid #6366f1;">
        <h2 style="margin: 0 0 15px; text-align: center; color: #818cf8;">${l("levelProgress")}</h2>
        <div style="background: rgba(99,102,241,0.15); border-radius: 10px; padding: 12px; margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 24px; font-weight: bold; color: #818cf8;">LV.${n}</span>
            <span style="color: #94a3b8;">/ ${B.displayMaxLevel}</span>
          </div>
          <div style="background: #0a0a0f; border-radius: 8px; height: 20px; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #6366f1, #818cf8); height: 100%; width: ${r}%;"></div>
          </div>
          <div style="text-align: center; margin-top: 5px; font-size: 13px; color: #94a3b8;">${s} / ${i} EXP (${r}%)</div>
        </div>
        <div style="background: rgba(34,197,94,0.1); border-radius: 10px; padding: 12px; margin-bottom: 12px;">
          <div style="font-weight: bold; margin-bottom: 8px; color: #22c55e;">${l("currentStats")}</div>
          <div style="font-size: 13px; line-height: 1.8;">
            <div>â¤ï¸ HP: <b>${p}</b> <span style="color:#94a3b8; font-size:11px;">(${f})</span></div>
            <div>âš”ï¸ ${l("attack")}: <b>${_}</b> <span style="color:#94a3b8; font-size:11px;">(${b})</span></div>
            <div>â±ï¸ ${l("time")}: <b>${A}${l("seconds")}</b> <span style="color:#94a3b8; font-size:11px;">(${x})</span></div>
            <div>ğŸ’° ${l("stats_gold")}: <b>${M}%</b> <span style="color:#94a3b8; font-size:11px;">(${y})</span></div>
          </div>
        </div>
        <div style="background: rgba(251,191,36,0.1); border-radius: 10px; padding: 12px; margin-bottom: 12px;">
          <div style="font-weight: bold; margin-bottom: 8px; color: #fbbf24;">${l("nextBonus")}</div>
          <div style="font-size: 13px; line-height: 1.8;">
            ${n>=B.maxLevel?`<div style="color:#fbbf24;font-weight:bold;">${l("maxLevelBonus")}</div>`:`<div>${l("level")} ${n+1}: â¤ï¸ HP +1</div>
            ${v<=B.displayMaxLevel?`<div>${l("level")} ${v}: âš”ï¸ ${l("attack")} +${B.damagePerLevels}</div>`:""}
            ${C<=B.displayMaxLevel?`<div>${l("level")} ${C}: â±ï¸ ${l("time")} +${B.timePerLevels}${l("seconds")}</div>`:""}`}
          </div>
        </div>
        <div style="background: rgba(99,102,241,0.1); border-radius: 10px; padding: 12px; margin-bottom: 15px;">
          <div style="font-weight: bold; margin-bottom: 8px; color: #818cf8;">${l("expGain")}</div>
          <div style="font-size: 13px; line-height: 1.8;">
            <div>${l("correctAnswer")}: <b>+${B.expPerCorrect}</b> EXP</div>
            <div>${l("monsterKill")}: <b>+${B.expPerMonsterKill}</b> EXP</div>
            <div>${l("normalBossLabel")} ğŸ‘¹: <b>+${B.expPerNormalBoss}</b> EXP</div>
            <div>${l("midBossLabel")} ğŸ‘¿: <b>+${B.expPerMidBoss}</b> EXP</div>
            <div>${l("finalBossLabel")} ğŸ‰: <b>+${B.expPerFinalBoss}</b> EXP</div>
          </div>
        </div>
        <button id="close-level-modal" style="width: 100%; padding: 12px; border: none; border-radius: 10px; background: #6366f1; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">${l("close")}</button>
      </div>
    `,document.body.appendChild(T),document.getElementById("close-level-modal").onclick=()=>T.remove(),T.onclick=k=>{k.target===T&&T.remove()}}async showProblemViewer(){const e=this.game.db,t=await e.getByIndex("monsters","status","alive"),n=await e.getByIndex("monsters","status","cleared"),s=[...t,...n].sort((m,p)=>(p.createdAt||0)-(m.createdAt||0)),i=document.getElementById("problem-viewer-modal");i&&i.remove();const a=document.createElement("div");a.id="problem-viewer-modal",a.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.92);z-index:10000;display:flex;flex-direction:column;align-items:center;font-family:system-ui,-apple-system,sans-serif;";const r=m=>{let p=s;return m==="image"&&(p=s.filter(_=>_.imageData)),p.length===0?`<div style="text-align:center;color:#94a3b8;padding:40px 0;font-size:15px;">${V(l("problemViewerEmpty"))}</div>`:p.map(_=>{let A=_.imageData;if(!A)try{A=ge(_)}catch{A=""}const v=A?`<img src="${A}" style="width:100%;border-radius:10px;cursor:pointer;display:block;" onclick="this.classList.toggle('pv-expanded');this.style.maxHeight=this.classList.contains('pv-expanded')?'none':'300px'" />`:`<div style="padding:16px;background:rgba(99,102,241,0.1);border-radius:10px;color:#e2e8f0;font-size:15px;line-height:1.6;word-break:keep-all;">${V(de(_.question)||"ë¬¸ì œ ì—†ìŒ")}</div>`;return`<div style="margin-bottom:12px;" data-monster-id="${_.id}">
          ${v}
          <div style="margin-top:6px;padding:8px 12px;background:rgba(30,30,60,0.8);border-radius:8px;font-size:13px;color:#94a3b8;">${V(l("answerLabel"))}: <span style="color:#22c55e;font-weight:bold;">${V(_.answer||"?")}</span></div>
        </div>`}).join("")},d=s.filter(m=>m.imageData).length;a.innerHTML=`
      <div style="width:100%;max-width:400px;height:100%;display:flex;flex-direction:column;">
        <div style="background:linear-gradient(135deg,#1a1a2e,#16213e);padding:16px 20px 12px;border-bottom:1px solid rgba(99,102,241,0.3);flex-shrink:0;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <span style="font-size:18px;font-weight:bold;color:#e2e8f0;">${V(l("problemViewer"))} <span style="font-size:14px;color:#818cf8;">(${s.length})</span></span>
            <button id="pv-close" style="background:none;border:none;color:#94a3b8;font-size:24px;cursor:pointer;padding:0 4px;">âœ•</button>
          </div>
          <div style="display:flex;gap:8px;" id="pv-filters">
            <button class="pv-filter-btn active" data-filter="all" style="padding:6px 14px;border-radius:8px;border:1px solid rgba(99,102,241,0.4);background:rgba(99,102,241,0.3);color:#e2e8f0;font-size:13px;cursor:pointer;">${V(l("filterAll"))} (${s.length})</button>
            <button class="pv-filter-btn" data-filter="image" style="padding:6px 14px;border-radius:8px;border:1px solid rgba(99,102,241,0.2);background:transparent;color:#94a3b8;font-size:13px;cursor:pointer;">${V(l("filterImage"))} (${d})</button>
          </div>
        </div>
        <div id="pv-list" style="flex:1;overflow-y:auto;padding:12px 16px;-webkit-overflow-scrolling:touch;">
          ${r("all")}
        </div>
      </div>
    `,document.body.appendChild(a),a.querySelectorAll(".pv-filter-btn").forEach(m=>{m.onclick=()=>{a.querySelectorAll(".pv-filter-btn").forEach(p=>{p.style.background="transparent",p.style.color="#94a3b8",p.style.borderColor="rgba(99,102,241,0.2)",p.classList.remove("active")}),m.style.background="rgba(99,102,241,0.3)",m.style.color="#e2e8f0",m.style.borderColor="rgba(99,102,241,0.4)",m.classList.add("active"),document.getElementById("pv-list").innerHTML=r(m.dataset.filter)}}),document.getElementById("pv-close").onclick=()=>{a.remove(),this._onDismiss()},a.onclick=m=>{m.target===a&&(a.remove(),this._onDismiss())};const h=s.filter(m=>!m.imageData);h.length>0&&this._generateImagesInBackground(h,e)}async _generateImagesInBackground(e,t){for(const n of e){if(!document.getElementById("problem-viewer-modal"))return;try{const s=ge(n);s&&(n.imageData=s,await t.put("monsters",n))}catch{}}}}class vt{constructor(e){this.game=e,this.clickAreas=[],this.scrollY=0,this.scrollMaxY=0,this._touchStartY=null,this._touchLastY=null,this._isTouchScrolling=!1,this._dragging=null,this._lastInputTime=0,this._bgmInitiated=!1}registerClickArea(e,t,n,s,i,a){this.clickAreas.push({id:e,x:t,y:n,width:s,height:i,callback:a})}registerDragArea(e,t,n,s,i,a){this.clickAreas.push({id:e,x:t,y:n,width:s,height:i,callback:a,draggable:!0})}clearClickAreas(){this.clickAreas=[]}_getFixedHeaderHeight(){return this.game.currentScreen===R.SHOP?86:60}handleInput(e,t){if(this._isTouchScrolling)return;if(this.game.isGenerating){for(const r of this.clickAreas)if(r.id==="cancelGeneration"&&e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height){r.callback(e,t);return}return}const n=Date.now(),s=this.game.dialogManager;if(s&&s._lastDismissTime&&n-s._lastDismissTime<400||this._lastInputTime&&n-this._lastInputTime<200)return;if(this._lastInputTime=n,this.game.guideStep!==null){for(const d of this.clickAreas)if(d.id&&d.id.startsWith("guide_")&&e>=d.x-8&&e<=d.x+d.width+8&&t>=d.y-8&&t<=d.y+d.height+8){d.callback(e,t);return}return}if(this.game.effects.isLevelUpActive()){this.game.effects.dismissLevelUp();return}this._bgmInitiated||(this._bgmInitiated=!0,D.init(),this.game.currentScreen===R.MAIN&&D.startLobbyBgm());const i=this._getFixedHeaderHeight(),a=this.scrollMaxY>0&&t>=i?t+this.scrollY:t;for(const r of this.clickAreas)if(e>=r.x&&e<=r.x+r.width&&a>=r.y&&a<=r.y+r.height){this.game._needsRender=!0,r.id==="toggleSfx"||r.id==="toggleBgm"||D.playClick(),r.callback(e,a);return}}handleTouchStart(e,t){const n=this._getFixedHeaderHeight(),s=this.scrollMaxY>0&&t>=n?t+this.scrollY:t;for(const i of this.clickAreas)if(i.draggable&&e>=i.x&&e<=i.x+i.width&&s>=i.y&&s<=i.y+i.height){this._dragging={id:i.id,handler:i.callback},i.callback(e,s),this.game._needsRender=!0;return}this.scrollMaxY<=0||(this._touchStartY=t,this._touchLastY=t,this._isTouchScrolling=!1)}handleTouchMove(e,t){if(this._dragging){this._dragging.handler(e),this.game.render();return}if(this._touchLastY===null||this.scrollMaxY<=0)return;const n=this._touchLastY-t;this._touchLastY=t,Math.abs(t-this._touchStartY)>15&&(this._isTouchScrolling=!0),this._isTouchScrolling&&(this.scrollY=Math.max(0,Math.min(this.scrollMaxY,this.scrollY+n)),this.game._needsRender=!0)}handleTouchEnd(){if(this._dragging){this._dragging=null;return}this._touchStartY=null,this._touchLastY=null,setTimeout(()=>{this._isTouchScrolling=!1},50)}}class Tt{constructor(e){this.game=e,this.guideStep=null}showGuide(){this.guideStep=0,this.game.render()}_advanceGuide(){this.guideStep<6?this.guideStep++:(this.guideStep=null,F("guide_shown","1")),this.game.render()}renderGuide(e){const n=this.guideStep;e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,400,700);const s=30,i=90,a=340,r=520,d=16;e.fillStyle="#1a1a2e",e.beginPath(),e.moveTo(s+d,i),e.lineTo(s+a-d,i),e.quadraticCurveTo(s+a,i,s+a,i+d),e.lineTo(s+a,i+r-d),e.quadraticCurveTo(s+a,i+r,s+a-d,i+r),e.lineTo(s+d,i+r),e.quadraticCurveTo(s,i+r,s,i+r-d),e.lineTo(s,i+d),e.quadraticCurveTo(s,i,s+d,i),e.closePath(),e.fill(),e.strokeStyle="#6366f1",e.lineWidth=2,e.stroke();const h=["ğŸ‘‹","ğŸ“¸","âš”ï¸","ğŸ’¥","ğŸ’","ğŸª","ğŸ†"];o.drawText(h[n],200,150,{font:"56px system-ui",align:"center"}),o.drawText(l(`guide_title_${n}`),200,230,{font:"bold 22px system-ui",color:"#818cf8",align:"center"}),o.drawText(`${n+1}/7`,200,255,{font:"13px system-ui",color:"rgba(255,255,255,0.5)",align:"center"});const p=l(`guide_desc_${n}`).split(`
`);let _=280;for(const g of p)o.drawText(g,200,_,{font:"15px system-ui",color:"#e2e8f0",align:"center"}),_+=22;const A=530;for(let g=0;g<7;g++){const S=200+(g-3)*20;e.beginPath(),e.arc(S,A,5,0,Math.PI*2),e.fillStyle=g===n?"#818cf8":"rgba(255,255,255,0.3)",e.fill()}const v=555,C=200,w=44,f=100,x=l(n===6?"guide_start":"guide_next");o.roundRect(f,v,C,w,12,"#6366f1"),o.drawText(x,200,v+w/2,{font:"bold 17px system-ui",color:"#ffffff",align:"center"}),this.game.registerClickArea("guide_btn",f,v,C,w,()=>{this._advanceGuide()})}}const Ye="https://caricature-api-rust.wizice.com",je="gemini-2.0-flash";class xt{constructor(){this.apiKey=null,this.loadApiKey()}setApiKey(e){this.apiKey=e,me("smileprint_api_key",e),H.isLoggedIn()&&H.saveKey("smileprint_api_key",e).catch(t=>{})}loadApiKey(){return this.apiKey=Pe("smileprint_api_key"),this.apiKey}hasApiKey(){return!!this.apiKey}buildPrompt(e){return`ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ${{math:"ìˆ˜í•™",english:"ì˜ì–´",korean:"êµ­ì–´",science:"ê³¼í•™",social:"ì‚¬íšŒ"}[e]||"ì¼ë°˜"} ì‹œí—˜ ë¬¸ì œ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì‘ì—…
ì´ ì´ë¯¸ì§€ì˜ ì‹œí—˜ ë¬¸ì œë¥¼ ì •í™•íˆ ë¶„ì„í•˜ì„¸ìš”.

## ë¶„ì„ ë‹¨ê³„
1. ë¬¸ì œ ìœ í˜• íŒŒì•… (ê°ê´€ì‹/ì£¼ê´€ì‹/ì„œìˆ í˜•)
2. ë¬¸ì œ ì „ë¬¸ ì¶”ì¶œ
3. ë¬¸ì œë¥¼ ì§ì ‘ í’€ì–´ì„œ ì •ë‹µ ë„ì¶œ
4. ì˜¤ë‹µ ì„ íƒì§€ ìƒì„±

## ì •ë‹µ ê·œì¹™
- ì´ì°¨ë°©ì •ì‹ ë“± ë³µìˆ˜ ì •ë‹µ: "2, -3" ë˜ëŠ” "x=2, x=-3"
- ë‹¨ì¼ ì •ë‹µ: "5" ë˜ëŠ” "-2"
- ë¶„ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ: "1/2" ë˜ëŠ” "2/3"
- ì†Œìˆ˜: "0.5" ë˜ëŠ” "3.14"

## ì˜¤ë‹µ ìƒì„± ê·œì¹™
ì •ë‹µê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ í‹€ë¦° ê°’ìœ¼ë¡œ ì˜¤ë‹µ 3ê°œ ìƒì„±:
- ì •ë‹µ 5 â†’ ì˜¤ë‹µ 3, 7, -5
- ì •ë‹µ "2, -3" â†’ ì˜¤ë‹µ "2, 3", "1, -3", "-2, 3"
- ê³„ì‚° ì‹¤ìˆ˜ë¡œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ê°’ ì‚¬ìš©
- ë¶€í˜¸ ì‹¤ìˆ˜, ê³„ì‚° ì‹¤ìˆ˜ ë“± í•™ìƒì´ í”íˆ í•˜ëŠ” ì‹¤ìˆ˜ ë°˜ì˜

## JSON ì¶œë ¥ (ë°˜ë“œì‹œ ì´ í˜•ì‹ë§Œ)
{
  "success": true,
  "questionType": "ê°ê´€ì‹",
  "question": "ë¬¸ì œ ì „ë¬¸",
  "answer": "ì •ë‹µê°’",
  "answers": ["ì •ë‹µ1", "ì •ë‹µ2"],
  "choices": ["ì •ë‹µ", "ì˜¤ë‹µ1", "ì˜¤ë‹µ2", "ì˜¤ë‹µ3"],
  "correctIndex": 0,
  "explanation": "ìƒì„¸ í’€ì´ ê³¼ì •",
  "topic": "ì´ì°¨ë°©ì •ì‹",
  "difficulty": "ì¤‘",
  "formula": "ì‚¬ìš©ëœ ê³µì‹"
}

## í•„ìˆ˜ í™•ì¸
- answer: ìµœì¢… ì •ë‹µ (ë³µìˆ˜ë©´ ì‰¼í‘œë¡œ êµ¬ë¶„)
- answers: ì •ë‹µ ë°°ì—´ (ë³µìˆ˜ ì •ë‹µ ì§€ì›)
- choices[0]ì€ ë°˜ë“œì‹œ ì •ë‹µê³¼ ë™ì¼
- explanation: ë‹¨ê³„ë³„ í’€ì´ ê³¼ì •
- formula: ê´€ë ¨ ê³µì‹ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
- questionì—ëŠ” ìˆœìˆ˜ ë¬¸ì œ í…ìŠ¤íŠ¸ë§Œ (ì˜ì–´ ë²ˆì—­, ë²ˆí˜¸, ë©”íƒ€ì •ë³´, ë§ˆí¬ë‹¤ìš´ ì„œì‹ ì œì™¸)`}async analyzeImage(e,t){if(!this.apiKey)throw new Error("SmilePrint API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");const n=e.includes(",")?e.split(",")[1]:e,s=atob(n),i=new Array(s.length);for(let p=0;p<s.length;p++)i[p]=s.charCodeAt(p);const a=new Uint8Array(i),r=new Blob([a],{type:"image/jpeg"}),d=new FormData;d.append("image",r,"problem.jpg"),d.append("prompt",this.buildPrompt(t)),d.append("model",je),d.append("temperature","0.3");let h=null,m=null;for(let p=0;p<=1;p++)try{const _=await fetch(`${Ye}/api/v1/analyze/image`,{method:"POST",headers:{"X-API-Key":this.apiKey},body:d});if(!_.ok){const A=await _.json().catch(()=>({})),v=_.status;throw v===401||v===403||v===400?new Error(A.errorMessage||`API ì˜¤ë¥˜: ${v}`):new Error(A.errorMessage||`ì„œë²„ ì˜¤ë¥˜: ${v}`)}m=await _.json();break}catch(_){if(h=_,_.message.includes("API ì˜¤ë¥˜"))throw _;p<1&&await this.sleep(1e3)}if(!m)throw new Error(`ì´ë¯¸ì§€ ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ${(h==null?void 0:h.message)||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);return{jobId:m.jobId,accessKey:m.accessKey,estimatedCost:m.estimatedCost}}async checkStatus(e,t){let n=null;for(let s=0;s<2;s++)try{const i=await fetch(`${Ye}/api/v1/analyze/status/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw i.status>=400&&i.status<500?new Error(`ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${i.status}`):new Error(`ì„œë²„ ì˜¤ë¥˜: ${i.status}`);return await i.json()}catch(i){if(n=i,i.message.includes("ìƒíƒœ í™•ì¸ ì‹¤íŒ¨"))throw i;s<1&&await this.sleep(1e3)}throw new Error(`ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${(n==null?void 0:n.message)||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}async waitForCompletion(e,t,n=30,s=null){let i=0;const a=3;for(let r=0;r<n;r++){const d=r===0?300:1e3;await this.sleep(d);try{const h=await this.checkStatus(e,t);if(i=0,s&&s(h.progress||0,h.status),h.status==="completed")return h;if(h.status==="failed")throw new Error(h.errorMessage||"ë¶„ì„ ì‹¤íŒ¨")}catch(h){if(h.message==="ë¶„ì„ ì‹¤íŒ¨"||h.message.includes("ë¶„ì„ ì‹¤íŒ¨")||h.message.includes("ìƒíƒœ í™•ì¸ ì‹¤íŒ¨"))throw h;if(i++,i>=a)throw new Error(`ì—°ì† ${a}íšŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì¤‘ë‹¨: ${h.message}`)}}throw new Error("ë¶„ì„ ì‹œê°„ ì´ˆê³¼ (ìµœëŒ€ í´ë§ íšŸìˆ˜ ë„ë‹¬)")}async analyze(e,t,n=null){var d;const s=await this.analyzeImage(e,t),i=await this.waitForCompletion(s.jobId,s.accessKey,30,n),a=((d=i.result)==null?void 0:d.analysisText)||"",r=this.parseJSON(a);if(!r||!r.success)throw new Error((r==null?void 0:r.message)||"ë¶„ì„ ê²°ê³¼ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return{...r,aiAnalysis:{model:je,processingTime:i.processingTime,cost:i.actualCost,analyzedAt:Date.now()}}}parseJSON(e){try{const t=e.match(/\{[\s\S]*\}/);if(t){const n=JSON.parse(t[0]);return n.question&&(n.question=de(n.question)),n}return null}catch{return null}}sleep(e){return new Promise(t=>setTimeout(t,e))}}const ye=new xt;class At{constructor(e){this.game=e,this.pendingImage=null,this.previewImg=null,this.previewImageLoaded=!1,this._previewImageLoading=!1}startRegister(){this.pendingImage=null,this.previewImg=null,this.previewImageLoaded=!1,this._previewImageLoading=!1,this.game.changeScreen(R.MAIN)}async completeRegister(e){var x;const t=this.game;if(t.isGenerating)return;if(!this.pendingImage){await t.showModal(l("noPhoto")),t.changeScreen(R.MAIN);return}const n=this.pendingImage,s=((x=Y[e.toUpperCase()])==null?void 0:x.nameKey)||"math",i=l(s);let a="",r="",d=[],h=[],m=0,p="",_=null,A="",v=2,C=[],w=l("multipleChoice"),f="";try{if(ye.hasApiKey())try{t._generationCancelled=!1,t.isGenerating=!0,t.generatingMessage=l("analyzing","SmilePrint"),t.generatingSubMessage=l("analyzingDesc"),t._needsRender=!0;const g=await Promise.race([ye.analyze(n,e),new Promise((S,M)=>setTimeout(()=>M(new Error("Timeout")),6e4))]);if(t._generationCancelled)return;if(g&&g.success&&g.question){a=g.question,r=g.answer||"",h=g.choices||[],m=g.correctIndex||0,p=g.explanation||"",A=g.topic||"",v=this._parseDifficulty(g.difficulty),C=g.keywords||[],_=g.aiAnalysis,d=g.answers||[r],w=g.questionType||l("multipleChoice"),f=g.formula||"",t.isGenerating=!1,t._needsRender=!0;const S=a.length>100?a.substring(0,100)+"...":a,M=d.length>1?d.join(", "):r;await t.showConfirm(l("aiAnalyzed",S,M,A,p))||(a=await t.showPrompt(l("editQuestion"),a)||a,r=await t.showPrompt(l("editAnswer"),r)||r)}else throw new Error((g==null?void 0:g.message)||l("noAnalysisResult"))}catch(g){if(q.hasApiKey())try{t.generatingMessage=l("analyzing","Gemini");const S=await Promise.race([q.analyzeImage(n,i),new Promise((M,y)=>setTimeout(()=>y(new Error("Timeout")),6e4))]);if(t.isGenerating=!1,t._needsRender=!0,S&&S.question){a=S.question,r=S.answer||"",h=S.choices||[],m=S.correctIndex||0,p=S.explanation||"";const M=a.length>100?a.substring(0,100)+"...":a;await t.showConfirm(l("aiAnalyzedSimple",M,r))||(a=await t.showPrompt(l("editQuestion"),a)||a,r=await t.showPrompt(l("editAnswer"),r)||r)}else throw new Error(l("noAnalysisResult"))}catch{if(t.isGenerating=!1,t._needsRender=!0,await t.showModal(l("aiFailed",this._safeErrorMsg(g))),a=await t.showPrompt(l("inputQuestion"))||"",!a)return;r=await t.showPrompt(l("inputAnswer"))||""}else{if(t.isGenerating=!1,t._needsRender=!0,await t.showModal(l("aiFailed",this._safeErrorMsg(g))),a=await t.showPrompt(l("inputQuestion"))||"",!a)return;r=await t.showPrompt(l("inputAnswer"))||""}}else if(q.hasApiKey())try{t._generationCancelled=!1,t.isGenerating=!0,t.generatingMessage=l("analyzing","Gemini"),t.generatingSubMessage=l("analyzingDesc"),t._needsRender=!0;const g=await Promise.race([q.analyzeImage(n,i),new Promise((S,M)=>setTimeout(()=>M(new Error("Timeout")),6e4))]);if(t._generationCancelled)return;if(t.isGenerating=!1,t._needsRender=!0,g&&g.question){a=g.question,r=g.answer||"",h=g.choices||[],m=g.correctIndex||0,p=g.explanation||"";const S=a.length>100?a.substring(0,100)+"...":a;await t.showConfirm(l("aiAnalyzedSimple",S,r))||(a=await t.showPrompt(l("editQuestion"),a)||a,r=await t.showPrompt(l("editAnswer"),r)||r)}else throw new Error(l("noAnalysisResult"))}catch(g){if(t.isGenerating=!1,t._needsRender=!0,await t.showModal(l("aiFailed",this._safeErrorMsg(g))),a=await t.showPrompt(l("inputQuestion"))||"",!a)return;r=await t.showPrompt(l("inputAnswer"))||""}else{if(a=await t.showPrompt(l("inputQuestion"))||"",!a)return;r=await t.showPrompt(l("inputAnswer"))||""}}finally{t.isGenerating=!1,t._needsRender=!0,t._removeCancelOverlay()}if(!r&&h&&h.length>0&&(r=h[m]||h[0]),!r&&(r=await t.showPrompt(l("inputAnswerNum"))||"",!r)){await t.showModal(l("noAnswer"));return}if(!h||h.length<4){const g=t.monsterManager.generateWrongAnswers(r);h=[r,...g],m=0}a=this._sanitize(a,1e3),r=this._sanitize(r,200),p=this._sanitize(p,1e3),A=this._sanitize(A,100),f=this._sanitize(f,500),d=d.map(g=>this._sanitize(g,200)),h=h.map(g=>this._sanitize(g,200)),C=C.map(g=>this._sanitize(g,50));const b={subject:e,imageData:n,question:a,answer:r,answers:d.length>0?d:[r],choices:h,correctIndex:m,explanation:p,topic:A,difficulty:v,keywords:C,questionType:w,formula:f,hp:80+v*20,maxHp:80+v*20,createdAt:Date.now(),status:"alive",aiAnalysis:_,stats:{attempts:0,correct:0,wrong:0,lastAttempt:null,averageTime:0},review:{nextReviewDate:null,reviewCount:0,masteryLevel:0}};await t.db.add("monsters",b),H.isLoggedIn()&&H.postMonster(b).catch(g=>{}),await t.monsterManager.loadMonsters(),t.achievementManager.onMonsterRegistered(e),this.pendingImage=null,this.previewImg=null,this.previewImageLoaded=!1,this._previewImageLoading=!1,await t.showModal(l("monsterRegistered")),t.changeScreen(R.MAIN)}_safeErrorMsg(e){return((e==null?void 0:e.message)||"").replace(/https?:\/\/[^\s]+/g,"[URL]").replace(/[A-Z]:\\[^\s]+/gi,"[path]").replace(/\/[^\s]*\/[^\s]+/g,"[path]").substring(0,100)}_sanitize(e,t=500){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"").trim().substring(0,t)}_parseDifficulty(e){return e==="ìƒ"||e==="high"||e==="é«˜"?3:e==="í•˜"||e==="low"||e==="ä½"?1:2}}class St{constructor(e){this.game=e}get db(){return this.game.db}async resetAllProblems(){const e=this.game,t=e.monsterManager.monsters;if(t.length===0){await e.showModal(l("noProblemsToReset"));return}if(await e.showConfirm(l("confirmReset",t.length))&&await e.showConfirm(l("confirmResetFinal",t.length)))try{for(const n of t)await this.db.delete("monsters",n.id);e.monsterManager.monsters=[],await e.showModal(l("resetDone",t.length)),e.render()}catch{await e.showModal(l("resetError"))}}async resetAccount(){const e=this.game;if(await e.showConfirm(l("confirmAccountReset"))&&await e.showConfirm(l("confirmAccountResetFinal")))try{await this.db.clear("runs"),await this.db.clear("items");const t=e.playerManager.createNewPlayer();await this.db.put("player",t),e.playerManager.player=t,e.playerManager.player.maxHp=e.playerManager.getTotalMaxHp(),e.playerManager.player.currentHp=e.playerManager.player.maxHp,e.achievementManager.initDailyMissions(),H.isLoggedIn()&&H.putPlayer(t).catch(n=>{}),Me("guide_shown"),await e.showModal(l("accountResetDone")),e.changeScreen(R.MAIN)}catch{await e.showModal(l("accountResetError"))}}async exportProblems(){const e=this.game,t=e.monsterManager.monsters;if(t.length===0){await e.showModal(l("noExportData"));return}try{const n=t.map(d=>({question:d.question,answer:d.answer,answers:d.answers,choices:d.choices,correctIndex:d.correctIndex,explanation:d.explanation,topic:d.topic,difficulty:d.difficulty,keywords:d.keywords,subject:d.subject,questionType:d.questionType,formula:d.formula})),s=JSON.stringify({version:"1.0",exportDate:new Date().toISOString(),count:n.length,problems:n},null,2),i=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(i),r=document.createElement("a");r.href=a,r.download=`${l("exportFilename")}_${new Date().toISOString().slice(0,10)}_${n.length}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),await e.showModal(l("exported",n.length))}catch{await e.showModal(l("exportError"))}}importProblems(){const e=this.game,t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=async n=>{const s=n.target.files[0];if(s)try{const i=await s.text(),a=JSON.parse(i);if(!a.problems||!Array.isArray(a.problems)){await e.showModal(l("invalidFile"));return}if(a.problems.length===0){await e.showModal(l("noImportData"));return}if(!await e.showConfirm(l("confirmImport",a.problems.length)))return;let r=0;for(const d of a.problems){if(!d.question)continue;const h={id:Date.now()+Math.random(),subject:d.subject||"math",createdAt:Date.now(),status:"alive",question:d.question,answer:d.answer||"",answers:d.answers||[d.answer],choices:d.choices||[],correctIndex:d.correctIndex||0,explanation:d.explanation||"",topic:d.topic||"",difficulty:d.difficulty||2,keywords:d.keywords||[],questionType:d.questionType||l("multipleChoice"),formula:d.formula||"",hp:100,maxHp:100};await this.db.add("monsters",h),e.monsterManager.monsters.push(h),r++}await e.showModal(l("imported",r)),e.render()}catch{await e.showModal(l("importError"))}},t.click()}}class Ct{constructor(e){this.game=e,this._aiGenerating=!1}_withTimeout(e,t=6e4){return Promise.race([e,new Promise((n,s)=>setTimeout(()=>s(new Error(l("timeout")||"Timeout")),t))])}_finishAndShowResult(e){const t=this.game;t.isGenerating=!1,t._needsRender=!0,t._removeCancelOverlay();try{t.changeScreen(R.MAIN)}catch{}e&&t.showToast(e)}async promptApiKey(){const e=await this.game.showPrompt(l("inputGeminiKey"));e&&e.trim()&&(q.setApiKey(e.trim()),await this.game.showModal(l("geminiKeySaved")))}async promptSmilePrintApiKey(){const e=await this.game.showPrompt(l("inputSmilePrintApiKey"));e&&e.trim()&&(ye.setApiKey(e.trim()),await this.game.showModal(l("smilePrintKeySaved")))}async testAIGeneration(){if(this._aiGenerating)return;this._aiGenerating=!0;const e=this.game;try{let t=null;try{e._generationCancelled=!1,e.isGenerating=!0,e.generatingMessage=l("testGenerating"),e.generatingSubMessage="",e._needsRender=!0;const n=await this._withTimeout(q.generateNewProblems(l("defaultTopic"),l("linearEquation"),3));if(!e._generationCancelled&&n&&n.problems&&n.problems.length>0){let s=0;for(const a of n.problems){const r={subject:"math",question:a.question,answer:a.answer,choices:a.choices||[],correctIndex:a.correctIndex||0,explanation:a.explanation||"",hp:80+(a.difficulty||1)*20,maxHp:80+(a.difficulty||1)*20,difficulty:a.difficulty||1,isGenerated:!0,createdAt:Date.now(),status:"alive"};r.imageData=ge(r),await e.db.add("monsters",r),s++}await e.monsterManager.loadMonsters();const i=n.problems[0];t=l("testGenerated",s,i.question,i.answer)}else e._generationCancelled||(t=l("generateFailed"))}catch(n){t=l("error")+n.message}this._finishAndShowResult(t)}finally{this._aiGenerating=!1,this._safeCleanup(e)}}async showAIGenerateMenu(){if(!this._aiGenerating){this._aiGenerating=!0;try{await this._doAIGenerateMenu()}finally{this._aiGenerating=!1,this._safeCleanup(this.game)}}}_safeCleanup(e){try{e.isGenerating=!1,e._needsRender=!0,e._removeCancelOverlay();const t=document.getElementById("custom-modal");t&&t.remove(),e.changeScreen(R.MAIN)}catch{e.isGenerating=!1,e._needsRender=!0}}async _doAIGenerateMenu(){const e=this.game,t=await e.showPrompt(l("aiGenerateMenu",l("math"),l("science")));if(t===null)return;const n=parseInt(t);if(isNaN(n)||n<1||n>2){await e.showModal(l("invalidInput"));return}const s=n===1?"math":"science",i=l(n===1?"math":"science"),a=U.getTopics(s),r=Object.keys(a),d=Object.entries(a).map(([b,x],g)=>`${g+1}. ${x.name}`).join(`
`),h=await e.showPrompt(l("aiTopicMenu",i,d,r.length));if(h===null)return;const m=parseInt(h)-1;if(isNaN(m)||m<0||m>=r.length){await e.showModal(l("invalidInput"));return}const p=r[m],_=await e.showPrompt(l("difficultyMenu",a[p].name,l("easy"),l("normal"),l("hard")),"2");if(_===null)return;const A=parseInt(_);if(isNaN(A)||A<1||A>3){await e.showModal(l("invalidInput"));return}const v=[l("easy"),l("normal"),l("hard")][A-1],C=await e.showPrompt(l("countMenu",a[p].name,v),"5");if(C===null)return;const w=parseInt(C);if(isNaN(w)||w<1||w>10){await e.showModal(l("invalidInput"));return}let f=null;try{e._generationCancelled=!1,e.isGenerating=!0,e.generatingMessage=l("generating"),e.generatingSubMessage=l("generatingDesc",w),e._needsRender=!0;const b=await this._withTimeout(U.generateProblems(p,A,w,s));if(!e._generationCancelled&&b&&b.length>0){let x=0;for(const S of b){const M={subject:s,question:S.question,answer:S.answer,answers:S.answers||[S.answer],choices:S.choices||[],correctIndex:S.correctIndex||0,explanation:S.explanation||"",topic:S.topic||a[p].name,hp:80+(S.difficulty||A)*20,maxHp:80+(S.difficulty||A)*20,difficulty:S.difficulty||A,isGenerated:!0,createdAt:Date.now(),status:"alive"};M.imageData=ge(M),await e.db.add("monsters",M),x++}await e.monsterManager.loadMonsters();const g=b[0];f=l("generated",x,a[p].name,v,g.question,g.answer)}else e._generationCancelled||(f=l("generateFailed"))}catch(b){f=l("error")+b.message}this._finishAndShowResult(f)}}function Mt(c){const e=c.playerManager.player;e&&c.playerManager.resetHp(),o.drawText(l("title"),200,30,{font:"bold 40px system-ui",color:u.ACCENT_LIGHT,align:"center",stroke:!0}),o.drawText(l("subtitle"),200,78,{font:"15px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.roundRect(20,105,360,130,14,u.BG_CARD),o.roundRect(32,117,76,76,14,"rgba(99,102,241,0.2)"),o.drawText("LV",70,133,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center",stroke:!0});const t=e.level>=100?"MAX":`${e.level}`,n=e.level>=100?"bold 22px system-ui":"bold 30px system-ui",s=e.level>=100?"#fbbf24":u.ACCENT_LIGHT;o.drawText(t,70,162,{font:n,color:s,align:"center",baseline:"middle",stroke:!0}),c.registerClickArea("levelDetail",32,117,76,76,()=>c.showLevelProgress()),o.roundRect(280,114,90,28,8,"rgba(251,191,36,0.15)"),o.drawText(`ğŸ’° ${e.gold.toLocaleString()}G`,325,122,{font:"bold 13px system-ui",color:u.WARNING,align:"center",stroke:!0}),o.drawText("HP",122,158,{font:"bold 11px system-ui",color:u.TEXT_SECONDARY,stroke:!0}),o.drawHPBar(148,155,160,16,e.currentHp,e.maxHp,u.HP_PLAYER),o.drawText(`${Math.round(e.currentHp)}/${e.maxHp}`,314,158,{font:"11px system-ui",color:u.TEXT_PRIMARY,stroke:!0});const i=e.level>=100,a=i?1:c.playerManager.getLevelProgress(),r=i?0:c.playerManager.getExpForLevel(e.level);o.drawText("EXP",122,188,{font:"bold 11px system-ui",color:u.TEXT_SECONDARY,stroke:!0}),o.roundRect(148,185,160,16,8,u.BG_SECONDARY),a>0&&o.roundRect(148,185,Math.max(8,160*a),16,8,i?"#fbbf24":u.ACCENT),o.drawText(i?"MAX":`${e.exp}/${r}`,314,188,{font:"11px system-ui",color:u.TEXT_PRIMARY,stroke:!0});const d=c.playerManager.getTotalDamage(),h=e.inventory||{};o.roundRect(20,250,360,42,12,u.BG_CARD),o.drawText(`âš”ï¸${d}`,80,267,{font:"bold 14px system-ui",color:u.TEXT_PRIMARY,align:"center",stroke:!0}),o.drawText(`ğŸª¶${h.reviveTicket||0}`,200,267,{font:"bold 14px system-ui",color:u.WARNING,align:"center",stroke:!0}),o.drawText(`ğŸ’¡${h.hintTicket||0}`,320,267,{font:"bold 14px system-ui",color:u.WARNING,align:"center",stroke:!0}),o.drawButton(20,310,360,65,l("enterDungeon"),{bgColor:u.ACCENT,fontSize:22,stroke:!0}),c.registerClickArea("dungeon",20,310,360,65,()=>c.changeScreen(R.DUNGEON_SELECT));const m=85,p=55,_=8,A=20,v=530;if(o.drawButton(A,v,m,p,l("stats"),{bgColor:u.BG_CARD,borderColor:"#38bdf8",fontSize:15,stroke:!0}),c.registerClickArea("stats",A,v,m,p,()=>c.changeScreen(R.STATS)),o.drawButton(A+(m+_),v,m,p,l("shop"),{bgColor:u.BG_CARD,borderColor:"#22c55e",fontSize:15,stroke:!0}),c.registerClickArea("shop",A+(m+_),v,m,p,()=>c.changeScreen(R.SHOP)),o.drawButton(A+(m+_)*2,v,m,p,l("achievement"),{bgColor:u.BG_CARD,borderColor:"#fbbf24",fontSize:15,stroke:!0}),c.registerClickArea("achievement",A+(m+_)*2,v,m,p,()=>c.changeScreen(R.ACHIEVEMENT)),o.drawButton(A+(m+_)*3,v,m+3,p,l("settings"),{bgColor:u.BG_CARD,borderColor:u.TEXT_SECONDARY,fontSize:15,stroke:!0}),c.registerClickArea("settings",A+(m+_)*3,v,m+3,p,()=>c.changeScreen(R.SETTINGS)),U.hasApiKey())o.drawButton(20,600,360,48,l("aiGenerate"),{bgColor:"#1d4ed8",borderColor:"#4b8df8",fontSize:16,stroke:!0}),c.registerClickArea("aiGenerate",20,600,360,48,()=>c.showAIGenerateMenu());else{o.roundRect(20,600,360,40,12,u.BG_CARD);const w=q.hasApiKey(),f=l(w?"aiConnected":"aiNotConnected");o.drawText(f,200,615,{font:"13px system-ui",color:w?u.SUCCESS:u.TEXT_SECONDARY,align:"center",stroke:!0})}o.drawText(l("slogan"),200,670,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"})}function Et(c){var fe,ne,we,ae;const e=c.playerManager.player,t=c.currentMonster;if(!t)return;const n=c.effects;o.roundRect(0,0,400,80,0,"rgba(18,18,26,0.85)"),o.drawText("HP",20,20,{font:"12px system-ui",color:u.TEXT_SECONDARY}),o.drawHPBar(50,18,150,18,e.currentHp,e.maxHp,u.HP_PLAYER),o.drawText(`${Math.round(e.currentHp)}/${e.maxHp}`,210,20,{font:"13px system-ui"}),o.roundRect(270,15,50,24,12,u.ACCENT);const s=e.level>=100?"MAX":`LV.${e.level}`,i=e.level>=100?"#fbbf24":"#ffffff";if(o.drawText(s,295,20,{font:"bold 11px system-ui",color:i,align:"center"}),o.drawText(`ğŸ’° ${e.gold}`,340,20,{font:"12px system-ui",color:u.WARNING}),o.drawText(`${l("stage")} ${c.stage}/${P.STAGES_PER_DUNGEON}`,20,52,{font:"14px system-ui"}),(((fe=c.currentRun)==null?void 0:fe.totalAnswers)||0)>=5){const K=Math.round(c.getAccuracyRate()*100),O=K>=80?"#ef4444":K<50?"#22c55e":u.TEXT_SECONDARY,ie=K>=80?"â†‘":K<50?"â†“":"";o.drawText(`${l("accuracyRate")} ${K}%${ie}`,160,52,{font:"12px system-ui",color:O})}c.combo>0&&(o.roundRect(280,45,100,24,12,"rgba(251,191,36,0.2)"),o.drawText(`ğŸ”¥ ${c.combo} COMBO`,330,50,{font:"bold 12px system-ui",color:u.WARNING,align:"center"}));const r=t.bossType;let d="rgba(26,26,36,0.8)",h="rgba(239,68,68,0.1)",m=u.HP_ENEMY,p=t.icon||"ğŸ‘¾",_="50px";if(r==="FINAL_BOSS"?(d="rgba(255,0,0,0.2)",h="rgba(255,215,0,0.3)",m="#ff0000",_="60px"):r==="MID_BOSS"?(d="rgba(128,0,128,0.2)",h="rgba(128,0,128,0.2)",m="#9932cc",_="55px"):r==="NORMAL_BOSS"&&(d="rgba(255,69,0,0.15)",h="rgba(255,69,0,0.2)",m="#ff4500"),o.roundRect(20,90,360,168,20,d),r){const K=.6+Math.sin(n.pulseTime/200)*.4,O=o.ctx;O.save(),O.globalAlpha=K,o.roundRect(20,90,360,168,20,null,m),O.restore()}const v=42*(1+Math.sin(n.pulseTime/500)*.05);o.drawCircle(200,152,v,h);let C=parseInt(_);n.bossEntrance>0&&(C=C*(1+n.bossEntrance*.5)),o.drawText(p,200,133,{font:`${C}px system-ui`,align:"center"}),o.drawText(t.name||l("wrongMonster"),200,205,{font:"bold 16px system-ui",color:r==="FINAL_BOSS"?"#8b0000":r==="MID_BOSS"?"#9932cc":r?"#ff0000":u.TEXT_PRIMARY,align:"center"}),o.drawHPBar(100,228,200,12,t.hp,t.maxHp,m),o.drawText(`HP ${Math.round(t.hp)}/${t.maxHp}`,200,245,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"});const w=272,f=110;o.roundRect(20,w,360,f,20,"rgba(26,26,36,0.85)"),o.roundRect(20,w,360,f,20,null,u.ACCENT),o.roundRect(160,w-12,80,24,12,u.ACCENT),o.drawText("QUESTION",200,w-7,{font:"bold 11px system-ui",align:"center"});const b=de(t.question)||l("loadingQuestion"),x=22,g=5,S=18,M=13,y=[];for(let K=0;K<b.length&&y.length<g;K+=x){let O=b.slice(K,K+x);y.length===g-1&&K+x<b.length&&(O=O.slice(0,-3)+"..."),y.push(O)}const T=y.length*S,I=w+f/2-T/2+S/2;y.forEach((K,O)=>{o.drawText(K,200,I+O*S,{font:`bold ${M}px system-ui`,align:"center"})}),o.drawText("ğŸ“· í„°ì¹˜í•˜ë©´ ì´ë¯¸ì§€ë¡œ ë³´ê¸°",200,w+f-10,{font:"bold 12px system-ui",color:"#60a5fa",align:"center"}),c.registerClickArea("viewQuestion",20,w,360,f,()=>c.battleManager.showFullQuestion());const N=t.choices||["â‘ ","â‘¡","â‘¢","â‘£"],G=175,$=48,k=10,L=8,W=20,J=425;N.forEach((K,O)=>{const ie=O%2,ve=Math.floor(O/2),z=W+ie*(G+k),oe=J+ve*($+L);o.roundRect(z,oe,G,$,12,"rgba(26,26,36,0.85)"),o.roundRect(z,oe,G,$,12,null,"rgba(99,102,241,0.3)"),o.drawText(`${O+1}.`,z+15,oe+$/2-5,{font:"bold 14px system-ui",color:u.ACCENT_LIGHT});const he=String(K),Ge=he.length>12?he.substring(0,12)+"...":he;o.drawText(Ge,z+35,oe+$/2-5,{font:"bold 16px system-ui",color:u.TEXT_PRIMARY}),c.registerClickArea(`choice_${O}`,z,oe,G,$,()=>c.battleManager.selectAnswer(O))});const te=t.difficulty||2,j=c.playerManager.getTotalTime(te);o.drawTimerBar(100,545,200,12,c.timer,j,n.pulseTime);const se=c.timer<10?u.DANGER:c.timer<j*.25?u.WARNING:u.TEXT_PRIMARY;o.drawText(`â±ï¸ ${Math.max(0,Math.ceil(c.timer))}${l("seconds")}`,200,565,{font:"bold 14px system-ui",color:se,align:"center"});const Q=c.itemManager.droppedItem;Q&&(o.roundRect(50,130,300,50,12,Q.rarity.color),o.drawText(`${Q.icon} ${Q.name} ${l("obtained")}`,200,145,{font:"bold 16px system-ui",color:"#000",align:"center"}),o.drawText(`[${l(Q.rarity.nameKey)}]`,200,165,{font:"12px system-ui",color:"#333",align:"center"})),o.roundRect(0,600,400,100,0,"rgba(18,18,26,0.85)"),o.drawButton(8,620,50,46,"ğŸ“·",{bgColor:"rgba(59,130,246,0.2)",borderColor:"rgba(59,130,246,0.6)",textColor:"#60a5fa",fontSize:18}),c.registerClickArea("viewImage",8,620,50,46,()=>c.battleManager.showFullQuestion());const be=((ne=e.inventory)==null?void 0:ne.hintTicket)||0,pe=be>0;o.drawButton(64,620,78,46,`ğŸ’¡${be}`,{bgColor:pe?"rgba(251,191,36,0.2)":"rgba(100,100,100,0.15)",borderColor:pe?"rgba(251,191,36,0.6)":"rgba(100,100,100,0.3)",textColor:pe?u.WARNING:u.TEXT_SECONDARY,fontSize:14}),c.registerClickArea("hint",64,620,78,46,()=>c.battleManager.useHint());const ue=(((we=e.inventory)==null?void 0:we.timeBoost)||0)>0;o.drawButton(148,620,78,46,`â°${((ae=e.inventory)==null?void 0:ae.timeBoost)||0}`,{bgColor:ue?"rgba(34,197,94,0.2)":"rgba(100,100,100,0.15)",borderColor:ue?"rgba(34,197,94,0.6)":"rgba(100,100,100,0.3)",textColor:ue?u.SUCCESS:u.TEXT_SECONDARY,fontSize:14}),c.registerClickArea("timeBoost",148,620,78,46,()=>c.battleManager.useTimeBoost()),o.drawButton(232,620,78,46,l("skip"),{bgColor:"rgba(239,68,68,0.15)",borderColor:"rgba(239,68,68,0.5)",textColor:u.DANGER,fontSize:14}),c.registerClickArea("skip",232,620,78,46,()=>c.battleManager.skipQuestion()),o.drawButton(316,620,78,46,l("quit"),{bgColor:"rgba(99,102,241,0.15)",borderColor:"rgba(99,102,241,0.5)",textColor:u.ACCENT_LIGHT,fontSize:14}),c.registerClickArea("quit",316,620,78,46,()=>c.endRun(!1))}function Rt(c){var N,G;const e=((N=c.currentRun)==null?void 0:N.result)==="clear",t=l(e?"cleared":"failed"),n=e?u.SUCCESS:u.DANGER,s=c.currentRun,i=o.ctx,a=(s==null?void 0:s.correctBySubject)||{},r=(s==null?void 0:s.wrongBySubject)||{},d=new Set([...Object.keys(a),...Object.keys(r)]),h=(s==null?void 0:s.wrongByTopic)||{},m=(s==null?void 0:s.correctByTopic)||{},p=new Set([...Object.keys(h),...Object.keys(m)]),_=(s==null?void 0:s.wrongByDifficulty)||{},A=Object.keys(_).length>0;let v=200;v+=80,d.size>0&&(v+=25+d.size*20),p.size>0&&(v+=35+Math.min(p.size,5)*18),A&&(v+=35+Object.keys(_).length*18);const C=90+v+65;c.scrollMaxY=Math.max(0,C-P.CANVAS_HEIGHT);const w=c.scrollY||0;o.drawText(t,200,55-w,{font:"bold 28px system-ui",color:n,align:"center"}),o.roundRect(25,90-w,350,v,16,"rgba(26,26,36,0.85)");let f=115-w;o.drawText(`${l("stageLabel")}: ${c.stage}/${P.STAGES_PER_DUNGEON}`,200,f,{font:"14px system-ui",align:"center"}),f+=28,o.drawText(`${l("defeatedMonsters")}: ${((G=s==null?void 0:s.defeatedMonsters)==null?void 0:G.length)||0}`,200,f,{font:"14px system-ui",align:"center"}),f+=28,o.drawText(`${l("bestCombo")}: ${(s==null?void 0:s.bestCombo)||0}`,200,f,{font:"14px system-ui",align:"center"}),f+=28;const b=(s==null?void 0:s.correctAnswers)||0,x=(s==null?void 0:s.totalAnswers)||0,g=x>0?Math.round(b/x*100):0;o.drawText(`${l("accuracyLabel")}: ${g}% (${b}/${x})`,200,f,{font:"14px system-ui",align:"center"}),f+=28,o.drawText(`${l("earnedGold")}: +${(s==null?void 0:s.earnedGold)||0}G`,200,f,{font:"bold 16px system-ui",color:u.WARNING,align:"center"}),f+=22,Se(i,50,f,300),f+=15,o.drawText(l("result_itemUsage"),200,f,{font:"bold 12px system-ui",color:u.ACCENT_LIGHT,align:"center"}),f+=20;const S=(s==null?void 0:s.skipCount)||0,M=(s==null?void 0:s.hintCount)||0,y=(s==null?void 0:s.timeBoostCount)||0,T=(s==null?void 0:s.reviveCount)||0,E=(s==null?void 0:s.timeoutCount)||0;if(o.drawText(`â­ï¸${S}`,65,f,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`ğŸ’¡${M}`,135,f,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`â°${y}`,205,f,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`ğŸª¶${T}`,275,f,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`â±ï¸${E}`,340,f,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"}),f+=20,d.size>0){Se(i,50,f,300),f+=15;const $={math:Y.MATH,english:Y.ENGLISH,korean:Y.KOREAN,science:Y.SCIENCE};for(const k of d){const L=$[k],W=(L==null?void 0:L.icon)||"ğŸ“",J=l((L==null?void 0:L.nameKey)||k),te=a[k]||0,j=r[k]||0;o.drawText(`${W}${J}`,55,f,{font:"11px system-ui",color:u.TEXT_PRIMARY}),o.drawText(`âœ…${te}`,220,f,{font:"11px system-ui",color:u.SUCCESS,align:"center"}),o.drawText(`âŒ${j}`,290,f,{font:"11px system-ui",color:u.DANGER,align:"center"});const se=te+j;if(se>0){const Q=Math.round(te/se*100);o.drawText(`${Q}%`,345,f,{font:"bold 11px system-ui",color:Q>=70?u.SUCCESS:u.WARNING,align:"right"})}f+=20}}if(p.size>0){Se(i,50,f,300),f+=15,o.drawText(l("stats_topicAnalysis"),200,f,{font:"bold 11px system-ui",color:u.ACCENT_LIGHT,align:"center"}),f+=16;const $=[...p].map(k=>({topic:k,correct:m[k]||0,wrong:h[k]||0})).sort((k,L)=>L.wrong-k.wrong).slice(0,5);for(const k of $){const L=k.topic.length>8?k.topic.substring(0,8)+"..":k.topic;o.drawText(L,55,f,{font:"10px system-ui",color:u.TEXT_PRIMARY}),o.drawText(`âœ…${k.correct}`,210,f,{font:"10px system-ui",color:u.SUCCESS,align:"center"}),o.drawText(`âŒ${k.wrong}`,270,f,{font:"10px system-ui",color:u.DANGER,align:"center"});const W=k.correct+k.wrong,J=W>0?Math.round(k.wrong/W*100):0;o.drawText(`${l("stats_wrongRate")}${J}%`,345,f,{font:"bold 10px system-ui",color:J>=50?u.DANGER:u.TEXT_SECONDARY,align:"right"}),f+=18}}if(A){Se(i,50,f,300),f+=15,o.drawText(l("stats_diffWrong"),200,f,{font:"bold 11px system-ui",color:u.ACCENT_LIGHT,align:"center"}),f+=16;const $={1:l("easy"),2:l("normal"),3:l("hard")},k={1:u.SUCCESS,2:u.WARNING,3:u.DANGER};for(const[L,W]of Object.entries(_).sort((J,te)=>Number(te[0])-Number(J[0])))o.drawText(`${$[L]||L}`,100,f,{font:"11px system-ui",color:k[L]||u.TEXT_SECONDARY,align:"center"}),o.drawText(`âŒ ${W}`,250,f,{font:"bold 11px system-ui",color:u.DANGER,align:"center"}),f+=18}const I=90+v+15-w;o.drawButton(100,I,200,50,l("toMain"),{bgColor:u.ACCENT}),c.registerClickArea("toMain",100,I,200,50,()=>{c.changeScreen(R.MAIN)})}function Se(c,e,t,n){c.save(),c.strokeStyle="rgba(255,255,255,0.08)",c.lineWidth=1,c.beginPath(),c.moveTo(e,t),c.lineTo(e+n,t),c.stroke(),c.restore()}let le=0;const Be=[{labelKey:"shopTabUpgrade",icon:"âš¡"},{labelKey:"shopTabConsume",icon:"ğŸ’"},{labelKey:"shopTabCosmetic",icon:"ğŸ¨"}],It=["reviveTicket","hintTicket","timeBoost","doubleGold"];function kt(c,e){var a,r;const t=c.playerManager,n=t.player,s=X[e];if((((a=n.permanentUpgrades)==null?void 0:a[e])||0)>=s.maxLevel)return null;switch(e){case"hp":{const d=t.getTotalMaxHp(),h=d+s.value;return{current:d,next:h,label:l("shopHp")}}case"damage":{const d=t.getTotalDamage(),h=d+s.value;return{current:d,next:h,label:l("shopAtk")}}case"time":{const d=t.getTotalTime(),h=d+s.value;return{current:d,next:h,label:l("shopTime")}}case"goldBonus":{const d=(((r=n.permanentUpgrades)==null?void 0:r.goldBonus)||0)*s.value,h=d+s.value;return{current:d+"%",next:h+"%",label:l("shopGoldBonus")}}default:return null}}function Bt(c){const e=c.playerManager.player,t=c.shopManager,n=400,s=700;o.roundRect(0,0,n,50,0,u.BG_SECONDARY),o.drawText(l("shopTitle"),n/2,16,{font:"bold 20px system-ui",align:"center"}),o.drawText(l("back"),30,18,{font:"15px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",0,0,90,50,()=>c.changeScreen(R.MAIN)),o.roundRect(275,10,115,32,10,"rgba(251,191,36,0.15)"),o.drawText(`ğŸ’° ${e.gold.toLocaleString()}G`,332,18,{font:"bold 15px system-ui",color:u.WARNING,align:"center"});const i=50,a=36,r=Math.floor(n/Be.length);Be.forEach((h,m)=>{const p=m*r,_=m===le;o.roundRect(p,i,r,a,0,_?u.ACCENT:u.BG_CARD),_&&o.roundRect(p+10,i+a-3,r-20,3,1.5,u.ACCENT_LIGHT);const A=`${h.icon} ${l(h.labelKey)}`;o.drawText(A,p+r/2,i+8,{font:`${_?"bold ":""}12px system-ui`,color:_?"#fff":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`shop_tab_${m}`,p,i,r,a,()=>{le!==m&&(le=m,c.scrollY=0,c.scrollMaxY=0,c.effects.flashScreen(u.ACCENT,.05))})});const d=i+a+12;switch(le){case 0:Gt(c,e,t,d,n,s);break;case 1:Dt(c,e,t,d,n,s);break;case 2:Nt(c,e,t,d,n,s);break}}function Pt(c,e,t,n,s,i,a,r){const d=-Math.PI/2;if(c.beginPath(),c.arc(e,t,n,0,Math.PI*2),c.strokeStyle=r,c.lineWidth=s,c.lineCap="round",c.stroke(),i>0){const h=d+Math.PI*2*i;c.beginPath(),c.arc(e,t,n,d,h),c.strokeStyle=a,c.lineWidth=s,c.lineCap="round",c.stroke()}}function Gt(c,e,t,n,s,i){var f,b;const a=Object.entries(X),r=100;let d=n;const h=o.ctx,m=c.playerManager,p=60,_=10,A=s-20;o.drawGradientCard(_,d,A,p,10,"rgba(99,102,241,0.12)","rgba(99,102,241,0.04)"),h.save(),h.strokeStyle="rgba(99,102,241,0.3)",h.lineWidth=1,h.beginPath(),h.roundRect(_,d,A,p,10),h.stroke(),h.restore(),o.drawText(l("shopStatSummary"),_+12,d+8,{font:"bold 11px system-ui",color:u.ACCENT_LIGHT});const v=[{label:l("shopHp"),value:m.getTotalMaxHp(),color:"#22c55e"},{label:l("shopAtk"),value:m.getTotalDamage(),color:"#ef4444"},{label:l("shopTime"),value:m.getTotalTime(),color:"#3b82f6"},{label:l("shopGoldBonus"),value:(((f=e.permanentUpgrades)==null?void 0:f.goldBonus)||0)*((b=X.goldBonus)==null?void 0:b.value)+"%",color:"#fbbf24"}],C=A/4;v.forEach((x,g)=>{const S=_+C*g+C/2;o.drawText(x.label,S,d+26,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(String(x.value),S,d+40,{font:"bold 14px system-ui",color:x.color,align:"center"})}),d+=p+10;const w={hp:{main:"#22c55e",glow:"rgba(34,197,94,0.25)",bg:"rgba(34,197,94,0.08)"},damage:{main:"#ef4444",glow:"rgba(239,68,68,0.25)",bg:"rgba(239,68,68,0.08)"},time:{main:"#3b82f6",glow:"rgba(59,130,246,0.25)",bg:"rgba(59,130,246,0.08)"},goldBonus:{main:"#fbbf24",glow:"rgba(251,191,36,0.25)",bg:"rgba(251,191,36,0.08)"}};a.forEach(([x,g])=>{var ve;const S=((ve=e.permanentUpgrades)==null?void 0:ve[x])||0,M=S>=g.maxLevel,y=t.getUpgradePrice(x),T=e.gold>=y&&!M,E=w[x]||w.hp,I=S/g.maxLevel,N=Math.round(I*100),G=r-6;o.drawGradientCard(10,d,s-20,G,12,"#1e1e2e","#16161f");const $=M?"#22c55e":T?E.main:"rgba(255,255,255,0.1)";o.roundRect(10,d+6,3,G-12,1.5,$),!T&&!M&&o.roundRect(10,d,s-20,G,12,"rgba(0,0,0,0.3)");const k=48,L=d+G/2,W=26,J=5;h.save(),h.shadowColor=M?"rgba(34,197,94,0.5)":E.glow,h.shadowBlur=10,o.drawCircle(k,L,W-4,"rgba(0,0,0,0.01)"),h.restore(),o.drawCircle(k,L,W-4,M?"rgba(34,197,94,0.1)":E.bg),h.save();const te=M?"#22c55e":E.main;Pt(h,k,L,W,J,I,te,"rgba(255,255,255,0.08)"),h.restore(),o.drawText(g.icon,k,L-14,{font:"20px system-ui",align:"center"}),M?o.drawText("MAX",k,L+6,{font:"bold 11px system-ui",color:"#22c55e",align:"center"}):o.drawText(`${N}%`,k,L+6,{font:"bold 11px system-ui",color:E.main,align:"center"});const j=84,se=d+12;o.drawText(l(g.nameKey),j,se,{font:"bold 14px system-ui",color:u.TEXT_PRIMARY});const Q=M?l("shopMaxReached"):`Lv.${S}/${g.maxLevel}`,be=M?"#22c55e":E.main,pe=M?"rgba(34,197,94,0.15)":E.glow,ue=h.measureText(l(g.nameKey)).width,fe=h.measureText(Q).width+12;o.roundRect(j+ue+6,se-3,fe,18,9,pe),o.drawText(Q,j+ue+6+fe/2,se,{font:"bold 10px system-ui",color:be,align:"center"});const ne=kt(c,x);if(ne){const z=se+20;o.drawText(`${ne.label}: `,j,z,{font:"12px system-ui",color:u.TEXT_SECONDARY});const oe=h.measureText(`${ne.label}: `).width;o.drawText(String(ne.current),j+oe,z,{font:"bold 12px system-ui",color:"#fff"});const he=h.measureText(String(ne.current)).width;o.drawText(" â†’ ",j+oe+he,z,{font:"12px system-ui",color:u.TEXT_SECONDARY});const Ge=h.measureText(" â†’ ").width;o.drawText(String(ne.next),j+oe+he+Ge,z,{font:"bold 12px system-ui",color:"#4ade80"})}const we=d+G-16;o.drawText(l(g.descKey),j,we,{font:"11px system-ui",color:u.TEXT_SECONDARY});const ae=80,K=32,O=s-10-ae-8,ie=d+Math.round((G-K)/2);if(M)o.drawGradientCard(O,ie,ae,K,8,"#22c55e","#16a34a"),o.drawText(l("shopMaxReached"),O+ae/2,ie+9,{font:"bold 13px system-ui",color:"#000",align:"center"});else{const z=T?u.WARNING:u.BG_SECONDARY;o.roundRect(O,ie,ae,K,8,z),o.drawText(`${y}G`,O+ae/2,ie+9,{font:"bold 13px system-ui",color:T?"#000":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`upgrade_${x}`,O,ie,ae,K,()=>t.buyUpgrade(x))}d+=r}),d+=20,c.scrollMaxY=Math.max(0,d-i)}function Dt(c,e,t,n,s,i){let r=n;It.forEach(d=>{var $;const h=Ie[d];if(!h)return;const m=(($=e.inventory)==null?void 0:$[d])||0,p=e.gold>=h.price,_=e.gold>=h.price*5,A=99;o.drawGradientCard(10,r,s-20,A,12,"#1e1e2e","#16161f"),p&&o.roundRect(10,r+6,3,A-12,1.5,u.ACCENT),p||o.roundRect(10,r,s-20,A,12,"rgba(0,0,0,0.35)");const v=42,C=r+A/2-5;o.roundRect(v-18,C-18,36,36,18,"rgba(99,102,241,0.15)"),o.drawText(h.icon,v,C-10,{font:"22px system-ui",align:"center"});const w=r+14;o.drawText(l(h.nameKey),72,w,{font:"bold 15px system-ui",color:u.TEXT_PRIMARY}),m>0?(o.roundRect(175,w-4,44,22,11,"rgba(99,102,241,0.25)"),o.drawText(`Ã—${m}`,197,w,{font:"bold 12px system-ui",color:u.ACCENT_LIGHT,align:"center"})):o.drawText("Ã—0",197,w,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"});const f=w+20;if(o.drawText(l(h.descKey),72,f,{font:"12px system-ui",color:u.TEXT_SECONDARY}),h.hintKey){const k=f+16;o.drawText(`ğŸ’¡ ${l(h.hintKey)}`,72,k,{font:"11px system-ui",color:"rgba(251,191,36,0.7)"})}const b=88,x=28,g=s-10-b-8,S=r+14,M=p?u.WARNING:u.BG_SECONDARY;o.roundRect(g,S,b,x,8,M),o.drawText(`${h.price}G`,g+b/2,S+7,{font:"bold 13px system-ui",color:p?"#000":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`buy_${d}`,g,S,b,x,()=>t.buyItem(d));const y=88,T=26,E=g,I=S+x+6,N=h.price*5,G=_?"rgba(251,191,36,0.7)":u.BG_SECONDARY;o.roundRect(E,I,y,T,6,G),o.drawText(`Ã—5 ${N}G`,E+y/2,I+6,{font:"bold 11px system-ui",color:_?"#000":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`bulkbuy_${d}`,E,I-7,y,40,()=>t.buyItemBulk(d,5)),r+=105}),r+=20,c.scrollMaxY=Math.max(0,r-i)}function Nt(c,e,t,n,s,i){let a=n;const r=e.cosmetics||{},d=10,h=s-20,m=50;o.drawGradientCard(d,a,h,m,10,"rgba(99,102,241,0.12)","rgba(99,102,241,0.04)"),o.ctx.save(),o.ctx.strokeStyle="rgba(99,102,241,0.3)",o.ctx.lineWidth=1,o.ctx.beginPath(),o.ctx.roundRect(d,a,h,m,10),o.ctx.stroke(),o.ctx.restore();const p=o.getCurrentBgThemeId(),_=re.find(f=>f.id===p)||re[0];o.drawText(l("shopCurrentTheme"),d+12,a+10,{font:"bold 11px system-ui",color:u.ACCENT_LIGHT}),o.drawCircle(d+12+o.ctx.measureText(l("shopCurrentTheme")).width+16,a+17,7,_.grid),o.drawText(l("theme_"+p),d+12,a+30,{font:"bold 14px system-ui",color:u.TEXT_PRIMARY}),a+=m+10;const A=60;o.drawGradientCard(10,a,h,A,10,"#1e1e2e","#16161f"),o.drawText(l("cosmetic_themes"),22,a+8,{font:"bold 11px system-ui",color:u.ACCENT_LIGHT});const v=r.purchasedThemes||["default"],C=re.length,w=h/(C+1);re.forEach((f,b)=>{const x=10+w*(b+1),g=a+36,S=f.id===p,M=v.includes(f.id),y=S?14:12;S&&o.drawCircle(x,g,y+3,null,"#fff"),o.drawCircle(x,g,y,f.grid),S?o.drawText("âœ“",x,g-7,{font:"bold 12px system-ui",color:"#fff",align:"center"}):M||(o.ctx.save(),o.ctx.globalAlpha=.6,o.ctx.fillStyle="rgba(0,0,0,0.5)",o.ctx.beginPath(),o.ctx.arc(x,g,y,0,Math.PI*2),o.ctx.fill(),o.ctx.restore(),o.drawText("ğŸ”’",x,g-8,{font:"10px system-ui",align:"center"})),c.registerClickArea(`theme_${f.id}`,x-16,g-16,32,32,()=>{M?t.equipCosmetic("theme",f.id):t.buyCosmetic("theme",f.id)})}),a+=A+10,a=Lt(c,e,t,a,s),a=De(c,e,t,a,s,"particle",r),a=De(c,e,t,a,s,"damageText",r),a=De(c,e,t,a,s,"correctFlash",r),a+=20,c.scrollMaxY=Math.max(0,a-i)}function Lt(c,e,t,n,s){const i=Ie.randomBg,a=e.gold>=i.price,r=70,d=r-6;o.drawGradientCard(10,n,s-20,d,12,"#1e1e2e","#16161f"),a?o.roundRect(10,n+6,3,d-12,1.5,u.ACCENT):o.roundRect(10,n,s-20,d,12,"rgba(0,0,0,0.35)");const h=42,m=n+d/2;o.roundRect(h-18,m-18,36,36,18,"rgba(99,102,241,0.15)"),o.drawText(i.icon,h,m-10,{font:"22px system-ui",align:"center"}),o.drawText(l(i.nameKey),72,n+Math.round(d*.35),{font:"bold 14px system-ui",color:u.TEXT_PRIMARY});const p=72,_=28,A=s-10-p-8,v=n+Math.round((d-_)/2);return o.roundRect(A,v,p,_,8,a?u.WARNING:u.BG_SECONDARY),o.drawText(`${i.price}G`,A+p/2,v+7,{font:"bold 13px system-ui",color:a?"#000":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea("buy_randomBg",A,v,p,_,()=>t.buyItem("randomBg")),n+r}function De(c,e,t,n,s,i,a){const r=ke[i];if(!r)return n;const d=s-20;o.drawText(`${r.icon} ${l(r.nameKey)}`,22,n+2,{font:"bold 13px system-ui",color:u.ACCENT_LIGHT}),n+=22;const h=i==="particle"?"purchasedParticles":i==="damageText"?"purchasedDamageText":"purchasedFlash",m=i==="particle"?"particleStyle":i==="damageText"?"damageTextStyle":"correctFlash",p=a[h]||["default"],_=a[m]||"default",A=56;return r.items.forEach(v=>{const C=v.price===0||p.includes(v.id),w=v.id===_,f=e.gold>=v.price,b=A-4;o.drawGradientCard(10,n,d,b,10,"#1e1e2e","#16161f"),w&&o.roundRect(10,n+4,3,b-8,1.5,"#a855f7"),!C&&!f&&o.roundRect(10,n,d,b,10,"rgba(0,0,0,0.3)");const x=36,g=n+b/2;if(o.roundRect(x-14,g-14,28,28,14,w?"rgba(168,85,247,0.25)":"rgba(99,102,241,0.12)"),i==="particle"&&v.colors){const E=v.colors;for(let I=0;I<Math.min(3,E.length);I++)o.drawCircle(x-6+I*6,g,3,E[I])}else if(i==="correctFlash"&&v.color)o.drawCircle(x,g,10,v.color);else if(i==="damageText"){const E=v.color||"#fbbf24";o.drawText("-99",x,g-8,{font:`bold ${v.fontScale?"13":"10"}px system-ui`,color:E,align:"center"})}else o.drawText(r.icon,x,g-8,{font:"14px system-ui",align:"center"});if(o.drawText(l(v.nameKey),60,n+10,{font:`${w?"bold ":""}13px system-ui`,color:w?"#e2e8f0":u.TEXT_SECONDARY}),w){const E=60+o.ctx.measureText(l(v.nameKey)).width+6;o.roundRect(E,n+6,36,16,8,"rgba(168,85,247,0.3)"),o.drawText(l("cosmetic_equipped"),E+18,n+8,{font:"bold 9px system-ui",color:"#c084fc",align:"center"})}const S=72,M=26,y=s-10-S-8,T=n+Math.round((b-M)/2);if(w)o.roundRect(y,T,S,M,8,"rgba(168,85,247,0.2)"),o.drawText(l("cosmetic_equipped"),y+S/2,T+6,{font:"bold 11px system-ui",color:"#c084fc",align:"center"});else if(C)o.roundRect(y,T,S,M,8,u.ACCENT),o.drawText(l("cosmetic_equip"),y+S/2,T+6,{font:"bold 11px system-ui",color:"#fff",align:"center"}),c.registerClickArea(`equip_${i}_${v.id}`,y,T,S,M,()=>{t.equipCosmetic(i,v.id)});else{const E=f?u.WARNING:u.BG_SECONDARY;o.roundRect(y,T,S,M,8,E),o.drawText(`${v.price}G`,y+S/2,T+6,{font:"bold 12px system-ui",color:f?"#000":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`buy_${i}_${v.id}`,y,T,S,M,()=>{t.buyCosmetic(i,v.id)})}n+=A}),n+=6,n}function Ht(c){const t=c.playerManager.player;o.roundRect(0,0,400,86,0,u.BG_SECONDARY),o.drawText(l("shopTitle"),400/2,16,{font:"bold 20px system-ui",align:"center"}),o.drawText(l("back"),30,18,{font:"15px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",0,0,90,50,()=>c.changeScreen(R.MAIN)),o.roundRect(275,10,115,32,10,"rgba(251,191,36,0.15)"),o.drawText(`ğŸ’° ${t.gold.toLocaleString()}G`,332,18,{font:"bold 15px system-ui",color:u.WARNING,align:"center"});const n=50,s=36,i=Math.floor(400/Be.length);Be.forEach((a,r)=>{const d=r*i,h=r===le;o.roundRect(d,n,i,s,0,h?u.ACCENT:u.BG_CARD),h&&o.roundRect(d+10,n+s-3,i-20,3,1.5,u.ACCENT_LIGHT);const m=`${a.icon} ${l(a.labelKey)}`;o.drawText(m,d+i/2,n+8,{font:`${h?"bold ":""}12px system-ui`,color:h?"#fff":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`shop_tab_${r}`,d,n,i,s,()=>{le!==r&&(le=r,c.scrollY=0,c.scrollMaxY=0,c.effects.flashScreen(u.ACCENT,.05))})})}let Le=0;const Fe=[{labelKey:"settingsTabGame",icon:"ğŸ®"},{labelKey:"settingsTabApi",icon:"ğŸ”‘"},{labelKey:"settingsTabData",icon:"ğŸ“¦"}];function $t(c){o.roundRect(0,0,400,96,0,u.BG_SECONDARY),o.drawText(l("settingsTitle"),200,18,{font:"bold 18px system-ui",align:"center"}),o.drawText(l("back"),30,20,{font:"14px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",10,10,80,35,()=>c.changeScreen(R.MAIN));const e=55,t=36,n=Math.floor(400/Fe.length);Fe.forEach((s,i)=>{const a=i*n,r=i===Le;o.roundRect(a,e,n,t,0,r?u.ACCENT:u.BG_CARD),r&&o.roundRect(a+10,e+t-3,n-20,3,1.5,u.ACCENT_LIGHT);const d=`${s.icon} ${l(s.labelKey)}`;o.drawText(d,a+n/2,e+8,{font:`${r?"bold ":""}12px system-ui`,color:r?"#fff":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`tab_${i}`,a,e,n,t,()=>{Le=i,c.scrollY=0,c.scrollMaxY=0})})}function Ot(c){c.registerClickArea("back",10,10,80,35,()=>c.changeScreen(R.MAIN));const e=106;switch(Le){case 0:Kt(c,e);break;case 1:qt(c,e);break;case 2:Yt(c,e);break}}function Kt(c,e){let t=e;o.roundRect(20,t,360,90,16,u.BG_CARD),o.drawText(l("soundSettings"),200,t+20,{font:"bold 14px system-ui",align:"center"});const n=D.bgmEnabled,s=D.sfxEnabled;o.drawButton(35,t+40,155,38,l(n?"bgmOn":"bgmOff"),{bgColor:n?"rgba(99,102,241,0.2)":u.BG_SECONDARY,borderColor:n?u.ACCENT:u.TEXT_SECONDARY,fontSize:13}),c.registerClickArea("toggleBgm",35,t+40,155,38,()=>{D.toggleBgm()}),o.drawButton(210,t+40,155,38,l(s?"sfxOn":"sfxOff"),{bgColor:s?"rgba(34,197,94,0.15)":u.BG_SECONDARY,borderColor:s?u.SUCCESS:u.TEXT_SECONDARY,fontSize:13}),c.registerClickArea("toggleSfx",210,t+40,155,38,()=>{D.toggleSfx()}),t+=105,o.roundRect(20,t,360,90,16,u.BG_CARD),o.drawText(l("langSettings"),200,t+20,{font:"bold 14px system-ui",align:"center"});const i=[{code:"ko",label:"í•œêµ­ì–´"},{code:"en",label:"English"},{code:"ja",label:"æ—¥æœ¬èª"},{code:"zh",label:"ä¸­æ–‡"}],a=ht(),r=80,d=22;i.forEach((f,b)=>{const x=d+b*(r+6),g=a===f.code;o.drawButton(x,t+42,r,36,f.label,{bgColor:g?u.ACCENT:u.BG_SECONDARY,borderColor:g?u.ACCENT_LIGHT:u.TEXT_SECONDARY,fontSize:12}),c.registerClickArea(`lang_${f.code}`,x,t+42,r,36,()=>{ut(f.code)})}),t+=105,o.roundRect(20,t,360,90,16,u.BG_CARD),o.drawText(l("uiOpacityTitle"),200,t+20,{font:"bold 14px system-ui",align:"center"});const h=o.getUiOpacity(),m=Math.round(h*100),p=50,_=t+48,A=230,v=12;o.roundRect(p,_,A,v,6,u.BG_SECONDARY);const C=A*((h-.1)/.9);C>0&&o.roundRect(p,_,Math.max(6,C),v,6,u.ACCENT);const w=p+C-8;o.roundRect(Math.max(p-4,w),_-4,16,20,8,u.ACCENT_LIGHT),o.drawText(`${m}%`,p+A+15,_-2,{font:"bold 14px system-ui",color:u.TEXT_PRIMARY}),c.registerDragArea("opacitySlider",p-10,_-15,A+20,40,f=>{const b=Math.max(0,Math.min(1,(f-p)/A));o.setUiOpacity(.1+b*.9)}),o.drawButton(310,t+40,30,30,"-",{bgColor:u.BG_SECONDARY,borderColor:u.TEXT_SECONDARY,fontSize:16}),c.registerClickArea("opacityDown",310,t+40,30,30,()=>{o.setUiOpacity(h-.1)}),o.drawButton(345,t+40,30,30,"+",{bgColor:u.BG_SECONDARY,borderColor:u.TEXT_SECONDARY,fontSize:16}),c.registerClickArea("opacityUp",345,t+40,30,30,()=>{o.setUiOpacity(h+.1)}),t+=105,c.scrollMaxY=Math.max(0,t-700)}function qt(c,e){let t=e;o.roundRect(20,t,360,110,16,u.BG_CARD),o.drawText(l("smilePrintApi"),200,t+20,{font:"bold 14px system-ui",align:"center"});const n=ye.hasApiKey();o.drawText(l(n?"configured":"notConfigured"),200,t+42,{font:"12px system-ui",color:n?u.SUCCESS:u.DANGER,align:"center"}),o.drawButton(50,t+62,300,38,l("inputSmilePrintKey"),{bgColor:u.ACCENT,fontSize:14}),c.registerClickArea("setSmilePrintKey",50,t+62,300,38,()=>c.promptSmilePrintApiKey()),t+=120,o.roundRect(20,t,360,110,16,u.BG_CARD),o.drawText(l("geminiApi"),200,t+20,{font:"bold 14px system-ui",align:"center"});const s=q.hasApiKey();o.drawText(l(s?"configured":"notConfigured"),200,t+42,{font:"12px system-ui",color:s?u.SUCCESS:u.DANGER,align:"center"}),o.drawButton(50,t+62,145,38,l("geminiKey"),{bgColor:u.BG_SECONDARY,borderColor:u.ACCENT,fontSize:12}),c.registerClickArea("setApiKey",50,t+62,145,38,()=>c.promptApiKey()),o.drawButton(205,t+62,145,38,l("testGenerate"),{bgColor:u.BG_SECONDARY,borderColor:u.WARNING,fontSize:12}),c.registerClickArea("testAI",205,t+62,145,38,()=>c.testAIGeneration()),t+=120,o.roundRect(20,t,360,145,16,u.BG_CARD),o.drawText(l("apiGuide"),200,t+20,{font:"bold 14px system-ui",align:"center"}),[l("smilePrintSection"),l("requestAdmin"),"",l("geminiSection"),l("visitAiStudio"),l("createApiKey")].forEach((a,r)=>{const d=a.startsWith("[");o.drawText(a,200,t+42+r*17,{font:d?"bold 11px system-ui":"11px system-ui",color:d?u.TEXT_PRIMARY:u.TEXT_SECONDARY,align:"center"})}),t+=155,o.roundRect(20,t,360,80,16,u.BG_CARD),o.drawText(l("aiFeatures"),200,t+18,{font:"bold 12px system-ui",align:"center"}),[l("aiFeature1"),l("aiFeature2"),l("aiFeature3")].forEach((a,r)=>{o.drawText(a,200,t+38+r*15,{font:"11px system-ui",color:u.TEXT_SECONDARY,align:"center"})}),t+=90,c.scrollMaxY=Math.max(0,t-700)}function Yt(c,e){let t=e;o.roundRect(20,t,360,130,16,u.BG_CARD),o.drawText(`${l("dataManage")} (${l("problemCount",c.monsterManager.monsters.length)})`,200,t+25,{font:"bold 14px system-ui",align:"center"}),o.drawButton(35,t+45,155,35,l("export"),{bgColor:u.SUCCESS,fontSize:13}),c.registerClickArea("exportProblems",35,t+45,155,35,()=>c.exportProblems()),o.drawButton(210,t+45,155,35,l("import"),{bgColor:u.ACCENT,fontSize:13}),c.registerClickArea("importProblems",210,t+45,155,35,()=>c.importProblems()),o.drawButton(35,t+90,330,35,l("resetAll"),{bgColor:u.DANGER,fontSize:13}),c.registerClickArea("resetProblems",35,t+90,330,35,()=>c.resetAllProblems()),t+=145,o.roundRect(20,t,360,60,16,u.BG_CARD),o.drawButton(35,t+10,330,40,l("viewGuide"),{bgColor:u.ACCENT,fontSize:14}),c.registerClickArea("viewGuide",35,t+10,330,40,()=>c.showGuide()),t+=75,o.roundRect(20,t,360,80,16,u.BG_CARD),o.drawText(l("resetAccount"),200,t+22,{font:"bold 14px system-ui",align:"center"}),o.drawButton(35,t+40,330,35,l("resetAccount"),{bgColor:u.DANGER,fontSize:13}),c.registerClickArea("resetAccount",35,t+40,330,35,()=>c.resetAccount()),t+=95,c.scrollMaxY=Math.max(0,t-700)}function jt(c){if(o.roundRect(0,0,400,60,0,u.BG_SECONDARY),o.drawText(l("subjectSelect"),200,20,{font:"bold 18px system-ui",align:"center"}),o.drawText(l("cancel"),30,22,{font:"14px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",10,10,80,40,()=>{c.pendingImage=null,c.changeScreen(R.MAIN)}),c.pendingImage&&!c.previewImageLoaded&&!c._previewImageLoading&&(c._previewImageLoading=!0,c.previewImg=new Image,c.previewImg.onload=()=>{c.previewImageLoaded=!0,c._previewImageLoading=!1},c.previewImg.onerror=()=>{c._previewImageLoading=!1},c.previewImg.src=c.pendingImage),o.roundRect(50,80,300,200,16,u.BG_CARD),c.previewImg&&c.previewImg.complete){const a=Math.min(280/c.previewImg.width,180/c.previewImg.height),r=c.previewImg.width*a,d=c.previewImg.height*a,h=50+(300-r)/2,m=80+(200-d)/2;o.drawImage(c.previewImg,h,m,r,d)}else o.drawText(l("capturedPhoto"),200,170,{font:"16px system-ui",color:u.TEXT_SECONDARY,align:"center"});o.drawText(l("selectSubject"),200,310,{font:"16px system-ui",color:u.TEXT_PRIMARY,align:"center"});const e=Object.values(Y),t=170,n=60;e.forEach((s,i)=>{const a=i%2,r=Math.floor(i/2),d=20+a*(t+10),h=350+r*(n+15);o.drawButton(d,h,t,n,`${s.icon} ${l(s.nameKey)}`,{bgColor:u.BG_CARD,borderColor:s.color,fontSize:16}),c.registerClickArea(`subject_${s.id}`,d,h,t,n,()=>c.completeRegister(s.id))}),o.drawButton(100,510,200,45,l("cancel"),{bgColor:u.BG_SECONDARY,borderColor:u.TEXT_SECONDARY,fontSize:14}),c.registerClickArea("retake",100,510,200,45,()=>c.startRegister())}let He=0;const Ue=[{labelKey:"stats_tabOverview",icon:"ğŸ“Š"},{labelKey:"stats_tabSubject",icon:"ğŸ“š"},{labelKey:"stats_tabAnalysis",icon:"ğŸ¯"}];function Re(c){if(!c||c<=0)return"-";const e=Math.floor(c/1e3),t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=e%60;return t>0?`${t}${l("stats_hr")} ${n}${l("stats_min")}`:n>0?`${n}${l("stats_min")} ${s}${l("stats_sec")}`:`${s}${l("stats_sec")}`}function Ft(c,e,t,n,s,i,a,r){if(c.beginPath(),c.arc(e,t,n,-Math.PI/2,Math.PI*1.5),c.strokeStyle="rgba(255,255,255,0.08)",c.lineWidth=s,c.lineCap="round",c.stroke(),i>0){const d=-Math.PI/2+Math.PI*2*Math.min(i,1);c.beginPath(),c.arc(e,t,n,-Math.PI/2,d),c.strokeStyle=a,c.lineWidth=s,c.lineCap="round",c.stroke()}}function Ut(c,e,t,n,s,i,a){if(c.beginPath(),c.arc(e,t,n,-Math.PI/2,Math.PI*1.5),c.strokeStyle="rgba(255,255,255,0.08)",c.lineWidth=s,c.lineCap="round",c.stroke(),i>0){const r=-Math.PI/2+Math.PI*2*Math.min(i,1);c.beginPath(),c.arc(e,t,n,-Math.PI/2,r),c.strokeStyle=a,c.lineWidth=s,c.lineCap="round",c.stroke()}}function Xt(c){o.roundRect(0,0,400,96,0,u.BG_SECONDARY),o.drawText(l("statsTitle"),200,18,{font:"bold 18px system-ui",align:"center"}),o.drawText(l("back"),30,20,{font:"14px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",10,10,80,35,()=>c.changeScreen(R.MAIN));const e=55,t=36,n=Math.floor(400/Ue.length);Ue.forEach((s,i)=>{const a=i*n,r=i===He;o.roundRect(a,e,n,t,0,r?u.ACCENT:u.BG_CARD),r&&o.roundRect(a+10,e+t-3,n-20,3,1.5,u.ACCENT_LIGHT);const d=`${s.icon} ${l(s.labelKey)}`;o.drawText(d,a+n/2,e+8,{font:`${r?"bold ":""}12px system-ui`,color:r?"#fff":u.TEXT_SECONDARY,align:"center"}),c.registerClickArea(`stats_tab_${i}`,a,e,n,t,()=>{He=i,c.scrollY=0,c.scrollMaxY=0})})}function Wt(c){const e=c.cachedStats||{},t=o.ctx;if(c.registerClickArea("back",10,10,80,40,()=>c.changeScreen(R.MAIN)),!e.totalRuns||e.totalRuns===0){o.drawText(l("stats_noData"),200,300,{font:"bold 18px system-ui",color:u.TEXT_PRIMARY,align:"center"}),o.drawText(l("stats_noDataSub"),200,330,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"});return}const n=106;switch(He){case 0:zt(c,e,t,n);break;case 1:Vt(c,e,t,n);break;case 2:Qt(c,e,t,n);break}}function zt(c,e,t,n){let s=n;const i=e.totalAnswers>0?Math.round(e.totalCorrect/e.totalAnswers*100):0;o.drawGradientCard(20,s,360,130,14,"#1e1e2e","#151520"),o.roundRect(20,s,360,130,14,null,"rgba(99,102,241,0.25)");const a=[{cx:80,label:l("stats_accuracy"),value:i,color:i>=70?"#22c55e":"#fbbf24",r:30,lw:6},{cx:200,label:l("stats_winRate"),value:e.winRate,color:e.winRate>=60?"#22c55e":e.winRate>=30?"#fbbf24":"#ef4444",r:40,lw:8},{cx:320,label:l("bestCombo"),value:e.bestCombo,color:"#fbbf24",r:30,lw:6,isRaw:!0}];t.save();for(const C of a){const w=s+58,f=C.isRaw?Math.min(C.value/30,1):C.value/100;Ft(t,C.cx,w,C.r,C.lw,f,C.color),o.drawText(C.isRaw?`${C.value}`:`${C.value}%`,C.cx,w-8,{font:`bold ${C.r>=40?20:16}px system-ui`,color:u.TEXT_PRIMARY,align:"center"}),o.drawText(C.label,C.cx,w+12,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"})}t.restore(),s+=140;const r=175,d=90,h=10;o.drawGradientCard(20,s,r,d,10,"#1a1a28","#151520"),o.roundRect(20,s,r,d,10,null,"rgba(34,197,94,0.2)"),o.drawText("âš”ï¸ "+l("stats_wins")+"/"+l("stats_losses"),108,s+10,{font:"bold 11px system-ui",color:u.TEXT_PRIMARY,align:"center"}),o.drawText(`${e.totalClears}`,62,s+38,{font:"bold 22px system-ui",color:u.SUCCESS,align:"center"}),o.drawText(l("stats_wins"),62,s+58,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`${e.totalFails}`,140,s+38,{font:"bold 22px system-ui",color:u.DANGER,align:"center"}),o.drawText(l("stats_losses"),140,s+58,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`ğŸ”¥ ${e.currentStreak}/${e.bestStreak}`,108,s+76,{font:"10px system-ui",color:u.WARNING,align:"center"});const m=20+r+h;o.drawGradientCard(m,s,r,d,10,"#1a1a28","#151520"),o.roundRect(m,s,r,d,10,null,"rgba(56,189,248,0.2)"),o.drawText("â±ï¸ "+l("stats_time"),m+r/2,s+10,{font:"bold 11px system-ui",color:"#38bdf8",align:"center"}),o.drawText(Re(e.totalPlayTime),m+r/2,s+40,{font:"bold 18px system-ui",color:u.TEXT_PRIMARY,align:"center"}),o.drawText(l("stats_totalPlayTime"),m+r/2,s+60,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(`${l("totalRuns")}: ${e.totalRuns}`,m+r/2,s+76,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"center"}),s+=d+10,o.drawGradientCard(20,s,360,80,14,"#1a1a28","#151520"),o.roundRect(20,s,360,80,14,null,"rgba(251,191,36,0.15)"),o.drawText("ğŸ’°",45,s+18,{font:"18px system-ui",align:"center"}),o.drawText(`${(e.totalGoldEarned||0).toLocaleString()}G`,200,s+16,{font:"bold 22px system-ui",color:"#fbbf24",align:"center"}),t.save(),t.strokeStyle="rgba(255,255,255,0.06)",t.lineWidth=1,t.beginPath(),t.moveTo(35,s+42),t.lineTo(365,s+42),t.stroke(),t.restore();const p=[{icon:"â­ï¸",value:e.totalSkips||0,color:u.TEXT_PRIMARY},{icon:"ğŸ’¡",value:e.totalHints||0,color:"#fbbf24"},{icon:"â°",value:e.totalTimeBoosts||0,color:"#38bdf8"},{icon:"ğŸª¶",value:e.totalRevives||0,color:u.SUCCESS},{icon:"â±ï¸",value:e.totalTimeouts||0,color:u.DANGER}],_=40,A=68;for(let C=0;C<p.length;C++){const w=_+C*A,f=p[C];o.drawText(`${f.icon}`,w,s+56,{font:"13px system-ui",align:"center"}),o.drawText(`${f.value}`,w+22,s+56,{font:"bold 12px system-ui",color:f.color})}s+=90;const v=s+40;c.scrollMaxY=Math.max(0,v-700)}function Vt(c,e,t,n){var v,C,w,f;let s=n;const i=e.wrongBySubject||{},a=e.correctBySubject||{};o.drawGradientCard(20,s,360,230,14,"#1a1a28","#151520"),o.roundRect(20,s,360,230,14,null,"rgba(99,102,241,0.2)"),o.drawText("ğŸ“š "+l("stats_subjectPerf"),40,s+18,{font:"bold 14px system-ui",color:u.ACCENT_LIGHT});const r=[{key:"math",...Y.MATH},{key:"english",...Y.ENGLISH},{key:"korean",...Y.KOREAN},{key:"science",...Y.SCIENCE}];let d=s+50;for(const b of r){const x=((v=e.bySubject)==null?void 0:v[b.key])||0,g=(C=e.subjectAccuracy)==null?void 0:C[b.key],S=g&&g.attempts>0?Math.round(g.correct/g.attempts*100):0,M=a[b.key]||0,y=i[b.key]||0;t.save(),Ut(t,52,d+12,16,4,S/100,b.color),o.drawText(`${S}%`,52,d+6,{font:"bold 9px system-ui",color:u.TEXT_PRIMARY,align:"center"}),t.restore(),o.drawText(`${b.icon} ${l(b.nameKey)}`,80,d,{font:"12px system-ui",color:u.TEXT_PRIMARY}),o.drawText(`âœ…${M} âŒ${y}`,355,d,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"right"});const T=Math.max(1,...r.map(N=>{var G;return((G=e.bySubject)==null?void 0:G[N.key])||0})),E=170,I=x>0?Math.max(5,E*x/T):0;o.roundRect(150,d+16,E,8,4,"rgba(255,255,255,0.06)"),I>0&&o.roundRect(150,d+16,I,8,4,b.color),g&&g.attempts>0&&o.drawText(`${g.correct}/${g.attempts}`,355,d+18,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"right"}),d+=45}s+=240;const h=e.subjectTopics||{},m={math:Y.MATH,english:Y.ENGLISH,korean:Y.KOREAN,science:Y.SCIENCE},p=[];for(const[b,x]of Object.entries(h))if(x)for(const[g,S]of Object.entries(x)){const M=S.attempts||0,y=S.correct||0,T=M-y;if(M>=2&&T>0){const E=Math.round(T/M*100);p.push({topic:g,subject:b,attempts:M,correct:y,wrong:T,wrongRate:E,icon:((w=m[b])==null?void 0:w.icon)||"ğŸ“",color:((f=m[b])==null?void 0:f.color)||u.TEXT_PRIMARY})}}p.sort((b,x)=>x.wrongRate-b.wrongRate||x.wrong-b.wrong);const _=p.slice(0,5);if(_.length===0)o.drawText(l("stats_noWrongTopics"),200,s+10,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"}),s+=36;else{const b=44+_.length*30;o.drawGradientCard(20,s,360,b,14,"#1a1a28","#151520"),o.roundRect(20,s,360,b,14,null,"rgba(239,68,68,0.25)"),o.drawText("ğŸš¨ "+l("stats_weakTopics"),40,s+16,{font:"bold 14px system-ui",color:u.DANGER});let x=s+42;for(const g of _){const S=g.topic.length>6?g.topic.substring(0,6)+"..":g.topic;o.drawText(`${g.icon} ${S}`,40,x,{font:"12px system-ui",color:u.TEXT_PRIMARY});const M=155,y=120,T=Math.max(4,y*g.wrongRate/100);o.roundRect(M,x-2,y,10,5,"rgba(255,255,255,0.06)"),o.roundRect(M,x-2,T,10,5,g.wrongRate>=60?u.DANGER:g.wrongRate>=40?u.WARNING:"rgba(239,68,68,0.4)"),o.drawText(`${g.wrongRate}%`,295,x,{font:"bold 12px system-ui",color:g.wrongRate>=60?u.DANGER:g.wrongRate>=40?u.WARNING:u.TEXT_SECONDARY,align:"center"}),o.drawText(`âŒ${g.wrong}/${g.attempts}`,355,x,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"right"}),x+=30}s+=b+10}for(const b of r){const x=h[b.key];if(!x||Object.keys(x).length===0)continue;const g=Object.entries(x).map(([E,I])=>({topic:E,attempts:I.attempts||0,correct:I.correct||0,wrong:(I.attempts||0)-(I.correct||0)})).filter(E=>E.attempts>0).sort((E,I)=>I.attempts-E.attempts);if(g.length===0)continue;const S=38,M=26,y=S+g.length*M+8;o.drawGradientCard(20,s,360,y,14,"#1a1a28","#151520"),o.roundRect(20,s,360,y,14,null,`${b.color}33`),o.drawText(`${b.icon} ${l(b.nameKey)} ${l("stats_topicDetail")||"ìœ í˜•ë³„"}`,40,s+14,{font:"bold 13px system-ui",color:b.color}),o.drawText(l("stats_colAttempts")||"íšŸìˆ˜",218,s+16,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("stats_colCorrectRate")||"ì •ë‹µë¥ ",274,s+16,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("stats_colWrongRate")||"ì˜¤ë‹µë¥ ",340,s+16,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"});let T=s+S;for(const E of g){const I=E.topic.length>8?E.topic.substring(0,8)+"..":E.topic,N=Math.round(E.correct/E.attempts*100),G=100-N;o.drawText(I,40,T+2,{font:"11px system-ui",color:u.TEXT_PRIMARY});const $=135,k=60,L=Math.max(0,k*N/100);o.roundRect($,T,k,8,4,"rgba(255,255,255,0.06)"),L>0&&o.roundRect($,T,Math.max(2,L),8,4,u.SUCCESS),L<k&&o.roundRect($+L,T,Math.max(2,k-L),8,4,u.DANGER),o.drawText(`${E.attempts}`,218,T+2,{font:"bold 11px system-ui",color:u.TEXT_PRIMARY,align:"center"}),o.drawText(`${N}%`,274,T+2,{font:"bold 11px system-ui",color:N>=70?u.SUCCESS:u.WARNING,align:"center"}),o.drawText(`${G}%`,340,T+2,{font:"bold 11px system-ui",color:G>=50?u.DANGER:u.TEXT_SECONDARY,align:"center"}),T+=M}s+=y+10}const A=s+40;c.scrollMaxY=Math.max(0,A-700)}function Qt(c,e,t,n){var v,C;let s=n;const i=e.recentRuns||[],a=i.length>=2?140:50;if(o.drawGradientCard(20,s,360,a,14,"#1a1a28","#151520"),o.roundRect(20,s,360,a,14,null,"rgba(99,102,241,0.2)"),o.drawText("ğŸ“ˆ "+l("stats_recentBattle"),40,s+18,{font:"bold 14px system-ui",color:u.ACCENT_LIGHT}),o.drawText(`${l("stats_recentWinRate")}: ${e.recentWinRate}%`,355,s+18,{font:"11px system-ui",color:e.recentWinRate>=50?u.SUCCESS:u.DANGER,align:"right"}),i.length>=2){const f=s+40,b=330,x=80;o.roundRect(40,f-5,b+10,x+10,8,"rgba(0,0,0,0.2)"),t.save(),t.strokeStyle="rgba(255,255,255,0.06)",t.lineWidth=1;for(let M=0;M<=100;M+=25){const y=f+x-x*M/100;t.beginPath(),t.moveTo(45,y),t.lineTo(45+b,y),t.stroke()}const g=i.map((M,y)=>({x:45+y/(i.length-1)*b,y:f+x-x*M.accuracy/100})),S=t.createLinearGradient(0,f,0,f+x);S.addColorStop(0,"rgba(99,102,241,0.3)"),S.addColorStop(1,"rgba(99,102,241,0.02)"),t.beginPath(),t.moveTo(g[0].x,f+x);for(const M of g)t.lineTo(M.x,M.y);t.lineTo(g[g.length-1].x,f+x),t.closePath(),t.fillStyle=S,t.fill(),t.beginPath(),t.moveTo(g[0].x,g[0].y);for(let M=1;M<g.length;M++)t.lineTo(g[M].x,g[M].y);t.strokeStyle=u.ACCENT_LIGHT,t.lineWidth=2,t.stroke();for(const M of g)t.beginPath(),t.arc(M.x,M.y,3,0,Math.PI*2),t.fillStyle=u.ACCENT,t.fill(),t.strokeStyle=u.ACCENT_LIGHT,t.lineWidth=1,t.stroke();t.restore(),o.drawText("100%",37,f-2,{font:"8px system-ui",color:u.TEXT_SECONDARY,align:"right"}),o.drawText("50%",37,f+x/2-2,{font:"8px system-ui",color:u.TEXT_SECONDARY,align:"right"}),o.drawText("0%",37,f+x-2,{font:"8px system-ui",color:u.TEXT_SECONDARY,align:"right"})}s+=a+10;const r=i.slice(-5).reverse();if(r.length>0){const f=48+r.length*24;o.drawGradientCard(20,s,360,f,14,"#1a1a28","#151520"),o.roundRect(20,s,360,f,14,null,"rgba(99,102,241,0.15)");const b=s+14;o.drawText(l("stats_colDate"),40,b,{font:"9px system-ui",color:u.TEXT_SECONDARY}),o.drawText(l("stats_colCorrectRate"),180,b,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("stats_colCombo"),240,b,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("stats_colGold"),300,b,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("stats_colTime"),365,b,{font:"9px system-ui",color:u.TEXT_SECONDARY,align:"right"});let x=s+14+18;for(const g of r){const S=g.result==="clear",M=S?"âœ…":"ğŸ’€",y=g.date?new Date(g.date).toLocaleDateString():"-";o.drawText(`${M} ${y}`,40,x,{font:"11px system-ui",color:S?u.SUCCESS:u.DANGER}),o.drawText(`${g.accuracy}%`,180,x,{font:"bold 11px system-ui",color:g.accuracy>=70?u.SUCCESS:u.WARNING,align:"center"}),o.drawText(`x${g.combo}`,240,x,{font:"11px system-ui",color:u.WARNING,align:"center"}),o.drawText(`${g.gold}G`,300,x,{font:"11px system-ui",color:"#fbbf24",align:"center"}),o.drawText(Re(g.duration),365,x,{font:"10px system-ui",color:u.TEXT_SECONDARY,align:"right"}),x+=24}s+=f+10}const d=[{key:1,name:l("easy"),color:u.SUCCESS,gradStart:"#16a34a",gradEnd:"#22c55e"},{key:2,name:l("normal"),color:u.WARNING,gradStart:"#d97706",gradEnd:"#fbbf24"},{key:3,name:l("hard"),color:u.DANGER,gradStart:"#dc2626",gradEnd:"#ef4444"}],h=e.wrongByDifficulty||{};o.drawGradientCard(20,s,360,155,14,"#1a1a28","#151520"),o.roundRect(20,s,360,155,14,null,"rgba(99,102,241,0.2)"),o.drawText("ğŸ¯ "+l("stats_diffAnalysis"),40,s+18,{font:"bold 14px system-ui",color:u.ACCENT_LIGHT});let m=s+45;for(const w of d){const f=((v=e.byDifficulty)==null?void 0:v[w.key])||0,b=(C=e.difficultyAccuracy)==null?void 0:C[w.key],x=b&&b.attempts>0?Math.round(b.correct/b.attempts*100):0,g=h[w.key]||0;o.drawText(w.name,40,m,{font:"bold 12px system-ui",color:w.color}),o.drawText(`${f}`,100,m,{font:"11px system-ui",color:u.TEXT_SECONDARY}),g>0&&o.drawText(`(âŒ${g})`,120,m,{font:"10px system-ui",color:u.DANGER});const S=160,M=Math.max(1,...d.map(T=>{var E;return((E=e.byDifficulty)==null?void 0:E[T.key])||0})),y=f>0?Math.max(5,S*f/M):0;if(o.roundRect(165,m-4,S,12,6,"rgba(255,255,255,0.06)"),y>0){const T=t.createLinearGradient(165,0,165+y,0);T.addColorStop(0,w.gradStart),T.addColorStop(1,w.gradEnd),o.roundRect(165,m-4,y,12,6,T)}o.drawText(`${x}%`,365,m,{font:"bold 12px system-ui",color:x>=70?u.SUCCESS:x>=40?u.WARNING:u.DANGER,align:"right"}),m+=34}s+=165,o.drawGradientCard(20,s,360,132,14,"#1a1a28","#151520"),o.roundRect(20,s,360,132,14,null,"rgba(99,102,241,0.2)"),o.drawText("ğŸ”¬ "+l("stats_advanced"),40,s+18,{font:"bold 14px system-ui",color:u.ACCENT_LIGHT});const p=[{label:l("stats_avgAccuracy"),value:`${e.avgAccuracy}%`,color:u.SUCCESS},{label:l("stats_avgGoldPerRun"),value:`${e.avgGoldPerRun}G`,color:"#fbbf24"},{label:l("stats_shortestClear"),value:Re(e.shortestClear),color:"#38bdf8"},{label:l("stats_longestRun"),value:Re(e.longestRun),color:u.TEXT_SECONDARY},{label:l("stats_totalDefeated"),value:`${e.totalDefeated}`,color:u.DANGER}];let _=s+40;for(let w=0;w<p.length;w++){const f=w%2,b=Math.floor(w/2),x=40+f*180,g=_+b*28;o.drawText(p[w].label,x,g,{font:"11px system-ui",color:u.TEXT_SECONDARY}),o.drawText(p[w].value,x+160,g,{font:"bold 12px system-ui",color:p[w].color,align:"right"})}s+=142;const A=s+40;c.scrollMaxY=Math.max(0,A-700)}function Jt(c){o.drawText(l("dungeonSelect"),200,30,{font:"bold 28px system-ui",color:u.ACCENT_LIGHT,align:"center"}),o.drawText(l("selectDungeon"),200,70,{font:"15px system-ui",color:u.TEXT_SECONDARY,align:"center"});const e=c.monsterManager.monsters.filter(n=>(n.subject||"math")==="math");o.roundRect(30,120,340,180,16,"rgba(26,26,36,0.85)"),o.roundRect(30,120,340,180,16,"rgba(99,102,241,0.15)"),o.drawText("ğŸ“",200,170,{font:"48px system-ui",align:"center",baseline:"middle"}),o.drawText(l("mathDungeon"),200,220,{font:"bold 22px system-ui",color:u.ACCENT_LIGHT,align:"center"}),o.drawText(l("registeredMonsters",e.length),200,250,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("mathTopics"),200,275,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"}),c.registerClickArea("mathDungeon",30,120,340,180,()=>c.startDungeon("math"));const t=c.monsterManager.monsters.filter(n=>n.subject==="science");o.roundRect(30,330,340,180,16,"rgba(26,26,36,0.85)"),o.roundRect(30,330,340,180,16,"rgba(251,191,36,0.15)"),o.drawText("ğŸ”¬",200,380,{font:"48px system-ui",align:"center",baseline:"middle"}),o.drawText(l("scienceDungeon"),200,430,{font:"bold 22px system-ui",color:u.WARNING,align:"center"}),o.drawText(l("registeredMonsters",t.length),200,460,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("scienceTopics"),200,485,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"}),c.registerClickArea("scienceDungeon",30,330,340,180,()=>c.startDungeon("science")),o.drawButton(30,560,340,55,l("goBack"),{bgColor:"rgba(26,26,36,0.85)",borderColor:u.TEXT_SECONDARY,fontSize:18}),c.registerClickArea("back",30,560,340,55,()=>c.changeScreen(R.MAIN))}function Ce(c){const e=[];return c.gold&&e.push(`${c.gold}G`),c.exp&&e.push(`${c.exp}EXP`),e.join(" +")}function Zt(c,e){var n,s,i,a;const t=c.condition;if(!t)return null;switch(t.type){case"combo":return{current:((n=e.stats)==null?void 0:n.bestCombo)||0,target:t.value};case"clear":return{current:((s=e.stats)==null?void 0:s.totalClears)||0,target:t.value};case"level":return{current:e.level||1,target:t.value};case"gold":return{current:e.totalGoldEarned||0,target:t.value};case"kills":return{current:((i=e.stats)==null?void 0:i.totalKills)||0,target:t.value};case"subject":return{current:((a=e.subjectCounts)==null?void 0:a[t.value])||0,target:t.count};case"answers":return{current:e.totalCorrectAnswers||0,target:t.value};case"damage":return{current:e._cachedDamage||0,target:t.value};case"hp":return{current:e._cachedMaxHp||0,target:t.value};default:return null}}function es(c){var m,p,_,A;const e=c.playerManager.player;e._cachedDamage=c.playerManager.getTotalDamage(),e._cachedMaxHp=c.playerManager.getTotalMaxHp();const t=e.achievements||{},n=((m=e.dailyMissions)==null?void 0:m.missions)||[];(_=(p=e.weeklyMissions)==null?void 0:p.missions)!=null&&_.length||c.achievementManager.initWeeklyMissions();const s=((A=e.weeklyMissions)==null?void 0:A.missions)||[];o.roundRect(0,0,400,60,0,u.BG_SECONDARY),o.drawText(l("achievementTitle"),200,20,{font:"bold 18px system-ui",align:"center"}),o.drawText(l("back"),30,22,{font:"14px system-ui",color:u.ACCENT_LIGHT}),c.registerClickArea("back",10,10,80,40,()=>c.changeScreen(R.MAIN));let i=75;o.drawText(l("dailyMissionTitle"),200,i+8,{font:"bold 16px system-ui",color:u.WARNING,align:"center"}),i+=30;for(let v=0;v<n.length;v++){const C=n[v],w=60;o.roundRect(20,i,360,w,12,u.BG_CARD),o.drawText(l(C.nameKey),35,i+15,{font:"bold 13px system-ui",color:u.TEXT_PRIMARY});const f=200,b=35,x=i+32;o.roundRect(b,x,f,10,5,u.BG_SECONDARY);const g=Math.min(C.progress/C.target,1);g>0&&o.roundRect(b,x,Math.max(6,f*g),10,5,C.completed?u.SUCCESS:u.ACCENT),o.drawText(`${C.progress}/${C.target}`,b+f+10,x+2,{font:"11px system-ui",color:u.TEXT_SECONDARY});const S=300,M=i+10;if(C.claimed)o.drawText(l("claimed"),S+30,M+18,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"});else if(C.completed){o.roundRect(S,M,70,32,8,u.SUCCESS),o.drawText(Ce(C.reward),S+35,M+10,{font:"bold 11px system-ui",color:"#fff",align:"center"});const y=v;c.registerClickArea("claimDaily_"+v,S,M,70,32,()=>{c.achievementManager.claimDailyReward(y)&&c.render()})}else o.drawText(Ce(C.reward),S+35,M+18,{font:"11px system-ui",color:u.WARNING,align:"center"});i+=w+8}i+=15,o.drawText(l("weeklyMissionTitle"),200,i+8,{font:"bold 16px system-ui",color:"#a78bfa",align:"center"}),i+=30,s.length===0&&(o.drawText("ì£¼ê°„ ë¯¸ì…˜ ë¡œë”© ì¤‘...",200,i+10,{font:"13px system-ui",color:u.TEXT_SECONDARY,align:"center"}),i+=30);for(let v=0;v<s.length;v++){const C=s[v],w=60;o.roundRect(20,i,360,w,12,u.BG_CARD),o.drawText(l(C.nameKey),35,i+15,{font:"bold 13px system-ui",color:u.TEXT_PRIMARY});const f=200,b=35,x=i+32;o.roundRect(b,x,f,10,5,u.BG_SECONDARY);const g=Math.min(C.progress/C.target,1);g>0&&o.roundRect(b,x,Math.max(6,f*g),10,5,C.completed?u.SUCCESS:"#a78bfa"),o.drawText(`${C.progress}/${C.target}`,b+f+10,x+2,{font:"11px system-ui",color:u.TEXT_SECONDARY});const S=300,M=i+10;if(C.claimed)o.drawText(l("claimed"),S+30,M+18,{font:"12px system-ui",color:u.TEXT_SECONDARY,align:"center"});else if(C.completed){o.roundRect(S,M,70,32,8,u.SUCCESS),o.drawText(Ce(C.reward),S+35,M+10,{font:"bold 11px system-ui",color:"#fff",align:"center"});const y=v;c.registerClickArea("claimWeekly_"+v,S,M,70,32,()=>{c.achievementManager.claimWeeklyReward(y)&&c.render()})}else o.drawText(Ce(C.reward),S+35,M+18,{font:"11px system-ui",color:"#a78bfa",align:"center"});i+=w+8}i+=15;const a=Object.keys(t).length,r=Ne.filter(v=>!v.hidden||t[v.id]).length;o.drawText(l("achievementList",a,r),200,i+8,{font:"bold 16px system-ui",color:u.ACCENT_LIGHT,align:"center"}),i+=30;const d=["combo","run","boss","level","gold","kills","subject","study","power"],h={combo:"achv_cat_combo",run:"achv_cat_run",boss:"achv_cat_boss",level:"achv_cat_level",gold:"achv_cat_gold",kills:"achv_cat_kills",subject:"achv_cat_subject",study:"achv_cat_study",power:"achv_cat_power"};for(const v of d){const C=Ne.filter(w=>w.category===v);if(C.length!==0){o.drawText(l(h[v]),30,i+8,{font:"bold 14px system-ui",color:u.TEXT_SECONDARY}),i+=25;for(const w of C){const f=!!t[w.id];if(w.hidden&&!f){o.roundRect(20,i,360,50,10,"rgba(30,30,50,0.6)"),o.drawText("â“",42,i+18,{font:"20px system-ui",align:"center"}),o.drawText("???",65,i+13,{font:"bold 13px system-ui",color:"#555"}),o.drawText(l("hiddenAchievement")||"ìˆ¨ê²¨ì§„ ì—…ì ",65,i+32,{font:"11px system-ui",color:"#444"}),o.drawText("????G",365,i+18,{font:"bold 12px system-ui",color:"#555",align:"right"}),i+=56;continue}const b=f?null:Zt(w,e),x=b?65:50,g=w.hidden&&f,S=g?"rgba(251,191,36,0.2)":f?"rgba(99,102,241,0.15)":u.BG_CARD,M=g?"#ffd700":f?"#fbbf24":null;o.roundRect(20,i,360,x,10,S,M),o.drawText(f?w.icon:"ğŸ”’",42,i+18,{font:"20px system-ui",align:"center"});const y=g?"#ffd700":f?u.TEXT_PRIMARY:u.TEXT_SECONDARY;if(o.drawText(l(w.nameKey),65,i+13,{font:"bold 13px system-ui",color:y}),o.drawText(l(w.descKey),65,i+32,{font:"11px system-ui",color:u.TEXT_SECONDARY}),b){const I=i+45,N=220,G=8,$=Math.min(b.current/b.target,1);o.roundRect(65,I,N,G,4,u.BG_SECONDARY),$>0&&o.roundRect(65,I,Math.max(6,N*$),G,4,u.ACCENT),o.drawText(`${b.current}/${b.target}`,65+N+8,I,{font:"10px system-ui",color:u.TEXT_SECONDARY})}let T=w.rewardExp?`${w.reward}G +${w.rewardExp}XP`:`${w.reward}G`;w.rewardBonusDamage&&(T+=` +ATK${w.rewardBonusDamage}`),w.rewardBonusHp&&(T+=` +HP${w.rewardBonusHp}`),o.drawText(T,365,i+18,{font:"bold 12px system-ui",color:f?u.WARNING:u.TEXT_SECONDARY,align:"right"}),i+=x+6}i+=10}}c.scrollMaxY=Math.max(0,i-700)}class ts{constructor(e){this.db=e,this.currentScreen=R.MAIN,this.inputManager=new vt(this),this.dialogManager=new wt(this),this.guideManager=new Tt(this),this.registerManager=new At(this),this.dataManager=new St(this),this.aiGenerateManager=new Ct(this),this.playerManager=new gt(e,this),this.monsterManager=new pt(e),this.effects=new mt,this.battleManager=new ft(this),this.shopManager=new _t(this),this.itemManager=new yt(this),this.statsManager=new _e(this),this.achievementManager=new bt(this),this.cachedStats=null,this.currentMonster=null,this.currentRun=null,this.stage=0,this.combo=0,this.timer=30,this.lastTime=0,this.finalBossWrongLastTurn=!1,this.isGenerating=!1,this._generationCancelled=!1,this._cancelOverlay=null,this._generatingStartTime=0,this.generatingMessage="",this.generatingSubMessage="",this._needsRender=!0,this._keys={},this._escHandled=!1,document.onkeydown=t=>{this._keys[t.key]=!0,this._keys[t.keyCode]=!0},document.onkeyup=t=>{this._keys[t.key]=!1,this._keys[t.keyCode]=!1}}async init(){await this.playerManager.loadPlayer(),await this.monsterManager.loadMonsters(),q.loadApiKey(),this.achievementManager.initDailyMissions(),this.effects.setCosmetics(this.playerManager.player.cosmetics);const e=this.playerManager.player;e&&e.stats&&e.stats.totalRuns===0&&!ee("guide_shown")&&(this.guideStep=0)}requestRender(){this._needsRender=!0}changeScreen(e){this.currentScreen=e,this.clearClickAreas(),this.scrollY=0,this.scrollMaxY=0,this._needsRender=!0;const t=document.getElementById("register-btn");t&&(e===R.MAIN?t.classList.add("visible"):t.classList.remove("visible")),e===R.MAIN&&this.playerManager.player&&(this.playerManager.resetHp(),this.playerManager.save(),D.init(),D.startLobbyBgm()),e===R.ACHIEVEMENT&&this.achievementManager.initDailyMissions(),e===R.STATS&&this.statsManager.aggregateStats().then(()=>this.render()).catch(n=>{}),e===R.BATTLE&&D.stopBgm()}_showCancelOverlay(){if(this._cancelOverlay)return;const e=document.createElement("div");e.id="generation-cancel-overlay",e.style.cssText="position:fixed;bottom:0;left:0;width:100%;z-index:9999;display:flex;justify-content:center;padding:20px 0 40px;pointer-events:none;";const t=document.createElement("button");t.textContent=l("cancel")||"ì·¨ì†Œ",t.style.cssText="padding:16px 64px;border:none;border-radius:12px;background:#dc2626;color:white;font-size:18px;font-weight:bold;cursor:pointer;font-family:system-ui,-apple-system,sans-serif;pointer-events:auto;",e.appendChild(t),t.onclick=n=>{n.stopPropagation(),this._generationCancelled=!0,this.isGenerating=!1,this._needsRender=!0,this._removeCancelOverlay(),this.changeScreen(R.MAIN)},document.body.appendChild(e),this._cancelOverlay=e}_removeCancelOverlay(){this._cancelOverlay&&(this._cancelOverlay.remove(),this._cancelOverlay=null),this._generatingStartTime=0}get clickAreas(){return this.inputManager.clickAreas}set clickAreas(e){this.inputManager.clickAreas=e}get scrollY(){return this.inputManager.scrollY}set scrollY(e){this.inputManager.scrollY=e}get scrollMaxY(){return this.inputManager.scrollMaxY}set scrollMaxY(e){this.inputManager.scrollMaxY=e}get _isTouchScrolling(){return this.inputManager._isTouchScrolling}get _dragging(){return this.inputManager._dragging}get _bgmInitiated(){return this.inputManager._bgmInitiated}set _bgmInitiated(e){this.inputManager._bgmInitiated=e}registerClickArea(e,t,n,s,i,a){return this.inputManager.registerClickArea(e,t,n,s,i,a)}registerDragArea(e,t,n,s,i,a){return this.inputManager.registerDragArea(e,t,n,s,i,a)}clearClickAreas(){return this.inputManager.clearClickAreas()}handleInput(e,t){return this.inputManager.handleInput(e,t)}handleTouchStart(e,t){return this.inputManager.handleTouchStart(e,t)}handleTouchMove(e,t){return this.inputManager.handleTouchMove(e,t)}handleTouchEnd(){return this.inputManager.handleTouchEnd()}update(){const e=this._keys.Escape||this._keys[27];if(e&&!this._escHandled){if(this._escHandled=!0,this.isGenerating)this._generationCancelled=!0,this.isGenerating=!1,this._removeCancelOverlay(),this.changeScreen(R.MAIN);else{const n=document.getElementById("level-modal");if(n)n.remove();else{const s=document.getElementById("custom-modal");s?s.click():this.currentScreen!==R.MAIN&&this.currentScreen!==R.BATTLE&&this.currentScreen!==R.RESULT&&this.changeScreen(R.MAIN)}}this._needsRender=!0}e||(this._escHandled=!1);const t=this.effects.hasActiveEffects();this.effects.update(),this.currentScreen===R.BATTLE?(this.battleManager.updateBattle(),this._needsRender=!0):this.isGenerating?(this._showCancelOverlay(),this._generatingStartTime?Date.now()-this._generatingStartTime>65e3&&(this._generationCancelled=!0,this.isGenerating=!1,this._needsRender=!0,this._removeCancelOverlay(),this.changeScreen(R.MAIN)):this._generatingStartTime=Date.now(),this._needsRender=!0):this._removeCancelOverlay(),(t||this.effects.hasActiveEffects())&&(this._needsRender=!0)}render(){const e=o.ctx;if(e.save(),this.effects.screenShake>0){const n=(Math.random()-.5)*this.effects.screenShake,s=(Math.random()-.5)*this.effects.screenShake;e.translate(n,s)}if(o.clear(),this.clearClickAreas(),this.isGenerating){const n=.6+Math.sin(Date.now()/300)*.4;e.globalAlpha=n,o.drawText("â³",200,260,{font:"48px system-ui",align:"center"}),e.globalAlpha=1,o.drawText(this.generatingMessage||l("generating"),200,320,{font:"bold 22px system-ui",color:u.ACCENT_LIGHT,align:"center"}),o.drawText(this.generatingSubMessage||"",200,360,{font:"15px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("pleaseWait"),200,400,{font:"14px system-ui",color:u.TEXT_SECONDARY,align:"center"}),o.drawText(l("cancel")||"ì·¨ì†Œ",200,470,{font:"bold 16px system-ui",color:"#f87171",align:"center"}),this.registerClickArea("cancelGeneration",0,0,400,700,()=>{this._generationCancelled=!0,this.isGenerating=!1,this._needsRender=!0,this._removeCancelOverlay(),this.changeScreen(R.MAIN)}),this.effects.render(),e.restore();return}const t=this.currentScreen!==R.BATTLE&&this.currentScreen!==R.RESULT;switch(t&&o.applyUiOpacity(),this.currentScreen){case R.MAIN:Mt(this);break;case R.REGISTER:jt(this);break;case R.BATTLE:Et(this);break;case R.RESULT:Rt(this);break;case R.SETTINGS:this._renderScrollableScreen(()=>Ot(this),()=>$t(this));break;case R.DUNGEON_SELECT:Jt(this);break;case R.SHOP:this._renderScrollableScreen(()=>Bt(this),()=>Ht(this));break;case R.STATS:this._renderScrollableScreen(()=>Wt(this),()=>Xt(this));break;case R.ACHIEVEMENT:this._renderScrollableScreen(()=>es(this),()=>{o.roundRect(0,0,400,60,0,u.BG_SECONDARY),o.drawText(l("achievementTitle"),200,20,{font:"bold 18px system-ui",align:"center"}),o.drawText(l("back"),30,22,{font:"14px system-ui",color:u.ACCENT_LIGHT})});break}t&&o.resetOpacity(),this.effects.render(),this.guideStep!==null&&this._renderGuide(e),e.restore()}_renderScrollableScreen(e,t){const n=o.ctx;if(n.save(),n.translate(0,-this.scrollY),e(),n.restore(),t&&t(),this.scrollMaxY>0){const s=Math.max(30,700*(700/(700+this.scrollMaxY))),i=this.scrollY/this.scrollMaxY*(700-s);o.roundRect(394,i,4,s,2,"rgba(255,255,255,0.2)")}}get guideStep(){return this.guideManager.guideStep}set guideStep(e){this.guideManager.guideStep=e}_renderGuide(e){return this.guideManager.renderGuide(e)}showGuide(){return this.guideManager.showGuide()}getAccuracyRate(){return!this.currentRun||this.currentRun.totalAnswers===0?.5:this.currentRun.correctAnswers/this.currentRun.totalAnswers}async nextMonster(){if(!this._loadingMonster){this._loadingMonster=!0;try{await this._nextMonsterImpl()}finally{this._loadingMonster=!1}}}async _nextMonsterImpl(){var i;if(this.monsterManager.monsters.length===0&&(await this._reviveClearedMonsters(),await this.monsterManager.loadMonstersBySubject(this.currentSubject||"math"),this.monsterManager.monsters.length===0)){this.endRun(!0);return}const e=this.getAccuracyRate(),t=((i=this.currentRun)==null?void 0:i.totalAnswers)||0,n=this.monsterManager.selectMonsterByDifficulty(e,t);this.currentMonster=this.monsterManager.prepareMonster(n,this.stage,this.effects);const s=this.currentMonster.difficulty||2;this.timer=this.playerManager.getTotalTime(s),this.lastTime=Date.now()}async startDungeon(e="math"){var s;if(this.isGenerating)return;this.currentSubject=e,await this.monsterManager.loadMonstersBySubject(e);const t=30;if(this.monsterManager.monsters.length<t&&(U.hasApiKey()||q.hasApiKey())&&(await this._autoFillProblems(e,t-this.monsterManager.monsters.length),await this.monsterManager.loadMonstersBySubject(e)),this.monsterManager.monsters.length===0){await this.showModal(l("noProblems"));return}D.playDungeonStart();let n=1;((s=this.playerManager.player.inventory)==null?void 0:s.doubleGold)>0&&(this.playerManager.player.inventory.doubleGold--,n=1.25,this.playerManager.save(),await this.showModal(l("goldMultiplierApplied"))),this.currentRun={startTime:Date.now(),defeatedMonsters:[],earnedGold:0,earnedExp:0,bestCombo:0,goldMultiplier:n,result:"ongoing",correctAnswers:0,totalAnswers:0,skipCount:0,hintCount:0,timeBoostCount:0,reviveCount:0,timeoutCount:0,wrongBySubject:{},correctBySubject:{},wrongByTopic:{},correctByTopic:{},wrongByDifficulty:{}},this.stage=1,this.combo=0,this.finalBossWrongLastTurn=!1,this.playerManager.resetHp(),await this.nextMonster(),this.changeScreen(R.BATTLE)}async endRun(e){if(!this.currentRun)return;this.currentRun.result=e?"clear":"failed",this.currentRun.endTime=Date.now();const t=!e&&(this.currentRun.totalAnswers||0)===0;e?D.playClear():D.playGameOver(),this.playerManager.resetHp(),await this.playerManager.save(),t||(await this.db.add("runs",this.currentRun),this.statsManager.invalidateCache(),H.isLoggedIn()&&H.postRun(this.currentRun).catch(n=>{}),this.achievementManager.onRunEnd(this.currentRun)),await this._reviveClearedMonsters(),this.changeScreen(R.RESULT)}async _reviveClearedMonsters(){try{const e=await this.db.getByIndex("monsters","status","cleared");if(e.length===0)return;await Promise.all(e.map(t=>(t.status="alive",this.db.put("monsters",t))))}catch{}}get pendingImage(){return this.registerManager.pendingImage}set pendingImage(e){this.registerManager.pendingImage=e}get previewImg(){return this.registerManager.previewImg}set previewImg(e){this.registerManager.previewImg=e}get previewImageLoaded(){return this.registerManager.previewImageLoaded}set previewImageLoaded(e){this.registerManager.previewImageLoaded=e}get _previewImageLoading(){return this.registerManager._previewImageLoading}set _previewImageLoading(e){this.registerManager._previewImageLoading=e}startRegister(){return this.registerManager.startRegister()}completeRegister(e){return this.registerManager.completeRegister(e)}promptApiKey(){return this.aiGenerateManager.promptApiKey()}promptSmilePrintApiKey(){return this.aiGenerateManager.promptSmilePrintApiKey()}testAIGeneration(){return this.aiGenerateManager.testAIGeneration()}showAIGenerateMenu(){return this.aiGenerateManager.showAIGenerateMenu()}showLevelProgress(){return this.dialogManager.showLevelProgress()}showProblemViewer(){return this.dialogManager.showProblemViewer()}resetAllProblems(){return this.dataManager.resetAllProblems()}resetAccount(){return this.dataManager.resetAccount()}exportProblems(){return this.dataManager.exportProblems()}importProblems(){return this.dataManager.importProblems()}showAnalyzingScreen(e){return this.dialogManager.showAnalyzingScreen(e)}showGeneratingScreen(e){return this.dialogManager.showGeneratingScreen(e)}showModal(e){return this.dialogManager.showModal(e)}showToast(e,t){return this.dialogManager.showToast(e,t)}showConfirm(e){return this.dialogManager.showConfirm(e)}showPrompt(e,t){return this.dialogManager.showPrompt(e,t)}async _autoFillProblems(e,t){const n=U.getTopics(e),s=Object.keys(n);let i=t,a=0;this._generationCancelled=!1,this.isGenerating=!0,this.generatingMessage=l("autoFillGenerating")||"ë¬¸ì œ ìë™ ìƒì„± ì¤‘...",this.generatingSubMessage=l("autoFillDesc",i)||`${i}ê°œ ë¬¸ì œë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤`,this._needsRender=!0;try{for(;i>0&&!this._generationCancelled;){const r=Math.min(i,5),d=s[Math.floor(Math.random()*s.length)],h=Math.random()<.5?1:2;try{let m=null;const p=_=>Promise.race([_,new Promise((A,v)=>setTimeout(()=>v(new Error("Timeout")),6e4))]);if(U.hasApiKey())m=await p(U.generateProblems(d,h,r,e));else if(q.hasApiKey()){const _=n[d].name,A=await p(q.generateNewProblems(e,_,r));m=A==null?void 0:A.problems}if(m&&m.length>0){for(const _ of m){if(!_.question||!_.answer)continue;const A={subject:e,question:_.question,answer:_.answer,answers:_.answers||[_.answer],choices:_.choices||[],correctIndex:_.correctIndex||0,explanation:_.explanation||"",topic:_.topic||n[d].name,hp:80+(_.difficulty||h)*20,maxHp:80+(_.difficulty||h)*20,difficulty:_.difficulty||h,isGenerated:!0,createdAt:Date.now(),status:"alive"};A.imageData=ge(A),await this.db.add("monsters",A),a++}i-=m.length}else break}catch{break}this.generatingSubMessage=l("autoFillProgress",a,t)||`${a}/${t}ê°œ ìƒì„± ì™„ë£Œ`,this._needsRender=!0}}finally{this.isGenerating=!1,this._needsRender=!0,this._removeCancelOverlay()}}async save(){await this.playerManager.save()}}const Xe="https://study-api.blueskyman1012.workers.dev";class ss{constructor(){this.canvas=null,this.ctx=null,this.db=null,this.game=null,this.registerBtn=null,this.problemViewerBtn=null,this.cameraInput=null,this.cameraModal=null,this.cameraVideo=null,this.captureCanvas=null,this.mediaStream=null,this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent),this.sessionToken=null,this.currentUser=null,this.lastSyncTime=0,this._animFrameId=null,this._eventsSetup=!1}async init(){if(document.getElementById("logout-btn").addEventListener("click",()=>this.logout()),this._migrateSensitiveKeys(),this.sessionToken=Pe("session_token"),this.sessionToken){if(await this.verifySession()){this.showGame();return}Ke("session_token"),this.sessionToken=null}this.initGoogleLogin()}_migrateSensitiveKeys(){const e=["session_token","gemini_api_key","smileprint_api_key"];for(const t of e){const n=ee(t);n&&(me(t,n),Me(t))}}initGoogleLogin(){if(document.getElementById("login-screen").style.display="flex",document.getElementById("game-container").style.display="none",typeof google<"u"&&google.accounts)this.renderGoogleButton();else{const e=setInterval(()=>{typeof google<"u"&&google.accounts&&(clearInterval(e),this.renderGoogleButton())},100);setTimeout(()=>{clearInterval(e),typeof google>"u"&&(document.getElementById("login-status").textContent=l("googleLoadFailed"))},5e3)}}renderGoogleButton(){google.accounts.id.initialize({client_id:"907312801581-6ddqujogiq9sanjd18ah9vs7pr5vmuo3.apps.googleusercontent.com",callback:e=>this.handleGoogleLogin(e)}),google.accounts.id.renderButton(document.getElementById("google-login-btn"),{theme:"outline",size:"large",text:"signin_with",locale:"ko",width:280})}async handleGoogleLogin(e){document.getElementById("login-status").textContent=l("loggingIn");try{const n=await(await fetch(`${Xe}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e.credential})})).json();n.success?(this.sessionToken=n.sessionToken,this.currentUser=n.user,me("session_token",n.sessionToken),F("user_name",n.user.name),F("user_picture",n.user.picture),H.setToken(n.sessionToken),this.showGame()):document.getElementById("login-status").textContent=n.error||l("loginFailed")}catch{document.getElementById("login-status").textContent=l("serverError")}}async verifySession(){try{const e=await fetch(`${Xe}/api/auth/me`,{headers:{Authorization:`Bearer ${this.sessionToken}`}});if(e.ok){const t=await e.json();return this.currentUser=t.user,H.setToken(this.sessionToken),!0}return!1}catch{return!1}}logout(){this._animFrameId&&(cancelAnimationFrame(this._animFrameId),this._animFrameId=null),this.sessionToken=null,this.currentUser=null,H.setToken(null),Ke("session_token"),Me("user_name"),Me("user_picture"),document.getElementById("login-screen").style.display="flex",document.getElementById("game-container").style.display="none",document.getElementById("login-status").textContent="",typeof google<"u"&&google.accounts&&this.renderGoogleButton()}async showGame(){if(document.getElementById("login-screen").style.display="none",document.getElementById("game-container").style.display="flex",this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.textRendering="optimizeLegibility",this.setupCanvas(),this.registerBtn=document.getElementById("register-btn"),this.problemViewerBtn=document.getElementById("problem-viewer-btn"),this.cameraInput=document.getElementById("camera-input"),this.setupCameraInput(),this.setupProblemViewerBtn(),o.init(this.ctx,P.CANVAS_WIDTH,P.CANVAS_HEIGHT),this.showLoading(),this.db=new Ve,await this.db.open(),H.isLoggedIn())try{await H.uploadMonsters(this.db);const[,,,e]=await Promise.all([H.downloadPlayerData(this.db),H.downloadMonsters(this.db),H.downloadRuns(this.db),H.downloadKeys()]);e&&(e.smileprint_api_key&&(ye.apiKey=e.smileprint_api_key,me("smileprint_api_key",e.smileprint_api_key)),e.gemini_api_key&&(q.apiKey=e.gemini_api_key,me("gemini_api_key",e.gemini_api_key)))}catch{}this.game=new ts(this.db),await this.game.init(),this.setupEvents(),this._logoutBtn=document.getElementById("logout-btn"),this._updateButtonLayout(),this._animFrameId&&(cancelAnimationFrame(this._animFrameId),this._animFrameId=null),this.gameLoop()}setupCameraInput(){this.cameraModal=document.getElementById("camera-modal"),this.cameraVideo=document.getElementById("camera-video"),this.captureCanvas=document.getElementById("capture-canvas"),this.cameraInput.addEventListener("change",e=>{const t=e.target.files[0];if(t){const n=new FileReader;n.onload=()=>{this.game.pendingImage=n.result,this.game.previewImg=null,this.game.previewImageLoaded=!1,this.game.completeRegister("math")},n.readAsDataURL(t)}this.cameraInput.value=""}),this.registerBtn.addEventListener("click",()=>{this.isIOS?this.cameraInput.click():this.openCamera()}),document.getElementById("camera-capture").addEventListener("click",()=>{this.capturePhoto()}),document.getElementById("camera-close").addEventListener("click",()=>{this.closeCamera()})}async openCamera(){try{this.cameraModal.style.display="flex",this.mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1}),this.cameraVideo.srcObject=this.mediaStream,await this.cameraVideo.play()}catch(e){this.cameraModal.style.display="none",this.game.showModal(l("cameraError")+e.message)}}capturePhoto(){const e=this.cameraVideo,t=this.captureCanvas;t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0);const s=t.toDataURL("image/jpeg",.8);this.game.pendingImage=s,this.game.previewImg=null,this.game.previewImageLoaded=!1,this.closeCamera(),this.game.completeRegister("math")}closeCamera(){this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>e.stop()),this.mediaStream=null),this.cameraModal.style.display="none"}setupProblemViewerBtn(){this.problemViewerBtn&&this.problemViewerBtn.addEventListener("click",()=>{this.game&&this.game.showProblemViewer().catch(e=>{this.game.showModal("ì˜¤ë¥˜: "+e.message)})})}setupCanvas(){const e=Math.min(window.devicePixelRatio||1,3);this.canvas.width=P.CANVAS_WIDTH*e,this.canvas.height=P.CANVAS_HEIGHT*e,this.ctx.scale(e,e),this.resizeCanvas()}resizeCanvas(){const e=document.getElementById("game-container"),t=e.clientWidth,n=e.clientHeight,s=P.CANVAS_WIDTH/P.CANVAS_HEIGHT,i=t/n;let a,r;i>s?(r=n,a=r*s):(a=t,r=a/s),this.canvas.style.width=`${a}px`,this.canvas.style.height=`${r}px`,this.updateButtonPosition(a,r)}updateButtonPosition(e,t){if(!this.registerBtn)return;const n=e/P.CANVAS_WIDTH,s=80,i=420,a=240,r=60,d=this.canvas.getBoundingClientRect();this.registerBtn.style.left=`${d.left+s*n}px`,this.registerBtn.style.top=`${d.top+i*n}px`,this.registerBtn.style.width=`${a*n}px`,this.registerBtn.style.height=`${r*n}px`,this.registerBtn.style.fontSize=`${18*n}px`,this.registerBtn.style.lineHeight=`${r*n}px`,this.registerBtn.style.padding="0"}setupEvents(){this._eventsSetup||(this._eventsSetup=!0,window.addEventListener("resize",()=>{this.resizeCanvas(),this._updateButtonLayout()}),this.canvas.addEventListener("click",e=>{this._touchHandled||this.handleInput(e)}),this.canvas.addEventListener("mousedown",e=>{const t=this.canvas.getBoundingClientRect(),n=P.CANVAS_WIDTH/t.width,s=P.CANVAS_HEIGHT/t.height,i=(e.clientX-t.left)*n,a=(e.clientY-t.top)*s;this.game.handleTouchStart(i,a),this.game._dragging&&(this._mouseDragging=!0)}),window.addEventListener("mousemove",e=>{if(!this._mouseDragging)return;const t=this.canvas.getBoundingClientRect(),n=P.CANVAS_WIDTH/t.width,s=(e.clientX-t.left)*n;this.game.handleTouchMove(s,0)}),window.addEventListener("mouseup",()=>{this._mouseDragging&&(this._mouseDragging=!1,this.game.handleTouchEnd())}),this.canvas.addEventListener("touchstart",e=>{e.preventDefault();const t=e.touches[0],n=this.canvas.getBoundingClientRect(),s=P.CANVAS_WIDTH/n.width,i=P.CANVAS_HEIGHT/n.height,a=(t.clientX-n.left)*s,r=(t.clientY-n.top)*i;this.game.handleTouchStart(a,r),this._pendingTouch=t},{passive:!1}),this.canvas.addEventListener("touchmove",e=>{e.preventDefault();const t=e.touches[0],n=this.canvas.getBoundingClientRect(),s=P.CANVAS_WIDTH/n.width,i=P.CANVAS_HEIGHT/n.height,a=(t.clientX-n.left)*s,r=(t.clientY-n.top)*i;this.game.handleTouchMove(a,r)},{passive:!1}),this.canvas.addEventListener("touchend",e=>{e.preventDefault();const t=!!this.game._dragging;this._pendingTouch&&!this.game._isTouchScrolling&&!t&&this.handleInput(this._pendingTouch),this.game.handleTouchEnd(),this._pendingTouch=null,this._touchHandled=!0,setTimeout(()=>{this._touchHandled=!1},300)},{passive:!1}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.syncFromServer()}),this.canvas.addEventListener("wheel",e=>{this.game.scrollMaxY>0&&(e.preventDefault(),this.game.scrollY=Math.max(0,Math.min(this.game.scrollMaxY,this.game.scrollY+e.deltaY*.5)),this.game.render())},{passive:!1}),document.addEventListener("keydown",e=>{this.game.scrollMaxY>0&&(e.key==="ArrowDown"?(e.preventDefault(),this.game.scrollY=Math.min(this.game.scrollMaxY,this.game.scrollY+40),this.game.render()):e.key==="ArrowUp"&&(e.preventDefault(),this.game.scrollY=Math.max(0,this.game.scrollY-40),this.game.render()))}),history.pushState(null,"",location.href),window.addEventListener("popstate",()=>{history.pushState(null,"",location.href),this.game.currentScreen!==R.MAIN&&this.game.changeScreen(R.MAIN)}))}async syncFromServer(){if(H.isLoggedIn()&&!(this.game&&this.game.currentScreen===R.BATTLE)&&!(Date.now()-this.lastSyncTime<3e4)&&!this._syncing){this._syncing=!0;try{await H.downloadPlayerData(this.db),await H.downloadMonsters(this.db),await H.downloadRuns(this.db),await this.game.playerManager.loadPlayer(),await this.game.monsterManager.loadMonsters(),this.lastSyncTime=Date.now(),this.game.render()}catch{}finally{this._syncing=!1}}}handleInput(e){const t=this.canvas.getBoundingClientRect(),n=P.CANVAS_WIDTH/t.width,s=P.CANVAS_HEIGHT/t.height,i=(e.clientX-t.left)*n,a=(e.clientY-t.top)*s;this.game.handleInput(i,a)}showLoading(){o.clear(),o.drawText(l("loading"),200,350,{font:"bold 24px system-ui",color:"#6366f1",align:"center"})}_updateButtonLayout(){if(!this.canvas)return;const e=this.canvas.getBoundingClientRect();this._cachedRect=e,this._cachedScale=e.width/P.CANVAS_WIDTH}_updateHTMLButtons(){const e=this.game.currentScreen===R.MAIN&&this.game.guideStep===null&&!this.game.isGenerating;if(!this._cachedRect&&this.canvas&&this._updateButtonLayout(),this.registerBtn)if(e){if(this.registerBtn.classList.add("visible"),this._cachedRect){const t=this._cachedScale,n=this._cachedRect;this.registerBtn.style.left=`${n.left+20*t}px`,this.registerBtn.style.top=`${n.top+390*t}px`,this.registerBtn.style.width=`${360*t}px`,this.registerBtn.style.height=`${65*t}px`,this.registerBtn.style.fontSize=`${20*t}px`}}else this.registerBtn.classList.remove("visible");if(this.problemViewerBtn)if(e){if(this.problemViewerBtn.classList.add("visible"),this._cachedRect){const t=this._cachedScale,n=this._cachedRect;this.problemViewerBtn.style.left=`${n.left+20*t}px`,this.problemViewerBtn.style.top=`${n.top+462*t}px`,this.problemViewerBtn.style.width=`${360*t}px`,this.problemViewerBtn.style.height=`${55*t}px`,this.problemViewerBtn.style.fontSize=`${18*t}px`}}else this.problemViewerBtn.classList.remove("visible");this._logoutBtn&&(this._logoutBtn.style.display=e?"":"none")}gameLoop(){if(this.game.update(),this._updateHTMLButtons(),!this.game._needsRender){this._animFrameId=requestAnimationFrame(()=>this.gameLoop());return}this.game._needsRender=!1,this.game.render(),this._animFrameId=requestAnimationFrame(()=>this.gameLoop())}}const ns=new ss;window.addEventListener("DOMContentLoaded",async()=>{ze(),await document.fonts.ready,ns.init()});
