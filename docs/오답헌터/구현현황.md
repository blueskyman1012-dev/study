# 오답헌터 - 구현 현황

> 최종 업데이트: 2026-01-19

## 프로젝트 개요

| 항목 | 내용 |
|------|------|
| 프로젝트명 | 오답헌터 (Wrong Answer Hunter) |
| 장르 | 로그라이크 학습 RPG |
| 플랫폼 | 웹 브라우저 (모바일 최적화) |
| 기술 스택 | HTML5, Canvas, JavaScript (ES Modules), Vite |
| 저장소 | IndexedDB (로컬) |

---

## 2026-01-19 업데이트 요약

| 기능 | 내용 |
|------|------|
| 레벨 시스템 | 레벨당 HP+1, 5레벨당 공격력+5, 10레벨당 시간+5초 |
| 레벨 진척도 UI | HTML 모달로 상세 스탯/보너스/경험치 정보 표시 |
| 보스 경험치 차등 | 일반 50, 중간 150, 최종 350 |
| 힌트 시스템 개선 | 정답 대신 주제/풀이힌트/오답제거 제공 |
| 데이터 관리 | 문제 내보내기/불러오기/초기화 기능 |
| 게임 밸런스 | 기본HP 100, 시간 60초, 시간초과 데미지 45 |

---

## 프로젝트 구조

```
C:\hjkim\app\
├── index.html              # 메인 HTML
├── package.json            # 프로젝트 설정
├── vite.config.js          # Vite 설정 (HTTPS, 외부 접속)
├── start.bat               # 실행 스크립트
├── src/
│   ├── main.js             # 앱 진입점
│   ├── style.css           # 스타일
│   ├── canvas/
│   │   └── Renderer.js     # Canvas 렌더링 유틸리티
│   ├── data/
│   │   └── Database.js     # IndexedDB 래퍼
│   ├── game/
│   │   └── Game.js         # 게임 메인 로직
│   ├── services/
│   │   ├── GeminiService.js  # Gemini AI 연동
│   │   └── SoundService.js   # 효과음 서비스
│   └── utils/
│       └── constants.js    # 상수 정의
└── public/                 # 정적 파일
```

---

## 구현 완료 기능

### 1. 핵심 게임 시스템

#### 던전 시스템
| 항목 | 내용 |
|------|------|
| 총 스테이지 | 100층 |
| 기본 HP | 100 |
| 기본 공격력 | 34 |
| 제한 시간 | 60초/문제 |

#### 보스 시스템
| 보스 타입 | 출현 층 | HP 배율 | 데미지 배율 | 골드 배율 | 아이콘 |
|-----------|---------|---------|-------------|-----------|--------|
| 일반 보스 | 10, 20, 30, 40, 60, 70, 80, 90 | x2 | x1.5 | x3 | 👹 |
| 중간 보스 | 50 | x3.5 | x2 | x5 | 👿 |
| 최종 보스 | 100 | x5 | x2.5 | x10 | 🐉 |

#### 레벨 시스템 (2026-01-19 추가)
| 항목 | 내용 |
|------|------|
| 최대 레벨 | 99 |
| 기본 경험치 | 100 (10%씩 증가, 1의 자리 반올림) |
| 레벨당 HP | +1 |
| 5레벨당 공격력 | +5 |
| 10레벨당 시간 | +5초 |

#### 경험치 획득
| 행동 | 경험치 |
|------|--------|
| 정답 | +5 |
| 몬스터 처치 | +20 |
| 일반 보스 👹 | +50 |
| 중간 보스 👿 | +150 |
| 최종 보스 🐉 | +350 |

#### 전투 시스템
- 정답 시: 몬스터에게 데미지 (기본 34 + 레벨보너스 + 콤보x2)
- 오답 시: 플레이어 HP 감소 (20 x 보스배율)
- 시간 초과: 플레이어 HP -45
- 콤보 시스템: 연속 정답 시 데미지/골드 증가

---

### 2. 아이템 드랍 시스템

#### 드랍 확률
| 조건 | 드랍률 |
|------|--------|
| 일반 몬스터 | 5% |
| 일반 보스 | 35% |
| 중간 보스 | 70% |
| 최종 보스 | 100% (+50% 추가 드랍) |

#### 아이템 등급
| 등급 | 확률 | 색상 |
|------|------|------|
| 일반 | 45% | 흰색 |
| 레어 | 35% | 파란색 |
| 에픽 | 17% | 보라색 |
| 전설 | 3% | 금색 |

#### 아이템 목록
| 등급 | 아이템 | 효과 |
|------|--------|------|
| 일반 | HP 포션 | HP +10 |
| 일반 | 시간의 모래 | 시간 +5초 |
| 일반 | 작은 금화 주머니 | 골드 +20 |
| 레어 | 고급 HP 포션 | HP +25 |
| 레어 | 시간의 수정 | 시간 +10초 |
| 레어 | 콤보 부스터 | 콤보 +3 |
| 에픽 | 생명의 성배 | HP +50 |
| 에픽 | 무료 힌트권 | 힌트 1회 무료 |
| 에픽 | 부활의 깃털 | 부활 1회 |
| 에픽 | 골드 2배 부적 | 골드 2배 |
| 전설 | 불사의 반지 | 부활 2회 |
| 전설 | 시간 정지 | 타이머 정지 1회 |
| 전설 | 전설의 금괴 | 골드 +200 |
| 전설 | 지혜의 왕관 | 시간 +10초 |

---

### 3. AI 연동 (Gemini)

#### 기능
| 기능 | 설명 |
|------|------|
| 유사 문제 생성 | 오답 시 비슷한 유형의 문제 2개 자동 생성 |
| 문제 유형 분석 | 문제의 유형, 난이도, 키워드 분석 |
| 새 문제 생성 | 주제별 문제 생성 |
| 힌트 생성 | 정답을 알려주지 않는 힌트 제공 |
| 풀이 설명 | 단계별 풀이 과정 설명 |

#### 설정 방법
1. https://aistudio.google.com 접속
2. Google 계정 로그인
3. Get API Key → Create API Key
4. 게임 내 설정 → API 키 입력

---

### 4. 데이터 관리 (2026-01-19 추가)

#### 문제 내보내기/불러오기
| 기능 | 설명 |
|------|------|
| 📤 내보내기 | 모든 문제를 JSON 파일로 다운로드 |
| 📥 불러오기 | JSON 파일에서 문제 추가 (기존 유지) |
| 🗑️ 전체 초기화 | 모든 문제 삭제 (2단계 확인) |

#### 내보내기 파일 형식
```json
{
  "version": "1.0",
  "exportDate": "2026-01-19T...",
  "count": 10,
  "problems": [{ "question", "answer", "choices", ... }]
}
```

---

### 5. 힌트 시스템 개선 (2026-01-19)

정답을 직접 알려주지 않고 교육적 힌트 제공:
| 힌트 종류 | 설명 |
|-----------|------|
| 📚 주제 | 문제의 단원/주제 표시 |
| 💭 풀이 힌트 | 풀이 설명의 첫 문장 일부 |
| ❌ 오답 제거 | 오답 중 하나를 랜덤으로 알려줌 |
| 🔑 키워드 | 관련 키워드 (있을 경우) |

---

### 7. OCR 기능 (Tesseract.js)

| 항목 | 내용 |
|------|------|
| 라이브러리 | Tesseract.js v5 (CDN) |
| 지원 언어 | 한국어 + 영어 |
| 처리 방식 | 클라이언트 사이드 (서버 불필요) |

#### 흐름
1. 과목 선택 → 카메라 촬영
2. "사진 분석 중..." 로딩 표시
3. OCR로 텍스트 추출
4. 추출된 텍스트 확인/수정
5. 정답 입력 → 몬스터 등록

---

### 8. 효과음 시스템 (Web Audio API)

#### 효과음 목록
| 상황 | 효과음 | 진동 |
|------|--------|------|
| 버튼 클릭 | 짧은 클릭음 | - |
| 정답 | 상승하는 음 | O |
| 오답 | 하강하는 음 | O (연속) |
| 콤보 (3+) | 콤보 수에 따라 음 상승 | - |
| 몬스터 처치 | 펑! 효과음 | - |
| 보스 등장 | 묵직한 저음 | - |
| 아이템 드랍 | 등급별 반짝임 소리 | - |
| 타이머 경고 | 매초 삐 소리 (10초 이하) | - |
| 던전 시작 | 출발 효과음 | - |
| 클리어 | 승리 멜로디 | - |
| 게임 오버 | 슬픈 멜로디 | - |
| 골드 획득 | 짤랑 소리 | - |

#### 설정
- 설정 화면에서 ON/OFF 토글 가능
- localStorage에 설정 저장

---

### 9. 모바일 지원

| 기능 | 구현 방식 |
|------|-----------|
| 반응형 캔버스 | 화면 크기에 맞춰 자동 조정 |
| 터치 입력 | touchstart/touchmove 이벤트 처리 |
| 카메라 촬영 | input.capture = 'environment' |
| HTTPS | Vite 자체 서명 인증서 |
| 외부 접속 | host: true (0.0.0.0 바인딩) |
| 진동 피드백 | navigator.vibrate() |

---

## 화면 구성

### 1. 메인 화면 (MAIN)
- 타이틀 로고
- 플레이어 레벨/경험치 바 (클릭 시 상세 진척도)
- 현재 스탯 (HP/공격력/시간)
- 골드 표시
- 등록된 오답 수 표시
- 던전 입장 버튼
- 오답 등록 버튼
- 상점/설정 버튼
- AI 문제 생성 버튼 (API 키 설정 시)

### 2. 오답 등록 화면 (REGISTER)
- 과목 선택 (수학, 영어, 과학, 국어)
- 카메라 촬영 → OCR → 문제 입력
- 몬스터 미리보기

### 3. 전투 화면 (BATTLE)
- 플레이어 HP 바
- 레벨/골드 표시
- 스테이지/콤보 표시
- 몬스터 영역 (보스별 다른 스타일)
- 문제 카드
- 4지선다 선택지
- 타이머
- 힌트/스킵/포기 버튼
- 아이템 드랍 알림

### 4. 결과 화면 (RESULT)
- 클리어/실패 표시
- 도달 스테이지
- 처치 몬스터 수
- 최고 콤보
- 획득 골드
- 메인으로 버튼

### 5. 설정 화면 (SETTINGS)
- SmilePrint API 키 입력 (권장)
- Gemini API 키 입력 (백업)
- API 테스트 버튼
- 효과음 ON/OFF
- API 키 발급 안내
- 데이터 관리 (내보내기/불러오기/초기화)

---

## 데이터 구조

### Player
```javascript
{
  id: 'main',
  level: 1,
  exp: 0,
  gold: 100,
  upgrades: { hp: 0, time: 0, goldBonus: 0, damage: 0 },
  inventory: { reviveTicket: 0, hintTicket: 0, timeBoost: 0, doubleGold: 0 },
  stats: { totalRuns: 0, totalKills: 0, bestCombo: 0 },
  createdAt: Date.now()
}
```

### Monster
```javascript
{
  id: auto,
  subject: 'math',
  imageData: 'base64...',
  question: '문제 텍스트',
  answer: '정답',
  choices: ['보기1', '보기2', '보기3', '보기4'],
  correctIndex: 0,
  hp: 100,
  maxHp: 100,
  difficulty: 1,
  parentId: null,          // AI 생성 시 원본 ID
  isGenerated: false,      // AI 생성 여부
  createdAt: Date.now(),
  status: 'alive'          // alive, defeated
}
```

### Run
```javascript
{
  startTime: Date.now(),
  endTime: Date.now(),
  defeatedMonsters: [],
  earnedGold: 0,
  earnedExp: 0,
  bestCombo: 0,
  freeHints: 0,
  revives: 0,
  goldMultiplier: 1,
  timeStops: 0,
  result: 'clear'          // ongoing, clear, failed
}
```

---

## 실행 방법

### 개발 서버
```bash
cd C:\hjkim\app
npm run dev
```

### 접속 주소
- 로컬: https://localhost:9333
- 네트워크: https://192.168.0.192:9333

### 방화벽 설정
```bash
netsh advfirewall firewall add rule name="Vite Dev 9333" dir=in action=allow protocol=tcp localport=9333
```

---

## 향후 개발 예정

### 우선순위 높음
- [ ] PWA 설치 기능 (오프라인 + 홈화면)
- [ ] 학습 통계 대시보드
- [ ] 복습 모드 (전투 없이 오답 복습)

### 우선순위 중간
- [ ] 클라우드 동기화 (계정 연동)
- [ ] 친구 대결 모드
- [ ] 오답 노트 PDF 내보내기

### 우선순위 낮음
- [ ] 테마 선택 (다크/라이트)
- [ ] 업적/뱃지 시스템
- [ ] 리더보드
