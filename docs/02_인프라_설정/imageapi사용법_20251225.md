# SmilePrint ì´ë¯¸ì§€ API í†µí•© ì‚¬ìš©ë²•

**ë²„ì „**: 2025-12-25
**ë² ì´ìŠ¤ URL**: `https://caricature-api-rust.wizice.com`

ì´ ë¬¸ì„œëŠ” SmilePrintì˜ ì´ë¯¸ì§€ ìƒì„± ë° ë¶„ì„ API ì‚¬ìš©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì‹œìŠ¤í…œì—ì„œ ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ì¸ì¦](#1-ì¸ì¦)
2. [Text-to-Image API](#2-text-to-image-api)
3. [Image-to-Image API (ìºë¦¬ì»¤ì²˜)](#3-image-to-image-api-ìºë¦¬ì»¤ì²˜)
4. [Image-to-Text API (ì´ë¯¸ì§€ ë¶„ì„)](#4-image-to-text-api-ì´ë¯¸ì§€-ë¶„ì„)
5. [ë°°ê²½ ì œê±° API](#5-ë°°ê²½-ì œê±°-api)
6. [ê³µí†µ ì‘ë‹µ í˜•ì‹](#6-ê³µí†µ-ì‘ë‹µ-í˜•ì‹)
7. [ì—ëŸ¬ ì²˜ë¦¬](#7-ì—ëŸ¬-ì²˜ë¦¬)
8. [ì‚¬ìš© ì˜ˆì œ](#8-ì‚¬ìš©-ì˜ˆì œ)

---

## 1. ì¸ì¦

ëª¨ë“  API ìš”ì²­ì—ëŠ” `X-API-Key` í—¤ë”ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```http
X-API-Key: YOUR_API_KEY
```

**ì˜ˆì‹œ**:
```bash
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json"
```

---

## 2. Text-to-Image API

í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### 2.1 ì§€ì› ëª¨ë¸

| ëª¨ë¸ ID | ì´ë¦„ | ë¹„ìš© | íŠ¹ì§• |
|---------|------|------|------|
| `gemini-2.5-flash-image` | Gemini 2.5 Flash | $0.039 | ë¹ ë¥´ê³  versatile (ì¶”ì²œ) |
| `gemini-3-pro-image-preview` | Gemini 3 Pro Preview | $0.12 | 4K ì§€ì›, ìµœê³  í’ˆì§ˆ |
| `imagen-3` | Imagen 3 | $0.03 | ìµœì €ê°€, ì‚¬ì§„ê°™ì€ í’ˆì§ˆ |
| `dall-e-3` | DALL-E 3 | $0.04-0.12 | GPT-4 í”„ë¡¬í”„íŠ¸ ê°œì„  |
| `gpt-image-1` | GPT Image 1 | $0.01-0.19 | OpenAI ìµœì‹  ëª¨ë¸ |
| `gpt-image-1-mini` | GPT Image 1 Mini | $0.005-0.052 | ì´ˆì €ê°€, ëŒ€ëŸ‰ ìƒì„± |

### 2.2 ì—”ë“œí¬ì¸íŠ¸

```
POST /api/v1/text-to-image/generate
```

### 2.3 ìš”ì²­ í˜•ì‹

#### ê³µí†µ íŒŒë¼ë¯¸í„°

```json
{
  "model": "gemini-2.5-flash-image",
  "prompt": "A serene mountain landscape at sunset",
  "storageType": "gcs"
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|------|------|--------|------|
| `model` | string | âœ… | - | ì‚¬ìš©í•  AI ëª¨ë¸ |
| `prompt` | string | âœ… | - | ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸ (ì˜ì–´) |
| `storageType` | string | âŒ | `base64` | `base64` (Firestore, 1ì‹œê°„ TTL) ë˜ëŠ” `gcs` (GCS/R2, ì‚¬ìš©ì ì§€ì • TTL) |
| `ttlHours` | number | âŒ | `168` | ì´ë¯¸ì§€ ë§Œë£Œ ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„, storageType=gcsì¸ ê²½ìš°ë§Œ ì ìš©)<br/>- ìµœì†Œ: 1ì‹œê°„<br/>- ìµœëŒ€: ì œí•œ ì—†ìŒ (10ë…„ë„ ê°€ëŠ¥)<br/>- ê¸°ë³¸ê°’: 168ì‹œê°„ (7ì¼) |

**ğŸ’¡ ì €ì¥ ì˜µì…˜**:
- `base64`: Firestoreì— ì••ì¶•ëœ Base64 í˜•íƒœë¡œ ì €ì¥ (1ì‹œê°„ ê³ ì • TTL)
- `gcs`: GCS ë˜ëŠ” Cloudflare R2ì— ì›ë³¸ PNGë¡œ ì €ì¥ (ë³´ì•ˆ ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸, **ì‚¬ìš©ì ì§€ì • TTL**)

**â° TTL (Time To Live) ì„¤ì •**:
- **Firestore** (`storageType=base64`): 1ì‹œê°„ ê³ ì • (ë³€ê²½ ë¶ˆê°€)
- **GCS/R2** (`storageType=gcs`): `ttlHours` íŒŒë¼ë¯¸í„°ë¡œ ììœ ë¡­ê²Œ ì„¤ì • ê°€ëŠ¥
  - ë‹¨ê¸° ë³´ê´€: 24ì‹œê°„ (`ttlHours: 24`)
  - ì¤‘ê¸° ë³´ê´€: 7ì¼ - ê¸°ë³¸ê°’ (`ttlHours: 168`)
  - ì¥ê¸° ë³´ê´€: 30ì¼ (`ttlHours: 720`), 1ë…„ (`ttlHours: 8760`), 10ë…„ (`ttlHours: 87600`)

#### Gemini ëª¨ë¸ ì¶”ê°€ íŒŒë¼ë¯¸í„°

```json
{
  "model": "gemini-2.5-flash-image",
  "prompt": "A serene mountain landscape",
  "aspectRatio": "16:9",
  "style": "watercolor",
  "storageType": "gcs"
}
```

| í•„ë“œ | íƒ€ì… | ì˜µì…˜ | ì„¤ëª… |
|------|------|------|------|
| `aspectRatio` | string | `1:1`, `3:4`, `4:3`, `16:9`, `9:16`, `21:9` | ì´ë¯¸ì§€ ë¹„ìœ¨ (ê¸°ë³¸: `1:1`) |
| `style` | string | - | ìŠ¤íƒ€ì¼ (ì˜ˆ: "watercolor", "anime") |

#### Imagen 3 ì¶”ê°€ íŒŒë¼ë¯¸í„°

```json
{
  "model": "imagen-3",
  "prompt": "A beautiful landscape",
  "aspectRatio": "16:9"
}
```

| í•„ë“œ | íƒ€ì… | ì˜µì…˜ | ì„¤ëª… |
|------|------|------|------|
| `aspectRatio` | string | `1:1`, `3:4`, `4:3`, `16:9`, `9:16` | ì´ë¯¸ì§€ ë¹„ìœ¨ |

#### DALL-E 3 ì¶”ê°€ íŒŒë¼ë¯¸í„°

```json
{
  "model": "dall-e-3",
  "prompt": "A futuristic city",
  "size": "1024x1024",
  "quality": "hd",
  "style": "vivid"
}
```

| í•„ë“œ | íƒ€ì… | ì˜µì…˜ | ì„¤ëª… |
|------|------|------|------|
| `size` | string | `1024x1024`, `1024x1792`, `1792x1024` | ì´ë¯¸ì§€ í¬ê¸° |
| `quality` | string | `standard`, `hd` | í’ˆì§ˆ |
| `style` | string | `vivid`, `natural` | ìŠ¤íƒ€ì¼ |

#### GPT Image ì¶”ê°€ íŒŒë¼ë¯¸í„°

```json
{
  "model": "gpt-image-1",
  "prompt": "An abstract art piece",
  "quality": "medium"
}
```

| í•„ë“œ | íƒ€ì… | ì˜µì…˜ | ì„¤ëª… |
|------|------|------|------|
| `quality` | string | `low`, `medium`, `high`, `auto` | í’ˆì§ˆ/ë¹„ìš© |

### 2.4 ì‘ë‹µ í˜•ì‹ (ë¹„ë™ê¸° ì²˜ë¦¬)

**âš ï¸ ì¤‘ìš”**: Text-to-Image APIëŠ” **ë¹„ë™ê¸°**ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ì¦‰ì‹œ Job IDë¥¼ ë°˜í™˜í•˜ê³ , ë³„ë„ë¡œ ìƒíƒœë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

#### ì¦‰ì‹œ ì‘ë‹µ (Job ìƒì„±)

```json
{
  "success": true,
  "jobId": "text_to_image_20251201_aBc123",
  "accessKey": "text_to_image_20251201_aBc123.9f8e7d6c5b4a3...",
  "status": "processing",
  "model": "gemini-2.5-flash-image",
  "estimatedCost": 0.039,
  "message": "Job created, processing in background"
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `success` | boolean | Job ìƒì„± ì„±ê³µ ì—¬ë¶€ (í•­ìƒ `true`) |
| `jobId` | string | Job ê³ ìœ  ID (ìƒíƒœ í™•ì¸ì— ì‚¬ìš©) |
| `accessKey` | string | Job ì ‘ê·¼ í‚¤ (ì¸ì¦ì— ì‚¬ìš©) |
| `status` | string | ì´ˆê¸° ìƒíƒœ (`processing`) |
| `model` | string | ì‚¬ìš© ì¤‘ì¸ ëª¨ë¸ |
| `estimatedCost` | number | ì˜ˆìƒ ë¹„ìš© (USD) |
| `message` | string | ìƒíƒœ ë©”ì‹œì§€ |

### 2.5 ìƒíƒœ í™•ì¸

```
GET /api/v1/text-to-image/status/{jobId}
Authorization: Bearer {accessKey}
```

**í—¤ë”**:
```http
Authorization: Bearer text_to_image_20251201_aBc123.9f8e7d6c5b4a3...
```

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°** (ì„ íƒ):
- `hashOnly=true`: Base64 ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì œì™¸í•˜ê³  ìƒíƒœë§Œ ì¡°íšŒ

#### ì²˜ë¦¬ ì¤‘ ì‘ë‹µ

```json
{
  "jobId": "text_to_image_20251201_aBc123",
  "status": "processing",
  "progress": 80,
  "message": "Image generated, uploading...",
  "model": "gemini-2.5-flash-image"
}
```

#### ì™„ë£Œ ì‘ë‹µ (Base64)

```json
{
  "jobId": "text_to_image_20251201_aBc123",
  "status": "completed",
  "progress": 100,
  "message": "Completed",
  "model": "gemini-2.5-flash-image",
  "imageData": "iVBORw0KGgoAAAANSUhEUgAA...",
  "mimeType": "image/png",
  "processingTime": 3.5,
  "actualCost": 0.039
}
```

#### ì™„ë£Œ ì‘ë‹µ (GCS/R2 ë³´ì•ˆ ë‹¤ìš´ë¡œë“œ)

```json
{
  "jobId": "text_to_image_20251201_aBc123",
  "status": "completed",
  "progress": 100,
  "message": "Completed",
  "model": "gemini-2.5-flash-image",
  "downloadUrl": "/api/v1/text-to-image/download/text_to_image_20251201_aBc123",
  "mimeType": "image/png",
  "processingTime": 4.2,
  "actualCost": 0.039,
  "generatedAt": "2025-12-24T00:08:12Z",
  "expireTime": "2025-12-31T00:08:12Z"
}
```

**ğŸ’¡ ë³´ì•ˆ ë‹¤ìš´ë¡œë“œ íŠ¹ì§•**:
- **ì¸ì¦ í•„ìš”**: `Authorization: Bearer {accessKey}` í—¤ë” í•„ìˆ˜
- **í˜•ì‹**: `/api/v1/text-to-image/download/{job_id}` (ìƒëŒ€ ê²½ë¡œ)
- **ì ‘ê·¼**: Job ì†Œìœ ìë§Œ ì ‘ê·¼ ê°€ëŠ¥ (Access Key ê²€ì¦)
- **ìœ íš¨ê¸°ê°„**: 7ì¼ (GCS signed URL ë§Œë£Œ ë˜ëŠ” R2 ë§Œë£Œ ë©”íƒ€ë°ì´í„°)

#### ì‹¤íŒ¨ ì‘ë‹µ

```json
{
  "jobId": "text_to_image_20251201_aBc123",
  "status": "failed",
  "progress": 0,
  "message": "Failed",
  "model": "gemini-2.5-flash-image",
  "errorMessage": "AI API error: ...",
  "errorCode": "GENERATION_FAILED"
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `jobId` | string | Job ID |
| `status` | string | `processing`, `completed`, `failed` |
| `progress` | number | ì§„í–‰ë¥  (0-100) |
| `message` | string | ìƒíƒœ ë©”ì‹œì§€ |
| `model` | string | ì‚¬ìš©ëœ ëª¨ë¸ |
| `imageData` | string | Base64 ì´ë¯¸ì§€ (storageType=base64) |
| `downloadUrl` | string | ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸ (storageType=gcs, ì¸ì¦ í•„ìš”) |
| `mimeType` | string | MIME íƒ€ì… |
| `processingTime` | number | ì²˜ë¦¬ ì‹œê°„ (ì´ˆ) |
| `actualCost` | number | ì‹¤ì œ ë¹„ìš© (USD) |
| `generatedAt` | string | ì´ë¯¸ì§€ ìƒì„± ì‹œê° (ISO 8601) |
| `expireTime` | string | ë§Œë£Œ ì‹œê° (ISO 8601, TTL ê¸°ë°˜) |
| `errorMessage` | string | ì—ëŸ¬ ë©”ì‹œì§€ (ì‹¤íŒ¨ ì‹œ) |
| `errorCode` | string | ì—ëŸ¬ ì½”ë“œ (ì‹¤íŒ¨ ì‹œ) |

### 2.6 ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

**âš ï¸ ë³´ì•ˆ**: `storageType=gcs`ë¡œ ìƒì„±ëœ ì´ë¯¸ì§€ëŠ” ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

```
GET /api/v1/text-to-image/download/{jobId}
Authorization: Bearer {accessKey}
```

#### ìš”ì²­ ì˜ˆì‹œ

```bash
curl "https://caricature-api-rust.wizice.com/api/v1/text-to-image/download/text_to_image_20251201_aBc123" \
  -H "Authorization: Bearer text_to_image_20251201_aBc123.9f8e7d6c5b4a3..." \
  -o image.png
```

#### ì‘ë‹µ

**ì„±ê³µ (200 OK)**:
```
Content-Type: image/png
Content-Disposition: inline; filename="text_to_image_20251201_aBc123.png"
Cache-Control: public, max-age=604800

[Binary Image Data]
```

**ì—ëŸ¬ ì‘ë‹µ**:
```json
// 401 Unauthorized (ì˜ëª»ëœ Access Key)
{
  "errorCode": "INVALID_ACCESS_KEY",
  "errorMessage": "Invalid access key"
}

// 404 Not Found (Job ì—†ìŒ ë˜ëŠ” ë§Œë£Œë¨)
{
  "errorCode": "JOB_NOT_FOUND",
  "errorMessage": "Job not found"
}

// 400 Bad Request (ì•„ì§ ì²˜ë¦¬ ì¤‘)
{
  "errorCode": "INVALID_REQUEST",
  "errorMessage": "Image not ready yet. Please check job status."
}
```

#### Pythonì—ì„œ ë‹¤ìš´ë¡œë“œ

```python
import requests

def download_image(job_id, access_key, output_path):
    """ë³´ì•ˆ ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ"""
    url = f"https://caricature-api-rust.wizice.com/api/v1/text-to-image/download/{job_id}"
    headers = {
        "Authorization": f"Bearer {access_key}"
    }

    response = requests.get(url, headers=headers)
    response.raise_for_status()

    with open(output_path, 'wb') as f:
        f.write(response.content)

    print(f"âœ… Image downloaded to {output_path}")

# ì‚¬ìš© ì˜ˆì‹œ
download_image(
    job_id="text_to_image_20251201_aBc123",
    access_key="text_to_image_20251201_aBc123.9f8e7d6c5b4a3...",
    output_path="generated_image.png"
)
```

#### JavaScriptì—ì„œ ë‹¤ìš´ë¡œë“œ

```javascript
async function downloadImage(jobId, accessKey, outputPath) {
  const url = `https://caricature-api-rust.wizice.com/api/v1/text-to-image/download/${jobId}`;

  const response = await fetch(url, {
    headers: {
      'Authorization': `Bearer ${accessKey}`
    }
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(`Download failed: ${error.errorMessage}`);
  }

  const blob = await response.blob();
  // ë¸Œë¼ìš°ì €ì—ì„œ ìë™ ë‹¤ìš´ë¡œë“œ
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${jobId}.png`;
  a.click();

  console.log('âœ… Image downloaded');
}

// ì‚¬ìš© ì˜ˆì‹œ
downloadImage(
  'text_to_image_20251201_aBc123',
  'text_to_image_20251201_aBc123.9f8e7d6c5b4a3...'
);
```

### 2.7 ì‚¬ìš© ì˜ˆì œ

#### Python (ë¹„ë™ê¸° ì²˜ë¦¬ with í´ë§)

```python
import requests
import base64
import time
from io import BytesIO
from PIL import Image

API_URL = "https://caricature-api-rust.wizice.com"
API_KEY = "YOUR_API_KEY"

def generate_text_to_image(prompt, model="gemini-2.5-flash-image", storage_type="base64", ttl_hours=None):
    """í…ìŠ¤íŠ¸ë¡œ ì´ë¯¸ì§€ ìƒì„± (ë¹„ë™ê¸°)"""

    # 1. Job ìƒì„±
    url = f"{API_URL}/api/v1/text-to-image/generate"

    payload = {
        "model": model,
        "prompt": prompt,
        "storageType": storage_type
    }

    # TTL ì„¤ì • (GCS ì €ì¥ì¸ ê²½ìš°)
    if storage_type == "gcs" and ttl_hours is not None:
        payload["ttlHours"] = ttl_hours

    # Gemini ëª¨ë¸ì¸ ê²½ìš° ì¶”ê°€ ì˜µì…˜
    if model.startswith("gemini"):
        payload["aspectRatio"] = "16:9"
        payload["style"] = "realistic"

    headers = {
        "X-API-Key": API_KEY,
        "Content-Type": "application/json"
    }

    response = requests.post(url, json=payload, headers=headers)
    response.raise_for_status()

    job_data = response.json()
    job_id = job_data["jobId"]
    access_key = job_data["accessKey"]

    print(f"Job created: {job_id}")
    print(f"Estimated cost: ${job_data['estimatedCost']}")

    # 2. ìƒíƒœ í´ë§ (ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°)
    status_url = f"{API_URL}/api/v1/text-to-image/status/{job_id}"
    status_headers = {
        "Authorization": f"Bearer {access_key}"
    }

    max_attempts = 60  # ìµœëŒ€ 60ì´ˆ ëŒ€ê¸°
    for attempt in range(max_attempts):
        time.sleep(1)  # 1ì´ˆ ëŒ€ê¸°

        status_response = requests.get(status_url, headers=status_headers)
        status_response.raise_for_status()

        status_data = status_response.json()
        status = status_data["status"]
        progress = status_data.get("progress", 0)

        print(f"Status: {status}, Progress: {progress}%")

        if status == "completed":
            print(f"Processing time: {status_data.get('processingTime', 0):.2f}s")
            print(f"Actual cost: ${status_data.get('actualCost', 0)}")

            if storage_type == "base64":
                # Base64 ì´ë¯¸ì§€ ë””ì½”ë”©
                image_data = base64.b64decode(status_data["imageData"])
                image = Image.open(BytesIO(image_data))
                return image
            else:
                # GCS: downloadUrl ë°˜í™˜ (ì¸ì¦ í•„ìš”)
                download_url = status_data["downloadUrl"]
                # ë‹¤ìš´ë¡œë“œ ìˆ˜í–‰
                download_response = requests.get(
                    f"{API_URL}{download_url}",
                    headers={"Authorization": f"Bearer {access_key}"}
                )
                download_response.raise_for_status()
                image_data = download_response.content
                image = Image.open(BytesIO(image_data))
                return image

        elif status == "failed":
            raise Exception(f"Generation failed: {status_data.get('errorMessage')}")

    raise Exception("Timeout waiting for job completion")

# ì‚¬ìš© ì˜ˆì‹œ
try:
    # Base64ë¡œ ë°›ê¸° (Firestore, 1ì‹œê°„ TTL)
    image = generate_text_to_image(
        prompt="A serene mountain landscape at sunset",
        model="gemini-2.5-flash-image",
        storage_type="base64"
    )
    image.save("output_base64.png")
    print("Image saved to output_base64.png")

    # GCSë¡œ ë°›ê¸° (R2, ê¸°ë³¸ 7ì¼ TTL, ë³´ì•ˆ ë‹¤ìš´ë¡œë“œ)
    image = generate_text_to_image(
        prompt="A cute cat playing with yarn",
        model="gemini-2.5-flash-image",
        storage_type="gcs"
    )
    image.save("output_gcs.png")
    print("Image saved to output_gcs.png")

    # GCSë¡œ ë°›ê¸° (R2, 30ì¼ TTL, ì¥ê¸° ë³´ê´€)
    image = generate_text_to_image(
        prompt="An important company logo design",
        model="gemini-2.5-flash-image",
        storage_type="gcs",
        ttl_hours=720  # 30ì¼
    )
    image.save("logo_30days.png")
    print("Logo saved with 30-day TTL")

except Exception as e:
    print(f"Error: {e}")

```

#### JavaScript/Node.js

```javascript
const axios = require('axios');
const fs = require('fs');

const API_URL = 'https://caricature-api-rust.wizice.com';
const API_KEY = 'YOUR_API_KEY';

async function generateTextToImage(prompt, model = 'gemini-2.5-flash-image') {
  try {
    const response = await axios.post(
      `${API_URL}/api/v1/text-to-image/generate`,
      {
        model,
        prompt,
        storageType: 'gcs', // 'base64' ë˜ëŠ” 'gcs'
        ...(model.startsWith('gemini') && {
          aspectRatio: '16:9',
          style: 'realistic'
        })
      },
      {
        headers: {
          'X-API-Key': API_KEY,
          'Content-Type': 'application/json'
        }
      }
    );

    const result = response.data;

    if (result.success) {
      if (result.imageBase64) {
        // Base64ë¥¼ íŒŒì¼ë¡œ ì €ì¥
        const base64Data = result.imageBase64.split(',')[1];
        const buffer = Buffer.from(base64Data, 'base64');
        fs.writeFileSync('generated_image.png', buffer);
        console.log(`âœ… ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ (ë¹„ìš©: $${result.actualCost.toFixed(4)})`);
      } else if (result.imageUrl) {
        console.log(`âœ… ì´ë¯¸ì§€ URL: ${result.imageUrl}`);
        console.log(`   ë¹„ìš©: $${result.actualCost.toFixed(4)}`);
      }
      return result;
    } else {
      console.error(`âŒ ì˜¤ë¥˜: ${result.message}`);
      return null;
    }
  } catch (error) {
    console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨:', error.response?.data || error.message);
    return null;
  }
}

// ì‚¬ìš© ì˜ˆì œ
generateTextToImage(
  'A beautiful sunset over mountains with vibrant colors',
  'gemini-2.5-flash-image'
);
```

#### cURL

```bash
# Base64ë¡œ ë°›ê¸°
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash-image",
    "prompt": "A beautiful sunset over mountains",
    "aspectRatio": "16:9",
    "storageType": "base64"
  }'

# URLë¡œ ë°›ê¸° (R2 ì €ì¥, ê¸°ë³¸ 7ì¼ TTL)
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash-image",
    "prompt": "A beautiful sunset over mountains",
    "aspectRatio": "16:9",
    "storageType": "gcs"
  }'

# URLë¡œ ë°›ê¸° (R2 ì €ì¥, 30ì¼ TTL)
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash-image",
    "prompt": "An important company logo design",
    "aspectRatio": "1:1",
    "storageType": "gcs",
    "ttlHours": 720
  }'

# URLë¡œ ë°›ê¸° (R2 ì €ì¥, 1ë…„ TTL - ì¥ê¸° ë³´ê´€)
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash-image",
    "prompt": "Permanent archive image",
    "storageType": "gcs",
    "ttlHours": 8760
  }'
```

---

## 3. Image-to-Image API (ìºë¦¬ì»¤ì²˜)

ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ ìºë¦¬ì»¤ì²˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

### 3.1 ì§€ì› ëª¨ë¸

| ëª¨ë¸ ID | ì´ë¦„ | ë¹„ìš© | ë‹¤ì¤‘ ì´ë¯¸ì§€ | íŠ¹ì§• |
|---------|------|------|-------------|------|
| `gemini` ë˜ëŠ” `gemini-2.5-flash-image` | Gemini 2.5 Flash | $0.039 | âœ… ì§€ì› | ë¹ ë¥´ê³  ì•ˆì •ì  (ì¶”ì²œ) |
| `gemini-3-pro-image-preview` | Gemini 3 Pro Image Preview | $0.12 | âœ… ì§€ì› (ìµœëŒ€ 14ê°œ) | ê³ ê¸‰ í•©ì„±, 4K ì¶œë ¥ |
| `flux` | Flux.1 Pro | $0.055 | âŒ ë‹¨ì¼ | ê³ í’ˆì§ˆ ì´ë¯¸ì§€ ìƒì„± |
| `gpt` | GPT Image 1 | $0.10 | âŒ ë‹¨ì¼ | OpenAI ì´ë¯¸ì§€ í¸ì§‘ |

**âš ï¸ ì°¸ê³ **: Gemini 3 Pro Image PreviewëŠ” ë‹¤ì¤‘ ì´ë¯¸ì§€ í•©ì„±ì„ ì§€ì›í•˜ì§€ë§Œ, image-to-image ë³€í™˜ì—ëŠ” ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Text-to-Image API ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

### 3.2 ì—”ë“œí¬ì¸íŠ¸

```
POST /api/v1/caricature/generate
```

### 3.3 ìš”ì²­ í˜•ì‹

**Multipart Form Data**

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|------|------|--------|------|
| `image` | file | âœ… | - | ë³€í™˜í•  ì´ë¯¸ì§€ íŒŒì¼ (JPEG, PNG) - ì—¬ëŸ¬ ë²ˆ ì§€ì • ê°€ëŠ¥ |
| `imageUrls` | string | âŒ | - | ì´ë¯¸ì§€ URL ë°°ì—´ (JSON í˜•ì‹: `["url1", "url2"]`) |
| `model` | string | âŒ | `gemini` | ì‚¬ìš©í•  ëª¨ë¸ |
| `prompt` | string | âŒ | - | ì¶”ê°€ í”„ë¡¬í”„íŠ¸ |
| `style` | string | âŒ | - | ìŠ¤íƒ€ì¼ ì§€ì • (ì˜ˆ: "watercolor", "anime") |
| `aspectRatio` | string | âŒ | `1:1` | ë¹„ìœ¨ (`1:1`, `3:4`, `4:3`, `16:9`, `9:16`) |
| `storageType` | string | âŒ | `firestore` | `firestore` (1ì‹œê°„ ê³ ì • TTL) ë˜ëŠ” `gcs` (ì‚¬ìš©ì ì§€ì • TTL) |
| `ttlHours` | number | âŒ | `24` | ì´ë¯¸ì§€ ë§Œë£Œ ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„, storageType=gcsì¸ ê²½ìš°ë§Œ ì ìš©)<br/>- ìµœì†Œ: 1ì‹œê°„<br/>- ìµœëŒ€: ì œí•œ ì—†ìŒ<br/>- ê¸°ë³¸ê°’: 24ì‹œê°„ |
| `background` | string | âŒ | - | ë°°ê²½ ì˜µì…˜ (`remove`, `transparent`, `original`) |

**ğŸ’¡ ë‹¤ì¤‘ ì´ë¯¸ì§€ í•©ì„±**:

ë°©ë²• 1: íŒŒì¼ ì—…ë¡œë“œ (ë¡œì»¬ íŒŒì¼)
```bash
# ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ í•©ì„±í•˜ì—¬ í•˜ë‚˜ì˜ í‘œì§€ ì´ë¯¸ì§€ ì œì‘ (30ì¼ ë³´ê´€)
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/caricature/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "model=gemini-3-pro-image-preview" \
  -F "image=@background.jpg" \
  -F "image=@person.png" \
  -F "image=@typography.png" \
  -F "prompt=Create a professional book cover with the person in the center, typography overlay on top, background landscape style, 4K quality" \
  -F "aspectRatio=3:4" \
  -F "storageType=gcs" \
  -F "ttlHours=720"
```

ë°©ë²• 2: ì´ë¯¸ì§€ URL ì‚¬ìš© (ì›ê²© ì´ë¯¸ì§€)
```bash
# ì—¬ëŸ¬ ì´ë¯¸ì§€ URLì„ JSON ë°°ì—´ë¡œ ì „ì†¡í•˜ì—¬ í•©ì„±
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/caricature/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F 'imageUrls=["https://example.com/background.jpg", "https://example.com/person.png", "https://example.com/logo.png"]' \
  -F "model=gemini-3-pro-image-preview" \
  -F "prompt=Create a professional poster with background, person in center, and logo overlay. 4K quality, modern design." \
  -F "aspectRatio=3:4" \
  -F "storageType=gcs" \
  -F "ttlHours=720"
```

**ğŸ’¡ ì°¸ê³ **:
- `image` í•„ë“œ: ë¡œì»¬ íŒŒì¼ ì—…ë¡œë“œ (ì—¬ëŸ¬ ë²ˆ ì§€ì • ê°€ëŠ¥)
- `imageUrls` í•„ë“œ: ì›ê²© ì´ë¯¸ì§€ URL (JSON ë°°ì—´ ë¬¸ìì—´ë¡œ ì „ì†¡)
- ë‘ ë°©ë²•ì„ í˜¼ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (ì¼ë¶€ëŠ” íŒŒì¼, ì¼ë¶€ëŠ” URL)
- ìì„¸í•œ ì˜ˆì œëŠ” [Section 3.6 - ë‹¤ì¤‘ ì´ë¯¸ì§€ URL í•©ì„±](#ë‹¤ì¤‘-ì´ë¯¸ì§€-url-í•©ì„±) ì°¸ì¡°

### 3.4 ì‘ë‹µ í˜•ì‹

#### ì¦‰ì‹œ ë°˜í™˜ (ì‘ì€ ì´ë¯¸ì§€)

```json
{
  "jobId": "caric_20251201_ABC123",
  "accessKey": "caric_20251201_ABC123.hash...",
  "status": "completed",
  "message": "Caricature generated successfully",
  "imageUrl": "/api/v1/caricature/image?key=caric_20251201_ABC123.hash...",
  "processingTime": 3.5,
  "model": "gemini",
  "actualCost": 0.039,
  "generatedAt": "2025-12-01T12:00:00Z",
  "expireTime": "2025-12-02T12:00:00Z"
}
```

**ğŸ’¡ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ**:
- `imageUrl`ì€ **ìƒëŒ€ ê²½ë¡œ** í˜•ì‹ìœ¼ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤: `/api/v1/caricature/image?key={access_key}`
- ë¸Œë¼ìš°ì €ë‚˜ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ì‹œ base URLì„ ì¶”ê°€í•˜ì„¸ìš”: `https://caricature-api-rust.wizice.com/api/v1/caricature/image?key={access_key}`
- ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” **ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥**í•˜ë©°, access keyê°€ URLì— í¬í•¨ë˜ì–´ ìˆì–´ ë³´ì•ˆì„ ìœ ì§€í•©ë‹ˆë‹¤
- TTL ê¸°ê°„ ë™ì•ˆ ì–¸ì œë“ ì§€ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ (Presigned URLì˜ 7ì¼ ì œí•œ ì—†ìŒ)

**ğŸ’¡ TTL (Time To Live) ì„¤ì •**:
- **Firestore** (`storageType=firestore`): 1ì‹œê°„ ê³ ì • (ë³€ê²½ ë¶ˆê°€)
- **GCS/R2** (`storageType=gcs`): `ttlHours` íŒŒë¼ë¯¸í„°ë¡œ ììœ ë¡­ê²Œ ì„¤ì • ê°€ëŠ¥
  - ë‹¨ê¸° ë³´ê´€: 1ì‹œê°„ (`ttlHours: 1`), 24ì‹œê°„ - ê¸°ë³¸ê°’ (`ttlHours: 24`)
  - ì¤‘ê¸° ë³´ê´€: 7ì¼ (`ttlHours: 168`), 30ì¼ (`ttlHours: 720`)
  - ì¥ê¸° ë³´ê´€: 1ë…„ (`ttlHours: 8760`), 10ë…„ (`ttlHours: 87600`)

#### ë¹„ë™ê¸° ì²˜ë¦¬ (í° ì´ë¯¸ì§€)

```json
{
  "jobId": "caric_20251201_ABC123",
  "accessKey": "caric_20251201_ABC123.hash...",
  "status": "processing",
  "message": "Job created and processing in background",
  "statusUrl": "/api/v1/caricature/status/caric_20251201_ABC123"
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `jobId` | string | ì‘ì—… ID |
| `accessKey` | string | ìƒíƒœ ì¡°íšŒìš© í‚¤ |
| `status` | string | `processing`, `completed`, `failed` |
| `message` | string | ìƒíƒœ ë©”ì‹œì§€ |
| `imageUrl` | string | ìƒì„±ëœ ì´ë¯¸ì§€ URL (completed ì‹œ) |
| `processingTime` | number | ì²˜ë¦¬ ì‹œê°„ (ì´ˆ) |
| `model` | string | ì‚¬ìš©ëœ ëª¨ë¸ |
| `actualCost` | number | ë¹„ìš© (USD) |
| `generatedAt` | string | ìƒì„± ì‹œê° (ISO 8601) |
| `expireTime` | string | ë§Œë£Œ ì‹œê° (Firestore: 1ì‹œê°„ ê³ ì • / GCS/R2: ì‚¬ìš©ì ì§€ì • TTL) |

### 3.5 ìƒíƒœ ì¡°íšŒ

```
GET /api/v1/caricature/status/{jobId}
Authorization: Bearer {accessKey}
```

#### ì‘ë‹µ (ì²˜ë¦¬ ì¤‘)

```json
{
  "jobId": "caric_20251201_ABC123",
  "status": "processing",
  "message": "Image is being processed...",
  "model": "gemini"
}
```

#### ì‘ë‹µ (ì™„ë£Œ)

```json
{
  "jobId": "caric_20251201_ABC123",
  "status": "completed",
  "message": "Caricature completed",
  "imageUrl": "/api/v1/caricature/image?key=caric_20251201_ABC123.hash...",
  "processingTime": 4.2,
  "model": "gemini",
  "actualCost": 0.039,
  "generatedAt": "2025-12-01T12:00:00Z",
  "expireTime": "2025-12-02T12:00:00Z"
}
```

#### ì‘ë‹µ (ì‹¤íŒ¨)

```json
{
  "jobId": "caric_20251201_ABC123",
  "status": "failed",
  "errorCode": "SAFETY_VIOLATION",
  "errorMessage": "Image rejected due to safety concerns",
  "errorDetails": {
    "rejection_analysis": {
      "summary": "ì´ë¯¸ì§€ê°€ ì•ˆì „ ì •ì±…ì„ ìœ„ë°˜í–ˆìŠµë‹ˆë‹¤",
      "safetyConcerns": {
        "riskLevel": "high",
        "violence": true,
        "sexualContent": false
      },
      "recommendations": [
        "ë‹¤ë¥¸ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”"
      ]
    }
  }
}
```

### 3.6 ì‚¬ìš© ì˜ˆì œ

#### Python

```python
import requests
import time

API_URL = "https://caricature-api-rust.wizice.com"
API_KEY = "YOUR_API_KEY"

def generate_caricature(image_path, model="gemini", ttl_hours=24):
    """ì´ë¯¸ì§€ë¥¼ ìºë¦¬ì»¤ì²˜ë¡œ ë³€í™˜"""
    url = f"{API_URL}/api/v1/caricature/generate"

    with open(image_path, 'rb') as f:
        files = {'image': f}
        data = {
            'model': model,
            'background': 'remove',  # ë°°ê²½ ì œê±°
            'storageType': 'gcs',    # GCS ì €ì¥ (TTL ì„¤ì • ê°€ëŠ¥)
            'ttlHours': ttl_hours    # TTL ì„¤ì •
        }
        headers = {'X-API-Key': API_KEY}

        response = requests.post(url, files=files, data=data, headers=headers)
        result = response.json()

    job_id = result['jobId']
    access_key = result['accessKey']

    # ì¦‰ì‹œ ì™„ë£Œëœ ê²½ìš°
    if result['status'] == 'completed':
        print(f"âœ… ì™„ë£Œ: {result['imageUrl']}")
        return result

    # ë¹„ë™ê¸° ì²˜ë¦¬ì¸ ê²½ìš° - ìƒíƒœ í´ë§
    print(f"â³ ì²˜ë¦¬ ì¤‘... (Job ID: {job_id})")
    status_url = f"{API_URL}/api/v1/caricature/status/{job_id}"

    while True:
        response = requests.get(
            status_url,
            headers={'Authorization': f'Bearer {access_key}'}
        )
        status = response.json()

        if status['status'] == 'completed':
            print(f"âœ… ì™„ë£Œ: {status['imageUrl']}")
            print(f"   ë¹„ìš©: ${status['actualCost']:.4f}")
            return status
        elif status['status'] == 'failed':
            print(f"âŒ ì‹¤íŒ¨: {status.get('errorMessage')}")
            return status

        time.sleep(2)  # 2ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„

# ì‚¬ìš© ì˜ˆì œ

# ê¸°ë³¸ 24ì‹œê°„ TTL
result = generate_caricature('my_photo.jpg', model='gemini')

# 7ì¼ TTL
result = generate_caricature('my_photo.jpg', model='gemini', ttl_hours=168)

# 30ì¼ TTL (ì¥ê¸° ë³´ê´€)
result = generate_caricature('important_photo.jpg', model='gemini', ttl_hours=720)
```

#### ë‹¤ì¤‘ ì´ë¯¸ì§€ URL í•©ì„±

ì—¬ëŸ¬ ì´ë¯¸ì§€ URLì„ ì‚¬ìš©í•˜ì—¬ í•˜ë‚˜ì˜ í•©ì„± ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

##### Python

```python
import requests
import json
import time

API_URL = "https://caricature-api-rust.wizice.com"
API_KEY = "YOUR_API_KEY"

def compose_images_from_urls(image_urls, prompt, model="gemini-3-pro-image-preview", aspect_ratio="16:9", ttl_hours=168):
    """ì—¬ëŸ¬ ì´ë¯¸ì§€ URLì„ í•©ì„±í•˜ì—¬ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ ìƒì„±"""
    url = f"{API_URL}/api/v1/caricature/generate"

    # imageUrlsëŠ” JSON ë¬¸ìì—´ë¡œ ì „ì†¡
    data = {
        'imageUrls': json.dumps(image_urls),  # JSON ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜
        'model': model,
        'prompt': prompt,
        'aspectRatio': aspect_ratio,
        'storageType': 'gcs',
        'ttlHours': ttl_hours
    }

    headers = {'X-API-Key': API_KEY}

    response = requests.post(url, data=data, headers=headers)
    result = response.json()

    job_id = result['jobId']
    access_key = result['accessKey']

    print(f"â³ í•©ì„± ì‘ì—… ì‹œì‘... (Job ID: {job_id})")

    # ì¦‰ì‹œ ì™„ë£Œëœ ê²½ìš°
    if result['status'] == 'completed':
        print(f"âœ… ì™„ë£Œ: {result['imageUrl']}")
        return result

    # ë¹„ë™ê¸° ì²˜ë¦¬ - ìƒíƒœ í´ë§
    status_url = f"{API_URL}/api/v1/caricature/status/{job_id}"

    while True:
        time.sleep(3)  # 3ì´ˆ ëŒ€ê¸°

        response = requests.get(
            status_url,
            headers={'Authorization': f'Bearer {access_key}'}
        )
        status = response.json()

        print(f"   ìƒíƒœ: {status['status']}")

        if status['status'] == 'completed':
            print(f"âœ… í•©ì„± ì™„ë£Œ!")
            print(f"   ì´ë¯¸ì§€ URL: {status['imageUrl']}")
            print(f"   ì²˜ë¦¬ ì‹œê°„: {status['processingTime']:.2f}ì´ˆ")
            print(f"   ë¹„ìš©: ${status['actualCost']:.4f}")
            return status
        elif status['status'] == 'failed':
            print(f"âŒ ì‹¤íŒ¨: {status.get('errorMessage')}")
            return status

# ì‚¬ìš© ì˜ˆì œ 1: ì±… í‘œì§€ ë””ìì¸ í•©ì„±
result = compose_images_from_urls(
    image_urls=[
        "https://example.com/background-landscape.jpg",
        "https://example.com/person-portrait.png",
        "https://example.com/logo.png"
    ],
    prompt="Create a professional book cover with the landscape as background, person in the center, and logo at the top. Make it elegant and modern with 4K quality.",
    model="gemini-3-pro-image-preview",
    aspect_ratio="3:4",
    ttl_hours=720  # 30ì¼ ë³´ê´€
)

# ì‚¬ìš© ì˜ˆì œ 2: ì œí’ˆ ì¹´íƒˆë¡œê·¸ í•©ì„±
result = compose_images_from_urls(
    image_urls=[
        "https://example.com/product1.jpg",
        "https://example.com/product2.jpg",
        "https://example.com/product3.jpg",
        "https://example.com/brand-background.png"
    ],
    prompt="Combine these products into a single promotional catalog image. Arrange the three products in a grid layout over the branded background. Add subtle shadows and make it look professional.",
    model="gemini-3-pro-image-preview",
    aspect_ratio="16:9",
    ttl_hours=168  # 7ì¼ ë³´ê´€
)

# ì‚¬ìš© ì˜ˆì œ 3: ì—¬ëŸ¬ ì¸ë¬¼ ì‚¬ì§„ í•©ì„±
result = compose_images_from_urls(
    image_urls=[
        "https://example.com/person1.jpg",
        "https://example.com/person2.jpg",
        "https://example.com/person3.jpg"
    ],
    prompt="Create a group photo composition with all three people together. Make them appear to be standing side by side in a natural way.",
    model="gemini-2.5-flash-image",
    aspect_ratio="16:9",
    ttl_hours=24  # 24ì‹œê°„ ë³´ê´€
)
```

##### cURL

```bash
# ì—¬ëŸ¬ ì´ë¯¸ì§€ URLì„ JSON ë°°ì—´ë¡œ ì „ì†¡í•˜ì—¬ í•©ì„±
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/caricature/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F 'imageUrls=["https://example.com/bg.jpg", "https://example.com/person.png", "https://example.com/logo.png"]' \
  -F "model=gemini-3-pro-image-preview" \
  -F "prompt=Create a professional poster with the background image, person in center, and logo overlay at top. 4K quality, modern design." \
  -F "aspectRatio=3:4" \
  -F "storageType=gcs" \
  -F "ttlHours=720"

# ì‘ë‹µ ì˜ˆì‹œ:
# {
#   "jobId": "caric_20251225_ABC123",
#   "accessKey": "caric_20251225_ABC123.hash...",
#   "status": "processing",
#   "message": "Job created and processing in background",
#   "statusUrl": "/api/v1/caricature/status/caric_20251225_ABC123"
# }

# ìƒíƒœ í™•ì¸
curl "https://caricature-api-rust.wizice.com/api/v1/caricature/status/caric_20251225_ABC123" \
  -H "Authorization: Bearer caric_20251225_ABC123.hash..."
```

##### JavaScript/Node.js

```javascript
const axios = require('axios');

const API_URL = 'https://caricature-api-rust.wizice.com';
const API_KEY = 'YOUR_API_KEY';

async function composeImagesFromUrls(imageUrls, prompt, options = {}) {
  try {
    // FormData ìƒì„±
    const FormData = require('form-data');
    const formData = new FormData();

    // ì´ë¯¸ì§€ URL ë°°ì—´ì„ JSON ë¬¸ìì—´ë¡œ ì „ì†¡
    formData.append('imageUrls', JSON.stringify(imageUrls));
    formData.append('model', options.model || 'gemini-3-pro-image-preview');
    formData.append('prompt', prompt);
    formData.append('aspectRatio', options.aspectRatio || '16:9');
    formData.append('storageType', 'gcs');
    formData.append('ttlHours', options.ttlHours || 168);

    // ì‘ì—… ìƒì„±
    const response = await axios.post(
      `${API_URL}/api/v1/caricature/generate`,
      formData,
      {
        headers: {
          'X-API-Key': API_KEY,
          ...formData.getHeaders()
        }
      }
    );

    const { jobId, accessKey, status } = response.data;
    console.log(`â³ í•©ì„± ì‘ì—… ì‹œì‘... (Job ID: ${jobId})`);

    // ì¦‰ì‹œ ì™„ë£Œëœ ê²½ìš°
    if (status === 'completed') {
      console.log(`âœ… ì™„ë£Œ: ${response.data.imageUrl}`);
      return response.data;
    }

    // ë¹„ë™ê¸° ì²˜ë¦¬ - ìƒíƒœ í´ë§
    const statusUrl = `${API_URL}/api/v1/caricature/status/${jobId}`;

    while (true) {
      await new Promise(resolve => setTimeout(resolve, 3000)); // 3ì´ˆ ëŒ€ê¸°

      const statusResponse = await axios.get(statusUrl, {
        headers: {
          'Authorization': `Bearer ${accessKey}`
        }
      });

      const statusData = statusResponse.data;
      console.log(`   ìƒíƒœ: ${statusData.status}`);

      if (statusData.status === 'completed') {
        console.log('âœ… í•©ì„± ì™„ë£Œ!');
        console.log(`   ì´ë¯¸ì§€ URL: ${statusData.imageUrl}`);
        console.log(`   ì²˜ë¦¬ ì‹œê°„: ${statusData.processingTime}ì´ˆ`);
        console.log(`   ë¹„ìš©: $${statusData.actualCost.toFixed(4)}`);
        return statusData;
      } else if (statusData.status === 'failed') {
        console.error(`âŒ ì‹¤íŒ¨: ${statusData.errorMessage}`);
        return statusData;
      }
    }
  } catch (error) {
    console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨:', error.response?.data || error.message);
    return null;
  }
}

// ì‚¬ìš© ì˜ˆì œ: ë§ˆì¼€íŒ… ë°°ë„ˆ í•©ì„±
composeImagesFromUrls(
  [
    'https://example.com/product-main.jpg',
    'https://example.com/background-gradient.png',
    'https://example.com/company-logo.png'
  ],
  'Create a professional marketing banner with the product as the main focus, gradient background, and company logo in the corner. Modern and eye-catching design.',
  {
    model: 'gemini-3-pro-image-preview',
    aspectRatio: '21:9',
    ttlHours: 720  // 30ì¼
  }
);
```

**ğŸ’¡ í™œìš© íŒ**:

1. **ëª¨ë¸ ì„ íƒ**:
   - `gemini-3-pro-image-preview`: ë‹¤ì¤‘ ì´ë¯¸ì§€ í•©ì„±ì— ìµœì í™” (ìµœëŒ€ 14ê°œ ì´ë¯¸ì§€, 4K ì¶œë ¥)
   - `gemini-2.5-flash-image`: ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„, ì ì€ ë¹„ìš©

2. **í”„ë¡¬í”„íŠ¸ ì‘ì„±**:
   - ê° ì´ë¯¸ì§€ì˜ ì—­í• ì„ ëª…í™•íˆ ì§€ì • (ì˜ˆ: "ë°°ê²½", "ì¤‘ì•™ ì¸ë¬¼", "ë¡œê³ ")
   - ë ˆì´ì•„ì›ƒê³¼ ìŠ¤íƒ€ì¼ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…
   - ì›í•˜ëŠ” í’ˆì§ˆ ëª…ì‹œ (ì˜ˆ: "4K quality", "professional design")

3. **ì´ë¯¸ì§€ URL ìš”êµ¬ì‚¬í•­**:
   - ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ URLì´ì–´ì•¼ í•¨
   - HTTPS ê¶Œì¥
   - ì§€ì› í˜•ì‹: JPEG, PNG, WebP
   - ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸°: ê° 10MB

4. **í•©ì„± ì‹œê°„**:
   - ì´ë¯¸ì§€ ê°œìˆ˜ì™€ í•´ìƒë„ì— ë¹„ë¡€
   - í‰ê·  5-15ì´ˆ (3-4ê°œ ì´ë¯¸ì§€ ê¸°ì¤€)

---

## 4. Image-to-Text API (ì´ë¯¸ì§€ ë¶„ì„)

ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ AIë¡œ ë¶„ì„í•˜ì—¬ í…ìŠ¤íŠ¸ ì„¤ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤.

### 4.1 ì§€ì› ëª¨ë¸

| ëª¨ë¸ ID | ì´ë¦„ | ë¹„ìš© | íŠ¹ì§• |
|---------|------|------|------|
| `gemini-1.5-flash` | Gemini 1.5 Flash | $0.01 | ë¹ ë¥´ê³  ì €ë ´ (ê¸°ë³¸ê°’) |
| `gemini-1.5-pro` | Gemini 1.5 Pro | $0.02 | ë†’ì€ ì •í™•ë„ |
| `gemini-2.0-flash-exp` | Gemini 2.0 Flash | $0.01 | ìµœì‹  ëª¨ë¸, ì‹¤í—˜ì  |
| `gpt-4o` | GPT-4 Omni | $0.015 | OpenAI ìµœì‹  ë¹„ì „ ëª¨ë¸ |
| `gpt-4o-mini` | GPT-4 Omni Mini | $0.005 | ì €ë¹„ìš© ë²„ì „ |
| `claude-sonnet-4` | Claude Sonnet 4 | $0.015 | ìƒì„¸í•œ ë¶„ì„ |

### 4.2 ì—”ë“œí¬ì¸íŠ¸

```
POST /api/v1/analyze/image
```

### 4.3 ìš”ì²­ í˜•ì‹

**Multipart Form Data**

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|------|------|--------|------|
| `image` | file[] | âœ… | - | ë¶„ì„í•  ì´ë¯¸ì§€ íŒŒì¼(ë“¤) (JPEG, PNG, ë‹¤ì¤‘ ê°€ëŠ¥) |
| `prompt` | string | âŒ | "ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”." | ë¶„ì„ í”„ë¡¬í”„íŠ¸ |
| `model` | string | âŒ | `gemini-1.5-flash` | ì‚¬ìš©í•  AI ëª¨ë¸ |
| `temperature` | float | âŒ | `0.7` | ìƒì„± ì˜¨ë„ (0.0~1.0) |

**ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›**: `image` í•„ë“œë¥¼ ì—¬ëŸ¬ ë²ˆ ì „ì†¡í•˜ì—¬ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 4.4 ì‘ë‹µ í˜•ì‹ (ë¹„ë™ê¸° ì²˜ë¦¬)

**âš ï¸ ì¤‘ìš”**: Image-to-Text APIëŠ” **ë¹„ë™ê¸°**ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ì¦‰ì‹œ Job IDë¥¼ ë°˜í™˜í•˜ê³ , ë³„ë„ë¡œ ìƒíƒœë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

#### ì¦‰ì‹œ ì‘ë‹µ (Job ìƒì„±)

```json
{
  "jobId": "analyze_caric_20251208_aBc123",
  "accessKey": "analyze_caric_20251208_aBc123.9f8e7d6c5b4a3...",
  "status": "processing",
  "estimatedCost": 0.00015,
  "estimatedTime": 3000,
  "message": "Analysis job created successfully"
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `jobId` | string | Job ê³ ìœ  ID (ìƒíƒœ í™•ì¸ì— ì‚¬ìš©) |
| `accessKey` | string | Job ì ‘ê·¼ í‚¤ (ì¸ì¦ì— ì‚¬ìš©) |
| `status` | string | ì´ˆê¸° ìƒíƒœ (`processing`) |
| `estimatedCost` | number | ì˜ˆìƒ ë¹„ìš© (USD) |
| `estimatedTime` | number | ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„ (ms) |
| `message` | string | ìƒíƒœ ë©”ì‹œì§€ |

### 4.5 ìƒíƒœ í™•ì¸

```
GET /api/v1/analyze/status/{jobId}
Authorization: Bearer {accessKey}
```

**í—¤ë”**:
```http
Authorization: Bearer analyze_caric_20251208_aBc123.9f8e7d6c5b4a3...
```

#### ì²˜ë¦¬ ì¤‘ ì‘ë‹µ

```json
{
  "jobId": "analyze_caric_20251208_aBc123",
  "accessKey": "analyze_caric_20251208_aBc123.9f8e7d6c5b4a3...",
  "status": "processing",
  "progress": 50,
  "message": "Analyzing image...",
  "createdAt": "2025-12-08T10:30:00Z",
  "model": "gemini-1.5-flash",
  "prompt": "ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.",
  "temperature": 0.7,
  "logs": [
    {
      "timestamp": "2025-12-08T10:30:01Z",
      "level": "info",
      "message": "Background analysis started"
    }
  ]
}
```

#### ì™„ë£Œ ì‘ë‹µ

```json
{
  "jobId": "analyze_caric_20251208_aBc123",
  "accessKey": "analyze_caric_20251208_aBc123.9f8e7d6c5b4a3...",
  "status": "completed",
  "progress": 100,
  "message": "Analysis completed",
  "createdAt": "2025-12-08T10:30:00Z",
  "completedAt": "2025-12-08T10:30:05Z",
  "model": "gemini-1.5-flash",
  "prompt": "ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.",
  "temperature": 0.7,
  "processingTime": 2543,
  "actualCost": 0.00015,
  "result": {
    "analysisText": "ì´ ì‚¬ì§„ì€ ì•¼ì™¸ì—ì„œ ì´¬ì˜ëœ ì¸ë¬¼ ì‚¬ì§„ì…ë‹ˆë‹¤. í•œ ëª…ì˜ ì„±ì¸ì´ ì¹´ë©”ë¼ë¥¼ ì •ë©´ìœ¼ë¡œ ë°”ë¼ë³´ê³  ìˆìœ¼ë©°, ë°°ê²½ì—ëŠ” ë‚˜ë¬´ì™€ í•˜ëŠ˜ì´ ë³´ì…ë‹ˆë‹¤. ì¸ë¬¼ì€ ì›ƒê³  ìˆìœ¼ë©° í¸ì•ˆí•œ í‘œì •ì„ ì§“ê³  ìˆìŠµë‹ˆë‹¤...",
    "metadata": {
      "inputImageSize": 512000,
      "outputTextLength": 1234
    }
  },
  "logs": [
    {
      "timestamp": "2025-12-08T10:30:01Z",
      "level": "info",
      "message": "Background analysis started"
    },
    {
      "timestamp": "2025-12-08T10:30:05Z",
      "level": "info",
      "message": "Analysis completed successfully"
    }
  ]
}
```

#### ì‹¤íŒ¨ ì‘ë‹µ

```json
{
  "jobId": "analyze_caric_20251208_aBc123",
  "accessKey": "analyze_caric_20251208_aBc123.9f8e7d6c5b4a3...",
  "status": "failed",
  "progress": 0,
  "message": "Analysis failed",
  "createdAt": "2025-12-08T10:30:00Z",
  "completedAt": "2025-12-08T10:30:03Z",
  "model": "gemini-1.5-flash",
  "errorMessage": "AI API error: Invalid image format",
  "errorCode": "INVALID_IMAGE",
  "errorDetails": {
    "provider": "gemini",
    "error_code": "INVALID_IMAGE",
    "status_code": 400,
    "timestamp": "2025-12-08T10:30:03Z",
    "model": "gemini-1.5-flash"
  }
}
```

### 4.6 ì‚¬ìš© ì˜ˆì œ

#### Python (ë¹„ë™ê¸° ì²˜ë¦¬ with í´ë§)

```python
import requests
import time

API_URL = "https://caricature-api-rust.wizice.com"
API_KEY = "YOUR_API_KEY"

def analyze_image(image_path, prompt="ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.", model="gemini-1.5-flash"):
    """ì´ë¯¸ì§€ ë¶„ì„ (ë¹„ë™ê¸°)"""

    # 1. Job ìƒì„±
    url = f"{API_URL}/api/v1/analyze/image"

    with open(image_path, 'rb') as f:
        files = {'image': f}
        data = {
            'prompt': prompt,
            'model': model,
            'temperature': 0.7
        }
        headers = {'X-API-Key': API_KEY}

        response = requests.post(url, files=files, data=data, headers=headers)
        response.raise_for_status()

    job_data = response.json()
    job_id = job_data["jobId"]
    access_key = job_data["accessKey"]

    print(f"Job created: {job_id}")
    print(f"Estimated cost: ${job_data['estimatedCost']}")

    # 2. ìƒíƒœ í´ë§ (ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°)
    status_url = f"{API_URL}/api/v1/analyze/status/{job_id}"
    status_headers = {
        "Authorization": f"Bearer {access_key}"
    }

    max_attempts = 60  # ìµœëŒ€ 60ì´ˆ ëŒ€ê¸°
    for attempt in range(max_attempts):
        time.sleep(1)  # 1ì´ˆ ëŒ€ê¸°

        status_response = requests.get(status_url, headers=status_headers)
        status_response.raise_for_status()

        status_data = status_response.json()
        status = status_data["status"]
        progress = status_data.get("progress", 0)

        print(f"Status: {status}, Progress: {progress}%")

        if status == "completed":
            print(f"\nâœ… ë¶„ì„ ì™„ë£Œ!")
            print(f"Processing time: {status_data.get('processingTime', 0)}ms")
            print(f"Actual cost: ${status_data.get('actualCost', 0)}")
            print(f"\në¶„ì„ ê²°ê³¼:\n{status_data['result']['analysisText']}")
            return status_data['result']['analysisText']

        elif status == "failed":
            raise Exception(f"Analysis failed: {status_data.get('errorMessage')}")

    raise Exception("Timeout waiting for job completion")

# ì‚¬ìš© ì˜ˆì‹œ
try:
    # ë‹¨ì¼ ì´ë¯¸ì§€ ë¶„ì„
    result = analyze_image(
        image_path="photo.jpg",
        prompt="ì´ ì‚¬ì§„ì— ìˆëŠ” ì‚¬ëŒì˜ íŠ¹ì§•ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
        model="gemini-1.5-flash"
    )

    # ë‹¤ì¤‘ ì´ë¯¸ì§€ ë¶„ì„
    url = f"{API_URL}/api/v1/analyze/image"
    files = [
        ('image', open('photo1.jpg', 'rb')),
        ('image', open('photo2.jpg', 'rb'))
    ]
    data = {
        'prompt': 'ì´ ë‘ ì´ë¯¸ì§€ë¥¼ ë¹„êµ ë¶„ì„í•´ì£¼ì„¸ìš”.',
        'model': 'gemini-1.5-flash'
    }
    headers = {'X-API-Key': API_KEY}

    response = requests.post(url, files=files, data=data, headers=headers)
    job_data = response.json()
    print(f"Multi-image job created: {job_data['jobId']}")

except Exception as e:
    print(f"Error: {e}")
```

#### JavaScript/Node.js

```javascript
const axios = require('axios');
const FormData = require('form-data');
const fs = require('fs');

const API_URL = 'https://caricature-api-rust.wizice.com';
const API_KEY = 'YOUR_API_KEY';

async function analyzeImage(imagePath, prompt = 'ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.', model = 'gemini-1.5-flash') {
  try {
    // 1. Job ìƒì„±
    const formData = new FormData();
    formData.append('image', fs.createReadStream(imagePath));
    formData.append('prompt', prompt);
    formData.append('model', model);
    formData.append('temperature', '0.7');

    const response = await axios.post(
      `${API_URL}/api/v1/analyze/image`,
      formData,
      {
        headers: {
          'X-API-Key': API_KEY,
          ...formData.getHeaders()
        }
      }
    );

    const { jobId, accessKey } = response.data;
    console.log(`Job created: ${jobId}`);

    // 2. ìƒíƒœ í´ë§
    const statusUrl = `${API_URL}/api/v1/analyze/status/${jobId}`;

    for (let i = 0; i < 60; i++) {
      await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°

      const statusResponse = await axios.get(statusUrl, {
        headers: {
          'Authorization': `Bearer ${accessKey}`
        }
      });

      const { status, progress, result, errorMessage } = statusResponse.data;
      console.log(`Status: ${status}, Progress: ${progress}%`);

      if (status === 'completed') {
        console.log('\nâœ… ë¶„ì„ ì™„ë£Œ!');
        console.log(`\në¶„ì„ ê²°ê³¼:\n${result.analysisText}`);
        return result.analysisText;
      } else if (status === 'failed') {
        throw new Error(`Analysis failed: ${errorMessage}`);
      }
    }

    throw new Error('Timeout waiting for job completion');
  } catch (error) {
    console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨:', error.response?.data || error.message);
    return null;
  }
}

// ì‚¬ìš© ì˜ˆì œ
analyzeImage(
  'photo.jpg',
  'ì´ ì‚¬ì§„ì— ìˆëŠ” ì‚¬ëŒì˜ íŠ¹ì§•ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.',
  'gemini-1.5-flash'
);
```

#### cURL

```bash
# 1. Job ìƒì„±
RESPONSE=$(curl -X POST "https://caricature-api-rust.wizice.com/api/v1/analyze/image" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "image=@photo.jpg" \
  -F "prompt=ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”." \
  -F "model=gemini-1.5-flash" \
  -F "temperature=0.7")

echo "$RESPONSE" | jq '.'

JOB_ID=$(echo "$RESPONSE" | jq -r '.jobId')
ACCESS_KEY=$(echo "$RESPONSE" | jq -r '.accessKey')

echo "Job ID: $JOB_ID"
echo "Access Key: $ACCESS_KEY"

# 2. ìƒíƒœ í™•ì¸ (ë°˜ë³µ)
for i in {1..60}; do
  sleep 1

  STATUS=$(curl -s "https://caricature-api-rust.wizice.com/api/v1/analyze/status/$JOB_ID" \
    -H "Authorization: Bearer $ACCESS_KEY")

  echo "$STATUS" | jq -r '"\(.status) - \(.progress)%"'

  if echo "$STATUS" | jq -e '.status == "completed"' > /dev/null; then
    echo "âœ… ë¶„ì„ ì™„ë£Œ!"
    echo "$STATUS" | jq -r '.result.analysisText'
    break
  elif echo "$STATUS" | jq -e '.status == "failed"' > /dev/null; then
    echo "âŒ ì‹¤íŒ¨"
    echo "$STATUS" | jq -r '.errorMessage'
    break
  fi
done

# ë‹¤ì¤‘ ì´ë¯¸ì§€ ë¶„ì„
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/analyze/image" \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "image=@photo1.jpg" \
  -F "image=@photo2.jpg" \
  -F "prompt=ì´ ë‘ ì´ë¯¸ì§€ë¥¼ ë¹„êµ ë¶„ì„í•´ì£¼ì„¸ìš”." \
  -F "model=gemini-1.5-flash"
```

---

## 5. ë°°ê²½ ì œê±° API

AI ìƒì„± ì´ë¯¸ì§€ ë˜ëŠ” ì—…ë¡œë“œëœ ì´ë¯¸ì§€ì—ì„œ ë°°ê²½ì„ ì œê±°í•˜ê³  íˆ¬ëª… PNGë¡œ ë³€í™˜í•©ë‹ˆë‹¤. Chroma Key ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ìƒ‰ìƒì„ íˆ¬ëª…ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

### 5.1 ê¸°ëŠ¥ íŠ¹ì§•

- âœ… **ìë™ ë°°ê²½ìƒ‰ ê²€ì¶œ**: ì´ë¯¸ì§€ ëª¨ì„œë¦¬ ë¶„ì„ìœ¼ë¡œ ë°°ê²½ìƒ‰ ìë™ ê°ì§€
- âœ… **ì ì‘í˜• Tolerance**: JPEG ì••ì¶• ì•„í‹°íŒ©íŠ¸ ìë™ ë³´ì •
- âœ… **Feathering**: ë¶€ë“œëŸ¬ìš´ ê²½ê³„ì„  ì²˜ë¦¬ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ê²°ê³¼
- âœ… **PNG ìµœì í™”**: íŒŒì¼ í¬ê¸° ìµœì†Œí™”
- âš¡ **ë¹ ë¥¸ ì²˜ë¦¬**: í‰ê·  1-2ì´ˆ (512x512 ê¸°ì¤€)
- ğŸ’° **ë¬´ë£Œ**: ì¶”ê°€ ë¹„ìš© ì—†ìŒ

### 5.2 ì—”ë“œí¬ì¸íŠ¸

```
POST /api/v1/image/remove-background
```

### 5.3 ìš”ì²­ í˜•ì‹

```json
{
  "imageUrl": "https://pub-xxx.r2.dev/caricatures/job_xxx.jpg",
  "method": "chroma",
  "chromaKey": {
    "color": "auto",
    "tolerance": 40
  },
  "edgeSmoothing": true,
  "storageType": "gcs"
}
```

#### íŒŒë¼ë¯¸í„°

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|------|------|--------|------|
| `imageUrl` | string | âš ï¸ | - | ì²˜ë¦¬í•  ì´ë¯¸ì§€ URL (imageUrl ë˜ëŠ” jobId ì¤‘ í•˜ë‚˜ í•„ìˆ˜) |
| `jobId` | string | âš ï¸ | - | ê¸°ì¡´ Text-to-Image Job ID (imageUrl ë˜ëŠ” jobId ì¤‘ í•˜ë‚˜ í•„ìˆ˜) |
| `method` | string | âŒ | `chroma` | ì²˜ë¦¬ ë°©ì‹ (í˜„ì¬ëŠ” `chroma`ë§Œ ì§€ì›) |
| `chromaKey.color` | string | âŒ | `auto` | íˆ¬ëª…ìœ¼ë¡œ ë§Œë“¤ ìƒ‰ìƒ<br/>- `auto`: ìë™ ê²€ì¶œ (ì¶”ì²œ)<br/>- Hex ì½”ë“œ: `#FFFFFF` (í°ìƒ‰), `#000000` (ê²€ì •ìƒ‰) ë“± |
| `chromaKey.tolerance` | number | âŒ | ìë™ ê³„ì‚° | ìƒ‰ìƒ í—ˆìš© ì˜¤ì°¨ (0-255)<br/>- `auto` ì‚¬ìš© ì‹œ ìë™ ê³„ì‚°ë¨<br/>- ìˆ˜ë™ ì„¤ì •: 20-60 ê¶Œì¥ |
| `edgeSmoothing` | boolean | âŒ | `true` | ê²½ê³„ì„  ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬ (Feathering) |
| `storageType` | string | âŒ | `gcs` | ì €ì¥ ìœ„ì¹˜<br/>- `gcs`: R2 ì €ì¥ (ì‚¬ìš©ì ì§€ì • TTL)<br/>- `firestore`: Base64ë¡œ Firestore ì €ì¥ |
| `ttlHours` | number | âŒ | `24` | ì´ë¯¸ì§€ ë§Œë£Œ ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„)<br/>- 1~720 ê¶Œì¥ (1ì‹œê°„~30ì¼)<br/>- storageTypeì´ `gcs`ì¼ ë•Œë§Œ ì ìš© |

### 5.4 ì‘ë‹µ í˜•ì‹

#### ì„±ê³µ ì‘ë‹µ

```json
{
  "success": true,
  "jobId": "bg_remove_caric_20251223_xVnk5rH",
  "originalUrl": "https://picsum.photos/id/1/512/512",
  "processedUrl": "https://storage.googleapis.com/...",
  "format": "PNG",
  "processingTime": 960,
  "method": "chroma",
  "removedColor": "#000000",
  "transparentPixels": 31415,
  "fileSize": 298603
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `success` | boolean | ì„±ê³µ ì—¬ë¶€ |
| `jobId` | string | ì²˜ë¦¬ Job ID |
| `originalUrl` | string | ì›ë³¸ ì´ë¯¸ì§€ URL |
| `processedUrl` | string | íˆ¬ëª… PNG ë‹¤ìš´ë¡œë“œ URL |
| `format` | string | ì¶œë ¥ í˜•ì‹ (`PNG`) |
| `processingTime` | number | ì²˜ë¦¬ ì‹œê°„ (ë°€ë¦¬ì´ˆ) |
| `method` | string | ì‚¬ìš©ëœ ë°©ì‹ (`chroma`) |
| `removedColor` | string | ì œê±°ëœ ë°°ê²½ìƒ‰ (Hex) |
| `transparentPixels` | number | íˆ¬ëª… ì²˜ë¦¬ëœ í”½ì…€ ìˆ˜ |
| `fileSize` | number | íŒŒì¼ í¬ê¸° (ë°”ì´íŠ¸) |

### 5.5 ì‚¬ìš© ì˜ˆì‹œ

#### ì˜ˆì‹œ 1: ìë™ ë°°ê²½ìƒ‰ ê²€ì¶œ (ì¶”ì²œ)

```bash
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/image/remove-background" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "https://example.com/image.jpg",
    "chromaKey": {
      "color": "auto"
    },
    "edgeSmoothing": true,
    "storageType": "gcs",
    "ttlHours": 24
  }'
```

#### ì˜ˆì‹œ 2: í°ìƒ‰ ë°°ê²½ ì œê±° (ê¸´ TTL ì„¤ì •)

```bash
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/image/remove-background" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "https://example.com/white-bg.jpg",
    "chromaKey": {
      "color": "#FFFFFF",
      "tolerance": 40
    },
    "edgeSmoothing": true,
    "storageType": "gcs",
    "ttlHours": 168
  }'
```

**ğŸ’¡ TTL 168ì‹œê°„ = 7ì¼ ë³´ê´€**

#### ì˜ˆì‹œ 3: Job IDë¡œ ì²˜ë¦¬

Text-to-Image APIë¡œ ìƒì„±í•œ ì´ë¯¸ì§€ë¥¼ ë°”ë¡œ ì²˜ë¦¬:

```bash
# 1. ì´ë¯¸ì§€ ìƒì„±
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/text-to-image/generate" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash-image",
    "prompt": "A cute cat on a white background",
    "storageType": "gcs"
  }'

# ì‘ë‹µ: {"jobId": "caric_20251223_ABC123", ...}

# 2. ë°°ê²½ ì œê±°
curl -X POST "https://caricature-api-rust.wizice.com/api/v1/image/remove-background" \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "jobId": "caric_20251223_ABC123",
    "chromaKey": {
      "color": "auto"
    },
    "storageType": "gcs",
    "ttlHours": 24
  }'
```

### 5.6 ì‚¬ìš© íŒ

#### ìµœì  ê²°ê³¼ë¥¼ ìœ„í•œ ê¶Œì¥ì‚¬í•­

1. **ë‹¨ìƒ‰ ë°°ê²½ ì‚¬ìš©**
   - í°ìƒ‰, ê²€ì •ìƒ‰, ë…¹ìƒ‰ ë“± ë‹¨ì¼ ìƒ‰ìƒ ë°°ê²½ì´ ê°€ì¥ íš¨ê³¼ì 
   - ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ì€ ì¼ë¶€ ì˜ì—­ë§Œ ì œê±°ë  ìˆ˜ ìˆìŒ

2. **ìë™ ê²€ì¶œ í™œìš©**
   - `color: "auto"` ì‚¬ìš© ê¶Œì¥
   - ì´ë¯¸ì§€ 4ê°œ ëª¨ì„œë¦¬ë¥¼ ë¶„ì„í•˜ì—¬ ê°€ì¥ ë§ì´ ë‚˜íƒ€ë‚˜ëŠ” ìƒ‰ìƒ ìë™ ê²€ì¶œ

3. **Tolerance ì¡°ì •**
   - ìë™ ê³„ì‚° ì‚¬ìš© ê¶Œì¥ (ìƒëµ ì‹œ)
   - ìˆ˜ë™ ì„¤ì • ì‹œ: ë°°ê²½ì´ ì™„ì „íˆ ì œê±°ë˜ì§€ ì•Šìœ¼ë©´ tolerance ì¦ê°€ (ì˜ˆ: 40 â†’ 60)

4. **Edge Smoothing**
   - í•­ìƒ `true` ê¶Œì¥
   - ë¶€ë“œëŸ¬ìš´ ê²½ê³„ì„ ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ê²°ê³¼

### 5.7 ì œí•œì‚¬í•­

- **ì§€ì› ë°°ê²½**: ë‹¨ìƒ‰ ë˜ëŠ” ë‹¨ìˆœí•œ ê·¸ë¼ë°ì´ì…˜
- **ë¹„ì§€ì›**: ë³µì¡í•œ íŒ¨í„´, ë‹¤ì¤‘ ê°ì²´ ë°°ê²½
- **ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸°**: 10MB
- **ì²˜ë¦¬ ì‹œê°„**: ì´ë¯¸ì§€ í¬ê¸°ì— ë¹„ë¡€ (512x512: ~1ì´ˆ, 4K: ~12ì´ˆ)

### 5.8 í™œìš© ì‚¬ë¡€

- **í”„ë¡œí•„ ì‚¬ì§„**: í°ìƒ‰ ë°°ê²½ ì œê±°
- **ì œí’ˆ ì´ë¯¸ì§€**: ë‹¨ìƒ‰ ë°°ê²½ ì œê±°ë¡œ íˆ¬ëª… PNG ìƒì„±
- **ë¡œê³  ì œì‘**: AI ìƒì„± ë¡œê³ ì˜ ë°°ê²½ íˆ¬ëª…í™”
- **ìŠ¤í‹°ì»¤ ì œì‘**: ìºë¦­í„° ì´ë¯¸ì§€ ë°°ê²½ ì œê±°
- **í•©ì„± ì‘ì—…**: íˆ¬ëª… PNGë¡œ ë‹¤ë¥¸ ì´ë¯¸ì§€ì™€ í•©ì„±

### 5.9 í…ŒìŠ¤íŠ¸ í˜ì´ì§€

ì›¹ UIì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ğŸ”— í…ŒìŠ¤íŠ¸ í˜ì´ì§€**: https://caricature-api-rust.wizice.com/test/remove-background

ê¸°ëŠ¥:
- âœ… ì´ë¯¸ì§€ URL ë˜ëŠ” Job IDë¡œ ë°°ê²½ ì œê±°
- âœ… ìƒ‰ìƒ ìë™ ê²€ì¶œ ë˜ëŠ” ìˆ˜ë™ ì„¤ì •
- âœ… TTL ì„¤ì • (1ì‹œê°„~30ì¼)
- âœ… ì‹¤ì‹œê°„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (íˆ¬ëª… ë°°ê²½)
- âœ… ì²˜ë¦¬ ì •ë³´ í‘œì‹œ (ì œê±°ëœ ìƒ‰ìƒ, íˆ¬ëª… í”½ì…€ ìˆ˜, íŒŒì¼ í¬ê¸° ë“±)

---

## 6. ê³µí†µ ì‘ë‹µ í˜•ì‹

### 6.1 ì„±ê³µ ì‘ë‹µ

ëª¨ë“  ì„±ê³µ ì‘ë‹µì€ ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

```json
{
  "success": true,
  "message": "Operation completed successfully",
  ...
}
```

### 5.2 ì—ëŸ¬ ì‘ë‹µ

```json
{
  "errorCode": "ERROR_CODE",
  "errorMessage": "Human readable error message",
  "provider": "gemini",
  "upstreamStatus": 400
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `errorCode` | string | ì—ëŸ¬ ì½”ë“œ |
| `errorMessage` | string | ì—ëŸ¬ ë©”ì‹œì§€ |
| `provider` | string | AI ì œê³µì |
| `upstreamStatus` | number | ì›ë³¸ API ìƒíƒœ ì½”ë“œ |

---

## 7. ì—ëŸ¬ ì²˜ë¦¬

### 7.1 ì¼ë°˜ ì—ëŸ¬ ì½”ë“œ

| ì½”ë“œ | HTTP | ì„¤ëª… | í•´ê²° ë°©ë²• |
|------|------|------|----------|
| `INVALID_API_KEY` | 401 | ì˜ëª»ëœ API í‚¤ | API í‚¤ í™•ì¸ |
| `INVALID_REQUEST` | 400 | ì˜ëª»ëœ ìš”ì²­ | ìš”ì²­ í˜•ì‹ í™•ì¸ |
| `AI_API_ERROR` | 500 | AI API ì˜¤ë¥˜ | ì¬ì‹œë„ ë˜ëŠ” ë‹¤ë¥¸ ëª¨ë¸ ì‚¬ìš© |
| `INTERNAL_ERROR` | 500 | ì„œë²„ ì˜¤ë¥˜ | ì¬ì‹œë„ |

### 6.2 AI ê´€ë ¨ ì—ëŸ¬

| ì½”ë“œ | ì„¤ëª… | í•´ê²° ë°©ë²• |
|------|------|----------|
| `SAFETY_VIOLATION` | ì•ˆì „ ì •ì±… ìœ„ë°˜ | ë‹¤ë¥¸ ì´ë¯¸ì§€/í”„ë¡¬í”„íŠ¸ ì‚¬ìš© |
| `CONTENT_BLOCKED` | ì½˜í…ì¸  ì°¨ë‹¨ | í”„ë¡¬í”„íŠ¸ ìˆ˜ì • |
| `RATE_LIMIT` | ìš”ì²­ ì œí•œ ì´ˆê³¼ | ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„ |

### 6.3 ì—ëŸ¬ ì²˜ë¦¬ ì˜ˆì œ

```python
def handle_api_error(error_response):
    """API ì—ëŸ¬ ì²˜ë¦¬"""
    error_code = error_response.get('errorCode')
    error_msg = error_response.get('errorMessage')

    if error_code == 'INVALID_API_KEY':
        print("âŒ API í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    elif error_code == 'SAFETY_VIOLATION':
        print(f"âš ï¸ ì•ˆì „ ì •ì±… ìœ„ë°˜: {error_msg}")
        # ìƒì„¸ ë¶„ì„ ì •ë³´ í™•ì¸
        if 'errorDetails' in error_response:
            details = error_response['errorDetails']
            analysis = details.get('rejection_analysis', {})
            print(f"   ìœ„í—˜ë„: {analysis.get('safetyConcerns', {}).get('riskLevel')}")
    elif error_code == 'RATE_LIMIT':
        print("â³ ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")
    else:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {error_msg}")
```

---

## 8. ì‚¬ìš© ì˜ˆì œ

### 8.1 ì™„ì „í•œ Python í´ë¼ì´ì–¸íŠ¸

```python
import requests
import time
from typing import Optional, Dict

class SmilePrintClient:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://caricature-api-rust.wizice.com"
        self.headers = {
            'X-API-Key': api_key,
            'Content-Type': 'application/json'
        }

    def text_to_image(
        self,
        prompt: str,
        model: str = "gemini-2.5-flash-image",
        storage_type: str = "gcs",
        ttl_hours: Optional[int] = None,
        **kwargs
    ) -> Optional[Dict]:
        """í…ìŠ¤íŠ¸ë¡œ ì´ë¯¸ì§€ ìƒì„±"""
        url = f"{self.base_url}/api/v1/text-to-image/generate"

        payload = {
            "model": model,
            "prompt": prompt,
            "storageType": storage_type,
            **kwargs
        }

        # TTL ì„¤ì • (GCS ì €ì¥ì¸ ê²½ìš°)
        if storage_type == "gcs" and ttl_hours is not None:
            payload["ttlHours"] = ttl_hours

        try:
            response = requests.post(url, json=payload, headers=self.headers)
            response.raise_for_status()
            return response.json()
        except requests.exceptions.RequestException as e:
            print(f"Error: {e}")
            return None

    def image_to_caricature(
        self,
        image_path: str,
        model: str = "gemini",
        background: str = "remove"
    ) -> Optional[Dict]:
        """ì´ë¯¸ì§€ë¥¼ ìºë¦¬ì»¤ì²˜ë¡œ ë³€í™˜"""
        url = f"{self.base_url}/api/v1/caricature/generate"

        with open(image_path, 'rb') as f:
            files = {'image': f}
            data = {'model': model, 'background': background}
            headers = {'X-API-Key': self.api_key}

            response = requests.post(url, files=files, data=data, headers=headers)
            result = response.json()

        # ë¹„ë™ê¸° ì²˜ë¦¬ì¸ ê²½ìš° ì™„ë£Œê¹Œì§€ ëŒ€ê¸°
        if result['status'] == 'processing':
            return self._wait_for_completion(result['jobId'], result['accessKey'])

        return result

    def _wait_for_completion(self, job_id: str, access_key: str, timeout: int = 60) -> Optional[Dict]:
        """ì‘ì—… ì™„ë£Œê¹Œì§€ ëŒ€ê¸°"""
        url = f"{self.base_url}/api/v1/caricature/status/{job_id}"
        headers = {'Authorization': f'Bearer {access_key}'}

        start_time = time.time()
        while time.time() - start_time < timeout:
            response = requests.get(url, headers=headers)
            status = response.json()

            if status['status'] in ['completed', 'failed']:
                return status

            time.sleep(2)

        return None

# ì‚¬ìš© ì˜ˆì œ
client = SmilePrintClient(api_key="YOUR_API_KEY")

# Text-to-Image (ê¸°ë³¸ 7ì¼ TTL)
result = client.text_to_image(
    prompt="A beautiful sunset over mountains",
    model="gemini-2.5-flash-image",
    aspectRatio="16:9"
)
print(f"Image URL: {result['imageUrl']}")

# Text-to-Image (30ì¼ TTL - ì¥ê¸° ë³´ê´€)
result = client.text_to_image(
    prompt="An important company logo design",
    model="gemini-2.5-flash-image",
    storage_type="gcs",
    ttl_hours=720  # 30ì¼
)
print(f"Logo URL (30-day TTL): {result['imageUrl']}")

# Image-to-Caricature
result = client.image_to_caricature(
    image_path="photo.jpg",
    model="gemini"
)
print(f"Caricature URL: {result['imageUrl']}")
```

---

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- **API ë² ì´ìŠ¤ URL**: https://caricature-api-rust.wizice.com
- **í…ŒìŠ¤íŠ¸ í˜ì´ì§€**:
  - Text-to-Image: `/test/text-to-image` (ë¡œê·¸ì¸ í•„ìš”)
  - Image-to-Image (ìºë¦¬ì»¤ì²˜): `/test` (ë¡œê·¸ì¸ í•„ìš”)
  - Image-to-Text (ì´ë¯¸ì§€ ë¶„ì„): API ì§ì ‘ í˜¸ì¶œ
- **API ì—”ë“œí¬ì¸íŠ¸**:
  - Text-to-Image: `POST /api/v1/text-to-image/generate`
  - Image-to-Image: `POST /api/v1/caricature/generate`
  - Image-to-Text: `POST /api/v1/analyze/image`
- **ëª¨ë¸ ëª©ë¡ API**: `GET /api/v1/text-to-image/models`
- **Health Check**: `GET /health`

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025-12-25
**ë¬¸ì„œ ë²„ì „**: 1.5

**ë³€ê²½ ì´ë ¥**:
- **v1.5 (2025-12-25)**: **Image-to-Image API ë‹¤ìš´ë¡œë“œ ë°©ì‹ ê°œì„  ë° ë‹¤ì¤‘ ì´ë¯¸ì§€ URL í•©ì„± ì˜ˆì œ ì¶”ê°€**
  - Download endpoint íŒ¨í„´ ì ìš©: `/api/v1/caricature/image?key={access_key}`
  - AWS S3/R2 Presigned URLì˜ 7ì¼ ì œí•œ í•´ê²° â†’ TTL ê¸°ê°„ ì „ì²´ ë™ì•ˆ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥
  - `imageUrl` ì‘ë‹µ í˜•ì‹ ë³€ê²½: Public URL â†’ ìƒëŒ€ ê²½ë¡œ ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸
  - ì„œë²„ê°€ on-demandë¡œ R2ì—ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë° ì œê³µ
  - ì„¹ì…˜ 3.4, 3.5 ì—…ë°ì´íŠ¸
  - **ë‹¤ì¤‘ ì´ë¯¸ì§€ URL í•©ì„± ì˜ˆì œ ì¶”ê°€**: `imageUrls` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•œ Python, cURL, JavaScript ì˜ˆì œ í¬í•¨
- **v1.4 (2025-12-24)**: **TTL ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥** ì¶”ê°€
  - `ttlHours` íŒŒë¼ë¯¸í„° ì¶”ê°€ (Text-to-Image API ë° Image-to-Image API)
  - ì‚¬ìš©ìê°€ 1ì‹œê°„~10ë…„ê¹Œì§€ ììœ ë¡­ê²Œ TTL ì„¤ì • ê°€ëŠ¥
  - Image-to-Image API ê¸°ë³¸ TTL: 24ì‹œê°„
  - ìƒíƒœ ì‘ë‹µì— `generatedAt`, `expireTime` í•„ë“œ ì¶”ê°€
  - ëª¨ë“  ì‚¬ìš© ì˜ˆì œì— TTL ì„¤ì • ì˜ˆì‹œ í¬í•¨
- **v1.3 (2025-12-22)**: ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ Download Endpoint ë„ì… (Public URL â†’ ì¸ì¦ëœ ë‹¤ìš´ë¡œë“œ), 7ì¼ TTL ì ìš©, ì„¹ì…˜ 2.6 ì¶”ê°€
- **v1.2 (2025-12-20)**: R2 ì˜êµ¬ Public URL ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½ (presigned URL ì œê±°), storageType ì„¤ëª… ëª…í™•í™”
- **v1.1 (2025-12-08)**: Image-to-Text API (ì´ë¯¸ì§€ ë¶„ì„) ì„¹ì…˜ ì¶”ê°€
- **v1.0 (2025-12-01)**: ì´ˆê¸° ë²„ì „ (Text-to-Image, Image-to-Image)
