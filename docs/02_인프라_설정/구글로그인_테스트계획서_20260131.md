# Google 로그인 + D1 클라우드 저장 테스트 계획서

## 구현 범위

### Phase 1: Workers API + D1 + Google 로그인 (백엔드)
### Phase 2: 프론트엔드 Google 로그인 연동
### Phase 3: 데이터 CRUD API 연동

---

## 테스트 항목

### 1. Google 로그인

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|-----------|----------|------|
| 1-1 | Google 로그인 버튼 표시 | 앱 시작 시 로그인 화면에 Google 로그인 버튼 표시 | - |
| 1-2 | Google 로그인 클릭 | Google 계정 선택 팝업 표시 | - |
| 1-3 | 첫 로그인 (신규 사용자) | 자동 회원가입 + 게임 데이터 초기 생성 + 메인 화면 이동 | - |
| 1-4 | 재로그인 (기존 사용자) | 기존 데이터 로드 + 메인 화면 이동 | - |
| 1-5 | 로그인 취소 | 로그인 화면 유지, 에러 없음 | - |
| 1-6 | 세션 유지 | 브라우저 새로고침 후에도 로그인 상태 유지 | - |
| 1-7 | 로그아웃 | 로그인 화면으로 돌아감, 세션 토큰 삭제 | - |
| 1-8 | 다른 기기 로그인 | 같은 Google 계정으로 다른 기기에서 동일 데이터 접근 | - |

### 2. Workers API 엔드포인트

| # | 테스트 항목 | 메서드 | 예상 결과 | 상태 |
|---|-----------|--------|----------|------|
| 2-1 | POST /api/auth/google | POST | ID Token 검증 → 세션 토큰 반환 | - |
| 2-2 | GET /api/auth/me | GET | 현재 사용자 정보 반환 | - |
| 2-3 | GET /api/player | GET | 플레이어 데이터 반환 | - |
| 2-4 | PUT /api/player | PUT | 플레이어 데이터 업데이트 | - |
| 2-5 | GET /api/monsters | GET | 오답 몬스터 목록 반환 | - |
| 2-6 | POST /api/monsters | POST | 오답 몬스터 추가 | - |
| 2-7 | PUT /api/monsters/:id | PUT | 몬스터 상태 변경 | - |
| 2-8 | DELETE /api/monsters/:id | DELETE | 몬스터 삭제 | - |
| 2-9 | GET /api/items | GET | 아이템 목록 | - |
| 2-10 | POST /api/items | POST | 아이템 추가 | - |
| 2-11 | GET /api/runs | GET | 플레이 기록 | - |
| 2-12 | POST /api/runs | POST | 플레이 기록 저장 | - |
| 2-13 | GET /api/settings | GET | 설정 조회 | - |
| 2-14 | PUT /api/settings | PUT | 설정 저장 | - |
| 2-15 | POST /api/keys | POST | API 키 암호화 저장 | - |
| 2-16 | POST /api/gemini/generate | POST | Gemini 프록시 호출 | - |
| 2-17 | POST /api/image/analyze | POST | 이미지 분석 프록시 호출 | - |

### 3. 보안

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|-----------|----------|------|
| 3-1 | 토큰 없이 API 호출 | 401 Unauthorized | - |
| 3-2 | 잘못된 토큰으로 API 호출 | 401 Unauthorized | - |
| 3-3 | 다른 사용자 데이터 접근 시도 | 403 Forbidden 또는 본인 데이터만 반환 | - |
| 3-4 | CORS 다른 도메인에서 호출 | 차단됨 | - |
| 3-5 | API 키 암호화 확인 | D1에 평문이 아닌 암호문으로 저장 | - |
| 3-6 | API 키 복호화 | Workers 내부에서만 복호화, 브라우저로 전송 안 됨 | - |

### 4. 데이터 동기화

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|-----------|----------|------|
| 4-1 | 게임 플레이 후 데이터 저장 | D1에 정상 저장 | - |
| 4-2 | 오답 등록 | 사진 촬영 → 분석 → D1에 몬스터 저장 | - |
| 4-3 | 아이템 획득 | D1에 아이템 저장 | - |
| 4-4 | 다른 기기에서 데이터 확인 | 동일 데이터 표시 | - |
| 4-5 | 브라우저 캐시 삭제 후 | 로그인하면 데이터 복원 | - |

### 5. 에러 처리

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|-----------|----------|------|
| 5-1 | 네트워크 끊김 | 에러 메시지 표시, 앱 크래시 안 됨 | - |
| 5-2 | Workers API 다운 | 에러 메시지 표시 | - |
| 5-3 | Google 로그인 실패 | 에러 메시지 + 재시도 가능 | - |
| 5-4 | D1 쿼리 실패 | 500 에러 + 에러 메시지 | - |

---

## 테스트 환경

| 환경 | 도구 |
|------|------|
| Workers 로컬 테스트 | `wrangler dev` (로컬 D1 포함) |
| API 테스트 | curl 또는 브라우저 개발자 도구 |
| 프론트엔드 | https://study-bhi.pages.dev |
| 모바일 | 휴대폰 Chrome 브라우저 |
