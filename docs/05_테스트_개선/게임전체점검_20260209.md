# 게임 전체 점검 및 개선점

> 작성일: 2026-02-09

---

## 1. 긴급 수정 (버그/치명적 문제)

### 1-1. 최종보스 연속 오답 페널티 과다
- **위치**: `BattleManager.js` 254~260줄
- **문제**: 최종보스 2회 연속 오답 시 HP-80 + 추가 HP-10 + 몬스터 HP 25 회복 → 사실상 즉사
- **제안**: 추가 페널티 HP-10 → HP-5로 완화, 또는 연속 3회부터 적용

### 1-2. 몬스터 풀 고갈 가능성
- **위치**: `MonsterManager.js` 601~616줄
- **문제**: 처치된 몬스터 `status='cleared'` → `loadMonsters()`에서 `alive`만 로드 → 몬스터 영구 소실
- **제안**: cleared 몬스터를 일정 시간 후 alive로 재등장시키는 로직 필요 (Game.js `_reviveClearedMonsters` 존재하나 승리 시에만 호출)

### 1-3. 선택지 중복/정답 누락 위험
- **위치**: `MonsterManager.js` 188~214줄
- **문제**: 부등식 문제 답 변환이 `_prepareChoices`와 `BattleManager`에서 중복 처리, 셔플 후 `correctIndex` 불일치 가능
- **제안**: 선택지 생성 로직을 단일 함수로 통합, 정답이 반드시 선택지에 포함되는지 최종 검증 추가

### 1-4. 타이머 delta 폭주
- **위치**: `BattleManager.js` 54, 206, 299줄
- **문제**: `game.lastTime = 0` 설정 후 다음 프레임에서 `Date.now() - 0` = 매우 큰 delta 값 → 타이머 즉시 소진 가능
- **제안**: `lastTime = 0` 대신 `lastTime = Date.now()`로 설정하여 다음 프레임부터 정상 delta 계산

### 1-5. 주간 미션 초기화 위치
- **위치**: `AchievementScreen.js` 40~42줄
- **문제**: 렌더링 함수 내에서 주간 미션 초기화 → 매 프레임 상태 변경 (안티패턴)
- **제안**: `changeScreen(ACHIEVEMENT)` 호출 시 또는 `Game.init()`에서 초기화

---

## 2. 게임 밸런스 문제

### 2-1. 경험치 곡선
| 구간 | 문제점 | 제안 |
|---|---|---|
| 레벨 1~30 | 적절 | 유지 |
| 레벨 30~70 | 성장 체감 시작 | 경험치 1.08배 증가로 완화 |
| 레벨 70~100 | 성장 극도로 느림 | 경험치 획득량 1.5배 보너스 |

### 2-2. 골드 밸런스
- **초반 골드 부족**: 기본 5~20G 획득인데 부활권 500G, 힌트 100G → 초반 진입장벽
- **후반 골드 폭증**: goldBonus × monsterGold × runGold + 콤보 보너스 중첩
- **제안**: 레벨 10 이하 골드 1.5배, goldBonus 가격 상승률 완화 (10레벨 이후 가속 완화)

### 2-3. 오답 페널티 표
| 몬스터 유형 | 현재 HP 감소 | 제안 HP 감소 |
|---|---|---|
| 일반 몬스터 | -25 | 유지 |
| 일반 보스 | -30 | 유지 |
| 중간 보스 | -40 + 몬스터 HP 30 회복 | -35 + 몬스터 HP 20 회복 |
| 최종 보스 | -80 + 연속 시 -10 추가 | -60 + 연속 시 -5 추가 |
| 시간초과 | -45 | -35 |

### 2-4. 스킵 페널티
- **문제**: 스킵할 때마다 10, 15, 20... 증가 → 후반 스킵 시 HP 대량 감소
- **제안**: 스킵 HP 감소 상한선 30 설정

### 2-5. 부활권 드랍률
- **현재**: epic 등급(드랍률 17%) × 보스 확률(35%) = 약 6% → 매우 희귀
- **제안**: rare 등급으로 변경하여 드랍률 상향 또는 상점 가격 300G로 인하

---

## 3. UI/UX 개선점

### 3-1. 전투 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 선택지 말줄임 | 12자 초과 시 `..` → 수식/영어 잘림 | 14자로 확대 또는 자동 폰트 축소 |
| 타이머 경고 | 10초 이하 시 효과음만 | 화면 테두리 붉은색 깜빡임 추가 |
| 아이템 드랍 알림 | 몬스터 영역에 겹침 | 화면 상단 배너 형태로 이동 |
| 전체문제 보기 | 있으나 눈에 안 띔 | 버튼 색상 강조 |

### 3-2. 메인 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 스탯 바 | 아이콘만 표시, 라벨 없음 | `⚔️ATK` `👾MON` 등 약어 추가 |
| AI 상태 영역 | SmilePrint/Gemini 여부에 따라 크기 달라짐 | 일관된 크기로 통일 |
| 레벨 MAX | 특별 효과 없음 | 골드 테두리 + 반짝임 효과 |

### 3-3. 상점 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| ×5 구매 버튼 | 터치 영역 위 버튼과 7px 겹침 가능 | 간격 8px 이상 확보 |
| 꾸미기 스와치 | 32×32 원 → 모바일 터치 어려움 | 48×48으로 확대 |
| 구매 불가 상태 | 클릭 영역은 등록됨 | 비활성 시각 피드백 강화 |

### 3-4. 통계 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 데이터 없을 때 | "데이터 없음"만 표시 | "던전 클리어 시 통계가 기록됩니다" 안내 |
| 과목별 유형 카드 | 데이터 많으면 스크롤 과다 | 접기/펼치기 기능 |
| 그래프 Y축 | 라벨이 작음 | 폰트 크기 증가 |

### 3-5. 업적 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 숨겨진 업적 | `???`만 표시 | "레벨 관련", "골드 관련" 등 카테고리 힌트 |
| 스크롤 길이 | 업적 많아서 매우 김 | 완료/미완료 필터 추가 |
| 주간 미션 | 없을 때 "로딩 중" 표시 | 초기화 타이밍 수정 |

### 3-6. 던전 선택 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 과목 수 | 수학/과학 2개만 | 4과목 모두 표시 (2×2 그리드) |
| 문제 수 안내 | 등록 수만 표시 | 최소 권장 문제 수 표시 |
| 난이도 표시 | 없음 | 쉬움/보통/어려움 비율 표시 |

### 3-7. 오답등록 화면
| 항목 | 문제 | 개선안 |
|---|---|---|
| 취소 버튼 2개 | 상단(뒤로가기), 하단(재촬영) → 혼동 | 하단 버튼 "📷 재촬영"으로 변경 |
| 이미지 로딩 실패 | 사용자 안내 없음 | "이미지를 불러올 수 없습니다" 메시지 |

---

## 4. 서비스/인프라 문제

### 4-1. 에러 처리 부족
| 위치 | 문제 | 심각도 |
|---|---|---|
| API 호출 전체 | 타임아웃 설정 없음 → 무한 대기 가능 | 높음 |
| 서버 동기화 | 실패 시 사용자 알림 없음 | 중간 |
| Promise.all 사용 | 하나 실패 시 전체 실패 | 중간 |
| AI 생성 중 | 취소 기능 없음 | 낮음 |

### 4-2. 비동기 Race Condition
| 위치 | 문제 |
|---|---|
| `syncFromServer` | 이전 동기화 미완료 시 새 동기화 시작 가능 |
| 문제 생성 | `isGenerating` 플래그만으로 중복 방지 → 빠른 연속 호출 시 중복 |
| 보스 문제 생성 | 비동기 생성 완료 전 전투 시작 가능 |

### 4-3. 메모리 관리
| 위치 | 문제 |
|---|---|
| `Game.js` keydown/keyup | destroy 시 리스너 제거 없음 |
| `EffectSystem` 업적 큐 | `_achievementQueue` 크기 제한 없음 |
| `DialogManager` 모달 | 에러 시 이벤트 리스너 잔존 가능 |

### 4-4. 보안
| 항목 | 문제 | 제안 |
|---|---|---|
| Google Client ID | main.js에 하드코딩 | 환경 변수 사용 |
| API 키 전송 | URL 쿼리 파라미터로 노출 | 헤더로 전송 |
| API 키 저장 | sessionStorage → XSS 시 탈취 가능 | httpOnly 쿠키 또는 서버 프록시 |

---

## 5. 성능 최적화

### 5-1. 렌더링
- **전투 화면**: 매 프레임 전체 렌더 → 타이머만 변경 시 부분 업데이트 가능
- **스크롤 화면**: 뷰포트 밖 요소도 렌더 → 화면 밖 요소 스킵으로 개선
- **폰트 캐시**: 크기 제한 없음 → 100개 제한 추가

### 5-2. 데이터
- **통계 재계산**: 몬스터 등록마다 전체 재계산 → 증분 업데이트 가능
- **난이도 인덱스**: `loadMonsters` 호출마다 O(n) 재구축 → 몬스터 1000+ 시 성능 저하
- **번역 데이터**: 4개 언어 전부 메모리 상주 → 현재 언어만 로드

---

## 6. 게임플레이 개선 아이디어

### 6-1. 학습 효과 강화
- **오답 노트**: 오답 문제만 모아서 복습 모드 제공
- **AI 해설 강화**: 정답 후에도 해설 보기 가능
- **약점 분석**: subjectTopics 데이터로 "인수분해 60%, 이차방정식 80%" 등 세부 분석

### 6-2. 진행 시스템
- **체크포인트**: 50층마다 저장 → 실패 시 해당 층부터 재시작
- **난이도 선택**: 보스 전 난이도 선택 가능 → 보상 차등
- **연속 정답 보너스**: 3연속 정답 시 추가 골드 등 다양한 보상

### 6-3. 콘텐츠 확장
- **4과목 던전**: 현재 수학/과학만 → 영어/국어 던전 추가
- **문제 히스토리**: 최근 5문제 정답/오답 표시
- **스킵권 아이템화**: HP 감소 없이 스킵 가능한 소모품

---

## 우선순위 정리

### P0 (즉시 수정)
1. 타이머 delta 폭주 버그 (`lastTime = 0` 문제)
2. 최종보스 연속 오답 페널티 완화
3. 몬스터 풀 고갈 방지

### P1 (빠른 시일 내)
4. 선택지 정답 포함 검증
5. 스킵 페널티 상한선
6. API 호출 타임아웃 설정
7. 초반 골드 밸런스 조정

### P2 (개선)
8. 전투 UI (타이머 경고, 선택지 말줄임, 드랍 알림)
9. 통계/업적 화면 UX
10. 던전 선택 4과목 확장
11. 메모리 누수 방지

### P3 (장기)
12. 오답 노트/복습 모드
13. 체크포인트 시스템
14. 렌더링 부분 업데이트
15. TypeScript 전환
