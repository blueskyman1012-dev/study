# AI 문제 생성 속도 개선

> 작성일: 2026-02-09

## 개요
AI 문제 생성(이미지 분석, 텍스트 생성)이 이전보다 느려진 원인을 분석하고 수정했다.

## 원인 분석

### 1. Polling Delay 증가 (가장 큰 원인)
ImageAnalysisService와 ProblemGeneratorService의 polling 간격이 후반부에 1500ms로 증가하여, 생성 시간이 10초 이상일 때 기존 대비 50% 느려짐.

| 구간 | 변경 전 | 문제 상태 | 수정 후 |
|------|---------|----------|---------|
| 첫 폴링 | 1000ms | 300ms | 300ms |
| 2~5회 | 1000ms | 800ms | 1000ms |
| 6회 이후 | 1000ms | **1500ms** | **1000ms** |

### 2. Exponential Backoff 재시도
analyzeImage에 최대 3회 재시도(1s→2s→4s)가 추가되어, 네트워크 불안정 시 최대 7초 추가 지연.

### 3. 폴백 타임아웃 과다
SmilePrint 실패 판정까지 최대 90초(60회 × 1.5초) 대기 후에야 Gemini 폴백 시도.

## 수정 내역

### ImageAnalysisService.js

| 항목 | Before | After |
|------|--------|-------|
| polling delay | 300→800→1500ms 단계 | 300ms → 1000ms 균일 |
| analyzeImage 재시도 | 최대 3회 (backoff 1s→2s→4s) | 최대 2회 (고정 1초) |
| checkStatus 재시도 | 최대 3회 (backoff 1s→2s) | 최대 2회 (고정 1초) |
| waitForCompletion maxAttempts | 60회 (최대 ~90초) | 30회 (최대 ~30초) |
| consecutiveErrors 허용 | 5회 | 3회 |

### ProblemGeneratorService.js

| 항목 | Before | After |
|------|--------|-------|
| polling delay | 300→800→1500ms 단계 | 300ms → 1000ms 균일 |
| maxAttempts | 60회 | 30회 |

## 수정 파일 목록

- `app/src/services/ImageAnalysisService.js` - polling/재시도/타임아웃 최적화
- `app/src/services/ProblemGeneratorService.js` - polling/타임아웃 최적화

## 예상 효과

| 시나리오 | Before (최대) | After (최대) |
|----------|-------------|-------------|
| 정상 생성 (10초) | ~15초 | ~10초 |
| SmilePrint 실패 → Gemini 폴백 | ~97초 | ~31초 |
| 네트워크 불안정 (재시도) | +7초 | +1초 |

## 검증 결과

- 단위 테스트: 145/145 통과
- 프로덕션 빌드: 성공
