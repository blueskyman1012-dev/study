# 서비스 지연시간(ms) 개선 방안 탐구

## 분석 일자
2026-02-02

## 발견된 병목 지점 (우선순위순)

### 🔴 1. gameLoop() 내 DOM 조작 (main.js ~Line 494)
- `getBoundingClientRect()`가 **매 프레임(60fps)** 호출됨
- 레이아웃 리플로우 강제 발생 → 프레임당 3-5ms 낭비
- **개선**: 리사이즈/화면전환 시에만 재계산

### 🔴 2. PlayerManager.save() 과다 호출 (PlayerManager.js)
- 정답마다 IndexedDB 쓰기 + 서버 동기화 시도
- 전투 중 초당 여러 번 save 가능 → 200-500ms/회
- **개선**: 디바운싱(1초) 적용, 전투 중 로컬만 → 종료 시 일괄 동기화

### 🔴 3. API 순차 호출 (main.js 초기 로딩)
- downloadPlayer → downloadMonsters → downloadRuns 순차 실행
- 총 600-1500ms 지연
- **개선**: `Promise.all()` 병렬 처리 → 200-500ms로 단축

### 🟡 4. EffectSystem 배열 filter() (EffectSystem.js)
- `Array.filter()`가 매 프레임 새 배열 생성 → GC 압력
- 파티클 30+개 시 성능 저하
- **개선**: 역순 for 루프 + splice 또는 오브젝트 풀 패턴

### 🟡 5. drawGrid() 매 프레임 재그리기 (Renderer.js)
- 매 프레임 54회 draw call (그리드)
- **개선**: 오프스크린 캔버스에 1회 렌더링 후 캐싱

### 🟡 6. MonsterManager 전체 로드 후 필터 (MonsterManager.js)
- loadMonstersBySubject()가 전체 로드 후 JS에서 필터링
- **개선**: IndexedDB 복합 인덱스 [status, subject] 활용

### 🟢 7. Vite 빌드 최적화 부족 (vite.config.js)
- console.log 제거, terser 압축, sourcemap off 미설정
- **개선**: terser + drop_console + sourcemap: false

### 🟢 8. HP바 그라데이션 매 프레임 생성 (Renderer.js)
- createLinearGradient() 매 프레임 호출
- **개선**: 그라데이션 캐싱

## 예상 개선 효과

| 항목 | 현재 추정 | 개선 후 | 개선율 |
|------|-----------|---------|--------|
| 게임 시작 로딩 | 1.2-2.0s | 0.6-0.8s | -60% |
| 전투 중 프레임 지연 | 150-300ms | 50-80ms | -70% |
| save() 지연 | 200-500ms/회 | 0ms (디바운스) | -100% |
| 렌더링 FPS | 45-55 | 58-60 | +20% |
