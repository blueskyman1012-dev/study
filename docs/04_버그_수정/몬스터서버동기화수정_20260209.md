# 몬스터 서버 동기화 수정

## 날짜
2026-02-09

## 문제 원인
1. `RegisterManager.js:158` - postMonster 에러를 `.catch(() => {})` 로 무시하여 업로드 실패 시 원인 파악 불가
2. `main.js:188-193` - 서버→로컬 다운로드만 있고, 로컬→서버 업로드 로직이 없음
3. 서버 `monsters.js:12-17` - addMonster에서 `data` JSON 필드를 저장하지 않아 choices, correctIndex 등 유실
4. 서버 `schema.sql` - monsters 테이블에 `data` 컬럼이 없음

## 수정 내용

### 1. `app/src/game/RegisterManager.js`
- `.catch(() => {})` → 에러 로깅(`console.warn`) 추가

### 2. `study-api/src/routes/monsters.js`
- addMonster INSERT 쿼리에 `data` 컬럼 추가
- `data.data`를 JSON.stringify하여 저장

### 3. `study-api/schema.sql`
- monsters 테이블에 `data TEXT` 컬럼 추가

### 4. `app/src/services/ApiService.js`
- `uploadMonsters(db)` 메서드 추가
  - 로컬 monsters 중 `serverId`가 없는 것을 서버에 업로드
  - 업로드 성공 시 로컬 DB에 serverId 저장

### 5. `app/src/main.js`
- 동기화 순서 변경: 로컬→서버 업로드 먼저 실행, 그 다음 서버→로컬 다운로드

## D1 마이그레이션 필요
기존 운영 DB에 아래 ALTER TABLE 실행 필요:
```sql
ALTER TABLE monsters ADD COLUMN data TEXT;
```

## 검증 방법
- wrangler d1 execute로 ALTER TABLE 실행 후 monsters 테이블 확인
- 앱에서 문제 등록 후 서버 DB 조회로 data 필드 저장 확인
- 로그인 시 serverId 없는 몬스터가 자동 업로드되는지 확인
