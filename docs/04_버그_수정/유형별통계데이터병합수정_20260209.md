# 유형별 통계 데이터 병합 수정

## 날짜: 2026-02-09

## 문제
통계 화면(Tab 1)의 "과목별 문제유형 상세" 섹션에 유형별 데이터가 표시되지 않음.

### 근본 원인
1. 사진 등록 몬스터(Gemini/수동)는 `topic` 필드가 비어있음 → 유형 통계에서 완전히 누락
2. `monster.stats`는 BattleManager에서 업데이트되지 않아 항상 0
3. 런의 `correctByTopic`/`wrongByTopic`도 topic이 없는 몬스터는 기록 안됨
4. 결과적으로 `subjectTopics`가 항상 비어있어 유형별 섹션이 렌더링되지 않음

## 수정 파일
- `app/src/game/StatsManager.js`
- `app/src/game/BattleManager.js`

## 수정 내용

### 1. StatsManager.inferTopic() 정적 메서드 추가
문제 텍스트에서 유형을 자동 추론하는 키워드 매칭 함수:
- **수학**: 부등식, 인수분해, 이차방정식, 함수, 수열, 확률, 도형, 비율/퍼센트, 분수 계산, 일차방정식(기본값)
- **과학**: 유전, 세포, 전자기, 몰과 반응식, 화학반응, 힘과 운동, 역학, 지구과학, 힘과 운동(기본값)
- topic이 이미 있으면 그대로 반환

### 2. StatsManager.aggregateStats() - 3단계 데이터 구축
1. **defeatedMonsters 기반**: 런의 처치 몬스터 ID로 역조회 → `inferTopic()`으로 유형 추론 → 카운트
2. **correctByTopic/wrongByTopic 병합**: 런 기반 정확한 데이터로 `Math.max()` 보정
3. **KNOWN_TOPIC_SUBJECTS 정적 매핑**: 알려진 토픽의 과목 폴백

### 3. BattleManager - 실시간 유형 추론
- 정답/오답 기록 시 `monster.topic`이 없으면 `StatsManager.inferTopic(monster)`로 추론
- 이후 런부터 `correctByTopic`/`wrongByTopic`에 정확한 유형 데이터 기록

## 동작 원리
- 기존 런: `defeatedMonsters` + 몬스터 역조회 + `inferTopic()`으로 유형 추론
- 새 런: BattleManager에서 실시간으로 유형 추론하여 정확한 정답/오답 카운트 기록
- 두 데이터 소스 중 더 큰 값 채택 (`Math.max`)

## 검증
- Vite 프로덕션 빌드 성공
