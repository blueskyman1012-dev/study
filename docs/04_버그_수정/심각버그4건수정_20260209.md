# 심각 버그 4건 수정

## 날짜
2026-02-09

## 수정 내용

### Bug #1: gameLoop 중복 실행 방지
**파일**: `app/src/main.js`
**문제**: 로그아웃 후 재로그인 시 `gameLoop()`에 종료 조건이 없어 이전 루프가 계속 실행되면서 인스턴스가 누적됨. CPU 사용량 증가, 렌더링 깜빡임 발생.
**수정**:
- `_animFrameId` 필드 추가하여 requestAnimationFrame ID 추적
- `logout()` 시 `cancelAnimationFrame()`으로 기존 루프 중지
- `showGame()` 재호출 시에도 기존 루프 중지 후 재시작

### Bug #2: 이벤트 리스너 중복 등록 방지
**파일**: `app/src/main.js`
**문제**: `setupEvents()`에서 익명함수로 등록된 리스너가 `showGame()` 재호출(재로그인)마다 누적됨. removeEventListener 불가능한 구조.
**수정**:
- `_eventsSetup` 플래그 추가하여 최초 1회만 등록
- 239행의 중복 resize 리스너 제거 (setupEvents 내 resize에 `_updateButtonLayout()` 통합)

### Bug #3: RegisterScreen 매 프레임 Image 생성 방지
**파일**: `app/src/game/screens/RegisterScreen.js`, `app/src/game/RegisterManager.js`, `app/src/game/Game.js`
**문제**: `previewImageLoaded`가 `true`가 될 때까지 매 프레임(매 render 호출마다) `new Image()`를 생성하고 base64 데이터를 src에 할당. 카메라 이미지가 수 MB일 경우 극심한 프레임드랍/앱 멈춤 발생.
**수정**:
- `_previewImageLoading` 플래그 추가하여 이미지 로딩 중 중복 생성 차단
- RegisterManager 생성자, startRegister(), completeRegister()에서 플래그 리셋
- Game.js에 프록시 getter/setter 추가
- onerror 핸들러도 추가하여 로딩 실패 시 플래그 리셋

### Bug #4: Renderer.init() 사용자 설정 강제 초기화 제거
**파일**: `app/src/canvas/Renderer.js`
**문제**: `init()` 호출 시 `bg_theme`, `ui_opacity`, `bg_image`를 매번 기본값으로 리셋. 사용자가 상점에서 구매한 배경 테마, 조정한 투명도가 새로고침/재로그인마다 소실됨.
**수정**:
- 강제 초기화 코드(`safeSetItem('bg_theme', 'default')` 등) 제거
- 대신 `_loadBgTheme()`, `_loadUiOpacity()`로 저장된 사용자 설정 복원
- 배경 이미지도 `safeGetItem('bg_image')`에서 복원
