# 오답헌터 업데이트 내역 (2026-02-02)

## 1. iOS 대화상자 숨기기 오류 수정
- 네이티브 `alert`/`confirm`/`prompt`를 HTML 커스텀 모달로 전면 교체
- `Game.js`에 `showModal()`, `showConfirm()`, `showPrompt()` 메서드 추가 (Promise 기반)
- `Game.js`, `BattleManager.js`, `ShopManager.js`, `main.js` 내 모든 호출 교체
- iOS Safari에서 "대화상자 숨기기" 옵션이 더 이상 발생하지 않음

## 2. 몬스터 이름 문제 연관 수정
- `MonsterManager._assignMonsterAppearance()`에서 문제의 주제/키워드를 몬스터 이름 앞에 붙이도록 변경
- `_extractNamePrefix()` 헬퍼 추가로 문제에서 키워드 추출
- 보스 이름에도 주제 접두어 포함

## 3. 보스 이름 색상 구분
- 일반 보스: 빨간색 (`#ff0000`)
- 중간 보스: 보라색 (`#9932cc`)
- 최종 보스: 진한 빨간색 (`#8b0000`)
- `BattleScreen.js`에서 `bossType`에 따라 색상 분기 처리

## 4. 레벨 100 시스템
- `constants.js`: `maxLevel=100`, `displayMaxLevel=99`
- UI에서는 최대 레벨 99로 표시, 실제로는 100까지 달성 가능
- 레벨 100 보너스: 공격력+10, 체력+10, 시간+15
- `PlayerManager`에 보너스 계산 로직 추가
- `MainScreen`, `BattleScreen`에서 레벨 100일 때 금색 "MAX" 표시

## 5. 숨겨진 업적 (레벨 100)
- `constants.js`에 `level_100` 업적 추가 (`hidden: true`, 보상 10,000G)
- `AchievementManager`에서 레벨 100 달성 시 자동 해금
- `AchievementScreen`에서 미해금 시 "❓ ??? — 숨겨진 업적" 표시, 해금 시 금색 테두리

## 6. 업적 표시 불일치 수정
- `kills_50`/`kills_100`/`kills_500` 업적 이름과 실제 조건이 불일치하던 문제 수정
- 4개 국어(한/영/일/중) 모두 올바른 수치로 수정

## 7. 상점 스크롤 + 랜덤 배경 (색상 테마)
- 상점 화면을 고정 레이아웃에서 스크롤 가능한 긴 레이아웃으로 변경 (카드 높이 80px 고정)
- 마우스 휠, 방향키(↑↓), 터치 스크롤 지원
- 고정 헤더 + 스크롤 인디케이터 바
- `Renderer.js`에 7개 배경 색상 테마 추가 (default, emerald, crimson, amber, violet, cyan, rose)
- `setRandomBgTheme()`: localStorage 저장, 오프스크린 캔버스 캐시 갱신
- 상점 소비 아이템에 "랜덤 배경" (1G) 추가 — 구매 시 색상 테마 랜덤 변경

## 8. 숨겨진 상점 아이템: 랜덤 배경2 (이미지 배경)
- `constants.js`에 `randomBg2` 추가 (2G, `hidden: true`)
- 상점 화면 하단에 숨겨진 보라색 카드로 배치 — 스크롤해야만 보임
- `Renderer.js`에 이미지 배경 시스템 추가:
  - `loadBgImageList()`: `/background/list.json`에서 이미지 목록 로드
  - `setRandomBgImage()`: 랜덤 이미지 선택 후 배경 설정
  - `_loadBgImage()`: Image 객체 로드
  - `clear()`에서 이미지 배경 + 40% 어두운 오버레이 렌더링
- `app/public/background/` 폴더에 이미지 파일 및 `list.json` 관리
- localStorage에 저장되어 새로고침 후에도 유지
- 랜덤 배경1 구매 시 이미지 배경 해제 → 색상 테마로 복귀

## 9. 상점 오답등록 버튼 겹침 버그 수정
- `changeScreen()` 시 HTML 오답등록 버튼(`#register-btn`)을 즉시 숨기도록 수정
- 메인 화면이 아닌 경우 `visible` 클래스 제거 → 캔버스 클릭이 정상 동작

## 10. 업적 & 일일 미션 시스템
- `AchievementManager.js` 신규 작성: 업적 해금/보상, 일일미션 생성/추적/보상
- 날짜 기반 시드로 10개 풀에서 3개 일일미션 선택
- 미션 이벤트 추적: correctAnswer, monsterDefeated, combo, dungeonClear, goldEarned, totalAnswers
- `AchievementScreen.js` 신규 작성: 업적 목록 + 일일미션 카드 UI

## 11. 업적 진척도 표시
- 업적 카드에 진행률 바 + 퍼센트 표시 추가
- 카테고리별 필터링 (전체/전투/수집/도전/파워)

## 12. 신규 유저 가이드
- 첫 접속 시 4페이지 캔버스 오버레이 가이드 표시
- 페이지별 게임 조작법 안내, 탭으로 넘기기
- localStorage에 가이드 완료 여부 저장

## 13. 과학 던전 + 던전 선택 화면
- 던전 입장 → 던전 선택 화면(수학/과학) → 전투 흐름으로 변경
- `DungeonSelectScreen.js` 신규 작성
- 과학 문제 AI 생성 (중+고 혼합)
- 능력치 공유, 문제와 몬스터 이름만 던전별 차이

## 14. 유저 통계 화면
- `StatsScreen.js` 신규 작성: 과목별 정답률, 난이도 분석, 플레이 기록
- D1 클라우드 동기화 연동

## 15. 통계 동기화 + 로비 UI 윤곽선
- 통계 데이터 D1 서버 동기화
- 메인 화면 버튼에 윤곽선 스타일 적용

## 16. 런/보스 업적 + 경험치 보상
- 런 클리어, 보스 처치 관련 업적 추가
- 업적 보상에 경험치(EXP) 지급 추가

## 17. 성능 최적화 패치
- 오프스크린 캔버스 캐싱으로 그리드 렌더링 최적화
- `vite.config.js`에 `esbuild: { drop: ['console', 'debugger'] }` 적용
- 불필요한 리렌더링 제거

## 18. 아이폰 설정화면 버튼 안 눌림 수정
- 설정 화면 스크롤 + 클릭 영역 충돌 문제 해결
- `handleInput`에서 클릭 좌표에 스크롤 오프셋 적용 시 헤더(y<60) 제외

## 19. 주간 미션 + 미션 보상 경험치 전환
- `WEEKLY_MISSIONS` 상수 추가 (10개 풀, 3개 선택, ISO 주차 기반 리셋)
- 일일미션 보상을 골드 → 골드+경험치 혼합으로 변경 (3단계 난이도 밸런스)
- 주간미션에도 골드+경험치 혼합 보상
- 업적 화면에 주간미션 섹션 추가 (보라색 테마)

## 20. 공격력/체력 업적 추가
- 공격력 100 달성 시 공격력+1 업적 (`damage_100`)
- 체력 500 달성 시 체력+1 업적 (`hp_500`)
- `PlayerManager`의 `getTotalDamage()`, `getTotalMaxHp()`에 업적 보너스 반영
- 상점 업그레이드 구매 시 자동 체크

## 21. UI 투명도 설정
- 설정 화면에서 슬라이더로 UI 투명도 조절 (10%~100%)
- `Renderer.js`에 `applyUiOpacity()`/`resetOpacity()` 추가
- 전투/결과 화면은 가독성을 위해 항상 100%
- HTML 요소(오답등록 버튼, 로그아웃 버튼)에도 투명도 적용
- 슬라이더 드래그 지원 (터치/마우스 모두)
- -/+ 버튼으로 10% 단위 조절

## 22. 다국어 지원 (i18n)
- 한국어, 영어, 일본어, 중국어(간체/번체) 5개 언어 지원
- `i18n.js` 번역 시스템 구현
- 모든 UI 텍스트 번역 키 적용

---

## 수정된 파일 목록
| 파일 | 주요 변경 |
|------|-----------|
| `Game.js` | 모달, 화면전환, 스크롤, 드래그 슬라이더, UI 투명도 |
| `BattleManager.js` | alert/confirm → 모달 교체 |
| `ShopManager.js` | 모달 교체, randomBg/randomBg2, 업적 체크 |
| `PlayerManager.js` | 레벨 100 보너스, 업적 보너스 스탯 |
| `MonsterManager.js` | 몬스터 이름 키워드 접두어 |
| `AchievementManager.js` | 업적 해금, 일일/주간 미션, 파워 업적 |
| `Renderer.js` | 배경 테마, 이미지 배경, UI 투명도 |
| `ShopScreen.js` | 스크롤 레이아웃, 숨겨진 아이템 |
| `BattleScreen.js` | 보스 이름 색상, 레벨 MAX 표시 |
| `MainScreen.js` | 레벨 100 MAX 표시 |
| `AchievementScreen.js` | 업적 진척도, 일일/주간 미션, 카테고리 필터 |
| `SettingsScreen.js` | UI 투명도 슬라이더, 드래그 지원 |
| `DungeonSelectScreen.js` | 던전 선택 화면 (신규) |
| `StatsScreen.js` | 유저 통계 화면 (신규) |
| `constants.js` | 레벨, 업적, 상점, 일일/주간 미션 |
| `i18n.js` | 5개 국어 번역 키 |
| `main.js` | 스크롤, 모달, 마우스 드래그, 터치 X좌표 전달 |
| `style.css` | 오답등록 버튼 CSS |
| `public/background/` | 배경 이미지 파일 + list.json |
