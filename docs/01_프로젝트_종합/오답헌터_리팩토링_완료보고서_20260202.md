# 오답헌터 코드 리팩토링 완료 보고서

## 작업일: 2026-02-02

---

## 1. 파일 분리 결과

### 기존 구조
- `Game.js` 단일 파일 (3,487줄)

### 리팩토링 후 구조
```
app/src/game/
├── Game.js               (메인 컨트롤러 - 초기화, render, 화면전환, 등록, 데이터관리)
├── EffectSystem.js        (파티클, 플로팅텍스트, 화면흔들림, 플래시)
├── BattleManager.js       (전투 로직 - 정답/오답, 데미지, 타이머, 콤보, 힌트)
├── MonsterManager.js      (몬스터 선택, 보스, 난이도, AI문제생성)
├── PlayerManager.js       (레벨, 경험치, 스탯 계산, 저장)
├── ShopManager.js         (상점 구매 로직 - 통일된 가격 함수)
├── ItemManager.js         (아이템 드랍, 효과 적용)
└── screens/
    ├── MainScreen.js      (메인 화면 렌더링)
    ├── BattleScreen.js    (전투 화면 렌더링)
    ├── ResultScreen.js    (결과 화면)
    ├── ShopScreen.js      (상점 화면)
    ├── SettingsScreen.js  (설정 화면)
    └── RegisterScreen.js  (오답 등록 화면)
```

---

## 2. 버그 수정 내역

| # | 버그 | 수정 내용 |
|---|------|-----------|
| 1 | 플로팅 텍스트 속성 불일치 (line 2493) | `life: 1.2` → `life: 1200`, `vy: -1.5` → `speed: 1.5` + `maxLife`, `alpha`, `scale` 추가 |
| 2 | 결과 화면 `/10` 하드코딩 (line 1064) | `${GAME_CONFIG.STAGES_PER_DUNGEON}` 사용 |
| 3 | `this.player.upgrades` → `permanentUpgrades` (line 3062) | `player.permanentUpgrades` 올바른 필드명 사용 |
| 4 | `GAME_CONFIG.DEFAULT_TIME` 참조 | constants.js에 존재 (60), 정상 참조하도록 수정 |
| 5 | 레벨업 시 `playClick` → `playLevelUp` (line 349) | `SoundService.playLevelUp()` 올바른 효과음 호출 |
| 6 | 상점 가격 표시/실제 불일치 (line 1472 vs 1617) | `ShopManager.getUpgradePrice()` 통일 함수로 해결 |
| 7 | 아이템 드랍 revive가 런에만 저장 (line 2853) | `player.inventory.reviveTicket`에 직접 추가 |
| 8 | 스킵 시 문제 안 바뀜 (line 2990) | `selectNextQuestion()` 호출 추가 |
| 9 | 시간초과 시 문제 안 바뀜 (line 2681) | `selectNextQuestion()` 호출 추가 |
| 10 | 몬스터 처치 시 영구 삭제 (line 2739) | `status: 'cleared'` 사용, 런 클리어 시 alive로 복구 |

---

## 3. 삭제된 불필요 코드

- `captureImage()` - main.js에서 카메라 처리하므로 Game에서 중복
- `runOcr()` - Tesseract OCR 미사용 (AI API로 대체됨)
- `showOcrLoading()` - OCR 로딩 화면 (미사용)

---

## 4. 빌드 검증

- `npx vite build` 성공 (경고/에러 없음)
- 24 modules 변환 완료
- 번들 크기: 92.37 kB (gzip: 30.06 kB)

---

## 5. 변경되지 않은 파일

- `canvas/Renderer.js` - 변경 없음
- `services/` (SoundService, GeminiService, ImageAnalysisService, ProblemGeneratorService) - 변경 없음
- `data/Database.js` - 변경 없음
- `utils/constants.js` - 변경 없음
- `main.js` - 변경 없음
- `style.css` - 변경 없음
